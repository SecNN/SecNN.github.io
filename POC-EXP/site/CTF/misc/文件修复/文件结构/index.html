<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/CTF/misc/%E6%96%87%E4%BB%B6%E4%BF%AE%E5%A4%8D/%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/">
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>文件结构 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\u6587\u4ef6\u7ed3\u6784", url: "#_top", children: [
              {title: "\u5173\u4e8e", url: "#_2" },
              {title: "\u6587\u4ef6\u7f72\u540d\u57df", url: "#_3" },
              {title: "\u6570\u636e\u5757", url: "#_4" },
              {title: "\u5173\u952e\u6570\u636e\u5757", url: "#_5" },
              {title: "\u7efc\u5408\u56fe\u8868", url: "#_6" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%E6%A0%87%E8%AF%86%E4%BF%AE%E5%A4%8D/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%E6%A0%87%E8%AF%86%E4%BF%AE%E5%A4%8D/" class="btn btn-xs btn-link">
        标识修复
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/%E9%99%84%E5%8A%A0%E5%BC%8F%E9%9A%90%E5%86%99/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/%E9%99%84%E5%8A%A0%E5%BC%8F%E9%9A%90%E5%86%99/" class="btn btn-xs btn-link">
        附加式隐写
      </a>
    </div>
    
  </div>

    

    <h1 id="_1">文件结构<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">关于<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>每一个类型的文件都有自己的结构和特性，通过附加式隐写中的原理我们可以得知 操作系统识别的过程中是，从文件头标志，到文件的结束标志位，当系统识别到图片的结束标志位后，则默认不再继续识别。所以，对于计算机来说文件的结构影响着对文件的属性判断，在CTF中也有针对文件结构的一些题目，例如PNG文件修改宽高，文件头缺失修复等。</p>
<h2 id="_3">文件署名域<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>文件的前8字节为文件的署名域，例如PNG的十六进制值为:</p>
<div class="highlight"><pre><span></span><code><span class="mi">89</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="mf">0d</span><span class="w"> </span><span class="mi">0</span><span class="n">a</span><span class="w"> </span><span class="mi">1</span><span class="n">a</span><span class="w"> </span><span class="mi">0</span><span class="n">a</span><span class="w"> </span>
</code></pre></div>
<p>我们使用工具打开任意一张PNG可以发现这个位置的结构</p>
<p><img alt="img" src="../../../.vuepress/public/img/1667876895336-a4686af4-451b-448e-9636-c4ab223b23c6.png" /></p>
<h2 id="_4">数据块<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>数据块分为两种: 关键数据块与辅助数据块，每个数据块都由4个域组成</p>
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>字节数</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Length(长度)</td>
<td>4字节</td>
<td>指定数据块中数据域的长度，其长度不超过(231−1)(231−1)字节</td>
</tr>
<tr>
<td>Chunk Type Code(数据块类型码)</td>
<td>4字节</td>
<td>数据块类型码由ASCII字母(A-Z和a-z)组成</td>
</tr>
<tr>
<td>Chunk Data(数据块实际内容</td>
<td>可变长度</td>
<td>存储按照Chunk Type Code指定的数据</td>
</tr>
<tr>
<td>CRC(循环冗余检测</td>
<td>4字节</td>
<td>存储用来检测是否有错误的循环冗余码</td>
</tr>
</tbody>
</table>
<p>一个4字节的CRC（循环冗余校验）计算，在所述块的前面的字节，包括该块类型的代码和数据块的数据字段，但是不包括长度字段。 CRC始终存在，即使不包含数据块。 CRC的值为 Chunk Type Code域和Chunk Data域中的数据进行计算，有时会通过检验CRC来验证文件是否被修改过。</p>
<h2 id="_5">关键数据块<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th><strong>数据块符号</strong></th>
<th><strong>数据块名称</strong></th>
<th><strong>多数据块</strong></th>
<th><strong>是否可选</strong></th>
<th><strong>位置限制</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>IHDR</td>
<td>文件头数据块</td>
<td>否</td>
<td>否</td>
<td>第一块</td>
</tr>
<tr>
<td>PLTE</td>
<td>调色板数据块</td>
<td>否</td>
<td>是</td>
<td>在IDAT之前</td>
</tr>
<tr>
<td>IDAT</td>
<td>图像数据块</td>
<td>是</td>
<td>否</td>
<td>与其他IDAT连续</td>
</tr>
<tr>
<td>IEND</td>
<td>图像结束数据</td>
<td>否</td>
<td>否</td>
<td>最后一个数据块</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="n">IHDR</span><span class="err">：</span><span class="n">文件头数据块IHDR</span><span class="p">(</span><span class="n">header</span><span class="w"> </span><span class="n">chunk</span><span class="p">)</span><span class="err">：</span><span class="n">它包含有PNG文件中存储的图像数据的基本信息</span><span class="err">，</span><span class="n">并要作为第一个数据块出现在PNG数据流中</span><span class="err">，</span><span class="n">而且一个PNG数据流中只能有一个文件头数据块</span><span class="err">。</span>
<span class="n">PLTE</span><span class="err">：</span><span class="n">调色板数据块PLTE</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="n">chunk</span><span class="p">)</span><span class="n">包含有与索引彩色图像</span><span class="p">(</span><span class="n">indexed</span><span class="o">-</span><span class="n">color</span><span class="w"> </span><span class="n">image</span><span class="p">)</span><span class="n">相关的彩色变换数据</span><span class="err">，</span><span class="n">它仅与索引彩色图像有关</span><span class="err">，</span><span class="n">而且要放在图像数据块</span><span class="p">(</span><span class="n">image</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">chunk</span><span class="p">)</span><span class="n">之前</span><span class="err">。</span><span class="n">PLTE数据块是定义图像的调色板信息</span><span class="err">，</span><span class="n">PLTE可以包含1</span><span class="o">~</span><span class="mi">256</span><span class="n">个调色板信息</span><span class="err">，</span><span class="n">每一个调色板信息由3个字节组成</span><span class="err">。</span>
<span class="n">IDAT</span><span class="err">：</span><span class="n">图像数据块IDAT</span><span class="p">(</span><span class="n">image</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">chunk</span><span class="p">)</span><span class="err">：</span><span class="n">它存储实际的数据</span><span class="err">，</span><span class="n">在数据流中可包含多个连续顺序的图像数据块</span><span class="err">。</span><span class="n">IDAT存放着图像真正的数据信息</span><span class="err">，</span><span class="n">因此</span><span class="err">，</span><span class="n">如果能够了解IDAT的结构</span><span class="err">，</span><span class="n">我们就可以很方便的生成PNG图像</span><span class="err">。</span>
<span class="n">IEND</span><span class="err">：</span><span class="n">图像结束数据IEND</span><span class="p">(</span><span class="n">image</span><span class="w"> </span><span class="n">trailer</span><span class="w"> </span><span class="n">chunk</span><span class="p">)</span><span class="err">：</span><span class="n">它用来标记PNG文件或者数据流已经结束</span><span class="err">，</span><span class="n">并且必须要放在文件的尾部</span><span class="err">。</span><span class="n">如果我们仔细观察PNG文件</span><span class="err">，</span><span class="n">我们会发现</span><span class="err">，</span><span class="n">文件的结尾12个字符看起来总应该是这样的</span><span class="err">：</span><span class="mo">000000004</span><span class="mi">9454</span><span class="n">E44AE426082</span><span class="err">，</span><span class="n">不难明白</span><span class="err">，</span><span class="n">由于数据块结构的定义</span><span class="err">，</span><span class="n">IEND数据块的长度总是0</span><span class="err">（</span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="w"> </span><span class="mo">00</span><span class="err">，</span><span class="n">除非人为加入信息</span><span class="err">），</span><span class="n">数据标识总是IEND</span><span class="err">（</span><span class="mi">49</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="mi">4</span><span class="n">E</span><span class="w"> </span><span class="mi">44</span><span class="err">），</span><span class="n">因此</span><span class="err">，</span><span class="n">CRC码也总是AE</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">82</span>
</code></pre></div>
<h2 id="_6">综合图表<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th><strong>数据块符号</strong></th>
<th><strong>数据块名称</strong></th>
<th><strong>多数据块</strong></th>
<th><strong>可选否</strong></th>
<th><strong>位置限制</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>IHDR</td>
<td>文件头数据块</td>
<td>否</td>
<td>否</td>
<td>第一块</td>
</tr>
<tr>
<td>cHRM</td>
<td>基色和白色点数据块</td>
<td>否</td>
<td>是</td>
<td>在PLTE和IDAT之前</td>
</tr>
<tr>
<td>gAMA</td>
<td>图像γ数据块</td>
<td>否</td>
<td>是</td>
<td>在PLTE和IDAT之前</td>
</tr>
<tr>
<td>sBIT</td>
<td>样本有效位数据块</td>
<td>否</td>
<td>是</td>
<td>在PLTE和IDAT之前</td>
</tr>
<tr>
<td>PLTE</td>
<td>调色板数据块</td>
<td>否</td>
<td>是</td>
<td>在IDAT之前</td>
</tr>
<tr>
<td>bKGD</td>
<td>背景颜色数据块</td>
<td>否</td>
<td>是</td>
<td>在PLTE之后IDAT之前</td>
</tr>
<tr>
<td>hIST</td>
<td>图像直方图数据块</td>
<td>否</td>
<td>是</td>
<td>在PLTE之后IDAT之前</td>
</tr>
<tr>
<td>tRNS</td>
<td>图像透明数据块</td>
<td>否</td>
<td>是</td>
<td>在PLTE之后IDAT之前</td>
</tr>
<tr>
<td>oFFs</td>
<td>(专用公共数据块)</td>
<td>否</td>
<td>是</td>
<td>在IDAT之前</td>
</tr>
<tr>
<td>pHYs</td>
<td>物理像素尺寸数据块</td>
<td>否</td>
<td>是</td>
<td>在IDAT之前</td>
</tr>
<tr>
<td>sCAL</td>
<td>(专用公共数据块)</td>
<td>否</td>
<td>是</td>
<td>在IDAT之前</td>
</tr>
<tr>
<td>IDAT</td>
<td>图像数据块</td>
<td>是</td>
<td>否</td>
<td>与其他IDAT连续</td>
</tr>
<tr>
<td>tIME</td>
<td>图像最后修改时间数据块</td>
<td>否</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>tEXt</td>
<td>文本信息数据块</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>zTXt</td>
<td>压缩文本数据块</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>fRAc</td>
<td>(专用公共数据块)</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>gIFg</td>
<td>(专用公共数据块)</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>gIFt</td>
<td>(专用公共数据块)</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>gIFx</td>
<td>(专用公共数据块)</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>IEND</td>
<td>图像结束数据</td>
<td>否</td>
<td>否</td>
<td>最后一个数据块</td>
</tr>
</tbody>
</table>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%E6%A0%87%E8%AF%86%E4%BF%AE%E5%A4%8D/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%E6%A0%87%E8%AF%86%E4%BF%AE%E5%A4%8D/" class="btn btn-xs btn-link">
        标识修复
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/%E9%99%84%E5%8A%A0%E5%BC%8F%E9%9A%90%E5%86%99/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/%E9%99%84%E5%8A%A0%E5%BC%8F%E9%9A%90%E5%86%99/" class="btn btn-xs btn-link">
        附加式隐写
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>