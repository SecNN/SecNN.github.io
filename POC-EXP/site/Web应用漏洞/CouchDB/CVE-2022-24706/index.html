<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/CouchDB/CVE-2022-24706/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>CouchDB Erlang distribution Remote Command Execution (CVE-2022-24706) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "CouchDB Erlang distribution Remote Command Execution (CVE-2022-24706)", url: "#_top", children: [
              {title: "Vulnerability Environment", url: "#vulnerability-environment" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        CouchDB Erlang 分布式协议代码执行 (CVE-2022-24706)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2017-12636/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2017-12636/README.zh-cn/" class="btn btn-xs btn-link">
        Couchdb 任意命令执行漏洞（CVE-2017-12636）
      </a>
    </div>
    
  </div>

    

    <h1 id="couchdb-erlang-distribution-remote-command-execution-cve-2022-24706">CouchDB Erlang distribution Remote Command Execution (CVE-2022-24706)<a class="headerlink" href="#couchdb-erlang-distribution-remote-command-execution-cve-2022-24706" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Apache CouchDB is an open-source document-oriented NoSQL database, implemented in Erlang.</p>
<p>Apache CouchDB is written in Erlang and so it has built-in support for distributed computing (clustering). The cluster nodes communicate using the Erlang/OTP Distribution Protocol, which provides for the possibility of executing OS command requests as the user running the software.</p>
<p>In order to connect and run OS commands, one needs to know the secret phrase or in Erlang terms the "cookie". The CouchDB installer in versions 3.2.1 and below, by default, sets the cookie to "monster".</p>
<p>References:</p>
<ul>
<li><a href="https://docs.couchdb.org/en/3.2.2-docs/cve/2022-24706.html">https://docs.couchdb.org/en/3.2.2-docs/cve/2022-24706.html</a></li>
<li><a href="https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/">https://insinuator.net/2017/10/erlang-distribution-rce-and-a-cookie-bruteforcer/</a></li>
<li><a href="https://github.com/rapid7/metasploit-framework/blob/master//modules/exploits/multi/misc/erlang_cookie_rce.rb">https://github.com/rapid7/metasploit-framework/blob/master//modules/exploits/multi/misc/erlang_cookie_rce.rb</a></li>
<li><a href="https://github.com/sadshade/CVE-2022-24706-CouchDB-Exploit">https://github.com/sadshade/CVE-2022-24706-CouchDB-Exploit</a></li>
</ul>
<h2 id="vulnerability-environment">Vulnerability Environment<a class="headerlink" href="#vulnerability-environment" title="Permanent link">&para;</a></h2>
<p>Execute following command to start a Apache CouchDB 3.2.1:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After service is started, 3 port will be listening on <code>target-ip</code>:</p>
<ul>
<li>5984: Web interface for Apache CouchDB</li>
<li>4369: Erlang port mapper daemon (epmd)</li>
<li>9100: clustered operation and runtime introspection port (command is actually executed through this port)</li>
</ul>
<p>In practice, Web interface and epmd service port is fixed, clustered operation port is random. We can accesses the EPMD service to obtain the clustered operation port number.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>We can just use <a href="poc.py">this poc</a> to exploit this vulnerability. The poc does 2 things, firstly obtain the clustered operation port from epmd service, then use default cookie to execute arbitrary commands in clusters.</p>
<div class="highlight"><pre><span></span><code>python poc.py target-ip 4369
</code></pre></div>
<p><img alt="" src="1.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        CouchDB Erlang 分布式协议代码执行 (CVE-2022-24706)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2017-12636/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2017-12636/README.zh-cn/" class="btn btn-xs btn-link">
        Couchdb 任意命令执行漏洞（CVE-2017-12636）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>