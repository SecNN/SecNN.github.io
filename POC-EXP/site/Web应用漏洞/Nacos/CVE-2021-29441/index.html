<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Nacos/CVE-2021-29441/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Nacos Authentication Bypass(CVE-2021-29441) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Nacos Authentication Bypass(CVE-2021-29441)", url: "#_top", children: [
              {title: "Vulnerable environments", url: "#vulnerable-environments" },
              {title: "Exploit Scripts", url: "#exploit-scripts" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Nacos 认证绕过漏洞（CVE-2021-29441）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Nacos%E9%BB%98%E8%AE%A4key%E5%AF%BC%E8%87%B4%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E7%99%BB%E9%99%86%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Nacos%E9%BB%98%E8%AE%A4key%E5%AF%BC%E8%87%B4%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E7%99%BB%E9%99%86%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Nacos默认key导致权限绕过登陆漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="nacos-authentication-bypasscve-2021-29441">Nacos Authentication Bypass(CVE-2021-29441)<a class="headerlink" href="#nacos-authentication-bypasscve-2021-29441" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Nacos is a new open source project launched by Alibaba. It is a dynamic service discovery, configuration management and service management platform that makes it easier to build cloud-native applications. Committed to helping discover, configure, and manage microservices. Nacos provides a set of simple and easy-to-use feature sets that can quickly realize dynamic service discovery, service configuration, service metadata and traffic management.</p>
<p>The vulnerability occurs when nacos will determine whether the requested user-agent is "Nacos-Server" when performing authentication and authorization operations, and if it is, it will not perform any authentication. The original intention of the developer is to handle some server-to-server requests. However, because the configuration is too simple, and the negotiated user-agent is set to Nacos-Server, it is directly hard-coded in the code, which leads to the emergence of loopholes. And by using this unauthorized vulnerability, an attacker can obtain sensitive information such as usernames and passwords.</p>
<p>Reference links:</p>
<ul>
<li><a href="https://github.com/advisories/GHSA-36hp-jr8h-556f">https://github.com/advisories/GHSA-36hp-jr8h-556f</a></li>
</ul>
<h2 id="vulnerable-environments">Vulnerable environments<a class="headerlink" href="#vulnerable-environments" title="Permanent link">&para;</a></h2>
<p>Running vulnerability environment：</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<p>After the environment is running, ports 3306, 8848, 9848 and 9555 will be open. In this exploit, we only need to use port 8848, which is the web access port.<strong>When executing the vulnerability verification process, please visit port 8848 first to confirm it is open. In some cases the nacos service will fail to start (caused by the inability to connect to the database), you can restart the nacos service or restart all services</strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>restart<span class="w"> </span>nacos
</code></pre></div>
<h2 id="exploit-scripts">Exploit Scripts<a class="headerlink" href="#exploit-scripts" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>poc.py<span class="w"> </span>http://target:8848
</code></pre></div>
<p><img alt="" src="poc.png" /></p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>The vulnerability exploitation process is as follows.</p>
<ol>
<li>Change the value of User-Agent to Nacos-Server in the request package</li>
<li>Visit <a href="http://target:8848/nacos/v1/auth/users?pageNo=1&amp;pageSize=9">http://target:8848/nacos/v1/auth/users?pageNo=1&amp;pageSize=9</a> to see if the status code is 200 and if the content contains <code>pageItems</code></li>
<li>Visit <a href="http://target:8848/nacos/v1/auth/users?username=vulhub&amp;password=vulhub">http://target:8848/nacos/v1/auth/users?username=vulhub&amp;password=vulhub</a> to add a new user using the POST method</li>
<li>Visit <a href="http://target:8848/nacos/v1/auth/users?pageNo=1&amp;pageSize=9">http://target:8848/nacos/v1/auth/users?pageNo=1&amp;pageSize=9</a> for a list of existing users</li>
<li>Visit <a href="http://target:8848/nacos/">http://target:8848/nacos/</a> and log in using the new user added (vulhub/vulhub)</li>
</ol>
<h3 id="detecting-the-presence-of-vulnerabilities">Detecting the presence of vulnerabilities<a class="headerlink" href="#detecting-the-presence-of-vulnerabilities" title="Permanent link">&para;</a></h3>
<p><img alt="" src="1.png" /></p>
<p>After adding the Header header, visit <code>http://target:8848/nacos/v1/auth/users?pageNo=1&amp;pageSize=9</code> to see if the return value is 200 and if the content contains <code>pageItems</code>.</p>
<h3 id="adding-a-new-user">Adding a new user<a class="headerlink" href="#adding-a-new-user" title="Permanent link">&para;</a></h3>
<p><img alt="" src="2.png" /></p>
<p>After adding the Header header use <strong>POST</strong> to request <code>http://target:8848/nacos/v1/auth/users?username=vulhub&amp;password=vulhub</code> to add a new user with the account and password of vulhub</p>
<h3 id="login-using-the-newly-created-account">Login using the newly created account<a class="headerlink" href="#login-using-the-newly-created-account" title="Permanent link">&para;</a></h3>
<p><img alt="" src="3.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Nacos 认证绕过漏洞（CVE-2021-29441）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Nacos%E9%BB%98%E8%AE%A4key%E5%AF%BC%E8%87%B4%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E7%99%BB%E9%99%86%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Nacos%E9%BB%98%E8%AE%A4key%E5%AF%BC%E8%87%B4%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E7%99%BB%E9%99%86%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Nacos默认key导致权限绕过登陆漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>