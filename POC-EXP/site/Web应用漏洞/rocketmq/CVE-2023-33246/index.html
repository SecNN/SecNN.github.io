<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/rocketmq/CVE-2023-33246/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Apache RocketMQ Broker Remote Command Execution (CVE-2023-33246) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Apache RocketMQ Broker Remote Command Execution (CVE-2023-33246)", url: "#_top", children: [
              {title: "Vulnerable environment", url: "#vulnerable-environment" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Apache RocketMQ Broker 远程命令执行漏洞（CVE-2023-33246）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../rocketchat/CVE-2021-22911/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../rocketchat/CVE-2021-22911/README.zh-cn/" class="btn btn-xs btn-link">
        Rocket Chat 前台 NoSQL 盲注漏洞（CVE-2021-22911）
      </a>
    </div>
    
  </div>

    

    <h1 id="apache-rocketmq-broker-remote-command-execution-cve-2023-33246">Apache RocketMQ Broker Remote Command Execution (CVE-2023-33246)<a class="headerlink" href="#apache-rocketmq-broker-remote-command-execution-cve-2023-33246" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>RocketMQ is a distributed messaging and streaming platform with low latency, high performance and reliability, trillion-level capacity and flexible scalability.</p>
<p>For RocketMQ versions 5.1.0 and below, under certain conditions, there is a risk of remote command execution. Several components of RocketMQ, including NameServer, Broker, and Controller, are leaked on the extranet and lack permission verification, an attacker can exploit this vulnerability by using the update configuration function to execute commands as the system users that RocketMQ is running as. Additionally, an attacker can achieve the same effect by forging the RocketMQ protocol content. To prevent these attacks, users are recommended to upgrade to version 5.1.1 or above for using RocketMQ 5.x or 4.9.6 or above for using RocketMQ 4.x.</p>
<p>References:</p>
<ul>
<li><a href="https://github.com/I5N0rth/CVE-2023-33246">https://github.com/I5N0rth/CVE-2023-33246</a></li>
<li><a href="https://github.com/Le1a/CVE-2023-33246">https://github.com/Le1a/CVE-2023-33246</a></li>
<li><a href="https://paper.seebug.org/2081/">https://paper.seebug.org/2081/</a></li>
<li><a href="https://xz.aliyun.com/news/12137">https://xz.aliyun.com/news/12137</a></li>
<li><a href="https://xz.aliyun.com/news/12035">https://xz.aliyun.com/news/12035</a></li>
</ul>
<h2 id="vulnerable-environment">Vulnerable environment<a class="headerlink" href="#vulnerable-environment" title="Permanent link">&para;</a></h2>
<p>Use following command to start a RocketMQ broker 5.1.0:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<p>After the environment is started, the RocketMQ broker will listen on port 10911.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>The vulnerability exists in the configuration update functionality of RocketMQ's Broker component. The Broker component lacks proper authentication and input validation in its configuration update interface, allowing attackers to modify configuration values.</p>
<p>What makes this vulnerability particularly dangerous is RocketMQ's filter server mechanism. Every 30 seconds, RocketMQ executes the filter server by running a shell command. This command is constructed by concatenating strings that include the <code>rocketmqHome</code> value from the configuration. Since an attacker can control this configuration value and it's used directly in command construction without proper sanitization, this leads to command injection.</p>
<p>I made a simple <a href="https://github.com/vulhub/rocketmq-attack">exploit project</a> to reproduce the vulnerability and execute arbitrary commands.</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://github.com/vulhub/rocketmq-attack/releases/download/1.0/rocketmq-attack-1.0-SNAPSHOT.jar
java<span class="w"> </span>-jar<span class="w"> </span>rocketmq-attack-1.0-SNAPSHOT.jar<span class="w"> </span>AttackBroker<span class="w"> </span>--target<span class="w"> </span>your-ip:10911<span class="w"> </span>--cmd<span class="w"> </span><span class="s2">&quot;touch /tmp/success&quot;</span>
</code></pre></div>
<p>Wait for up to 30 seconds, and you will see the <code>touch /tmp/success</code> command has been executed.</p>
<p><img alt="" src="1.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Apache RocketMQ Broker 远程命令执行漏洞（CVE-2023-33246）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../rocketchat/CVE-2021-22911/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../rocketchat/CVE-2021-22911/README.zh-cn/" class="btn btn-xs btn-link">
        Rocket Chat 前台 NoSQL 盲注漏洞（CVE-2021-22911）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>