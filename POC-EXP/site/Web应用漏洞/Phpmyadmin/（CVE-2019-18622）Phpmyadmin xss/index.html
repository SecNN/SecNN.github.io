<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Phpmyadmin/%EF%BC%88CVE-2019-18622%EF%BC%89Phpmyadmin%20xss/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2019-18622）Phpmyadmin xss - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2019-18622\uff09Phpmyadmin xss", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2020-5504%EF%BC%89Phpmyadmin%20%E5%90%8E%E5%8F%B0sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2020-5504%EF%BC%89Phpmyadmin%20%E5%90%8E%E5%8F%B0sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2020-5504）Phpmyadmin 后台sql注入漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-12616%EF%BC%89Phpmyadmin%20CSRF/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-12616%EF%BC%89Phpmyadmin%20CSRF/" class="btn btn-xs btn-link">
        （CVE-2019-12616）Phpmyadmin CSRF
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2019-18622phpmyadmin-xss">（CVE-2019-18622）Phpmyadmin xss<a class="headerlink" href="#cve-2019-18622phpmyadmin-xss" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>官方公布的是sql注入漏洞，但是实际是xss漏洞</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Phpmyadmin \&lt;=4.9.2，至少影响到4.7.7。</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">漏洞分析<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>首先看官方修复的方式：</p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId25.png" /></p>
<p>如上图，先关注/js/designer/move.js文件，可以看到单纯的修改了取值方式，最终的值通过POST
方式提交到db_desingner.php文件，关键内容如下：</p>
<div class="codehilite"><pre><span></span><code><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">_POST</span><span class="p">[</span><span class="s">&#39;dialog&#39;</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>

<span class="w">     </span><span class="p">....</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="n">_POST</span><span class="p">[</span><span class="s">&#39;dialog&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;add_table&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Pass the db and table to the getTablesInfo so we only have the table we asked for</span>
<span class="w">        </span><span class="err">$</span><span class="n">script_display_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">designerCommon</span><span class="o">-&gt;</span><span class="n">getTablesInfo</span><span class="p">(</span><span class="err">$</span><span class="n">_POST</span><span class="p">[</span><span class="s">&#39;db&#39;</span><span class="p">],</span><span class="w"> </span><span class="err">$</span><span class="n">_POST</span><span class="p">[</span><span class="s">&#39;table&#39;</span><span class="p">]);</span>
<span class="w">     </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>

<p>传到了getTablesInfo()函数中，该函数内容主要如下：</p>
<div class="codehilite"><pre><span></span><code><span class="n">public</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="n">getTablesInfo</span><span class="p">(</span><span class="err">$</span><span class="n">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">null</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="nf">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="p">.....</span>
<span class="w">        </span><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="n">tables</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="err">$</span><span class="n">one_table</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">$</span><span class="n">DF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">relation</span><span class="o">-&gt;</span><span class="n">getDisplayField</span><span class="p">(</span><span class="err">$</span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">one_table</span><span class="p">[</span><span class="s">&#39;TABLE_NAME&#39;</span><span class="p">]);</span>
<span class="w">            </span><span class="err">$</span><span class="n">DF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">is_string</span><span class="p">(</span><span class="err">$</span><span class="n">DF</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="err">$</span><span class="n">DF</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="err">$</span><span class="n">DF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="n">DF</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="err">$</span><span class="n">DF</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">null</span><span class="p">;</span>
<span class="w">            </span><span class="err">$</span><span class="n">designerTables</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DesignerTable</span><span class="p">(</span>
<span class="w">                                    </span><span class="err">$</span><span class="n">db</span><span class="p">,</span>
<span class="w">                                    </span><span class="err">$</span><span class="n">one_table</span><span class="p">[</span><span class="s">&#39;TABLE_NAME&#39;</span><span class="p">],</span>
<span class="w">                                    </span><span class="err">$</span><span class="n">one_table</span><span class="p">[</span><span class="s">&#39;ENGINE&#39;</span><span class="p">],</span>
<span class="w">                                    </span><span class="err">$</span><span class="n">DF</span>
<span class="w">                                </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="err">$</span><span class="n">designerTables</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<p>跟进getDisplayField()，内容如下：</p>
<div class="codehilite"><pre><span></span><code><span class="n">public</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">getDisplayField</span><span class="p">(</span><span class="n">$db</span><span class="p">,</span><span class="w"> </span><span class="n">$table</span><span class="p">)</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="n">$cfgRelation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">$this</span><span class="o">-&gt;</span><span class="n">getRelationsParam</span><span class="p">();</span>

<span class="w">        </span><span class="cm">/**</span>
<span class="cm">         * Try to fetch the display field from DB.</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">$cfgRelation</span><span class="err">[</span><span class="s1">&#39;displaywork&#39;</span><span class="err">]</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">$disp_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">                SELECT `display_field`</span>
<span class="s1">                FROM &#39;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">Util</span><span class="o">::</span><span class="n">backquote</span><span class="p">(</span><span class="n">$cfgRelation</span><span class="err">[</span><span class="s1">&#39;db&#39;</span><span class="err">]</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">Util</span><span class="o">::</span><span class="n">backquote</span><span class="p">(</span><span class="n">$cfgRelation</span><span class="err">[</span><span class="s1">&#39;table_info&#39;</span><span class="err">]</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">                WHERE `db_name`    = </span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">$GLOBALS</span><span class="err">[</span><span class="s1">&#39;dbi&#39;</span><span class="err">]</span><span class="o">-&gt;</span><span class="n">escapeString</span><span class="p">(</span><span class="n">$db</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;</span><span class="se">\&#39;</span>
<span class="s1">                    AND `table_name` = </span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">$GLOBALS</span><span class="err">[</span><span class="s1">&#39;dbi&#39;</span><span class="err">]</span><span class="o">-&gt;</span><span class="n">escapeString</span><span class="p">(</span><span class="n">$table</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">;</span>

<span class="w">            </span><span class="n">$row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">$GLOBALS</span><span class="err">[</span><span class="s1">&#39;dbi&#39;</span><span class="err">]</span><span class="o">-&gt;</span><span class="n">fetchSingleRow</span><span class="p">(</span>
<span class="w">                </span><span class="n">$disp_query</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ASSOC&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DatabaseInterface</span><span class="o">::</span><span class="n">CONNECT_CONTROL</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="n">$row</span><span class="err">[</span><span class="s1">&#39;display_field&#39;</span><span class="err">]</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">$row</span><span class="err">[</span><span class="s1">&#39;display_field&#39;</span><span class="err">]</span><span class="p">;</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">   </span><span class="p">....</span>
</code></pre></div>

<p>通过escapeString过滤 table 名，查看该过滤函数：</p>
<div class="codehilite"><pre><span></span><code>public function escapeString($link, $str)
    {
        return mysql_real_escape_string($str, $link);
    }
</code></pre></div>

<p>引入了mysql_real_escape_string()函数</p>
<p>这个函数类似于addslashes()函数，当编码不当的时候，可能导致宽字节注入</p>
<p>但真的那么简单吗？继续往下看</p>
<p>这里获得的table_name 参数会传入以下语句：</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`COLUMN_NAME`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Field`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`COLUMN_TYPE`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Type`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`COLLATION_NAME`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Collation`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`IS_NULLABLE`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Null`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`COLUMN_KEY`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Key`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`COLUMN_DEFAULT`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Default`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`EXTRA`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Extra`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`PRIVILEGES`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Privileges`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`COLUMN_COMMENT`</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n n-Quoted">`Comment`</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`information_schema`</span><span class="p">.</span><span class="n n-Quoted">`COLUMNS`</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n n-Quoted">`TABLE_SCHEMA`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;day1&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n n-Quoted">`TABLE_NAME`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;$table_name&#39;</span><span class="p">;</span>
</code></pre></div>

<p>这里的$table_name在
db_designer.php中可控，然而当环境准备好，语句配置好后，却出现了以下错误：</p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId26.png" /></p>
<div class="codehilite"><pre><span></span><code>JSON encoding failed: Malformed UTF-8 characters, possibly incorrectly encoded
</code></pre></div>

<p>提示是因为编码问题，因此我们重新将 payload url 编码后再传入：</p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId27.png" /></p>
<p>这次无误，查看执行的语句：</p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId28.png" /></p>
<p>%df%27并没有按照我们想法闭合单引号，到底是什么原因呢？</p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId29.png" /></p>
<p>在数据库连接的时候，phpmyadmin会将默认的字符格式设置为
utf8mb4，而我们宽字节注入必须要求编码为g
bk，因此其实这里不存在宽字节注入。</p>
<p>说明这里的修复对SQL
漏洞并无多大关系（其实从修复文件上看，就知道了），继续看下一处修复。</p>
<div class="codehilite"><pre><span></span><code>/templates/database/designer/database_tables.twig处
</code></pre></div>

<p>diff 如下：</p>
<div class="codehilite"><pre><span></span><code><span class="x">-                    </span><span class="cp">{{</span> <span class="nv">designerTable.getTableName</span><span class="o">()|</span><span class="nf">raw</span> <span class="cp">}}</span>
<span class="x">+                    </span><span class="cp">{{</span> <span class="nv">designerTable.getTableName</span><span class="o">()</span> <span class="cp">}}</span>
</code></pre></div>

<p>可以看到，唯一的差别就是删除了|raw，这种写法是Twig模板语言的写法，raw
的作用就是让数据在 autoescape过滤器里失效，可以安装一个 twig
模板看看实例。</p>
<div class="codehilite"><pre><span></span><code>composer require &quot;twig/twig:^3.0&quot;
</code></pre></div>

<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId30.png" /></p>
<p>运行命令后该目录下会生成2个文件：composer.json、composer.lock以及一个目录vendor</p>
<p>然后在同目录下创建文件夹templates、tmp</p>
<p>进入templates目录下创建index.html.twig文件，内容如下</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>twig<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>test<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
 <span class="cp">{{</span> <span class="nv">name</span> <span class="o">|</span><span class="nf">raw</span><span class="cp">}}</span>
<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>根目录下创建index.php，内容如下：</p>
<div class="codehilite"><pre><span></span><code><span class="n">require_once</span><span class="w"> </span><span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>

<span class="o">$</span><span class="n">loader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span>\<span class="n">Twig</span>\<span class="n">Loader</span>\<span class="n">FilesystemLoader</span><span class="p">(</span><span class="s1">&#39;templates&#39;</span><span class="p">);</span>
<span class="o">$</span><span class="n">twig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span>\<span class="n">Twig</span>\<span class="n">Environment</span><span class="p">(</span><span class="o">$</span><span class="n">loader</span><span class="p">,</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s1">&#39;cache&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;/Library/WebServer/Documents/twig/tmp&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="n">twig</span><span class="o">-&gt;</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;index.html.twig&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">&#39;panda</span><span class="se">\&#39;</span><span class="s1"> union select 1,2, from a&#39;</span><span class="p">]);</span>
</code></pre></div>

<p>访问index.php可以发现：</p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId31.png" /></p>
<p>单引号被转义成了实体字符</p>
<p>修复的 SQL 漏洞点在这里吗？</p>
<p>并不是。这里修复的仅仅是前端显示字符串的问题，与后端的 sql
注入也并无关系。</p>
<p>前文中提到的move.js修复的也是前端的内容，其实也和后端的 sql
注入并无关系。</p>
<p>那么这个修复方式和 sql 注入到底是什么关系呢？</p>
<p>可能没关系吧。</p>
<p>考虑到该修复内容全部为前端的内容，于是将表名改为 XSS 的 payload：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;script&gt;</span>alert(0)<span class="nt">&lt;/script&gt;</span>
</code></pre></div>

<p>果然，和当初想的一样，触发了 XSS 漏洞。</p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId32.png" /></p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId33.png" /></p>
<p>然后看v4.9.2版本的 phpmyadmin：</p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId34.png" /></p>
<p><img alt="" src="../resource/%28CVE-2019-18622%29Phpmyadminxss/media/rId35.png" /></p>
<p>转义成实体字符，无法触发 XSS</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2020-5504%EF%BC%89Phpmyadmin%20%E5%90%8E%E5%8F%B0sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2020-5504%EF%BC%89Phpmyadmin%20%E5%90%8E%E5%8F%B0sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2020-5504）Phpmyadmin 后台sql注入漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-12616%EF%BC%89Phpmyadmin%20CSRF/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-12616%EF%BC%89Phpmyadmin%20CSRF/" class="btn btn-xs btn-link">
        （CVE-2019-12616）Phpmyadmin CSRF
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>