<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/httpd/apache_parsing_vulnerability/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Apache HTTPD Multiple Extension Parsing Vulnerability - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Apache HTTPD Multiple Extension Parsing Vulnerability", url: "#_top", children: [
              {title: "Environment Setup", url: "#environment-setup" },
              {title: "Vulnerability Reproduction", url: "#vulnerability-reproduction" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Apache HTTPD 多后缀解析漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2021-42013/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2021-42013/README.zh-cn/" class="btn btn-xs btn-link">
        Apache HTTP Server 2.4.50 路径穿越漏洞（CVE-2021-42013）
      </a>
    </div>
    
  </div>

    

    <h1 id="apache-httpd-multiple-extension-parsing-vulnerability">Apache HTTPD Multiple Extension Parsing Vulnerability<a class="headerlink" href="#apache-httpd-multiple-extension-parsing-vulnerability" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Apache HTTPD is a widely-used HTTP server that can run PHP web pages through mod_php. This vulnerability is related to how Apache HTTPD handles files with multiple extensions.</p>
<p>Apache HTTPD supports files having multiple extensions, with different directives being executed for each extension. When misconfigured, this feature can lead to security vulnerabilities where malicious files bypass upload restrictions. For example, with the following configuration:</p>
<div class="highlight"><pre><span></span><code>AddType text/html .html
AddLanguage zh-CN .cn
AddHandler application/x-httpd-php .php
</code></pre></div>
<p>The server will process multiple extensions from left to right, and if any extension is configured to be handled by a specific handler (like PHP), it will be executed regardless of its position in the filename. This means a file named <code>malicious.php.jpg</code> would still be executed as PHP code, potentially bypassing upload restrictions that only check the final extension.</p>
<p>References:</p>
<ul>
<li><a href="https://httpd.apache.org/docs/current/content-negotiation.html#multiviews">Apache HTTP Server Documentation - MultiViews</a></li>
<li><a href="https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload">OWASP File Upload Vulnerabilities</a></li>
</ul>
<h2 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>Execute the following command to start an Apache server with PHP 7.3 environment:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<h2 id="vulnerability-reproduction">Vulnerability Reproduction<a class="headerlink" href="#vulnerability-reproduction" title="Permanent link">&para;</a></h2>
<p>First, visit <code>http://your-ip/uploadfiles/apache.php.jpeg</code> in your browser. You'll notice that despite having a <code>.jpeg</code> extension, the file is executed as PHP code and displays the phpinfo() page.</p>
<p>To actively exploit this vulnerability, visit <code>http://your-ip/index.php</code> where you'll find a file upload interface with extension whitelist validation. The upload functionality only checks the final extension but doesn't rename the uploaded file. By uploading a file with multiple extensions like <code>shell.php.jpg</code> or <code>shell.php.jpeg</code>, we can bypass the extension check while ensuring the file is still executed as PHP code by Apache.</p>
<p><img alt="Upload Interface" src="1.png" /></p>
<p>After successful upload, accessing the file through the browser will execute the PHP code, demonstrating the vulnerability:</p>
<p><img alt="Vulnerability Proof" src="2.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Apache HTTPD 多后缀解析漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2021-42013/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2021-42013/README.zh-cn/" class="btn btn-xs btn-link">
        Apache HTTP Server 2.4.50 路径穿越漏洞（CVE-2021-42013）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>