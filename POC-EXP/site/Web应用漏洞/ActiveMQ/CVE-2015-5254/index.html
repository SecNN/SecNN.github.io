<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/ActiveMQ/CVE-2015-5254/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>ActiveMQ Deserialization Vulnerability (CVE-2015-5254) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "ActiveMQ Deserialization Vulnerability (CVE-2015-5254)", url: "#_top", children: [
              {title: "Vulnerability environment", url: "#vulnerability-environment" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        ActiveMQ 反序列化漏洞（CVE-2015-5254）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2017-15709%EF%BC%89ActiveMQ%20%E4%BF%A1%E6%81%AF%E6%B3%84%E6%BC%8F%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2017-15709%EF%BC%89ActiveMQ%20%E4%BF%A1%E6%81%AF%E6%B3%84%E6%BC%8F%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2017-15709）ActiveMQ 信息泄漏漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="activemq-deserialization-vulnerability-cve-2015-5254">ActiveMQ Deserialization Vulnerability (CVE-2015-5254)<a class="headerlink" href="#activemq-deserialization-vulnerability-cve-2015-5254" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Apache ActiveMQ is an open source messaging middleware developed by the American Pachitea (Apache) Software Foundation that supports Java messaging services, clustering, Spring framework, and more.</p>
<p>Apache ActiveMQ version 5.x before the 5.13.0 security vulnerability, the vulnerability caused by the program does not limit the classes that can be serialized in the proxy. Remote attacker can make a special serialized Java Message Service (JMS) ObjectMessage objects exploit this vulnerability to execute arbitrary code.</p>
<p>Reference Links:</p>
<ul>
<li><a href="https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf">https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf</a></li>
</ul>
<h2 id="vulnerability-environment">Vulnerability environment<a class="headerlink" href="#vulnerability-environment" title="Permanent link">&para;</a></h2>
<p>Start the vulnerable environment:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After running the environment, it will establish two ports on port 61616 and 8161. Port 61616 is the working port, and messages are delivered on this port. Port 8161 is the webpage management page port. Access <code>http://your-ip:8161</code>, You can see the network management page, but this vulnerability does not require a network theoretically.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>The exploit process is as follows:</p>
<ol>
<li>Generate serialized payload (u can using ysoserial)</li>
<li>send payload to port 61616</li>
<li>Access the web management page and read the serialization messages, then u can trigger vulnerability.</li>
</ol>
<p>To exploit this environment we will use <a href="https://github.com/matthiaskaiser/jmet">jmet</a> (Java Message Exploitation Tool). First download the jar file of jmet, and create folder called <strong>external</strong> in the same directory (otherwise it may occur the error that the folder does not exist).</p>
<p>the jmet is to use ysoserial to generate Payload and send it (the jar comes with ysoserial, we don't no need to download it again), so we need to choose one that can be used in ysoserial as the gadget, such as ROME.</p>
<p>Execute:</p>
<div class="highlight"><pre><span></span><code>java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y &quot;touch /tmp/success&quot; -Yp ROME your-ip 61616
</code></pre></div>
<p><img alt="" src="1.png" /></p>
<p>At this point, a queue named event will be added to the target ActiveMQ.</p>
<p>You can visit <code>http://your-ip:8161/admin/browse.jsp?JMSDestination=Event</code> to see all messages in this queue.</p>
<p>(<strong>login / password:</strong> admin/admin):</p>
<p><img alt="" src="2.png" /></p>
<p>Click this message to trigger the command execute, this time into the container <code>docker compose exec activemq bash</code>,</p>
<p>we can see /tmp/success has been successfully created, indicating exploit successful:</p>
<p><img alt="" src="3.png" /></p>
<p>Replace the command with a reverse shell statement and reuse it:</p>
<p><img alt="" src="4.png" /></p>
<p>It's worth noting that accessing messages through the web administration page and triggering the vulnerability requires administrator privileges. In the absence of password, we can induce administrator visit our link to trigger, or disguised as legitimate messages from other services need to wait for client access when triggered.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        ActiveMQ 反序列化漏洞（CVE-2015-5254）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2017-15709%EF%BC%89ActiveMQ%20%E4%BF%A1%E6%81%AF%E6%B3%84%E6%BC%8F%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2017-15709%EF%BC%89ActiveMQ%20%E4%BF%A1%E6%81%AF%E6%B3%84%E6%BC%8F%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2017-15709）ActiveMQ 信息泄漏漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>