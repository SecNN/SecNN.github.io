<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/SaltStack/CVE-2020-11652/README.zh-cn/">
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>SaltStack 任意文件读写漏洞（CVE-2020-11652） - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "SaltStack \u4efb\u610f\u6587\u4ef6\u8bfb\u5199\u6f0f\u6d1e\uff08CVE-2020-11652\uff09", url: "#_top", children: [
              {title: "\u6f0f\u6d1e\u73af\u5883", url: "#_1" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_2" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../CVE-2020-16846/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../CVE-2020-16846/" class="btn btn-xs btn-link">
        SaltStack Command Injection Remote Code Execution (CVE-2020-16846)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../" class="btn btn-xs btn-link">
        SaltStack Arbitrary File Read and Write (CVE-2020-11652)
      </a>
    </div>
    
  </div>

    

    <h1 id="saltstack-cve-2020-11652">SaltStack 任意文件读写漏洞（CVE-2020-11652）<a class="headerlink" href="#saltstack-cve-2020-11652" title="Permanent link">&para;</a></h1>
<p>SaltStack 是基于 Python 开发的一套C/S架构配置管理工具。国外某安全团队披露了 SaltStack 存在认证绕过漏洞（CVE-2020-11651）和目录遍历漏洞（CVE-2020-11652）。</p>
<p>在 CVE-2020-11652 目录遍历漏洞中，攻击者通过构造恶意请求，可以读取、写入服务器上任意文件。</p>
<p>参考链接：</p>
<ul>
<li><a href="https://labs.f-secure.com/advisories/saltstack-authorization-bypass">https://labs.f-secure.com/advisories/saltstack-authorization-bypass</a></li>
<li><a href="https://github.com/rossengeorgiev/salt-security-backports">https://github.com/rossengeorgiev/salt-security-backports</a></li>
<li><a href="https://github.com/jasperla/CVE-2020-11651-poc">https://github.com/jasperla/CVE-2020-11651-poc</a></li>
</ul>
<h2 id="_1">漏洞环境<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>执行如下命令启动一个SaltStack Master服务：</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>环境启动后，将会在本地监听如下端口：</p>
<ul>
<li>4505/4506 这是SaltStack Master与minions通信的端口</li>
<li>8000 这是Salt的API端口</li>
<li>2222 这是容器内部的SSH服务器监听的端口</li>
</ul>
<h2 id="_2">漏洞复现<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>本文档复现CVE-2020-11652漏洞，参考漏洞作者的说明：</p>
<blockquote>
<p>The wheel module contains commands used to read and write files under specific directory paths. The inputs to these functions are concatenated with the target directory and the resulting path is not canonicalized, leading to an escape of the intended path restriction.</p>
</blockquote>
<p>wheel/file_roots.py文件中的write方法，使用<code>os.path.isabs</code>来判断用户输入是否是绝对路径，可能目的是防止写入其他目录，但实际上攻击者可以通过<code>../</code>的方式跳转至根目录，进而写入任意文件：</p>
<div class="highlight"><pre><span></span><code>msg = {
    &#39;key&#39;: root_key,
    &#39;cmd&#39;: &#39;wheel&#39;,
    &#39;fun&#39;: &#39;file_roots.write&#39;,
    &#39;path&#39;: &#39;../../path/to/target&#39;,
    &#39;data&#39;: &#39;test&#39;
#    &#39;saltenv&#39;: &#39;base&#39;,
  }
</code></pre></div>
<p>参考<a href="https://github.com/rossengeorgiev/salt-security-backports">这个项目</a>，编写一个简单的POC，写入<code>/etc/cron.d/shell</code>，利用crontab执行任意命令：</p>
<p><img alt="" src="../1.png" /></p>
<p><code>id &gt; /tmp/success</code>成功被执行。</p>
<p>也可以通过这个<a href="https://github.com/jasperla/CVE-2020-11651-poc">POC</a>来复现该漏洞。</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../CVE-2020-16846/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../CVE-2020-16846/" class="btn btn-xs btn-link">
        SaltStack Command Injection Remote Code Execution (CVE-2020-16846)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../" class="btn btn-xs btn-link">
        SaltStack Arbitrary File Read and Write (CVE-2020-11652)
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>