<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/SaltStack/CVE-2020-11652/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>SaltStack Arbitrary File Read and Write (CVE-2020-11652) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "SaltStack Arbitrary File Read and Write (CVE-2020-11652)", url: "#_top", children: [
              {title: "Environment Setup", url: "#environment-setup" },
              {title: "Vulnerability Reproduction", url: "#vulnerability-reproduction" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        SaltStack 任意文件读写漏洞（CVE-2020-11652）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2020-11651/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2020-11651/README.zh-cn/" class="btn btn-xs btn-link">
        SaltStack 信息泄露导致权限提升漏洞（CVE-2020-11651）
      </a>
    </div>
    
  </div>

    

    <h1 id="saltstack-arbitrary-file-read-and-write-cve-2020-11652">SaltStack Arbitrary File Read and Write (CVE-2020-11652)<a class="headerlink" href="#saltstack-arbitrary-file-read-and-write-cve-2020-11652" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>SaltStack is a Python-based client-server configuration management tool. A security team disclosed that SaltStack has an authentication bypass vulnerability (CVE-2020-11651) and a directory traversal vulnerability (CVE-2020-11652).</p>
<p>In the CVE-2020-11652, attackers can read and write arbitrary files on the server by constructing malicious requests.</p>
<p>References:</p>
<ul>
<li><a href="https://labs.f-secure.com/advisories/saltstack-authorization-bypass">https://labs.f-secure.com/advisories/saltstack-authorization-bypass</a></li>
<li><a href="https://github.com/rossengeorgiev/salt-security-backports">https://github.com/rossengeorgiev/salt-security-backports</a></li>
<li><a href="https://github.com/jasperla/CVE-2020-11651-poc">https://github.com/jasperla/CVE-2020-11651-poc</a></li>
</ul>
<h2 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>Execute the following command to start a SaltStack Master service 2019.2.3:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the environment starts, the following ports will be listening:</p>
<ul>
<li>4505/4506: These are the ports for communication between SaltStack Master and minions</li>
<li>8000: This is the Salt API port</li>
<li>2222: This is the SSH server port inside the container</li>
</ul>
<h2 id="vulnerability-reproduction">Vulnerability Reproduction<a class="headerlink" href="#vulnerability-reproduction" title="Permanent link">&para;</a></h2>
<p>This document demonstrates the CVE-2020-11652 vulnerability, referring to the vulnerability author's explanation:</p>
<blockquote>
<p>The wheel module contains commands used to read and write files under specific directory paths. The inputs to these functions are concatenated with the target directory and the resulting path is not canonicalized, leading to an escape of the intended path restriction.</p>
</blockquote>
<p>The write method in wheel/file_roots.py uses <code>os.path.isabs</code> to check if the user input is an absolute path, possibly to prevent writing to other directories. However, attackers can actually use <code>../</code> to traverse to the root directory and write arbitrary files:</p>
<div class="highlight"><pre><span></span><code>msg = {
    &#39;key&#39;: root_key,
    &#39;cmd&#39;: &#39;wheel&#39;,
    &#39;fun&#39;: &#39;file_roots.write&#39;,
    &#39;path&#39;: &#39;../../path/to/target&#39;,
    &#39;data&#39;: &#39;test&#39;
#    &#39;saltenv&#39;: &#39;base&#39;,
  }
</code></pre></div>
<p>Referring to <a href="https://github.com/rossengeorgiev/salt-security-backports">this project</a>, we can write a simple POC to write to <code>/etc/cron.d/shell</code> and use crontab to execute arbitrary commands:</p>
<p><img alt="" src="1.png" /></p>
<p><code>id &gt; /tmp/success</code> was successfully executed.</p>
<p>You can also use this <a href="https://github.com/jasperla/CVE-2020-11651-poc">POC</a> to reproduce the vulnerability.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        SaltStack 任意文件读写漏洞（CVE-2020-11652）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2020-11651/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2020-11651/README.zh-cn/" class="btn btn-xs btn-link">
        SaltStack 信息泄露导致权限提升漏洞（CVE-2020-11651）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>