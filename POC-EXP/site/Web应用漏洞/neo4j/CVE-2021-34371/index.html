<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/neo4j/CVE-2021-34371/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Neo4j Shell Server setSessionVariable Deserialization (CVE-2021-34371) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Neo4j Shell Server setSessionVariable Deserialization (CVE-2021-34371)", url: "#_top", children: [
              {title: "Vulnerable Environment", url: "#vulnerable-environment" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Neo4j Shell Server 反序列化漏洞（CVE-2021-34371）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../mysql2/mysql2%E5%8E%9F%E5%9E%8B%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%28CVE-2024-21512%29/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../mysql2/mysql2%E5%8E%9F%E5%9E%8B%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%28CVE-2024-21512%29/" class="btn btn-xs btn-link">
        mysql2原型污染漏洞(CVE 2024 21512)
      </a>
    </div>
    
  </div>

    

    <h1 id="neo4j-shell-server-setsessionvariable-deserialization-cve-2021-34371">Neo4j Shell Server <code>setSessionVariable</code> Deserialization (CVE-2021-34371)<a class="headerlink" href="#neo4j-shell-server-setsessionvariable-deserialization-cve-2021-34371" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Neo4j is a graph database management system developed by Neo4j, Inc.</p>
<p>Neo4j through 3.4.18 (with the shell server enabled) exposes an RMI service that arbitrarily deserializes Java objects, e.g., through setSessionVariable. An attacker can abuse this for remote code execution because there are dependencies with exploitable gadget chains.</p>
<p>Neo4j Shell is replaced by Cyber Shell after Neo4j 3.5.</p>
<p>References:</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/50170">https://www.exploit-db.com/exploits/50170</a></li>
<li><a href="https://github.com/mozilla/rhino/issues/520">https://github.com/mozilla/rhino/issues/520</a></li>
</ul>
<h2 id="vulnerable-environment">Vulnerable Environment<a class="headerlink" href="#vulnerable-environment" title="Permanent link">&para;</a></h2>
<p>If you are using Linux or OSX, you can execute the following command to start a Neo4j 3.4.18:</p>
<div class="highlight"><pre><span></span><code>TARGET_IP=&lt;your-ip&gt; docker compose up -d
</code></pre></div>
<p>Environment <code>TARGET_IP</code> is a configuration to describe the Neo4j's hostname.</p>
<p>If you are using Windows, update the content of <code>docker-compose.yml</code> and modify the environment manually.</p>
<p>Once the service is started, visit <code>http://your-ip:7474</code> to see the web management page, but what we need to attack is port 1337, which is the Neo4j Shell port and uses the RMI protocol to communicate.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>Sending RMI request through the <a href="rhino_gadget/">Rhino Gadget</a>:</p>
<p><img alt="" src="1.png" /></p>
<p><code>touch /tmp/success5</code> has been successfully executed:</p>
<p><img alt="" src="2.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Neo4j Shell Server 反序列化漏洞（CVE-2021-34371）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../mysql2/mysql2%E5%8E%9F%E5%9E%8B%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%28CVE-2024-21512%29/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../mysql2/mysql2%E5%8E%9F%E5%9E%8B%E6%B1%A1%E6%9F%93%E6%BC%8F%E6%B4%9E%28CVE-2024-21512%29/" class="btn btn-xs btn-link">
        mysql2原型污染漏洞(CVE 2024 21512)
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>