<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Drupal/CVE-2019-6339/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Drupal Remote Code Execution by phar deserialization (CVE-2019-6339) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Drupal Remote Code Execution by phar deserialization (CVE-2019-6339)", url: "#_top", children: [
              {title: "Environment Setup", url: "#environment-setup" },
              {title: "Vulnerability Reproduction", url: "#vulnerability-reproduction" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Drupal远程代码执行漏洞（CVE-2019-6339）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2018-7602/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2018-7602/README.zh-cn/" class="btn btn-xs btn-link">
        Drupal Drupalgeddon 3 后台远程代码执行漏洞（CVE-2018-7602）
      </a>
    </div>
    
  </div>

    

    <h1 id="drupal-remote-code-execution-by-phar-deserialization-cve-2019-6339">Drupal Remote Code Execution by phar deserialization (CVE-2019-6339)<a class="headerlink" href="#drupal-remote-code-execution-by-phar-deserialization-cve-2019-6339" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>Drupal is a free and open-source web content management framework written in PHP.</p>
<p>A remote code execution vulnerability exists in Drupal 7.x before 7.62, Drupal 8.5.x before 8.5.9 and 8.6.x before 8.6.6. The vulnerability is caused by improper handling of PHAR deserialization in the file system service, which can lead to remote code execution.</p>
<p>References:</p>
<ul>
<li><a href="https://www.drupal.org/sa-core-2019-002">https://www.drupal.org/sa-core-2019-002</a></li>
<li><a href="https://www.zerodayinitiative.com/blog/2019/4/11/a-series-of-unfortunate-images-drupal-1-click-to-rce-exploit-chain-detailed">https://www.zerodayinitiative.com/blog/2019/4/11/a-series-of-unfortunate-images-drupal-1-click-to-rce-exploit-chain-detailed</a></li>
<li><a href="https://paper.seebug.org/897/">https://paper.seebug.org/897/</a></li>
</ul>
<h2 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>Execute the following command to start a vulnerable Drupal 8.5.0 server:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the server is started, visit <code>http://your-ip:8080/</code> to access the Drupal installation page. Follow the default configuration steps to complete the installation. Since there is no MySQL environment, you can choose SQLite as the database.</p>
<h2 id="vulnerability-reproduction">Vulnerability Reproduction<a class="headerlink" href="#vulnerability-reproduction" title="Permanent link">&para;</a></h2>
<p>First, log in as an administrator and upload an avatar. The avatar image should be a specially crafted PoC file (you can refer to <a href="https://github.com/thezdi/PoC/tree/master/Drupal">thezdi/PoC</a> for the PoC):</p>
<p><img alt="1" src="1.png" /></p>
<p>By default, Drupal stores uploaded images in the <code>/sites/default/files/pictures/&lt;YYYY-MM&gt;/</code> directory and keeps their original filenames. This information is important for exploiting the vulnerability.</p>
<p>Visit <code>http://127.0.0.1:8080/admin/config/media/file-system</code> and enter the path to the previously uploaded image in the "Temporary directory" field. For example:</p>
<div class="highlight"><pre><span></span><code>phar://./sites/default/files/pictures/2019-06/blog-ZDI-CAN-7232-cat_0.jpg
</code></pre></div>
<p>Save the configuration to trigger the vulnerability. The successful exploitation will be confirmed by the execution of the malicious code:</p>
<p><img alt="2" src="2.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        Drupal远程代码执行漏洞（CVE-2019-6339）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2018-7602/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2018-7602/README.zh-cn/" class="btn btn-xs btn-link">
        Drupal Drupalgeddon 3 后台远程代码执行漏洞（CVE-2018-7602）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>