<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Wordpress/Wordpress%20%E6%8F%92%E4%BB%B6%E6%BC%8F%E6%B4%9E/%EF%BC%88CVE-2020-12462%EF%BC%89WordPress%20Plugin%20-%20Ninja%20Forms%20CSRF%20to%20XSS/">
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2020-12462）WordPress Plugin - Ninja Forms CSRF to XSS - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2020-12462\uff09WordPress Plugin - Ninja Forms CSRF to XSS", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Wordpress%20%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E/WordPress%20_%3D5.3.0%20xmlrpc.php%20%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Wordpress%20%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E/WordPress%20_%3D5.3.0%20xmlrpc.php%20%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        WordPress \&lt;=5.3.x xmlrpc.php拒绝服务漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2020-10385%EF%BC%89WordPress%20Plugin%20-%20WPForms%201.5.9%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2020-10385%EF%BC%89WordPress%20Plugin%20-%20WPForms%201.5.9%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="btn btn-xs btn-link">
        （CVE-2020-10385）WordPress Plugin - WPForms 1.5.9 储存型xss
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2020-12462wordpress-plugin-ninja-forms-csrf-to-xss">（CVE-2020-12462）WordPress Plugin - Ninja Forms CSRF to XSS<a class="headerlink" href="#cve-2020-12462wordpress-plugin-ninja-forms-csrf-to-xss" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>Ninja Forms 3.4.24.2之前的所有版本中存在一个严重的CSRF to
XSS漏洞。成功利用此漏洞可以使得攻击者将WordPress网站中启用的Ninja
Forms表单替换为包含恶意JavaScript的表单。当用户使用这些表单时触发xss漏洞。</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Ninja Forms \&lt; 3.4.24.2</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>根据漏洞披露来看，本次漏洞存在于ninja-forms\lib\NF_Upgrade.php文件
ninja_forms_ajax_import_form函数</p>
<p>在分析漏洞之前，我们先来了解下这个存在漏洞的文件是做什么用的。存在漏洞的文件名为NF_Upgrade.php，从字面意义上来看，是升级的意思，但这个文件的功能并不是如同其命名（Upgrade）那样用来升级ninja-forms插件版本，而是涉及到ninja-forms的一个特殊功能------"降级"Ninja Forms插件中存在着一个名为
"降级"的功能。使用该功能用户可以将其表单样式和功能恢复为该插件2.9.x版本</p>
<p><img alt="1.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId24.png" /></p>
<p>使用降级后，将删除目前安装的3.0版本的所有表单数据。因此该功能提示用户在使用该功能前导出表单数据。</p>
<p>从后台代码来看，点击降级按钮后，程序启用位于deprecated路径的旧版ninja-forms入口文件</p>
<p><img alt="2.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId25.png" /></p>
<p>下图是位于deprecated路径的2.x版本ninja-forms入口文件</p>
<p><img alt="3.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId26.png" /></p>
<p>作为降级功能的一部分，ninja-forms编写了NF_Upgrade.php文件，文件中AJAX函数旨在在使用"降级"模式时可以导入正常模式中导出的表单</p>
<p>在了解了NF_Upgrade.php文件存在的意义之后，接下来分析下NF_Upgrade.php文件中存在漏洞的ninja_forms_ajax_import_form函数</p>
<p><img alt="4.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId27.png" /></p>
<p>NF_Upgrade.php文件在25行处通过add_action注册了一个连接到ninja_forms_ajax_import_form函数的hook</p>
<p><img alt="5.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId28.png" /></p>
<p>因此可以通过访问如下链接来触发ninja_forms_ajax_import_form函数</p>
<p><img alt="6.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId29.png" />在了解了ninja_forms_ajax_import_form函数如何通过请求调用后，继续分析该函数</p>
<p><img alt="7.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId30.png" /></p>
<p>ninja_forms_ajax_import_form函数在27行处检验了用户权限</p>
<p><img alt="8.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId31.png" /></p>
<p>在29行处获取POST请求中import参数，在31行处获取POST请求中formID参数</p>
<p><img alt="9.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId32.png" /></p>
<p>程序在35行处将POST中提交的import参数与formID参数传入import_form函数中进行导入处理</p>
<p>ninja_forms_ajax_import_form函数的作用，从对上文代码的理解，应该是用来给管理员提供导入表单功能用的。</p>
<p>但是ninja_forms_ajax_import_form函数在安全上仅仅校验了使用者的权限，这点确实可以防止未授权访问的发生，但并未校验提交表单中的csrf
token进行校验，并不能防范csrf漏洞，因此攻击者可以构造一个恶意页面链接诱骗管理员点击，从而向Ninja
Forms插件提交一个导入恶意表单的请求。</p>
<p>ninja_forms_ajax_import_form函数接收POST传入的两个参数：import参数与formID参数，import参数中的内容是导入表单的数据，formID参数值是对应的表单id。经过实际测试发现，如果formID参数设置为一个已经存在的表单，则导入的表单内容将会覆盖原有表单。</p>
<p>在测试环境中有如下表单normal_form。攻击者可以通过查看使用该表单的页面源码来获得formID，这里normal_form的formID为2</p>
<p><img alt="10.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId33.png" /></p>
<p>normal_form是一个简单的单行文本表单</p>
<p><img alt="11.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId34.png" /></p>
<p>如果攻击者向在这个表单中插入一些恶意的js脚本，则可以在攻击时指定POST中formID为2</p>
<p>要覆盖的目标有了，但是导入的数据信息到底怎么构造呢？</p>
<p>回头看下ninja_forms_ajax_import_form函数</p>
<p><img alt="12.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId35.png" /></p>
<p>ninja_forms_ajax_import_form函数从POST请求中获取import参数，这个值就是导入模板的信息。接着程序将其传入import_form方法中进行导入处理。</p>
<p>$_POST['import']值应该是什么样子的呢？只有知道了这个值的格式，我们才好构造payload</p>
<p>经过一番搜索，位于wp-content\plugins\ninja-forms\ninja-forms.php文件中<img alt="13.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId36.png" /></p>
<p>我们可以看到如上的代码</p>
<p>可见程序通过template方法读取位于wp-content\plugins\ninja-forms\includes\Templates文件夹的formtemplate-contactform.nff文件内容，并传入import_form接口</p>
<p>formtemplate-contactform.nff文件是这个样子的</p>
<p><img alt="14.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId37.png" /></p>
<p>到这里就很好办了，.nff文件正是ninja forms插件导出表单的默认格式。</p>
<p><img alt="15.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId38.png" /></p>
<p>因此利用思路比较清晰了</p>
<ol>
<li>攻击者在本地模仿目标表单模板构造一个含有恶意代码的表单模板</li>
<li>通过ninja forms插件将其导出为.nff文件</li>
<li>构造csrf页面，该页面会在管理员访问时发起csrf攻击，使用恶意的表单模板替换原有模板</li>
<li>诱使管理员访问</li>
<li>当用户与管理员使用这个恶意表单的页面时，xss将会被触发</li>
</ol>
<p>现在已经理清利用思路，接下来构造一个恶意的.nff文件。模仿上文的normal_form表单，攻击者可以构造一个与之相似的恶意表单，与之不同的是，攻击者在描述处加入一行js脚本</p>
<p><img alt="16.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId39.png" /></p>
<p>攻击者将这个恶意的表单模板导出</p>
<p><img alt="17.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId40.png" /></p>
<p>导出的恶意表单部分内容如下</p>
<p><img alt="18.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId41.png" /></p>
<p>攻击者构造一个表单提交页面，表单提交的地址为http://<a href="http://www.0-sec.org/wordpress/wp-admin/admin-ajax.php?action=ninja">www.0-sec.org/wordpress/wp-admin/admin-ajax.php?action=ninja</a>_forms_ajax_import_form提交内容中import值为恶意文件内容、formID值为要覆盖的原normal_form的id，并诱使管理员点击页面链接</p>
<p>当攻击成功后，normal_form表单将会被恶意的表单覆盖</p>
<p>当用户使用该表单进行提交时</p>
<p><img alt="19.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId42.png" /></p>
<p>点击submit时xss被触发</p>
<p><img alt="20.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId43.png" />不仅如此，当管理员在后台管理编辑该表单时，当进入编辑页面，xss仍然可以被触发</p>
<p><img alt="21.png" src="../resource/%28CVE-2020-12462%29WordPressPlugin-NinjaFormsCSRFtoXSS/media/rId44.png" /></p>
<h2 id="_4">参考链接<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://xz.aliyun.com/t/7768">https://xz.aliyun.com/t/7768</a>#toc-0</p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Wordpress%20%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E/WordPress%20_%3D5.3.0%20xmlrpc.php%20%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Wordpress%20%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E/WordPress%20_%3D5.3.0%20xmlrpc.php%20%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        WordPress \&lt;=5.3.x xmlrpc.php拒绝服务漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2020-10385%EF%BC%89WordPress%20Plugin%20-%20WPForms%201.5.9%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2020-10385%EF%BC%89WordPress%20Plugin%20-%20WPForms%201.5.9%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="btn btn-xs btn-link">
        （CVE-2020-10385）WordPress Plugin - WPForms 1.5.9 储存型xss
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>